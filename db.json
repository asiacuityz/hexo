{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"themes/hexo-theme-matery/source/favicon.png","path":"favicon.png","modified":0,"renderable":1},{"_id":"source/images/Linux/linux目录结构.png","path":"images/Linux/linux目录结构.png","modified":0,"renderable":0},{"_id":"source/images/idea/1548208510812.png","path":"images/idea/1548208510812.png","modified":0,"renderable":0},{"_id":"source/images/git/Git流.png","path":"images/git/Git流.png","modified":0,"renderable":0},{"_id":"source/images/zookeeper/0a3e0527ec7a4dcdbbd5597d20d77fe3.jpg","path":"images/zookeeper/0a3e0527ec7a4dcdbbd5597d20d77fe3.jpg","modified":0,"renderable":0},{"_id":"source/images/zookeeper/13c3e24881a7471cb180590d884568ba.jpg","path":"images/zookeeper/13c3e24881a7471cb180590d884568ba.jpg","modified":0,"renderable":0},{"_id":"source/images/zookeeper/6102d866d5e14718958b2a0ab193e9ea.jpg","path":"images/zookeeper/6102d866d5e14718958b2a0ab193e9ea.jpg","modified":0,"renderable":0},{"_id":"source/images/zookeeper/f04752a7eb974518b9221e509f14cc00.jpg","path":"images/zookeeper/f04752a7eb974518b9221e509f14cc00.jpg","modified":0,"renderable":0},{"_id":"source/images/zookeeper/ff857235dba54561a41ff49bbea15795.jpg","path":"images/zookeeper/ff857235dba54561a41ff49bbea15795.jpg","modified":0,"renderable":0},{"_id":"source/images/微服务/952935-20170623150643570-1733575926.png","path":"images/微服务/952935-20170623150643570-1733575926.png","modified":0,"renderable":0},{"_id":"themes/hexo-theme-matery/source/css/gitment.css","path":"css/gitment.css","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/js/matery.js","path":"js/matery.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/css/my-gitalk.css","path":"css/my-gitalk.css","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/css/matery.css","path":"css/matery.css","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/css/my.css","path":"css/my.css","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/js/search.js","path":"js/search.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/avatar.jpg","path":"medias/avatar.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/logo.png","path":"medias/logo.png","modified":0,"renderable":1},{"_id":"source/images/zookeeper/zkservice.jpg","path":"images/zookeeper/zkservice.jpg","modified":0,"renderable":0},{"_id":"source/images/跨域/clipboard.png","path":"images/跨域/clipboard.png","modified":0,"renderable":0},{"_id":"source/images/道/926638-20171117190525546-1072349257.png","path":"images/道/926638-20171117190525546-1072349257.png","modified":0,"renderable":0},{"_id":"source/images/道/926638-20171117190609421-1278140860.png","path":"images/道/926638-20171117190609421-1278140860.png","modified":0,"renderable":0},{"_id":"source/images/道/926638-20171117190819921-1868250278.png","path":"images/道/926638-20171117190819921-1868250278.png","modified":0,"renderable":0},{"_id":"source/images/道/926638-20171117190914734-312299182.png","path":"images/道/926638-20171117190914734-312299182.png","modified":0,"renderable":0},{"_id":"source/images/道/926638-20171117191245265-301978953.png","path":"images/道/926638-20171117191245265-301978953.png","modified":0,"renderable":0},{"_id":"themes/hexo-theme-matery/source/libs/aos/aos.js","path":"libs/aos/aos.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/cryptojs/crypto-js.min.js","path":"libs/cryptojs/crypto-js.min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/aos/aos.css","path":"libs/aos/aos.css","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/jqcloud/jqcloud-1.0.4.min.js","path":"libs/jqcloud/jqcloud-1.0.4.min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/gitalk/gitalk.css","path":"libs/gitalk/gitalk.css","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/jqcloud/jqcloud.css","path":"libs/jqcloud/jqcloud.css","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/gitment/gitment-default.css","path":"libs/gitment/gitment-default.css","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/animate/animate.min.css","path":"libs/animate/animate.min.css","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/masonry/masonry.pkgd.min.js","path":"libs/masonry/masonry.pkgd.min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/scrollprogress/scrollProgress.min.js","path":"libs/scrollprogress/scrollProgress.min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/tocbot/tocbot.css","path":"libs/tocbot/tocbot.css","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/others/clicklove.js","path":"libs/others/clicklove.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/tocbot/tocbot.min.js","path":"libs/tocbot/tocbot.min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/15.jpg","path":"medias/featureimages/15.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/16.jpg","path":"medias/featureimages/16.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/22.jpg","path":"medias/featureimages/22.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/7.jpg","path":"medias/featureimages/7.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/cover.jpg","path":"medias/cover.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/reward/alipay.jpg","path":"medias/reward/alipay.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/reward/wechat.png","path":"medias/reward/wechat.png","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/gitment/gitment.js","path":"libs/gitment/gitment.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/jquery/jquery-2.2.0.min.js","path":"libs/jquery/jquery-2.2.0.min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/0.jpg","path":"medias/featureimages/0.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/1.jpg","path":"medias/featureimages/1.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/valine/Valine.min.js","path":"libs/valine/Valine.min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/11.jpg","path":"medias/featureimages/11.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/14.jpg","path":"medias/featureimages/14.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/10.jpg","path":"medias/featureimages/10.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/12.jpg","path":"medias/featureimages/12.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/19.jpg","path":"medias/featureimages/19.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/2.jpg","path":"medias/featureimages/2.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/20.jpg","path":"medias/featureimages/20.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/21.jpg","path":"medias/featureimages/21.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/13.jpg","path":"medias/featureimages/13.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/23.jpg","path":"medias/featureimages/23.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/4.jpg","path":"medias/featureimages/4.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/5.jpg","path":"medias/featureimages/5.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/17.jpg","path":"medias/featureimages/17.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/18.jpg","path":"medias/featureimages/18.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/6.jpg","path":"medias/featureimages/6.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/3.jpg","path":"medias/featureimages/3.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/8.jpg","path":"medias/featureimages/8.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/9.jpg","path":"medias/featureimages/9.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/awesome/css/font-awesome.min.css","path":"libs/awesome/css/font-awesome.min.css","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/fonts/lg.eot","path":"libs/lightGallery/fonts/lg.eot","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/fonts/lg.svg","path":"libs/lightGallery/fonts/lg.svg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/img/loading.gif","path":"libs/lightGallery/img/loading.gif","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/fonts/lg.ttf","path":"libs/lightGallery/fonts/lg.ttf","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/fonts/lg.woff","path":"libs/lightGallery/fonts/lg.woff","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/css/lightgallery.min.css","path":"libs/lightGallery/css/lightgallery.min.css","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/img/vimeo-play.png","path":"libs/lightGallery/img/vimeo-play.png","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/img/video-play.png","path":"libs/lightGallery/img/video-play.png","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/img/youtube-play.png","path":"libs/lightGallery/img/youtube-play.png","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/share/css/share.min.css","path":"libs/share/css/share.min.css","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/share/fonts/iconfont.eot","path":"libs/share/fonts/iconfont.eot","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/share/fonts/iconfont.svg","path":"libs/share/fonts/iconfont.svg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/share/fonts/iconfont.ttf","path":"libs/share/fonts/iconfont.ttf","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/share/fonts/iconfont.woff","path":"libs/share/fonts/iconfont.woff","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/banner/0.jpg","path":"medias/banner/0.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/valine/av-min.js","path":"libs/valine/av-min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/banner/5.jpg","path":"medias/banner/5.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/banner/2.jpg","path":"medias/banner/2.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/share/js/jquery.share.min.js","path":"libs/share/js/jquery.share.min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/share/js/social-share.min.js","path":"libs/share/js/social-share.min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/banner/6.jpg","path":"medias/banner/6.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/materialize/js/materialize.min.js","path":"libs/materialize/js/materialize.min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/banner/1.jpg","path":"medias/banner/1.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/banner/3.jpg","path":"medias/banner/3.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/awesome/fonts/FontAwesome.otf","path":"libs/awesome/fonts/FontAwesome.otf","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/gitalk/gitalk.min.js","path":"libs/gitalk/gitalk.min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/awesome/fonts/fontawesome-webfont.woff","path":"libs/awesome/fonts/fontawesome-webfont.woff","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/awesome/fonts/fontawesome-webfont.woff2","path":"libs/awesome/fonts/fontawesome-webfont.woff2","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/js/lightgallery-all.min.js","path":"libs/lightGallery/js/lightgallery-all.min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/materialize/font/material-design-icons/Material-Design-Icons.woff2","path":"libs/materialize/font/material-design-icons/Material-Design-Icons.woff2","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/materialize/font/roboto/Roboto-Bold.eot","path":"libs/materialize/font/roboto/Roboto-Bold.eot","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/materialize/font/roboto/Roboto-Light.eot","path":"libs/materialize/font/roboto/Roboto-Light.eot","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/materialize/font/material-design-icons/LICENSE.txt","path":"libs/materialize/font/material-design-icons/LICENSE.txt","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/materialize/font/roboto/Roboto-Light.woff2","path":"libs/materialize/font/roboto/Roboto-Light.woff2","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/materialize/font/roboto/Roboto-Regular.eot","path":"libs/materialize/font/roboto/Roboto-Regular.eot","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/materialize/font/roboto/Roboto-Light.woff","path":"libs/materialize/font/roboto/Roboto-Light.woff","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/materialize/font/roboto/Roboto-Medium.eot","path":"libs/materialize/font/roboto/Roboto-Medium.eot","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/materialize/css/materialize.min.css","path":"libs/materialize/css/materialize.min.css","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/materialize/font/roboto/Roboto-Thin.eot","path":"libs/materialize/font/roboto/Roboto-Thin.eot","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/materialize/font/roboto/Roboto-Thin.woff","path":"libs/materialize/font/roboto/Roboto-Thin.woff","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/materialize/font/material-design-icons/Material-Design-Icons.woff","path":"libs/materialize/font/material-design-icons/Material-Design-Icons.woff","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/materialize/font/roboto/Roboto-Bold.woff2","path":"libs/materialize/font/roboto/Roboto-Bold.woff2","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/materialize/font/roboto/Roboto-Medium.woff","path":"libs/materialize/font/roboto/Roboto-Medium.woff","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/materialize/font/roboto/Roboto-Medium.woff2","path":"libs/materialize/font/roboto/Roboto-Medium.woff2","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/materialize/font/roboto/Roboto-Bold.woff","path":"libs/materialize/font/roboto/Roboto-Bold.woff","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/materialize/font/roboto/Roboto-Regular.woff2","path":"libs/materialize/font/roboto/Roboto-Regular.woff2","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/materialize/font/roboto/Roboto-Regular.woff","path":"libs/materialize/font/roboto/Roboto-Regular.woff","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/materialize/font/roboto/Roboto-Thin.woff2","path":"libs/materialize/font/roboto/Roboto-Thin.woff2","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/banner/4.jpg","path":"medias/banner/4.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/materialize/font/roboto/Roboto-Bold.ttf","path":"libs/materialize/font/roboto/Roboto-Bold.ttf","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/materialize/font/roboto/Roboto-Light.ttf","path":"libs/materialize/font/roboto/Roboto-Light.ttf","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/materialize/font/roboto/Roboto-Regular.ttf","path":"libs/materialize/font/roboto/Roboto-Regular.ttf","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/awesome/fonts/fontawesome-webfont.eot","path":"libs/awesome/fonts/fontawesome-webfont.eot","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/materialize/font/roboto/Roboto-Medium.ttf","path":"libs/materialize/font/roboto/Roboto-Medium.ttf","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/materialize/font/material-design-icons/Material-Design-Icons.ttf","path":"libs/materialize/font/material-design-icons/Material-Design-Icons.ttf","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/awesome/fonts/fontawesome-webfont.ttf","path":"libs/awesome/fonts/fontawesome-webfont.ttf","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/materialize/font/material-design-icons/Material-Design-Icons.eot","path":"libs/materialize/font/material-design-icons/Material-Design-Icons.eot","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/materialize/font/roboto/Roboto-Thin.ttf","path":"libs/materialize/font/roboto/Roboto-Thin.ttf","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/materialize/font/material-design-icons/Material-Design-Icons.svg","path":"libs/materialize/font/material-design-icons/Material-Design-Icons.svg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/awesome/fonts/fontawesome-webfont.svg","path":"libs/awesome/fonts/fontawesome-webfont.svg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/echarts/echarts.min.js","path":"libs/echarts/echarts.min.js","modified":0,"renderable":1}],"Cache":[{"_id":"themes/hexo-theme-matery/_config.yml","hash":"7652e0f39ba1398e2b8df2b36693129c71568d2b","modified":1549942254848},{"_id":"themes/hexo-theme-matery/LICENSE","hash":"b314c7ebb7d599944981908b7f3ed33a30e78f3a","modified":1546423011250},{"_id":"themes/hexo-theme-matery/README_CN.md","hash":"4dc638bacc50b90fba39a3c7eadd5c01dcbd52c3","modified":1546423011264},{"_id":"themes/hexo-theme-matery/README.md","hash":"1bec48f672ec9a1f92b3b333cc99b94a52d4dc43","modified":1546423011259},{"_id":"source/_discarded/hello-world.md","hash":"df0d3fdc800eb53503012740e97cde34172b9972","modified":1546423011148},{"_id":"source/_posts/GitHub搭建Hexo.md","hash":"d91452bfa7f1f373ebfa00ddaaa191d408e12915","modified":1549942255531},{"_id":"source/_posts/Git流.md","hash":"47db312923458923e1a66b6beb84a3f7f81421f2","modified":1547105326181},{"_id":"source/_posts/Eureka配置大全.md","hash":"fedcc7c4d579517d474e1874999fa27c10a9b768","modified":1548743753236},{"_id":"source/_posts/Java规范.md","hash":"467ddd9685d82ba7a80e47e9c2a1a9a8826a0395","modified":1546931794023},{"_id":"source/_posts/JNI-加载本地dll类库.md","hash":"4890ec087422baffc757339ed24607db3da67ad4","modified":1546423011164},{"_id":"source/_posts/Js模板.md","hash":"820e2d145ebd596f52d53408e8ade7660c2c037d","modified":1547776465779},{"_id":"source/_posts/Linux命令.md","hash":"d46319b153024e26ef1e9160fa7477e3fb6cd524","modified":1547775558285},{"_id":"source/_posts/Linux目录结构.md","hash":"b075212c5699397761e17986d1e6a8f1aa23517d","modified":1547776164747},{"_id":"source/_posts/Maven依赖机制.md","hash":"45e04a21ea3f5b7d072948aaba7cea0d7319ed40","modified":1547544862342},{"_id":"source/_posts/RESTful-API-的幂等性.md","hash":"9888f7ff74f678d403bf2890b0be8e88c24fcfe0","modified":1547774600578},{"_id":"source/_posts/Mysql命令.md","hash":"43754a5670c28e201d03dbd0ff754b3b6604e4aa","modified":1547013062263},{"_id":"source/_posts/SnowFlake雪花算法.md","hash":"add5bf7d83842968e7e745b21f614d4960199444","modified":1548122758044},{"_id":"source/_posts/Spring-Boot-Starts模块依赖详解.md","hash":"69b1abad28b3d12d107272939daec8700710db73","modified":1548671041216},{"_id":"source/_posts/Session一致性.md","hash":"7a39b7ad3ca4368bb1edd82a49dd14e501aebce7","modified":1546925327418},{"_id":"source/_posts/Spring-Boot配置拦截器和过滤器.md","hash":"01682a156a8d96cade31e1899d38bc3362ae8dbf","modified":1547617771824},{"_id":"source/_posts/Java开发知名网站.md","hash":"aa443a2be45dda154fe307d1b0059bcce0d016c5","modified":1547791837310},{"_id":"source/_posts/Spring-Boot默认配置源码.md","hash":"7f04b6cf3c3a1fc20870a461954b1ac7ca3e81b2","modified":1546423011168},{"_id":"source/_posts/SpringBoot常用注解大全.md","hash":"84c8ff1f7c8398ce12e119f2e29363ff47ba5fba","modified":1548035371112},{"_id":"source/_posts/Swagger的集成和使用.md","hash":"50c4f354b954a956c64d5dcb90af77f6a3d9e77b","modified":1548301349808},{"_id":"source/_posts/ZooKeeper介绍.md","hash":"83d434ca2f899f68735ad14614e254a4d7d7cfae","modified":1548654978326},{"_id":"source/_posts/idea同步配置到Git.md","hash":"88e143fba29401a7af2331a1e3391751c1e5a593","modified":1548208763857},{"_id":"source/_posts/XML工具类.md","hash":"2eda96e782c472db646109c2e6cf18172249ac33","modified":1546423011172},{"_id":"source/_posts/事务管理入门.md","hash":"d069854a5a3d20c5d321a709540a139b5f420843","modified":1548121968362},{"_id":"source/_posts/分布式锁的场景与实现.md","hash":"b9b44f2360765cb2262c235392e30c4de20c3ec8","modified":1546936521537},{"_id":"source/_posts/正则表达式.md","hash":"cacda4c17da619ac43290783fd2aa04f2e1b0c62","modified":1547791364492},{"_id":"source/_posts/设计一个良好的-API.md","hash":"577c8b6a81b610dbf7e1cf24e87da42b13c36da9","modified":1548324579807},{"_id":"source/_posts/解决-Maven-无法自动下载依赖的问题.md","hash":"fa00b98750774d1331795ec66de992d9ddae64bc","modified":1547544445256},{"_id":"source/_posts/示例.md","hash":"4bd96b1df99d29081f2e01f0267f1c7957fb4595","modified":1546423011189},{"_id":"source/_posts/跨域解决方案.md","hash":"2dc02bc20026209000c174dc8d7f27ee227bd7e1","modified":1547777558131},{"_id":"source/about/index.md","hash":"d1d00b8bc3e17e9d878417c9fbd2ee13977eb196","modified":1546423011211},{"_id":"source/_posts/期工具类.md","hash":"5a6b21b1183650f5e14c26d3035b1ea4b2d59641","modified":1546423011183},{"_id":"source/doc/index.md","hash":"7b31f6ca5907de64c5b2c1aec2f4ac8ae0831e4c","modified":1548036211493},{"_id":"source/categories/index.md","hash":"355927f9760314dc429baed60bd61b0344cf69d6","modified":1549942255314},{"_id":"source/utils/index.md","hash":"9063adfc03defd61873f95c822f0e51b1a4aa8b6","modified":1549942255053},{"_id":"source/friends/index.md","hash":"759c3f98d3608fff979bde11d00e745bc741cf04","modified":1546423011228},{"_id":"source/tags/index.md","hash":"dc487abf9c0a5f5c6fd8efd9f19897ef073f20f8","modified":1546423011234},{"_id":"source/_posts/配置MyBatis Redis 二级缓存.md","hash":"35f3b44c68400e78f484339a743cc264951c88fe","modified":1546423011199},{"_id":"themes/hexo-theme-matery/languages/zh-CN.yml","hash":"5dde7c7a85fa08ffabd593943c6e0be87d01c0fd","modified":1546423011284},{"_id":"themes/hexo-theme-matery/languages/default.yml","hash":"7b9308cce14317c1685f3fede3c59ca29e70b577","modified":1546423011280},{"_id":"themes/hexo-theme-matery/layout/about.ejs","hash":"0a8942e2fa070d7d08ef0779267e1e05ff8e3065","modified":1546423011525},{"_id":"themes/hexo-theme-matery/layout/archive.ejs","hash":"76bbb94fd35870699b7a9741b2eafd2df4275506","modified":1546423011534},{"_id":"themes/hexo-theme-matery/layout/categories.ejs","hash":"c431e772d0f7700592228bbd9502793bdc28a893","modified":1546423011539},{"_id":"themes/hexo-theme-matery/layout/layout.ejs","hash":"3c9987fa0ae189b6a054e5cfce610e1c421c2f54","modified":1546423011569},{"_id":"themes/hexo-theme-matery/layout/post.ejs","hash":"caa7f0c717560423e7e993cf2d6952b450139f75","modified":1546423011574},{"_id":"themes/hexo-theme-matery/layout/tag.ejs","hash":"c9589d0e192910550decfcf962c896aca7254db5","modified":1546423011578},{"_id":"themes/hexo-theme-matery/layout/tags.ejs","hash":"851c0ee599e91e7b1d657673859e8b6ff79cf50b","modified":1546423011585},{"_id":"themes/hexo-theme-matery/layout/category.ejs","hash":"2a414afa71f94edba24851c0732c884d1f163f13","modified":1546423011543},{"_id":"themes/hexo-theme-matery/layout/friends.ejs","hash":"b5ebe0ce1f08e6c5f417a55a6e98c728d35019c1","modified":1546423011552},{"_id":"themes/hexo-theme-matery/layout/index.ejs","hash":"e4a9d2892dcce4b599c6c0a253caf10e4d0f9cd6","modified":1546423011563},{"_id":"themes/hexo-theme-matery/source/favicon.png","hash":"20674c497b75fc889194b47fd18ecea12303d8ec","modified":1546423011620},{"_id":"source/images/Linux/linux目录结构.png","hash":"d11b3a4677c6a1112f89bbc2615bfcbd4949be7f","modified":1547775835668},{"_id":"source/images/idea/1548208510812.png","hash":"6505d3e1201c32a9c2190c0cef0bdefc33da293c","modified":1548208510879},{"_id":"source/images/git/Git流.png","hash":"34f1f799b96acfb9e1f86998ea6492ed430c8d05","modified":1547027706689},{"_id":"source/images/zookeeper/0a3e0527ec7a4dcdbbd5597d20d77fe3.jpg","hash":"f2472dda27983da8c887adb334422e5b2e489d20","modified":1548651600937},{"_id":"source/images/zookeeper/13c3e24881a7471cb180590d884568ba.jpg","hash":"01821b057a2ca998a17a17a631da819e4875ca6e","modified":1548651798857},{"_id":"source/images/zookeeper/6102d866d5e14718958b2a0ab193e9ea.jpg","hash":"71cae9ca5580f344aaba493277058a9f309881fd","modified":1548651919890},{"_id":"source/images/zookeeper/f04752a7eb974518b9221e509f14cc00.jpg","hash":"a226c4537f6417af62de571f38ca0faae6e012b8","modified":1548651970821},{"_id":"source/images/zookeeper/ff857235dba54561a41ff49bbea15795.jpg","hash":"5e1945911913ff6db79b0f8042bb2cf66b790c58","modified":1548651679192},{"_id":"source/images/微服务/952935-20170623150643570-1733575926.png","hash":"f29a86c326147e5ffef490ff104557e4ff207dc5","modified":1548671239156},{"_id":"themes/hexo-theme-matery/layout/_partial/back-top.ejs","hash":"cb99dc352397ec5d0765794d7b8884972e61973b","modified":1546423011296},{"_id":"themes/hexo-theme-matery/layout/_partial/footer.ejs","hash":"0379679839f91a4fe9f18d4cd048251e84a9ddb2","modified":1546423011310},{"_id":"themes/hexo-theme-matery/layout/_partial/disqus.ejs","hash":"42dda8e67f7f09d148347887e52f18aea546df26","modified":1546423011305},{"_id":"themes/hexo-theme-matery/layout/_partial/google-analytics.ejs","hash":"890c8f04c1f4905dfceb3ea9fd6efdd040d79c01","modified":1546423011339},{"_id":"themes/hexo-theme-matery/layout/_partial/gitment.ejs","hash":"d8c40dbc8106b5bc53ceb727ad968c1d8f234261","modified":1546423011333},{"_id":"themes/hexo-theme-matery/layout/_partial/github-link.ejs","hash":"fd4034bca2eb3987dcf113e6477260bee97eb1e7","modified":1546423011324},{"_id":"themes/hexo-theme-matery/layout/_partial/gitalk.ejs","hash":"2f2f19ff29862ce056f2ed909f0f0b6b57b4c0bb","modified":1546423011320},{"_id":"themes/hexo-theme-matery/layout/_partial/bg-cover.ejs","hash":"023d6f717390452d6de4a1da8797b8891a591e5e","modified":1546423011300},{"_id":"themes/hexo-theme-matery/layout/_partial/head.ejs","hash":"27952311e17475ae5ce4d8d462458bcbac3bf620","modified":1546423011348},{"_id":"themes/hexo-theme-matery/layout/_partial/header.ejs","hash":"b05d20668c396116b7375ed469e2c62860722ba6","modified":1546423011354},{"_id":"themes/hexo-theme-matery/layout/_partial/navigation.ejs","hash":"c63ec2d1eb6d804347c590dac662bb5af5bc8b03","modified":1546423011369},{"_id":"themes/hexo-theme-matery/layout/_partial/livere.ejs","hash":"42728561c09589f79b698eb059ab4def53ed3642","modified":1546423011359},{"_id":"themes/hexo-theme-matery/layout/_partial/mobile-nav.ejs","hash":"dec427f2b87b4d281faa963d5a224de861bb4283","modified":1546423011363},{"_id":"themes/hexo-theme-matery/layout/_partial/paging.ejs","hash":"dfdeea9c59d157acb851d4bf44bf95f81787523c","modified":1546423011373},{"_id":"themes/hexo-theme-matery/layout/_partial/post-cover.ejs","hash":"f7271dd1eb8f4fd29cc49f8f226de0b9b797e74a","modified":1546423011378},{"_id":"themes/hexo-theme-matery/layout/_partial/post-detail-toc.ejs","hash":"2fa40dc53312c76e6a20ae107cb4188b653eac47","modified":1546423011384},{"_id":"themes/hexo-theme-matery/layout/_partial/post-statis.ejs","hash":"3b42900247d5ea4ea5b68e2be44420a0d54785ad","modified":1546423011402},{"_id":"themes/hexo-theme-matery/layout/_partial/prev-next.ejs","hash":"2d72c5c2da3ae1bccd3ed5f2e691c9fc0d224e75","modified":1546423011409},{"_id":"themes/hexo-theme-matery/layout/_partial/reward.ejs","hash":"e20f68a0e099b9467ffdfbc187ece212fecef4eb","modified":1546423011416},{"_id":"themes/hexo-theme-matery/layout/_partial/search.ejs","hash":"06493fc4f3b256dd67b8399d929fa80d29de1486","modified":1546423011425},{"_id":"themes/hexo-theme-matery/layout/_partial/post-detail.ejs","hash":"4cd68764b0436d5ceb30a4546ff0013dd756392a","modified":1546423011394},{"_id":"themes/hexo-theme-matery/layout/_partial/share.ejs","hash":"0f2e1e27d21492cf228e786daead985b1e1dcea4","modified":1546423011430},{"_id":"themes/hexo-theme-matery/layout/_partial/social-link.ejs","hash":"0c4f9df3b5820d33f1c26039833977c629b6cd6a","modified":1546423011435},{"_id":"themes/hexo-theme-matery/layout/_widget/category-cloud.ejs","hash":"319587adc3a46518077af68e3558cd9c4b2d61eb","modified":1546423011453},{"_id":"themes/hexo-theme-matery/layout/_partial/valine.ejs","hash":"8671cff27aef7298b2518dd57fe0671959f21701","modified":1546423011440},{"_id":"themes/hexo-theme-matery/layout/_widget/my-gallery.ejs","hash":"441f5a685350d0a765a01596de20bcf74a52a763","modified":1546423011461},{"_id":"themes/hexo-theme-matery/layout/_widget/category-radar.ejs","hash":"f166abe86d5e4279758d48b8a6827f58c0facaaa","modified":1546423011457},{"_id":"themes/hexo-theme-matery/layout/_widget/my-projects.ejs","hash":"c7a1e65b4a75ecdbf460ea1b4fe0643fd47ec1eb","modified":1546423011471},{"_id":"themes/hexo-theme-matery/layout/_widget/my-skills.ejs","hash":"66666b851899ac0c7088f3612b993268e5cf5464","modified":1546423011477},{"_id":"themes/hexo-theme-matery/layout/_widget/recommend.ejs","hash":"47730e36f2694c976838dd59d982e021743ca8c7","modified":1546423011509},{"_id":"themes/hexo-theme-matery/layout/_widget/post-calendar.ejs","hash":"7bb46650940dc7265a9331536b722754d1d3d53a","modified":1546423011484},{"_id":"themes/hexo-theme-matery/layout/_widget/tag-cloud.ejs","hash":"468a8419f2af3baff2dda2e3fab9461804a75a32","modified":1546423011514},{"_id":"themes/hexo-theme-matery/layout/_widget/post-charts.ejs","hash":"6d40e0107499dd280e5b8bc6b433a41057ce2390","modified":1546423011489},{"_id":"themes/hexo-theme-matery/layout/_widget/tag-wordcloud.ejs","hash":"0afac0d330db3053c22b3082c299aa0d8c9b1c7a","modified":1546423011518},{"_id":"themes/hexo-theme-matery/source/css/gitment.css","hash":"d5ef623065d1fbc897119f7b70ccf7563e329917","modified":1546423011595},{"_id":"themes/hexo-theme-matery/source/js/matery.js","hash":"c08f0c4d43da6c4632f31f96d3885754298bba32","modified":1546423011631},{"_id":"themes/hexo-theme-matery/source/css/my-gitalk.css","hash":"4e3e855767ac5a48b13af1d6a42df13d8975e03f","modified":1546423011610},{"_id":"themes/hexo-theme-matery/source/css/matery.css","hash":"7fdf6a8995e3f470504d3d90069a0643c9e48607","modified":1546423011604},{"_id":"themes/hexo-theme-matery/source/css/my.css","hash":"37683a9f11c68903a53e2b8593ca8c095a721896","modified":1546423011613},{"_id":"themes/hexo-theme-matery/source/js/search.js","hash":"77ecae23dd3edd8ad962c5b12954652bb2f7a1b6","modified":1546423011637},{"_id":"themes/hexo-theme-matery/source/medias/avatar.jpg","hash":"b7f8ca0c682f95d93f002c845aafbcb508ec2b0f","modified":1546423012281},{"_id":"themes/hexo-theme-matery/source/medias/logo.png","hash":"4050259723bd418648ec40028a8020364e57a6a3","modified":1546423012558},{"_id":"source/images/zookeeper/zkservice.jpg","hash":"3045c7da0e924031f16bc17b91d610a4fd043833","modified":1548651872577},{"_id":"source/images/跨域/clipboard.png","hash":"b040be5a712cf61dcc48052c5398d60301310f1e","modified":1545277093552},{"_id":"source/images/道/926638-20171117190525546-1072349257.png","hash":"6094686b441c9d226055f9107d15634a51c2dde1","modified":1546913496284},{"_id":"source/images/道/926638-20171117190609421-1278140860.png","hash":"99252c3d7e81c2bd456261fbc198f2fe001e11ba","modified":1546916987902},{"_id":"source/images/道/926638-20171117190819921-1868250278.png","hash":"0c064f5551980e02457a650480db9c78866b0c79","modified":1546917232035},{"_id":"source/images/道/926638-20171117190914734-312299182.png","hash":"eb54b2398b2ba21dcc2d3ef28fcdad1542500d7d","modified":1546917279159},{"_id":"source/images/道/926638-20171117191245265-301978953.png","hash":"1da18269d0359b25f3ad3f66f16fe9b830d9daca","modified":1546917134963},{"_id":"themes/hexo-theme-matery/source/libs/aos/aos.js","hash":"5a8e6d07ffa55642418ab3fd4b263aa08284b77a","modified":1546423011668},{"_id":"themes/hexo-theme-matery/source/libs/cryptojs/crypto-js.min.js","hash":"33810b2b757fc4327bc1d3b83bb5e0d3dc1fec5b","modified":1546423011737},{"_id":"themes/hexo-theme-matery/source/libs/aos/aos.css","hash":"ded9739f803d114c9168d3351fded72b3b478b4c","modified":1546423011658},{"_id":"themes/hexo-theme-matery/source/libs/jqcloud/jqcloud-1.0.4.min.js","hash":"26849509f196a2d21bbfd15696e5d5153163b8f1","modified":1546423011802},{"_id":"themes/hexo-theme-matery/source/libs/gitalk/gitalk.css","hash":"021898a16279ac2ffe75af4f902fab2a0a39f11a","modified":1546423011763},{"_id":"themes/hexo-theme-matery/source/libs/jqcloud/jqcloud.css","hash":"4e6538c8312aeeab845d361c37a8c1a0931241f0","modified":1546423011807},{"_id":"themes/hexo-theme-matery/source/libs/gitment/gitment-default.css","hash":"a0625d8b432af8bdc820f8768d36cde439e7257c","modified":1546423011777},{"_id":"themes/hexo-theme-matery/source/libs/animate/animate.min.css","hash":"5dfcbcee866e9dc564916416281885f3e320871e","modified":1546423011650},{"_id":"themes/hexo-theme-matery/source/libs/masonry/masonry.pkgd.min.js","hash":"f81cd7bfcf7aa2d043bd3e6077df42656fc44b82","modified":1546423011908},{"_id":"themes/hexo-theme-matery/source/libs/scrollprogress/scrollProgress.min.js","hash":"777ffe5d07e85a14fbe97d846f45ffc0087251cc","modified":1546423012178},{"_id":"themes/hexo-theme-matery/source/libs/tocbot/tocbot.css","hash":"f646f2bb75bcd1eb65b2788ac7bf15d4fd243ce9","modified":1546423012247},{"_id":"themes/hexo-theme-matery/source/libs/others/clicklove.js","hash":"6a39b8c683ba5dcd92f70c6ab45d1cfac3213e8e","modified":1546423012163},{"_id":"themes/hexo-theme-matery/source/libs/tocbot/tocbot.min.js","hash":"5ec27317f0270b8cf6b884c6f12025700b9a565c","modified":1546423012255},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/15.jpg","hash":"5cf9fc64d5d74ab6ba69bb8bff580fdc22ba32d0","modified":1546423012432},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/16.jpg","hash":"9cac6b80b0cc8959fc8aabfbd1adcab79ebebfc9","modified":1546423012438},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/22.jpg","hash":"bf5b59d193e5ca089a7fff034c222bfa2c4dc41f","modified":1546423012492},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/7.jpg","hash":"a0246a4a560438938489cdd154e35f172b3f31b0","modified":1546423012534},{"_id":"themes/hexo-theme-matery/source/medias/cover.jpg","hash":"d4957ff7cc5e88555cd840f2956ab0561e6f1ccf","modified":1546423012357},{"_id":"themes/hexo-theme-matery/source/medias/reward/alipay.jpg","hash":"1abc719b95d1b26f1f898e6b0a9b7609146e332f","modified":1546423012569},{"_id":"themes/hexo-theme-matery/source/medias/reward/wechat.png","hash":"fe93385aa92fe328e01c8221a80b039be9e4e140","modified":1546423012575},{"_id":"themes/hexo-theme-matery/source/libs/gitment/gitment.js","hash":"5a13983930b019450e4fe01a407c64b3dd316be4","modified":1546423011787},{"_id":"themes/hexo-theme-matery/source/libs/jquery/jquery-2.2.0.min.js","hash":"7a551393b8360731104fdef1af36a6f3638f5855","modified":1546423011820},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/0.jpg","hash":"2066cdda98ad0035071cd4aa7bd696eb078c0b6d","modified":1546423012366},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/1.jpg","hash":"d16e28bd23ea3a63643826dde5eea6b7a9bdda5d","modified":1546423012373},{"_id":"themes/hexo-theme-matery/source/libs/valine/Valine.min.js","hash":"6979c760beb550b681a06a8f11688f2d1591a70e","modified":1546423012267},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/11.jpg","hash":"9ed45f95b83626e3d91d6c405eb8bfe6fcb9736a","modified":1546423012391},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/14.jpg","hash":"8aeb816faca2d5eaea4cce9e881d6ff87b8c7cf1","modified":1546423012426},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/10.jpg","hash":"838e704942de076c60894d14e5f280e2724b6f68","modified":1546423012383},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/12.jpg","hash":"047be4239dd7e0be83243ee6b49a392a61f16b9a","modified":1546423012403},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/19.jpg","hash":"57bc7c804b78b5cceb4eb1f9e51b734b75151b71","modified":1546423012464},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/2.jpg","hash":"16f1d89cdba4dce935ac0f12599e0fcfda543a93","modified":1546423012471},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/20.jpg","hash":"8271c4a327632b566ea62f546c083d08a0528e72","modified":1546423012477},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/21.jpg","hash":"d70b088850c3565e5b5bb9eb8fe4abe688c964cf","modified":1546423012486},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/13.jpg","hash":"66706dfde7d910182c2f1dbadd0e9e917630b8dd","modified":1546423012411},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/23.jpg","hash":"ed5ac9f616d3b99af5188a10b1761884c37e93e5","modified":1546423012497},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/4.jpg","hash":"4eea5bdb5724ef1ed65790e481eda0d2fb176bf0","modified":1546423012515},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/5.jpg","hash":"c3c1f36a1b1886037db604f151f335cd4599e970","modified":1546423012521},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/17.jpg","hash":"f168ca5b046d10a878a7b0bcfab540e2c4428887","modified":1546423012444},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/18.jpg","hash":"ae23fdfaa59bc57b7ed49e90c5d59e4b68e1eea5","modified":1546423012457},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/6.jpg","hash":"c63ff64bdd5f6c82da8804c7248fc519d23eaf0b","modified":1546423012528},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/3.jpg","hash":"5e879652e032f02961a331b598a50b60ebe80a39","modified":1546423012503},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/8.jpg","hash":"5a46ca4ab4c4ab2101a2af77a31a8878bccc483c","modified":1546423012545},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/9.jpg","hash":"815c84778b721e3606c2bd7c099c7de7c53251ba","modified":1546423012551},{"_id":"themes/hexo-theme-matery/source/libs/awesome/css/font-awesome.min.css","hash":"88af80502c44cd52ca81ffe7dc7276b7eccb06cf","modified":1546423011675},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/fonts/lg.eot","hash":"54caf05a81e33d7bf04f2e420736ce6f1de5f936","modified":1546423011844},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/fonts/lg.svg","hash":"3480f00d284c812d623ed16a9e0ead3fb964c72e","modified":1546423011849},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/img/loading.gif","hash":"15a76af2739482d8de7354abc6d8dc4fca8d145e","modified":1546423011870},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/fonts/lg.ttf","hash":"f6421c0c397311ae09f9257aa58bcd5e9720f493","modified":1546423011859},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/fonts/lg.woff","hash":"3048de344dd5cad4624e0127e58eaae4b576f574","modified":1546423011863},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/css/lightgallery.min.css","hash":"1b7227237f9785c66062a4811508916518e4132c","modified":1546423011836},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/img/vimeo-play.png","hash":"1142b47de219dddfba2e712cd3189dec0c8b7bee","modified":1546423011885},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/img/video-play.png","hash":"fbfdbe06aebf7d0c00da175a4810cf888d128f11","modified":1546423011880},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/img/youtube-play.png","hash":"39150b45ec5fc03155b7ebeaa44f1829281788e2","modified":1546423011890},{"_id":"themes/hexo-theme-matery/source/libs/share/css/share.min.css","hash":"7126de5cec8371e580b7b1f22512da0985cc39e5","modified":1546423012187},{"_id":"themes/hexo-theme-matery/source/libs/share/fonts/iconfont.eot","hash":"00ff749c8e202401190cc98d56087cdda716abe4","modified":1546423012200},{"_id":"themes/hexo-theme-matery/source/libs/share/fonts/iconfont.svg","hash":"337b4f156f6d8f4beb32c32a3db46fef361cff74","modified":1546423012206},{"_id":"themes/hexo-theme-matery/source/libs/share/fonts/iconfont.ttf","hash":"afd898f59d363887418669520b24d175f966a083","modified":1546423012211},{"_id":"themes/hexo-theme-matery/source/libs/share/fonts/iconfont.woff","hash":"2e3fce1dcfbd6e2114e7bfbeaf72d3c62e15a1bd","modified":1546423012220},{"_id":"themes/hexo-theme-matery/source/medias/banner/0.jpg","hash":"1f2ec55fe7825475fde2601573bb622f0bf2acba","modified":1546423012297},{"_id":"themes/hexo-theme-matery/source/libs/valine/av-min.js","hash":"04c6b2782ce4610c429563110f6a20a47432fc4c","modified":1546423012274},{"_id":"themes/hexo-theme-matery/source/medias/banner/5.jpg","hash":"4a08deec1dd5b4f1490e8fc23adfb75a0f88b0c4","modified":1546423012338},{"_id":"themes/hexo-theme-matery/source/medias/banner/2.jpg","hash":"8d3c8391ff161eec70f66d69e5545a9468cc52ef","modified":1546423012311},{"_id":"themes/hexo-theme-matery/source/libs/share/js/jquery.share.min.js","hash":"16ce82901ca0e302cf47a35fb10f59009a5e7eb9","modified":1546423012228},{"_id":"themes/hexo-theme-matery/source/libs/share/js/social-share.min.js","hash":"4df722bafde2c5d8faaace0d1f894798385a8793","modified":1546423012235},{"_id":"themes/hexo-theme-matery/source/medias/banner/6.jpg","hash":"62e9586a8cec91a160f147c424a3d1d1aea360f9","modified":1546423012344},{"_id":"themes/hexo-theme-matery/source/libs/materialize/js/materialize.min.js","hash":"338a96318e7c9452cec509fcf8dea1511db660b2","modified":1546423012154},{"_id":"themes/hexo-theme-matery/source/medias/banner/1.jpg","hash":"c3d5ab183b39a7140941b8375e29498f9d24f343","modified":1546423012303},{"_id":"themes/hexo-theme-matery/source/medias/banner/3.jpg","hash":"d4957ff7cc5e88555cd840f2956ab0561e6f1ccf","modified":1546423012323},{"_id":"themes/hexo-theme-matery/source/libs/awesome/fonts/FontAwesome.otf","hash":"048707bc52ac4b6563aaa383bfe8660a0ddc908c","modified":1546423011687},{"_id":"themes/hexo-theme-matery/source/libs/gitalk/gitalk.min.js","hash":"9d5dd7e092c8eaf6266e2498cff72e6c98790a05","modified":1546423011768},{"_id":"themes/hexo-theme-matery/source/libs/awesome/fonts/fontawesome-webfont.woff","hash":"28b782240b3e76db824e12c02754a9731a167527","modified":1546423011718},{"_id":"themes/hexo-theme-matery/source/libs/awesome/fonts/fontawesome-webfont.woff2","hash":"d6f48cba7d076fb6f2fd6ba993a75b9dc1ecbf0c","modified":1546423011727},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/js/lightgallery-all.min.js","hash":"f8cd48e1fff82ecd54a7ce3e69de8dba7c92d113","modified":1546423011901},{"_id":"themes/hexo-theme-matery/source/libs/materialize/font/material-design-icons/Material-Design-Icons.woff2","hash":"2355cb4f824d070bc42c4ce6b97cab71af1f4ca2","modified":1546423011994},{"_id":"themes/hexo-theme-matery/source/libs/materialize/font/roboto/Roboto-Bold.eot","hash":"a76cd602f5188b9fbd4ba7443dcb9c064e3dbf10","modified":1546423012002},{"_id":"themes/hexo-theme-matery/source/libs/materialize/font/roboto/Roboto-Light.eot","hash":"42fe156996197e5eb0c0264c5d1bb3b4681f4595","modified":1546423012028},{"_id":"themes/hexo-theme-matery/source/libs/materialize/font/material-design-icons/LICENSE.txt","hash":"b7085b5c1dc3f56f81a8bf93290e2a3f24e4d8ed","modified":1546423011942},{"_id":"themes/hexo-theme-matery/source/libs/materialize/font/roboto/Roboto-Light.woff2","hash":"bbdc28b887400fcb340b504ec2904993af42a5d7","modified":1546423012052},{"_id":"themes/hexo-theme-matery/source/libs/materialize/font/roboto/Roboto-Regular.eot","hash":"77ae3e980ec03863ebe2587a8ef9ddfd06941db0","modified":1546423012087},{"_id":"themes/hexo-theme-matery/source/libs/materialize/font/roboto/Roboto-Light.woff","hash":"6300f659be9e834ab263efe2fb3c581d48b1e7b2","modified":1546423012045},{"_id":"themes/hexo-theme-matery/source/libs/materialize/font/roboto/Roboto-Medium.eot","hash":"1517f4b6e1c5d0e5198f937557253aac8fab0416","modified":1546423012058},{"_id":"themes/hexo-theme-matery/source/libs/materialize/css/materialize.min.css","hash":"4eaae73c0c2e342523d391057945e3c366020e3e","modified":1546423011923},{"_id":"themes/hexo-theme-matery/source/libs/materialize/font/roboto/Roboto-Thin.eot","hash":"0790a51a848dbe7292c98f9d0459218bf1a8ffdd","modified":1546423012117},{"_id":"themes/hexo-theme-matery/source/libs/materialize/font/roboto/Roboto-Thin.woff","hash":"fbc3e71d456c96667d8082ab910e3946ef89240b","modified":1546423012137},{"_id":"themes/hexo-theme-matery/source/libs/materialize/font/material-design-icons/Material-Design-Icons.woff","hash":"ee77184556f7b66fcb8ee9496f81ac62f792d7dc","modified":1546423011984},{"_id":"themes/hexo-theme-matery/source/libs/materialize/font/roboto/Roboto-Bold.woff2","hash":"933b866d09c2b087707a98dab64b3888865eeb96","modified":1546423012024},{"_id":"themes/hexo-theme-matery/source/libs/materialize/font/roboto/Roboto-Medium.woff","hash":"d45f84922131364989ad6578c7a06b6b4fc22c34","modified":1546423012075},{"_id":"themes/hexo-theme-matery/source/libs/materialize/font/roboto/Roboto-Medium.woff2","hash":"6cc1b73571af9e827c4e7e91418f476703cd4c4b","modified":1546423012080},{"_id":"themes/hexo-theme-matery/source/libs/materialize/font/roboto/Roboto-Bold.woff","hash":"ee99cd87a59a9a5d4092c83232bb3eec67547425","modified":1546423012018},{"_id":"themes/hexo-theme-matery/source/libs/materialize/font/roboto/Roboto-Regular.woff2","hash":"ed1558b0541f5e01ce48c7db1588371b990eec19","modified":1546423012111},{"_id":"themes/hexo-theme-matery/source/libs/materialize/font/roboto/Roboto-Regular.woff","hash":"74734dde8d94e7268170f9b994dedfbdcb5b3a15","modified":1546423012106},{"_id":"themes/hexo-theme-matery/source/libs/materialize/font/roboto/Roboto-Thin.woff2","hash":"2449e3dac5ddb7c3da8bb07450493b62d052758c","modified":1546423012143},{"_id":"themes/hexo-theme-matery/source/medias/banner/4.jpg","hash":"56850c3139cbd72a0eff0c35d8fac32c9c66dd6a","modified":1546423012330},{"_id":"themes/hexo-theme-matery/source/libs/materialize/font/roboto/Roboto-Bold.ttf","hash":"47327df0f35e7cd7c8645874897a7449697544ae","modified":1546423012012},{"_id":"themes/hexo-theme-matery/source/libs/materialize/font/roboto/Roboto-Light.ttf","hash":"e321c183e2b75ee19813892b7bac8d7c411cb88a","modified":1546423012039},{"_id":"themes/hexo-theme-matery/source/libs/materialize/font/roboto/Roboto-Regular.ttf","hash":"824b5480c977a8166e177e5357d13164ccc45f47","modified":1546423012098},{"_id":"themes/hexo-theme-matery/source/libs/awesome/fonts/fontawesome-webfont.eot","hash":"d980c2ce873dc43af460d4d572d441304499f400","modified":1546423011693},{"_id":"themes/hexo-theme-matery/source/libs/materialize/font/roboto/Roboto-Medium.ttf","hash":"6060ca726b9760b76f7c347dce9d2fa1fe42ec92","modified":1546423012069},{"_id":"themes/hexo-theme-matery/source/libs/materialize/font/material-design-icons/Material-Design-Icons.ttf","hash":"2cb66ac73a2d32ae8d2f807f705eff26fcf93323","modified":1546423011973},{"_id":"themes/hexo-theme-matery/source/libs/awesome/fonts/fontawesome-webfont.ttf","hash":"13b1eab65a983c7a73bc7997c479d66943f7c6cb","modified":1546423011712},{"_id":"themes/hexo-theme-matery/source/libs/materialize/font/material-design-icons/Material-Design-Icons.eot","hash":"fc1bc1337f3313ead42b22a67a142d4e0d356b3a","modified":1546423011952},{"_id":"themes/hexo-theme-matery/source/libs/materialize/font/roboto/Roboto-Thin.ttf","hash":"173ed64528b4d010a76d8d38deb1d7e7eed58eda","modified":1546423012130},{"_id":"themes/hexo-theme-matery/source/libs/materialize/font/material-design-icons/Material-Design-Icons.svg","hash":"c5ff32ccf63106152dac687395d2e3551d9fcadb","modified":1546423011965},{"_id":"themes/hexo-theme-matery/source/libs/awesome/fonts/fontawesome-webfont.svg","hash":"b5483b11f8ba213e733b5b8af9927a04fec996f6","modified":1546423011700},{"_id":"themes/hexo-theme-matery/source/libs/echarts/echarts.min.js","hash":"8789b5e4daf0029a6c88f238f10e54d01c4fce82","modified":1546423011747},{"_id":"public/search.xml","hash":"fb4d1d011788fcbc3af0417a66d9d1e81eca4e4a","modified":1549942416387},{"_id":"public/about/index.html","hash":"0819d02af625474d8c4a25fbd0ceb9c3e46c7ac9","modified":1549942417805},{"_id":"public/doc/index.html","hash":"369cf8ea19ab4626c16e9b671a126d2584e57723","modified":1549942417806},{"_id":"public/categories/index.html","hash":"af3d2e4a7e440a178bb570924cd0ba1422021a6f","modified":1549942417819},{"_id":"public/utils/index.html","hash":"988ebbd891f915f909ab2cce8819c7f5a60e43f3","modified":1549942417823},{"_id":"public/friends/index.html","hash":"dd1ef09a66b2ce909c6ad3170cd0f833bd76c995","modified":1549942417824},{"_id":"public/tags/index.html","hash":"002295d3b7ebe3878584c75b08be5fea87d35cf8","modified":1549942417825},{"_id":"public/2019/01/28/Eureka配置大全/index.html","hash":"d4bab4238f4d933cd298032cc29e8562f3568d8d","modified":1549942417825},{"_id":"public/2019/01/28/Spring-Boot-Starts模块依赖详解/index.html","hash":"12117b381d24ff53fabf8b1c33ee78a32c5b7b17","modified":1549942417825},{"_id":"public/2019/01/28/ZooKeeper介绍/index.html","hash":"2711d5212802e6457eaf03a110c9dd31b0aaa05e","modified":1549942417826},{"_id":"public/2019/01/24/Swagger的集成和使用/index.html","hash":"8cc8e73c53d6a0ead32324637bb0ebaf938974b7","modified":1549942417826},{"_id":"public/2019/01/23/idea同步配置到Git/index.html","hash":"c51a08cb07312b63f67d6ade393597a433b56f13","modified":1549942417826},{"_id":"public/2019/01/22/事务管理入门/index.html","hash":"3759e86a42e07226b1f7e5ea017ad79062275505","modified":1549942417826},{"_id":"public/2019/01/22/SnowFlake雪花算法/index.html","hash":"5c10e6857846a68839b3588ec7497da127c3c596","modified":1549942417826},{"_id":"public/2019/01/21/SpringBoot常用注解大全/index.html","hash":"e80d92c84b69e189a832bbe6b247b8bae5531f11","modified":1549942417827},{"_id":"public/2019/01/18/Java开发知名网站/index.html","hash":"612e0421d696300443c21aabdee10859d2f37535","modified":1549942417827},{"_id":"public/2019/01/18/正则表达式/index.html","hash":"9f3d21906be4cd58b24ea8c086d5f1ff6dc2039c","modified":1549942417827},{"_id":"public/2019/01/18/跨域解决方案/index.html","hash":"287887fce1383fdf4de5dc2ade07f3ec59a5a24d","modified":1549942417827},{"_id":"public/2019/01/18/Js模板/index.html","hash":"ac38b8144ba3c2f038c051a9c7bfe4aed2fea66f","modified":1549942417828},{"_id":"public/2019/01/18/Linux目录结构/index.html","hash":"5bb926f9b73b8b0f7c8a062b7a570a7bda276c24","modified":1549942417828},{"_id":"public/2019/01/18/Linux命令/index.html","hash":"a7ee006e42780b924b9bd80a683dda6f272015c5","modified":1549942417828},{"_id":"public/2019/01/18/设计一个良好的-API/index.html","hash":"75d259f4242e5453e9a772ac1d1a08342669e8bf","modified":1549942417829},{"_id":"public/2019/01/18/RESTful-API-的幂等性/index.html","hash":"104c18e9818a8347aaeafc030a33172d62f0c942","modified":1549942417829},{"_id":"public/2019/01/16/Spring-Boot配置拦截器和过滤器/index.html","hash":"eb0d931c1b807fb616ac72f97a8dfa49d69a7fd6","modified":1549942417829},{"_id":"public/2019/01/15/Maven依赖机制/index.html","hash":"fc19ae77d103d2c5e14a6ee195d156bbd47d9865","modified":1549942417829},{"_id":"public/2019/01/15/解决-Maven-无法自动下载依赖的问题/index.html","hash":"89851aa515d11a69547d2fb5aeb018a54463db67","modified":1549942417830},{"_id":"public/2019/01/09/Git流/index.html","hash":"8a445a84c8fa89fa886805cb2ecd91b0ffd824d9","modified":1549942417830},{"_id":"public/2019/01/09/Mysql命令/index.html","hash":"52d0a0033f85a5bccd176bfcce121d717bac0d96","modified":1549942417830},{"_id":"public/2019/01/08/分布式锁的场景与实现/index.html","hash":"6b41ce7fa2e750f0966bf99f64c871d07635455f","modified":1549942417831},{"_id":"public/2019/01/08/Java规范/index.html","hash":"d8f045b673336d2525570cefc692d17b04ebc9c4","modified":1549942417831},{"_id":"public/2019/01/08/Session一致性/index.html","hash":"873f9eef4f56317a76aef2789a86425b307f27b2","modified":1549942417831},{"_id":"public/2019/01/02/XML工具类/index.html","hash":"dff5b992c5bc73a3a4bd23353e4c1c83a95c0236","modified":1549942417831},{"_id":"public/2019/01/02/配置MyBatis Redis 二级缓存/index.html","hash":"8272e8e5be77189515677988bab299302db31dc7","modified":1549942417831},{"_id":"public/2018/12/31/JNI-加载本地dll类库/index.html","hash":"8e6af26fd7ad41f4df85b027650be21dff4ca2a3","modified":1549942417831},{"_id":"public/2018/12/31/期工具类/index.html","hash":"e9c7a2efa5a50e283a37d163fa0321b3b1d9c32a","modified":1549942417832},{"_id":"public/2018/12/30/Spring-Boot默认配置源码/index.html","hash":"8a83f7e7499a0027a9d18edb3bcd62af7e7d270c","modified":1549942417834},{"_id":"public/2018/12/29/GitHub搭建Hexo/index.html","hash":"77c63a6997e07f4db9b7a203659ef53ff402b4a1","modified":1549942417834},{"_id":"public/2018/12/29/示例/index.html","hash":"70a93dd211d83654c780cb814a0bea0f401c740b","modified":1549942417834},{"_id":"public/archives/index.html","hash":"49608fa8e729e219a5f1f6383efdcab1fb5afefb","modified":1549942417835},{"_id":"public/archives/page/2/index.html","hash":"bfe2356cd6d3acbc995bb624c30f8c52db6fcfc0","modified":1549942417835},{"_id":"public/archives/page/3/index.html","hash":"5900ab7fefe972ffbcd7562cf03f46f3a288dd67","modified":1549942417835},{"_id":"public/archives/2018/index.html","hash":"6eed24a1d9f42824b960087aa4ac5a4c55cf8b25","modified":1549942417835},{"_id":"public/archives/2018/12/index.html","hash":"aa3b4ceda0150b288c417d55a1bda0fd6885f5a7","modified":1549942417836},{"_id":"public/archives/2019/index.html","hash":"59022f0cb99053a360ba2d30e965241fd2227b63","modified":1549942417836},{"_id":"public/archives/2019/page/2/index.html","hash":"7399aed89119d63acf04e97a714c10eca07916a9","modified":1549942417836},{"_id":"public/archives/2019/page/3/index.html","hash":"1fb2ae6816ef37e2322bbd26ff5eca74b7282595","modified":1549942417836},{"_id":"public/archives/2019/01/index.html","hash":"76eb4eb8277a767421c4fcc971d6a7b112fe94eb","modified":1549942417837},{"_id":"public/archives/2019/01/page/2/index.html","hash":"7d86f5123079353c5d246532c5e0d91945072ac6","modified":1549942417837},{"_id":"public/archives/2019/01/page/3/index.html","hash":"186992b979d39c65181aaa3438cb379d5327dc40","modified":1549942417837},{"_id":"public/categories/Git流/index.html","hash":"51d5536563570a16522b56c713417c2d4f13f50a","modified":1549942417839},{"_id":"public/categories/GitHub搭建Hexo/index.html","hash":"83ff344a7b5691f3a00e55ae6c78002418a6cd39","modified":1549942417841},{"_id":"public/categories/JNI-加载本地dll类库/index.html","hash":"c6eaad494dc50fe89a7890325d85516134d94cf8","modified":1549942417843},{"_id":"public/categories/Js模板/index.html","hash":"e15ae728650b9f22cc6aa1100aa2df3d19e80f27","modified":1549942417843},{"_id":"public/categories/Linux命令/index.html","hash":"36459825c2dcbab079c5e51bd2a4dec03e21c3ad","modified":1549942417843},{"_id":"public/categories/Linux目录结构/index.html","hash":"0b8133b8d4c990b2309f67db1a01d72fb174cc62","modified":1549942417843},{"_id":"public/categories/Maven依赖机制/index.html","hash":"11627a891a1f0d1476eb0b764be7dd22fb75395c","modified":1549942417844},{"_id":"public/categories/RESTful-API-的幂等性/index.html","hash":"ead035021919edd76a98833d2e83056805846a49","modified":1549942417844},{"_id":"public/categories/MySQL命令/index.html","hash":"583b603a971dffd218e342b0fad7e195af548271","modified":1549942417844},{"_id":"public/categories/雪花算法/index.html","hash":"d969eecab615c0a15ec87324e8623eb4e3b742e8","modified":1549942417844},{"_id":"public/categories/Session/index.html","hash":"8f056697d3d90ce44c19448aded951f584c7cde8","modified":1549942417844},{"_id":"public/categories/学习网站/index.html","hash":"2bdc0585a0bd84cc0434c7230d6ae66d31edc583","modified":1549942417844},{"_id":"public/categories/Spring-Boot默认配置源码/index.html","hash":"a3023f957e582cf8ee353121d2b242d717e873bb","modified":1549942417845},{"_id":"public/categories/同步配置/index.html","hash":"f2644edc80c8e50cc1881e9b6b745a7e0aaecdcb","modified":1549942417845},{"_id":"public/categories/XML工具类/index.html","hash":"9e461c8f15b0d0d2662748a44b5efbd6440406da","modified":1549942417845},{"_id":"public/categories/正则/index.html","hash":"bb1b906ab207007b95d3cc8b6dd6477ec691057c","modified":1549942417845},{"_id":"public/categories/下载依赖/index.html","hash":"742b3d1e23bf8b2b2c8ecd28c5c41bdbc7e4af4e","modified":1549942417845},{"_id":"public/categories/新建文章格式/index.html","hash":"c7ce501d85e54a31054cd2c849cba5200b24dc99","modified":1549942417846},{"_id":"public/categories/跨域问题解决方案/index.html","hash":"269476238812d30aa5caef8b5c39bd0d18a40630","modified":1549942417846},{"_id":"public/categories/Spring-Boot-Starts/index.html","hash":"44edb68afac242b4ee58b41a400953286e212987","modified":1549942417847},{"_id":"public/categories/配置/index.html","hash":"1b07e5fb4aa29ad1443a0536430ffa625c1b1744","modified":1549942417847},{"_id":"public/categories/常用注解/index.html","hash":"4a4204c33c3fb08f787c38d3d13be3770181ac0e","modified":1549942417847},{"_id":"public/categories/Swagger/index.html","hash":"b60ff3d74f7d70ef887152c14e34dbc145a2e21d","modified":1549942417847},{"_id":"public/categories/事务/index.html","hash":"a09823c50f3e8a9e14acc61d07f97294c55af92c","modified":1549942417847},{"_id":"public/categories/分布式/index.html","hash":"442e91b0b1ec2e89a991f78b332e86f6c84f7ce3","modified":1549942417848},{"_id":"public/categories/设计一个良好的-API/index.html","hash":"24389a36084421599c575f8cac07ca1a424e8ad8","modified":1549942417848},{"_id":"public/categories/日期时间工具类/index.html","hash":"840996bb8a524209a56add453b081637882a3a64","modified":1549942417848},{"_id":"public/categories/Eureka/index.html","hash":"b570b1032a4d0473171c59305289ce1e560727af","modified":1549942417848},{"_id":"public/categories/Zookeeper/index.html","hash":"7ee53acf7a5c72251b4e5fe21fd00896a5d75fc0","modified":1549942417848},{"_id":"public/categories/配置-MyBatis-Redis-二级缓存/index.html","hash":"ac383675431de08b49e645afbb343b84ea8ab6d9","modified":1549942417849},{"_id":"public/categories/Java规范/index.html","hash":"39f6eb60b7d29674553edc97d37658f66b5b3f15","modified":1549942417849},{"_id":"public/page/3/index.html","hash":"2ded9eb3e25e727c139cc810781cc302c72be788","modified":1549942417850},{"_id":"public/page/2/index.html","hash":"694e1427646c384cdb2a9ea81fe8adcc2d428149","modified":1549942417850},{"_id":"public/index.html","hash":"97f02b3914beecc8708c2be026482a07e41650e0","modified":1549942417850},{"_id":"public/tags/安装教程/index.html","hash":"d9b5eee5f48069ebe4a606a7b78efe2949dd7225","modified":1549942417850},{"_id":"public/tags/Git/index.html","hash":"7d09f45eaf2470e21aafba27115162038be81f12","modified":1549942417850},{"_id":"public/tags/Java工具类/index.html","hash":"fac39f88a71646efdcf5309c0d854b5ddf4ed3c3","modified":1549942417850},{"_id":"public/tags/Js/index.html","hash":"1980d8fcb15b3cd24828aa04b65b8c031f233b73","modified":1549942417851},{"_id":"public/tags/Linux/index.html","hash":"0c10bff600440acf224f24c9bd1d8ab28c15c530","modified":1549942417851},{"_id":"public/tags/Maven/index.html","hash":"4a31eec90d42c7b951ccc7311174f6cc9cb7a2a5","modified":1549942417851},{"_id":"public/tags/RESTful/index.html","hash":"903fb905be8cd6ea03402cba13956b9a9fb195a0","modified":1549942417851},{"_id":"public/tags/MySQL/index.html","hash":"29c4ed5b6ddcbcd898b9deb25a3b5c950057ea32","modified":1549942417851},{"_id":"public/tags/道/index.html","hash":"ae637a3a5ee14f7207b0bfe3d2dd938791a78e1c","modified":1549942417852},{"_id":"public/tags/干货/index.html","hash":"43115c4bf7ac7f8a2c230c5079f4742bcac07b7a","modified":1549942417852},{"_id":"public/tags/Spring-Boot/index.html","hash":"d9974c95967ecd2e5b9ce4077161d7e3eecb4283","modified":1549942417852},{"_id":"public/tags/idea/index.html","hash":"6420471d45ac2b8e334ae9d3b15f0a571bb89407","modified":1549942417852},{"_id":"public/tags/文章/index.html","hash":"ebba3c2443d1da4041bd8672a978fa5622e6e15c","modified":1549942417852},{"_id":"public/tags/跨域/index.html","hash":"33fd6d76c46d9b28751f1e3e71da81058cb5d45d","modified":1549942417852},{"_id":"public/tags/Js工具类/index.html","hash":"1d3cdcd136adc5b5b2749c931ea6f7332e19b717","modified":1549942417853},{"_id":"public/tags/Spring-Cloud/index.html","hash":"33a39197b24b44754111ac17f2d4e4e2d14ad47f","modified":1549942417899},{"_id":"public/tags/规范/index.html","hash":"517e23f4b6c49767fc6806ef8af407a6aa105f65","modified":1549942417899},{"_id":"public/favicon.png","hash":"20674c497b75fc889194b47fd18ecea12303d8ec","modified":1549942417899},{"_id":"public/images/Linux/linux目录结构.png","hash":"d11b3a4677c6a1112f89bbc2615bfcbd4949be7f","modified":1549942417900},{"_id":"public/images/idea/1548208510812.png","hash":"6505d3e1201c32a9c2190c0cef0bdefc33da293c","modified":1549942417900},{"_id":"public/images/git/Git流.png","hash":"34f1f799b96acfb9e1f86998ea6492ed430c8d05","modified":1549942417900},{"_id":"public/images/zookeeper/0a3e0527ec7a4dcdbbd5597d20d77fe3.jpg","hash":"f2472dda27983da8c887adb334422e5b2e489d20","modified":1549942417900},{"_id":"public/images/zookeeper/13c3e24881a7471cb180590d884568ba.jpg","hash":"01821b057a2ca998a17a17a631da819e4875ca6e","modified":1549942417901},{"_id":"public/images/zookeeper/6102d866d5e14718958b2a0ab193e9ea.jpg","hash":"71cae9ca5580f344aaba493277058a9f309881fd","modified":1549942417901},{"_id":"public/images/zookeeper/f04752a7eb974518b9221e509f14cc00.jpg","hash":"a226c4537f6417af62de571f38ca0faae6e012b8","modified":1549942417901},{"_id":"public/images/zookeeper/ff857235dba54561a41ff49bbea15795.jpg","hash":"5e1945911913ff6db79b0f8042bb2cf66b790c58","modified":1549942417901},{"_id":"public/images/微服务/952935-20170623150643570-1733575926.png","hash":"f29a86c326147e5ffef490ff104557e4ff207dc5","modified":1549942417901},{"_id":"public/medias/avatar.jpg","hash":"b7f8ca0c682f95d93f002c845aafbcb508ec2b0f","modified":1549942417902},{"_id":"public/medias/logo.png","hash":"4050259723bd418648ec40028a8020364e57a6a3","modified":1549942417902},{"_id":"public/medias/featureimages/15.jpg","hash":"5cf9fc64d5d74ab6ba69bb8bff580fdc22ba32d0","modified":1549942417902},{"_id":"public/medias/featureimages/16.jpg","hash":"9cac6b80b0cc8959fc8aabfbd1adcab79ebebfc9","modified":1549942417903},{"_id":"public/medias/featureimages/22.jpg","hash":"bf5b59d193e5ca089a7fff034c222bfa2c4dc41f","modified":1549942417903},{"_id":"public/medias/featureimages/7.jpg","hash":"a0246a4a560438938489cdd154e35f172b3f31b0","modified":1549942417904},{"_id":"public/medias/reward/alipay.jpg","hash":"1abc719b95d1b26f1f898e6b0a9b7609146e332f","modified":1549942417904},{"_id":"public/medias/reward/wechat.png","hash":"fe93385aa92fe328e01c8221a80b039be9e4e140","modified":1549942417904},{"_id":"public/medias/featureimages/2.jpg","hash":"16f1d89cdba4dce935ac0f12599e0fcfda543a93","modified":1549942417905},{"_id":"public/medias/featureimages/21.jpg","hash":"d70b088850c3565e5b5bb9eb8fe4abe688c964cf","modified":1549942417905},{"_id":"public/medias/featureimages/13.jpg","hash":"66706dfde7d910182c2f1dbadd0e9e917630b8dd","modified":1549942417905},{"_id":"public/medias/featureimages/23.jpg","hash":"ed5ac9f616d3b99af5188a10b1761884c37e93e5","modified":1549942417905},{"_id":"public/medias/featureimages/5.jpg","hash":"c3c1f36a1b1886037db604f151f335cd4599e970","modified":1549942417906},{"_id":"public/medias/featureimages/8.jpg","hash":"5a46ca4ab4c4ab2101a2af77a31a8878bccc483c","modified":1549942417906},{"_id":"public/libs/lightGallery/fonts/lg.eot","hash":"54caf05a81e33d7bf04f2e420736ce6f1de5f936","modified":1549942417906},{"_id":"public/libs/lightGallery/fonts/lg.svg","hash":"3480f00d284c812d623ed16a9e0ead3fb964c72e","modified":1549942417907},{"_id":"public/libs/lightGallery/img/loading.gif","hash":"15a76af2739482d8de7354abc6d8dc4fca8d145e","modified":1549942417907},{"_id":"public/libs/lightGallery/fonts/lg.ttf","hash":"f6421c0c397311ae09f9257aa58bcd5e9720f493","modified":1549942417910},{"_id":"public/libs/lightGallery/img/vimeo-play.png","hash":"1142b47de219dddfba2e712cd3189dec0c8b7bee","modified":1549942417911},{"_id":"public/libs/lightGallery/fonts/lg.woff","hash":"3048de344dd5cad4624e0127e58eaae4b576f574","modified":1549942417911},{"_id":"public/libs/lightGallery/img/youtube-play.png","hash":"39150b45ec5fc03155b7ebeaa44f1829281788e2","modified":1549942417911},{"_id":"public/libs/lightGallery/img/video-play.png","hash":"fbfdbe06aebf7d0c00da175a4810cf888d128f11","modified":1549942417911},{"_id":"public/libs/share/fonts/iconfont.eot","hash":"00ff749c8e202401190cc98d56087cdda716abe4","modified":1549942417911},{"_id":"public/libs/share/fonts/iconfont.ttf","hash":"afd898f59d363887418669520b24d175f966a083","modified":1549942417912},{"_id":"public/libs/share/fonts/iconfont.svg","hash":"337b4f156f6d8f4beb32c32a3db46fef361cff74","modified":1549942417912},{"_id":"public/libs/share/fonts/iconfont.woff","hash":"2e3fce1dcfbd6e2114e7bfbeaf72d3c62e15a1bd","modified":1549942417912},{"_id":"public/libs/materialize/font/material-design-icons/Material-Design-Icons.woff2","hash":"2355cb4f824d070bc42c4ce6b97cab71af1f4ca2","modified":1549942417912},{"_id":"public/libs/materialize/font/roboto/Roboto-Bold.eot","hash":"a76cd602f5188b9fbd4ba7443dcb9c064e3dbf10","modified":1549942417912},{"_id":"public/libs/materialize/font/roboto/Roboto-Light.eot","hash":"42fe156996197e5eb0c0264c5d1bb3b4681f4595","modified":1549942417912},{"_id":"public/libs/materialize/font/material-design-icons/LICENSE.txt","hash":"b7085b5c1dc3f56f81a8bf93290e2a3f24e4d8ed","modified":1549942417913},{"_id":"public/libs/materialize/font/roboto/Roboto-Light.woff2","hash":"bbdc28b887400fcb340b504ec2904993af42a5d7","modified":1549942417913},{"_id":"public/libs/materialize/font/roboto/Roboto-Regular.eot","hash":"77ae3e980ec03863ebe2587a8ef9ddfd06941db0","modified":1549942417913},{"_id":"public/libs/materialize/font/roboto/Roboto-Light.woff","hash":"6300f659be9e834ab263efe2fb3c581d48b1e7b2","modified":1549942417913},{"_id":"public/libs/materialize/font/roboto/Roboto-Medium.eot","hash":"1517f4b6e1c5d0e5198f937557253aac8fab0416","modified":1549942417914},{"_id":"public/libs/materialize/font/roboto/Roboto-Thin.eot","hash":"0790a51a848dbe7292c98f9d0459218bf1a8ffdd","modified":1549942417915},{"_id":"public/libs/materialize/font/roboto/Roboto-Thin.woff","hash":"fbc3e71d456c96667d8082ab910e3946ef89240b","modified":1549942417915},{"_id":"public/libs/materialize/font/roboto/Roboto-Bold.woff2","hash":"933b866d09c2b087707a98dab64b3888865eeb96","modified":1549942417916},{"_id":"public/libs/materialize/font/roboto/Roboto-Medium.woff","hash":"d45f84922131364989ad6578c7a06b6b4fc22c34","modified":1549942417916},{"_id":"public/libs/materialize/font/roboto/Roboto-Medium.woff2","hash":"6cc1b73571af9e827c4e7e91418f476703cd4c4b","modified":1549942417917},{"_id":"public/libs/materialize/font/roboto/Roboto-Bold.woff","hash":"ee99cd87a59a9a5d4092c83232bb3eec67547425","modified":1549942417917},{"_id":"public/libs/materialize/font/roboto/Roboto-Regular.woff2","hash":"ed1558b0541f5e01ce48c7db1588371b990eec19","modified":1549942417917},{"_id":"public/libs/materialize/font/roboto/Roboto-Regular.woff","hash":"74734dde8d94e7268170f9b994dedfbdcb5b3a15","modified":1549942417918},{"_id":"public/libs/materialize/font/roboto/Roboto-Thin.woff2","hash":"2449e3dac5ddb7c3da8bb07450493b62d052758c","modified":1549942417918},{"_id":"public/css/prism-base16-ateliersulphurpool.light.css","hash":"7c75c045b5e9d2d230c59882e2e9b84a967882e2","modified":1549942417918},{"_id":"public/css/prism-line-numbers.css","hash":"e0db113a99e4a09d2161a539b1652d96e4a22fac","modified":1549942417918},{"_id":"public/images/zookeeper/zkservice.jpg","hash":"3045c7da0e924031f16bc17b91d610a4fd043833","modified":1549942417997},{"_id":"public/images/跨域/clipboard.png","hash":"b040be5a712cf61dcc48052c5398d60301310f1e","modified":1549942417997},{"_id":"public/images/道/926638-20171117190525546-1072349257.png","hash":"6094686b441c9d226055f9107d15634a51c2dde1","modified":1549942417999},{"_id":"public/images/道/926638-20171117190609421-1278140860.png","hash":"99252c3d7e81c2bd456261fbc198f2fe001e11ba","modified":1549942417999},{"_id":"public/images/道/926638-20171117190819921-1868250278.png","hash":"0c064f5551980e02457a650480db9c78866b0c79","modified":1549942417999},{"_id":"public/images/道/926638-20171117190914734-312299182.png","hash":"eb54b2398b2ba21dcc2d3ef28fcdad1542500d7d","modified":1549942417999},{"_id":"public/images/道/926638-20171117191245265-301978953.png","hash":"1da18269d0359b25f3ad3f66f16fe9b830d9daca","modified":1549942418000},{"_id":"public/medias/featureimages/0.jpg","hash":"2066cdda98ad0035071cd4aa7bd696eb078c0b6d","modified":1549942418000},{"_id":"public/medias/featureimages/1.jpg","hash":"d16e28bd23ea3a63643826dde5eea6b7a9bdda5d","modified":1549942418000},{"_id":"public/medias/featureimages/11.jpg","hash":"9ed45f95b83626e3d91d6c405eb8bfe6fcb9736a","modified":1549942418000},{"_id":"public/medias/featureimages/14.jpg","hash":"8aeb816faca2d5eaea4cce9e881d6ff87b8c7cf1","modified":1549942418000},{"_id":"public/medias/featureimages/10.jpg","hash":"838e704942de076c60894d14e5f280e2724b6f68","modified":1549942418000},{"_id":"public/medias/featureimages/12.jpg","hash":"047be4239dd7e0be83243ee6b49a392a61f16b9a","modified":1549942418001},{"_id":"public/medias/featureimages/19.jpg","hash":"57bc7c804b78b5cceb4eb1f9e51b734b75151b71","modified":1549942418001},{"_id":"public/medias/featureimages/20.jpg","hash":"8271c4a327632b566ea62f546c083d08a0528e72","modified":1549942418003},{"_id":"public/medias/featureimages/4.jpg","hash":"4eea5bdb5724ef1ed65790e481eda0d2fb176bf0","modified":1549942418003},{"_id":"public/medias/featureimages/18.jpg","hash":"ae23fdfaa59bc57b7ed49e90c5d59e4b68e1eea5","modified":1549942418004},{"_id":"public/medias/featureimages/17.jpg","hash":"f168ca5b046d10a878a7b0bcfab540e2c4428887","modified":1549942418004},{"_id":"public/medias/featureimages/6.jpg","hash":"c63ff64bdd5f6c82da8804c7248fc519d23eaf0b","modified":1549942418005},{"_id":"public/medias/featureimages/3.jpg","hash":"5e879652e032f02961a331b598a50b60ebe80a39","modified":1549942418017},{"_id":"public/medias/featureimages/9.jpg","hash":"815c84778b721e3606c2bd7c099c7de7c53251ba","modified":1549942418018},{"_id":"public/medias/banner/0.jpg","hash":"1f2ec55fe7825475fde2601573bb622f0bf2acba","modified":1549942418018},{"_id":"public/medias/banner/2.jpg","hash":"8d3c8391ff161eec70f66d69e5545a9468cc52ef","modified":1549942418018},{"_id":"public/libs/awesome/fonts/fontawesome-webfont.woff","hash":"28b782240b3e76db824e12c02754a9731a167527","modified":1549942418019},{"_id":"public/libs/awesome/fonts/fontawesome-webfont.woff2","hash":"d6f48cba7d076fb6f2fd6ba993a75b9dc1ecbf0c","modified":1549942418019},{"_id":"public/libs/materialize/font/material-design-icons/Material-Design-Icons.woff","hash":"ee77184556f7b66fcb8ee9496f81ac62f792d7dc","modified":1549942418019},{"_id":"public/libs/materialize/font/roboto/Roboto-Bold.ttf","hash":"47327df0f35e7cd7c8645874897a7449697544ae","modified":1549942418025},{"_id":"public/libs/materialize/font/roboto/Roboto-Light.ttf","hash":"e321c183e2b75ee19813892b7bac8d7c411cb88a","modified":1549942418025},{"_id":"public/libs/materialize/font/roboto/Roboto-Regular.ttf","hash":"824b5480c977a8166e177e5357d13164ccc45f47","modified":1549942418025},{"_id":"public/libs/materialize/font/roboto/Roboto-Medium.ttf","hash":"6060ca726b9760b76f7c347dce9d2fa1fe42ec92","modified":1549942418026},{"_id":"public/libs/materialize/font/material-design-icons/Material-Design-Icons.ttf","hash":"2cb66ac73a2d32ae8d2f807f705eff26fcf93323","modified":1549942418026},{"_id":"public/libs/materialize/font/material-design-icons/Material-Design-Icons.eot","hash":"fc1bc1337f3313ead42b22a67a142d4e0d356b3a","modified":1549942418026},{"_id":"public/libs/materialize/font/roboto/Roboto-Thin.ttf","hash":"173ed64528b4d010a76d8d38deb1d7e7eed58eda","modified":1549942418026},{"_id":"public/css/gitment.css","hash":"2bd15cc17dca35ac3ecc0acf167a23a1dd362acd","modified":1549942418064},{"_id":"public/js/matery.js","hash":"3f8e6afb067705375ce27affdab77db19bbc3ce1","modified":1549942418064},{"_id":"public/css/my-gitalk.css","hash":"eeda46a83d0db1cc239a9cd27d544faf663f9883","modified":1549942418064},{"_id":"public/css/my.css","hash":"497e50351f7838f8546cac76850a42e7e380a110","modified":1549942418064},{"_id":"public/js/search.js","hash":"499e11786efbb04815b54a1de317cc8606a37555","modified":1549942418064},{"_id":"public/libs/jqcloud/jqcloud-1.0.4.min.js","hash":"257eaae3020599e4939f50d5008a743827f25b8c","modified":1549942418065},{"_id":"public/libs/jqcloud/jqcloud.css","hash":"20d9f11a19d95c70e27cb922e0d6dccbec4eae89","modified":1549942418065},{"_id":"public/libs/scrollprogress/scrollProgress.min.js","hash":"777ffe5d07e85a14fbe97d846f45ffc0087251cc","modified":1549942418065},{"_id":"public/libs/tocbot/tocbot.css","hash":"15601837bf8557c2fd111e4450ed4c8495fd11a0","modified":1549942418065},{"_id":"public/libs/others/clicklove.js","hash":"6a39b8c683ba5dcd92f70c6ab45d1cfac3213e8e","modified":1549942418065},{"_id":"public/libs/share/css/share.min.css","hash":"8a778a86f3ce9a042df6be63a9f1039631e351a5","modified":1549942418065},{"_id":"public/medias/cover.jpg","hash":"d4957ff7cc5e88555cd840f2956ab0561e6f1ccf","modified":1549942418066},{"_id":"public/medias/banner/5.jpg","hash":"4a08deec1dd5b4f1490e8fc23adfb75a0f88b0c4","modified":1549942418066},{"_id":"public/medias/banner/6.jpg","hash":"62e9586a8cec91a160f147c424a3d1d1aea360f9","modified":1549942418066},{"_id":"public/medias/banner/1.jpg","hash":"c3d5ab183b39a7140941b8375e29498f9d24f343","modified":1549942418066},{"_id":"public/medias/banner/3.jpg","hash":"d4957ff7cc5e88555cd840f2956ab0561e6f1ccf","modified":1549942418066},{"_id":"public/libs/awesome/fonts/FontAwesome.otf","hash":"048707bc52ac4b6563aaa383bfe8660a0ddc908c","modified":1549942418067},{"_id":"public/libs/aos/aos.js","hash":"02bfb40b0c4b6e9b0b4081218357145cbb327d74","modified":1549942418074},{"_id":"public/libs/tocbot/tocbot.min.js","hash":"5ec27317f0270b8cf6b884c6f12025700b9a565c","modified":1549942418075},{"_id":"public/libs/awesome/fonts/fontawesome-webfont.ttf","hash":"13b1eab65a983c7a73bc7997c479d66943f7c6cb","modified":1549942418076},{"_id":"public/libs/gitment/gitment-default.css","hash":"2903c59ee06b965bef32e937bd69f5b0b2190717","modified":1549942418081},{"_id":"public/libs/masonry/masonry.pkgd.min.js","hash":"ff940b4ea68368ca0e4d5560cbb79fb147dfc3c5","modified":1549942418081},{"_id":"public/libs/lightGallery/css/lightgallery.min.css","hash":"1b7227237f9785c66062a4811508916518e4132c","modified":1549942418081},{"_id":"public/libs/share/js/social-share.min.js","hash":"4df722bafde2c5d8faaace0d1f894798385a8793","modified":1549942418081},{"_id":"public/libs/awesome/fonts/fontawesome-webfont.eot","hash":"d980c2ce873dc43af460d4d572d441304499f400","modified":1549942418117},{"_id":"public/libs/aos/aos.css","hash":"191a3705a8f63e589a50a0ff2f2c5559f1a1b6b2","modified":1549942418123},{"_id":"public/libs/gitalk/gitalk.css","hash":"3aac1db83b0135c521187254ff302d125cc30706","modified":1549942418123},{"_id":"public/libs/awesome/css/font-awesome.min.css","hash":"512c7d79033e3028a9be61b540cf1a6870c896f8","modified":1549942418123},{"_id":"public/libs/share/js/jquery.share.min.js","hash":"16ce82901ca0e302cf47a35fb10f59009a5e7eb9","modified":1549942418123},{"_id":"public/css/matery.css","hash":"683ab6da3f89b0ab9f8cb01fa63545e241947ba9","modified":1549942418219},{"_id":"public/medias/banner/4.jpg","hash":"56850c3139cbd72a0eff0c35d8fac32c9c66dd6a","modified":1549942418308},{"_id":"public/libs/cryptojs/crypto-js.min.js","hash":"5989527a378b55011a59522f41eeb3981518325c","modified":1549942418309},{"_id":"public/libs/animate/animate.min.css","hash":"97afa151569f046b2e01f27c1871646e9cd87caf","modified":1549942418400},{"_id":"public/libs/lightGallery/js/lightgallery-all.min.js","hash":"9f5ef4bc8a0a3c746ca4f3c3e6d64493b1a977d8","modified":1549942418400},{"_id":"public/libs/valine/Valine.min.js","hash":"031c1a5640d64ab3b829395ad5a7596b9fb122e6","modified":1549942418716},{"_id":"public/libs/gitment/gitment.js","hash":"28c02c45ce568e084cd1041dc493f83f9c6c88c6","modified":1549942418781},{"_id":"public/libs/awesome/fonts/fontawesome-webfont.svg","hash":"b5483b11f8ba213e733b5b8af9927a04fec996f6","modified":1549942418816},{"_id":"public/libs/jquery/jquery-2.2.0.min.js","hash":"5d7e5bbfa540f0e53bd599e4305e1a4e815b5dd1","modified":1549942418831},{"_id":"public/libs/materialize/font/material-design-icons/Material-Design-Icons.svg","hash":"c5ff32ccf63106152dac687395d2e3551d9fcadb","modified":1549942418882},{"_id":"public/libs/materialize/js/materialize.min.js","hash":"900e478fb609e18a4f785164fc6f6b0442e8a94e","modified":1549942418928},{"_id":"public/libs/valine/av-min.js","hash":"2577e72b52b736d99649f9e95be8976d58563333","modified":1549942418937},{"_id":"public/libs/materialize/css/materialize.min.css","hash":"ca9b5271c307593264daad9753b962a0a8db1cef","modified":1549942418942},{"_id":"public/libs/gitalk/gitalk.min.js","hash":"734f56442e62fe55f677e8ccae7f175445667767","modified":1549942418942},{"_id":"public/libs/echarts/echarts.min.js","hash":"9496f386a0da4601cad22c479cc5543913a4d67f","modified":1549942419013}],"Category":[{"name":"GitHub搭建Hexo","_id":"cjs17mhxa0003pwgt2rtg8eao"},{"name":"Git流","_id":"cjs17mhxk0008pwgt2jyuhmhe"},{"name":"JNI 加载本地dll类库","_id":"cjs17mhxq000epwgt17dv8gt1"},{"name":"Js模板","_id":"cjs17mhxy000kpwgt36z6692h"},{"name":"Linux命令","_id":"cjs17mhy4000rpwgt8oszlvvj"},{"name":"Linux目录结构","_id":"cjs17mhyc000ypwgtb26kekp8"},{"name":"Maven依赖机制","_id":"cjs17mhyi0015pwgtiq2z5b2z"},{"name":"RESTful API 的幂等性","_id":"cjs17mhym001cpwgt1trqwtav"},{"name":"MySQL命令","_id":"cjs17mhyr001ipwgt3hnvuitz"},{"name":"雪花算法","_id":"cjs17mhys001mpwgt8s2l7rb4"},{"name":"Session","_id":"cjs17mhyt001qpwgt9x9cij8b"},{"name":"学习网站","_id":"cjs17mhyu001upwgt4okph8kr"},{"name":"Spring Boot默认配置源码","_id":"cjs17mhyv001ypwgtol97hcef"},{"name":"同步配置","_id":"cjs17mhyw0022pwgt51b5cyqx"},{"name":"XML工具类","_id":"cjs17mhyy0026pwgtfrqh6jqc"},{"name":"正则","_id":"cjs17mhyz002apwgtmlryt46i"},{"name":"下载依赖","_id":"cjs17mhz0002dpwgti9opa8yu"},{"name":"新建文章格式","_id":"cjs17mhz1002gpwgtfoqrdfqh"},{"name":"跨域问题解决方案","_id":"cjs17mhz1002ipwgtnvytkfqi"},{"name":"Spring Boot Starts","_id":"cjs17mi08002ppwgtikpfx5xg"},{"name":"配置","_id":"cjs17mi0g002zpwgtxykezxcp"},{"name":"常用注解","_id":"cjs17mi0l0035pwgt7plxd258"},{"name":"Swagger","_id":"cjs17mi0o003apwgtpe5wdhhz"},{"name":"事务","_id":"cjs17mi0q003dpwgt7oy7ysyp"},{"name":"分布式","_id":"cjs17mi0r003gpwgtstewe422"},{"name":"设计一个良好的 API","_id":"cjs17mi0s003ipwgt8mqggx43"},{"name":"日期时间工具类","_id":"cjs17mi0t003kpwgt1u7ha4n6"},{"name":"Eureka","_id":"cjs17mi1t003ppwgtfcid8as0"},{"name":"Zookeeper","_id":"cjs17mi1y003upwgtcmg0vnhg"},{"name":"配置 MyBatis Redis 二级缓存","_id":"cjs17mi20003xpwgtl70p6rky"},{"name":"Java规范","_id":"cjs17mi3n0041pwgtwuo69916"}],"Data":[],"Page":[{"title":"about","date":"2018-12-30T04:09:15.000Z","_content":"","source":"about/index.md","raw":"---\ntitle: about\ndate: 2018-12-30 12:09:15\n---\n","updated":"2019-01-02T09:56:51.211Z","path":"about/index.html","comments":1,"layout":"page","_id":"cjs17mhx50001pwgtrrg5na7u","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"doc","date":"2019-01-21T02:01:08.000Z","_content":"### 后端文档\n* [Elasticsearch中文文档](https://www.elastic.co/guide/cn/elasticsearch/guide/cn/index.html)\n\n\n### 前端文档\n","source":"doc/index.md","raw":"title: doc\ndate: 2019-01-21 10:01:08\n---\n### 后端文档\n* [Elasticsearch中文文档](https://www.elastic.co/guide/cn/elasticsearch/guide/cn/index.html)\n\n\n### 前端文档\n","updated":"2019-01-21T02:03:31.493Z","path":"doc/index.html","comments":1,"layout":"page","_id":"cjs17mi03002lpwgtnfkikwyx","content":"<h3 id=\"后端文档\"><a href=\"#后端文档\" class=\"headerlink\" title=\"后端文档\"></a>后端文档</h3><ul>\n<li><a href=\"https://www.elastic.co/guide/cn/elasticsearch/guide/cn/index.html\" target=\"_blank\" rel=\"noopener\">Elasticsearch中文文档</a></li>\n</ul>\n<h3 id=\"前端文档\"><a href=\"#前端文档\" class=\"headerlink\" title=\"前端文档\"></a>前端文档</h3>","site":{"data":{}},"excerpt":"","more":"<h3 id=\"后端文档\"><a href=\"#后端文档\" class=\"headerlink\" title=\"后端文档\"></a>后端文档</h3><ul>\n<li><a href=\"https://www.elastic.co/guide/cn/elasticsearch/guide/cn/index.html\" target=\"_blank\" rel=\"noopener\">Elasticsearch中文文档</a></li>\n</ul>\n<h3 id=\"前端文档\"><a href=\"#前端文档\" class=\"headerlink\" title=\"前端文档\"></a>前端文档</h3>"},{"title":"categories","date":"2018-12-30T04:09:50.000Z","_content":"### Spring Boot\n* [常用注解大全](/2019/01/21/SpringBoot常用注解大全/)\n* [事务入门](/2019/01/22/事务管理入门/)\n* [Spring Boot默认配置源码](/2018/12/30/Spring-Boot默认配置源码)\n* [Spring Boot Starts模块依赖详解](/2019/01/28/Spring-Boot-Starts模块依赖详解/)\n* [配置拦截器和过滤器](/2019/01/16/Spring-Boot配置拦截器和过滤器/)\n* [配置MyBatis Redis 二级缓存](/2019/01/02/配置MyBatis%20Redis%20二级缓存/)\n* [Swagger的集成和使用](/2019/01/24/Swagger的集成和使用/)\n \n### Spring Cloud\n* [Eureka配置大全](/2019/01/28/Eureka配置大全/)\n\n\n\n### 规范\n* [Java规范](/2019/01/08/Java规范/)\n\n### Linux\n* [Linux目录结构](/2019/01/18/Linux目录结构/)\n* [Linux命令](/2019/01/18/Linux命令/)\n\n\n\n### JS\n* [Js模板](/2019/01/18/Js模板/)\n\n\n### Java工具类\n* [雪花算法](/2019/01/22/SnowFlake雪花算法/)\n* [JNI-加载本地dll类库](/2018/12/31/JNI-加载本地dll类库/)\n* [XML工具类](/2019/01/02/XML工具类/)\n\n\n### JS工具类\n* [日期工具类](/2018/12/31/期工具类/)\n\n\n### Git\n* [Git流](/2019/01/09/Git流/)\n\n### 道\n* [Session一致性](/2019/01/08/Session一致性/)\n* [分布式锁的场景与实现](/2019/01/08/分布式锁的场景与实现/)\n* [ZooKeeper介绍](/2019/01/28/ZooKeeper介绍/)\n\n\n### RESTful\n\n * [设计一个良好的Rest API](/2019/01/18/设计一个良好的-API/)\n * [RESTful API 的幂等性](/2019/01/18/RESTful-API-的幂等性/)\n\n### 跨域问题\n* [跨域解决方案](/2019/01/18/跨域解决方案/)\n\n\n### Maven\n* [Maven依赖机制](/2019/01/15/Maven依赖机制/)\n* [解决Maven无法自动下载依赖的问题](/2019/01/15/解决-Maven-无法自动下载依赖的问题/)\n\n\n### MySQL\n* [MySQL命令](/2019/01/09/Mysql命令/)\n\n### Docker\n\n\n### 干货\n* [20个常用正则表达式](/2019/01/18/正则表达式/)","source":"categories/index.md","raw":"title: categories\ndate: 2018-12-30 12:09:50\n---\n### Spring Boot\n* [常用注解大全](/2019/01/21/SpringBoot常用注解大全/)\n* [事务入门](/2019/01/22/事务管理入门/)\n* [Spring Boot默认配置源码](/2018/12/30/Spring-Boot默认配置源码)\n* [Spring Boot Starts模块依赖详解](/2019/01/28/Spring-Boot-Starts模块依赖详解/)\n* [配置拦截器和过滤器](/2019/01/16/Spring-Boot配置拦截器和过滤器/)\n* [配置MyBatis Redis 二级缓存](/2019/01/02/配置MyBatis%20Redis%20二级缓存/)\n* [Swagger的集成和使用](/2019/01/24/Swagger的集成和使用/)\n \n### Spring Cloud\n* [Eureka配置大全](/2019/01/28/Eureka配置大全/)\n\n\n\n### 规范\n* [Java规范](/2019/01/08/Java规范/)\n\n### Linux\n* [Linux目录结构](/2019/01/18/Linux目录结构/)\n* [Linux命令](/2019/01/18/Linux命令/)\n\n\n\n### JS\n* [Js模板](/2019/01/18/Js模板/)\n\n\n### Java工具类\n* [雪花算法](/2019/01/22/SnowFlake雪花算法/)\n* [JNI-加载本地dll类库](/2018/12/31/JNI-加载本地dll类库/)\n* [XML工具类](/2019/01/02/XML工具类/)\n\n\n### JS工具类\n* [日期工具类](/2018/12/31/期工具类/)\n\n\n### Git\n* [Git流](/2019/01/09/Git流/)\n\n### 道\n* [Session一致性](/2019/01/08/Session一致性/)\n* [分布式锁的场景与实现](/2019/01/08/分布式锁的场景与实现/)\n* [ZooKeeper介绍](/2019/01/28/ZooKeeper介绍/)\n\n\n### RESTful\n\n * [设计一个良好的Rest API](/2019/01/18/设计一个良好的-API/)\n * [RESTful API 的幂等性](/2019/01/18/RESTful-API-的幂等性/)\n\n### 跨域问题\n* [跨域解决方案](/2019/01/18/跨域解决方案/)\n\n\n### Maven\n* [Maven依赖机制](/2019/01/15/Maven依赖机制/)\n* [解决Maven无法自动下载依赖的问题](/2019/01/15/解决-Maven-无法自动下载依赖的问题/)\n\n\n### MySQL\n* [MySQL命令](/2019/01/09/Mysql命令/)\n\n### Docker\n\n\n### 干货\n* [20个常用正则表达式](/2019/01/18/正则表达式/)","updated":"2019-02-12T03:30:55.314Z","path":"categories/index.html","comments":1,"layout":"page","_id":"cjs17mi06002npwgtcq16uva1","content":"<h3 id=\"Spring-Boot\"><a href=\"#Spring-Boot\" class=\"headerlink\" title=\"Spring Boot\"></a>Spring Boot</h3><ul>\n<li><a href=\"/2019/01/21/SpringBoot常用注解大全/\">常用注解大全</a></li>\n<li><a href=\"/2019/01/22/事务管理入门/\">事务入门</a></li>\n<li><a href=\"/2018/12/30/Spring-Boot默认配置源码\">Spring Boot默认配置源码</a></li>\n<li><a href=\"/2019/01/28/Spring-Boot-Starts模块依赖详解/\">Spring Boot Starts模块依赖详解</a></li>\n<li><a href=\"/2019/01/16/Spring-Boot配置拦截器和过滤器/\">配置拦截器和过滤器</a></li>\n<li><a href=\"/2019/01/02/配置MyBatis%20Redis%20二级缓存/\">配置MyBatis Redis 二级缓存</a></li>\n<li><a href=\"/2019/01/24/Swagger的集成和使用/\">Swagger的集成和使用</a></li>\n</ul>\n<h3 id=\"Spring-Cloud\"><a href=\"#Spring-Cloud\" class=\"headerlink\" title=\"Spring Cloud\"></a>Spring Cloud</h3><ul>\n<li><a href=\"/2019/01/28/Eureka配置大全/\">Eureka配置大全</a></li>\n</ul>\n<h3 id=\"规范\"><a href=\"#规范\" class=\"headerlink\" title=\"规范\"></a>规范</h3><ul>\n<li><a href=\"/2019/01/08/Java规范/\">Java规范</a></li>\n</ul>\n<h3 id=\"Linux\"><a href=\"#Linux\" class=\"headerlink\" title=\"Linux\"></a>Linux</h3><ul>\n<li><a href=\"/2019/01/18/Linux目录结构/\">Linux目录结构</a></li>\n<li><a href=\"/2019/01/18/Linux命令/\">Linux命令</a></li>\n</ul>\n<h3 id=\"JS\"><a href=\"#JS\" class=\"headerlink\" title=\"JS\"></a>JS</h3><ul>\n<li><a href=\"/2019/01/18/Js模板/\">Js模板</a></li>\n</ul>\n<h3 id=\"Java工具类\"><a href=\"#Java工具类\" class=\"headerlink\" title=\"Java工具类\"></a>Java工具类</h3><ul>\n<li><a href=\"/2019/01/22/SnowFlake雪花算法/\">雪花算法</a></li>\n<li><a href=\"/2018/12/31/JNI-加载本地dll类库/\">JNI-加载本地dll类库</a></li>\n<li><a href=\"/2019/01/02/XML工具类/\">XML工具类</a></li>\n</ul>\n<h3 id=\"JS工具类\"><a href=\"#JS工具类\" class=\"headerlink\" title=\"JS工具类\"></a>JS工具类</h3><ul>\n<li><a href=\"/2018/12/31/期工具类/\">日期工具类</a></li>\n</ul>\n<h3 id=\"Git\"><a href=\"#Git\" class=\"headerlink\" title=\"Git\"></a>Git</h3><ul>\n<li><a href=\"/2019/01/09/Git流/\">Git流</a></li>\n</ul>\n<h3 id=\"道\"><a href=\"#道\" class=\"headerlink\" title=\"道\"></a>道</h3><ul>\n<li><a href=\"/2019/01/08/Session一致性/\">Session一致性</a></li>\n<li><a href=\"/2019/01/08/分布式锁的场景与实现/\">分布式锁的场景与实现</a></li>\n<li><a href=\"/2019/01/28/ZooKeeper介绍/\">ZooKeeper介绍</a></li>\n</ul>\n<h3 id=\"RESTful\"><a href=\"#RESTful\" class=\"headerlink\" title=\"RESTful\"></a>RESTful</h3><ul>\n<li><a href=\"/2019/01/18/设计一个良好的-API/\">设计一个良好的Rest API</a></li>\n<li><a href=\"/2019/01/18/RESTful-API-的幂等性/\">RESTful API 的幂等性</a></li>\n</ul>\n<h3 id=\"跨域问题\"><a href=\"#跨域问题\" class=\"headerlink\" title=\"跨域问题\"></a>跨域问题</h3><ul>\n<li><a href=\"/2019/01/18/跨域解决方案/\">跨域解决方案</a></li>\n</ul>\n<h3 id=\"Maven\"><a href=\"#Maven\" class=\"headerlink\" title=\"Maven\"></a>Maven</h3><ul>\n<li><a href=\"/2019/01/15/Maven依赖机制/\">Maven依赖机制</a></li>\n<li><a href=\"/2019/01/15/解决-Maven-无法自动下载依赖的问题/\">解决Maven无法自动下载依赖的问题</a></li>\n</ul>\n<h3 id=\"MySQL\"><a href=\"#MySQL\" class=\"headerlink\" title=\"MySQL\"></a>MySQL</h3><ul>\n<li><a href=\"/2019/01/09/Mysql命令/\">MySQL命令</a></li>\n</ul>\n<h3 id=\"Docker\"><a href=\"#Docker\" class=\"headerlink\" title=\"Docker\"></a>Docker</h3><h3 id=\"干货\"><a href=\"#干货\" class=\"headerlink\" title=\"干货\"></a>干货</h3><ul>\n<li><a href=\"/2019/01/18/正则表达式/\">20个常用正则表达式</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"Spring-Boot\"><a href=\"#Spring-Boot\" class=\"headerlink\" title=\"Spring Boot\"></a>Spring Boot</h3><ul>\n<li><a href=\"/2019/01/21/SpringBoot常用注解大全/\">常用注解大全</a></li>\n<li><a href=\"/2019/01/22/事务管理入门/\">事务入门</a></li>\n<li><a href=\"/2018/12/30/Spring-Boot默认配置源码\">Spring Boot默认配置源码</a></li>\n<li><a href=\"/2019/01/28/Spring-Boot-Starts模块依赖详解/\">Spring Boot Starts模块依赖详解</a></li>\n<li><a href=\"/2019/01/16/Spring-Boot配置拦截器和过滤器/\">配置拦截器和过滤器</a></li>\n<li><a href=\"/2019/01/02/配置MyBatis%20Redis%20二级缓存/\">配置MyBatis Redis 二级缓存</a></li>\n<li><a href=\"/2019/01/24/Swagger的集成和使用/\">Swagger的集成和使用</a></li>\n</ul>\n<h3 id=\"Spring-Cloud\"><a href=\"#Spring-Cloud\" class=\"headerlink\" title=\"Spring Cloud\"></a>Spring Cloud</h3><ul>\n<li><a href=\"/2019/01/28/Eureka配置大全/\">Eureka配置大全</a></li>\n</ul>\n<h3 id=\"规范\"><a href=\"#规范\" class=\"headerlink\" title=\"规范\"></a>规范</h3><ul>\n<li><a href=\"/2019/01/08/Java规范/\">Java规范</a></li>\n</ul>\n<h3 id=\"Linux\"><a href=\"#Linux\" class=\"headerlink\" title=\"Linux\"></a>Linux</h3><ul>\n<li><a href=\"/2019/01/18/Linux目录结构/\">Linux目录结构</a></li>\n<li><a href=\"/2019/01/18/Linux命令/\">Linux命令</a></li>\n</ul>\n<h3 id=\"JS\"><a href=\"#JS\" class=\"headerlink\" title=\"JS\"></a>JS</h3><ul>\n<li><a href=\"/2019/01/18/Js模板/\">Js模板</a></li>\n</ul>\n<h3 id=\"Java工具类\"><a href=\"#Java工具类\" class=\"headerlink\" title=\"Java工具类\"></a>Java工具类</h3><ul>\n<li><a href=\"/2019/01/22/SnowFlake雪花算法/\">雪花算法</a></li>\n<li><a href=\"/2018/12/31/JNI-加载本地dll类库/\">JNI-加载本地dll类库</a></li>\n<li><a href=\"/2019/01/02/XML工具类/\">XML工具类</a></li>\n</ul>\n<h3 id=\"JS工具类\"><a href=\"#JS工具类\" class=\"headerlink\" title=\"JS工具类\"></a>JS工具类</h3><ul>\n<li><a href=\"/2018/12/31/期工具类/\">日期工具类</a></li>\n</ul>\n<h3 id=\"Git\"><a href=\"#Git\" class=\"headerlink\" title=\"Git\"></a>Git</h3><ul>\n<li><a href=\"/2019/01/09/Git流/\">Git流</a></li>\n</ul>\n<h3 id=\"道\"><a href=\"#道\" class=\"headerlink\" title=\"道\"></a>道</h3><ul>\n<li><a href=\"/2019/01/08/Session一致性/\">Session一致性</a></li>\n<li><a href=\"/2019/01/08/分布式锁的场景与实现/\">分布式锁的场景与实现</a></li>\n<li><a href=\"/2019/01/28/ZooKeeper介绍/\">ZooKeeper介绍</a></li>\n</ul>\n<h3 id=\"RESTful\"><a href=\"#RESTful\" class=\"headerlink\" title=\"RESTful\"></a>RESTful</h3><ul>\n<li><a href=\"/2019/01/18/设计一个良好的-API/\">设计一个良好的Rest API</a></li>\n<li><a href=\"/2019/01/18/RESTful-API-的幂等性/\">RESTful API 的幂等性</a></li>\n</ul>\n<h3 id=\"跨域问题\"><a href=\"#跨域问题\" class=\"headerlink\" title=\"跨域问题\"></a>跨域问题</h3><ul>\n<li><a href=\"/2019/01/18/跨域解决方案/\">跨域解决方案</a></li>\n</ul>\n<h3 id=\"Maven\"><a href=\"#Maven\" class=\"headerlink\" title=\"Maven\"></a>Maven</h3><ul>\n<li><a href=\"/2019/01/15/Maven依赖机制/\">Maven依赖机制</a></li>\n<li><a href=\"/2019/01/15/解决-Maven-无法自动下载依赖的问题/\">解决Maven无法自动下载依赖的问题</a></li>\n</ul>\n<h3 id=\"MySQL\"><a href=\"#MySQL\" class=\"headerlink\" title=\"MySQL\"></a>MySQL</h3><ul>\n<li><a href=\"/2019/01/09/Mysql命令/\">MySQL命令</a></li>\n</ul>\n<h3 id=\"Docker\"><a href=\"#Docker\" class=\"headerlink\" title=\"Docker\"></a>Docker</h3><h3 id=\"干货\"><a href=\"#干货\" class=\"headerlink\" title=\"干货\"></a>干货</h3><ul>\n<li><a href=\"/2019/01/18/正则表达式/\">20个常用正则表达式</a></li>\n</ul>\n"},{"title":"utils","date":"2018-12-30T04:46:23.000Z","_content":"### 在线编辑器\n* [PDF 转换器1](https://smallpdf.com/cn/pdf-to-word)\n* [PDF 转换器2](https://www.pdf365.cn/?utm_campaign=haruki&utm_content=note&utm_medium=reader_share&utm_source=weixin)\n* [JSON 格式化](https://www.bejson.com/jsoneditoronline)\n* [代码格式化](http://tool.oschina.net/codeformat/html)\n* [公式编辑器](https://zh.numberempire.com/latexequationeditor.php)\n* [二维码生成器](https://cli.im/)\n* [porperties <=> yaml](http://www.toyaml.com/index.html)\n* [JSON 转 Bean](https://www.bejson.com/json2javapojo/new/)\n* [Banner 生成](http://patorjk.com/software/taag)\n\n\n### 在线服务\n* [Boot CDN](https://www.bootcdn.cn/)\n* [微信 CDN](https://qydev.weixin.qq.com/cdn/cdnjs.html)\n\n\n### Web资源\n\n* [Web 表单设计器](http://formdesign.leipi.org/)\n* [懒人之家](http://www.lanrenzhijia.com/)\n* [矢量图标](http://www.icontuku.com/)\n* [阿里矢量图标](http://www.iconfont.cn/search/index)\n* [奥森图标](https://www.thinkcmf.com/font_awesome.html)\n\n### 服务端资源\n* [Maven 中央仓库](https://mvnrepository.com/)\n* [Hub 仓库](https://hub.docker.com/)\n\n### Idea\n* [文件文档在线预览](/2019/01/23/idea同步配置到Git/)\n\n### 开源项目\n* [文件文档在线预览](https://gitee.com/kekingcn/file-online-preview)\n\n#### 微服务\n* [后台管理框架-zheng](https://gitee.com/shuzheng/zheng)\n\n\n### 学习网站\n* [Java开发知名网站](/2019/01/18/Java开发知名网站/)\n\n\n### 博客建站\n* [docsify](https://docsify.js.org)","source":"utils/index.md","raw":"title: utils\ndate: 2018-12-30 12:46:23\n---\n### 在线编辑器\n* [PDF 转换器1](https://smallpdf.com/cn/pdf-to-word)\n* [PDF 转换器2](https://www.pdf365.cn/?utm_campaign=haruki&utm_content=note&utm_medium=reader_share&utm_source=weixin)\n* [JSON 格式化](https://www.bejson.com/jsoneditoronline)\n* [代码格式化](http://tool.oschina.net/codeformat/html)\n* [公式编辑器](https://zh.numberempire.com/latexequationeditor.php)\n* [二维码生成器](https://cli.im/)\n* [porperties <=> yaml](http://www.toyaml.com/index.html)\n* [JSON 转 Bean](https://www.bejson.com/json2javapojo/new/)\n* [Banner 生成](http://patorjk.com/software/taag)\n\n\n### 在线服务\n* [Boot CDN](https://www.bootcdn.cn/)\n* [微信 CDN](https://qydev.weixin.qq.com/cdn/cdnjs.html)\n\n\n### Web资源\n\n* [Web 表单设计器](http://formdesign.leipi.org/)\n* [懒人之家](http://www.lanrenzhijia.com/)\n* [矢量图标](http://www.icontuku.com/)\n* [阿里矢量图标](http://www.iconfont.cn/search/index)\n* [奥森图标](https://www.thinkcmf.com/font_awesome.html)\n\n### 服务端资源\n* [Maven 中央仓库](https://mvnrepository.com/)\n* [Hub 仓库](https://hub.docker.com/)\n\n### Idea\n* [文件文档在线预览](/2019/01/23/idea同步配置到Git/)\n\n### 开源项目\n* [文件文档在线预览](https://gitee.com/kekingcn/file-online-preview)\n\n#### 微服务\n* [后台管理框架-zheng](https://gitee.com/shuzheng/zheng)\n\n\n### 学习网站\n* [Java开发知名网站](/2019/01/18/Java开发知名网站/)\n\n\n### 博客建站\n* [docsify](https://docsify.js.org)","updated":"2019-02-12T03:30:55.053Z","path":"utils/index.html","comments":1,"layout":"page","_id":"cjs17mi08002rpwgtwua8wjgy","content":"<h3 id=\"在线编辑器\"><a href=\"#在线编辑器\" class=\"headerlink\" title=\"在线编辑器\"></a>在线编辑器</h3><ul>\n<li><a href=\"https://smallpdf.com/cn/pdf-to-word\" target=\"_blank\" rel=\"noopener\">PDF 转换器1</a></li>\n<li><a href=\"https://www.pdf365.cn/?utm_campaign=haruki&amp;utm_content=note&amp;utm_medium=reader_share&amp;utm_source=weixin\" target=\"_blank\" rel=\"noopener\">PDF 转换器2</a></li>\n<li><a href=\"https://www.bejson.com/jsoneditoronline\" target=\"_blank\" rel=\"noopener\">JSON 格式化</a></li>\n<li><a href=\"http://tool.oschina.net/codeformat/html\" target=\"_blank\" rel=\"noopener\">代码格式化</a></li>\n<li><a href=\"https://zh.numberempire.com/latexequationeditor.php\" target=\"_blank\" rel=\"noopener\">公式编辑器</a></li>\n<li><a href=\"https://cli.im/\" target=\"_blank\" rel=\"noopener\">二维码生成器</a></li>\n<li><a href=\"http://www.toyaml.com/index.html\" target=\"_blank\" rel=\"noopener\">porperties &lt;=&gt; yaml</a></li>\n<li><a href=\"https://www.bejson.com/json2javapojo/new/\" target=\"_blank\" rel=\"noopener\">JSON 转 Bean</a></li>\n<li><a href=\"http://patorjk.com/software/taag\" target=\"_blank\" rel=\"noopener\">Banner 生成</a></li>\n</ul>\n<h3 id=\"在线服务\"><a href=\"#在线服务\" class=\"headerlink\" title=\"在线服务\"></a>在线服务</h3><ul>\n<li><a href=\"https://www.bootcdn.cn/\" target=\"_blank\" rel=\"noopener\">Boot CDN</a></li>\n<li><a href=\"https://qydev.weixin.qq.com/cdn/cdnjs.html\" target=\"_blank\" rel=\"noopener\">微信 CDN</a></li>\n</ul>\n<h3 id=\"Web资源\"><a href=\"#Web资源\" class=\"headerlink\" title=\"Web资源\"></a>Web资源</h3><ul>\n<li><a href=\"http://formdesign.leipi.org/\" target=\"_blank\" rel=\"noopener\">Web 表单设计器</a></li>\n<li><a href=\"http://www.lanrenzhijia.com/\" target=\"_blank\" rel=\"noopener\">懒人之家</a></li>\n<li><a href=\"http://www.icontuku.com/\" target=\"_blank\" rel=\"noopener\">矢量图标</a></li>\n<li><a href=\"http://www.iconfont.cn/search/index\" target=\"_blank\" rel=\"noopener\">阿里矢量图标</a></li>\n<li><a href=\"https://www.thinkcmf.com/font_awesome.html\" target=\"_blank\" rel=\"noopener\">奥森图标</a></li>\n</ul>\n<h3 id=\"服务端资源\"><a href=\"#服务端资源\" class=\"headerlink\" title=\"服务端资源\"></a>服务端资源</h3><ul>\n<li><a href=\"https://mvnrepository.com/\" target=\"_blank\" rel=\"noopener\">Maven 中央仓库</a></li>\n<li><a href=\"https://hub.docker.com/\" target=\"_blank\" rel=\"noopener\">Hub 仓库</a></li>\n</ul>\n<h3 id=\"Idea\"><a href=\"#Idea\" class=\"headerlink\" title=\"Idea\"></a>Idea</h3><ul>\n<li><a href=\"/2019/01/23/idea同步配置到Git/\">文件文档在线预览</a></li>\n</ul>\n<h3 id=\"开源项目\"><a href=\"#开源项目\" class=\"headerlink\" title=\"开源项目\"></a>开源项目</h3><ul>\n<li><a href=\"https://gitee.com/kekingcn/file-online-preview\" target=\"_blank\" rel=\"noopener\">文件文档在线预览</a></li>\n</ul>\n<h4 id=\"微服务\"><a href=\"#微服务\" class=\"headerlink\" title=\"微服务\"></a>微服务</h4><ul>\n<li><a href=\"https://gitee.com/shuzheng/zheng\" target=\"_blank\" rel=\"noopener\">后台管理框架-zheng</a></li>\n</ul>\n<h3 id=\"学习网站\"><a href=\"#学习网站\" class=\"headerlink\" title=\"学习网站\"></a>学习网站</h3><ul>\n<li><a href=\"/2019/01/18/Java开发知名网站/\">Java开发知名网站</a></li>\n</ul>\n<h3 id=\"博客建站\"><a href=\"#博客建站\" class=\"headerlink\" title=\"博客建站\"></a>博客建站</h3><ul>\n<li><a href=\"https://docsify.js.org\" target=\"_blank\" rel=\"noopener\">docsify</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"在线编辑器\"><a href=\"#在线编辑器\" class=\"headerlink\" title=\"在线编辑器\"></a>在线编辑器</h3><ul>\n<li><a href=\"https://smallpdf.com/cn/pdf-to-word\" target=\"_blank\" rel=\"noopener\">PDF 转换器1</a></li>\n<li><a href=\"https://www.pdf365.cn/?utm_campaign=haruki&amp;utm_content=note&amp;utm_medium=reader_share&amp;utm_source=weixin\" target=\"_blank\" rel=\"noopener\">PDF 转换器2</a></li>\n<li><a href=\"https://www.bejson.com/jsoneditoronline\" target=\"_blank\" rel=\"noopener\">JSON 格式化</a></li>\n<li><a href=\"http://tool.oschina.net/codeformat/html\" target=\"_blank\" rel=\"noopener\">代码格式化</a></li>\n<li><a href=\"https://zh.numberempire.com/latexequationeditor.php\" target=\"_blank\" rel=\"noopener\">公式编辑器</a></li>\n<li><a href=\"https://cli.im/\" target=\"_blank\" rel=\"noopener\">二维码生成器</a></li>\n<li><a href=\"http://www.toyaml.com/index.html\" target=\"_blank\" rel=\"noopener\">porperties &lt;=&gt; yaml</a></li>\n<li><a href=\"https://www.bejson.com/json2javapojo/new/\" target=\"_blank\" rel=\"noopener\">JSON 转 Bean</a></li>\n<li><a href=\"http://patorjk.com/software/taag\" target=\"_blank\" rel=\"noopener\">Banner 生成</a></li>\n</ul>\n<h3 id=\"在线服务\"><a href=\"#在线服务\" class=\"headerlink\" title=\"在线服务\"></a>在线服务</h3><ul>\n<li><a href=\"https://www.bootcdn.cn/\" target=\"_blank\" rel=\"noopener\">Boot CDN</a></li>\n<li><a href=\"https://qydev.weixin.qq.com/cdn/cdnjs.html\" target=\"_blank\" rel=\"noopener\">微信 CDN</a></li>\n</ul>\n<h3 id=\"Web资源\"><a href=\"#Web资源\" class=\"headerlink\" title=\"Web资源\"></a>Web资源</h3><ul>\n<li><a href=\"http://formdesign.leipi.org/\" target=\"_blank\" rel=\"noopener\">Web 表单设计器</a></li>\n<li><a href=\"http://www.lanrenzhijia.com/\" target=\"_blank\" rel=\"noopener\">懒人之家</a></li>\n<li><a href=\"http://www.icontuku.com/\" target=\"_blank\" rel=\"noopener\">矢量图标</a></li>\n<li><a href=\"http://www.iconfont.cn/search/index\" target=\"_blank\" rel=\"noopener\">阿里矢量图标</a></li>\n<li><a href=\"https://www.thinkcmf.com/font_awesome.html\" target=\"_blank\" rel=\"noopener\">奥森图标</a></li>\n</ul>\n<h3 id=\"服务端资源\"><a href=\"#服务端资源\" class=\"headerlink\" title=\"服务端资源\"></a>服务端资源</h3><ul>\n<li><a href=\"https://mvnrepository.com/\" target=\"_blank\" rel=\"noopener\">Maven 中央仓库</a></li>\n<li><a href=\"https://hub.docker.com/\" target=\"_blank\" rel=\"noopener\">Hub 仓库</a></li>\n</ul>\n<h3 id=\"Idea\"><a href=\"#Idea\" class=\"headerlink\" title=\"Idea\"></a>Idea</h3><ul>\n<li><a href=\"/2019/01/23/idea同步配置到Git/\">文件文档在线预览</a></li>\n</ul>\n<h3 id=\"开源项目\"><a href=\"#开源项目\" class=\"headerlink\" title=\"开源项目\"></a>开源项目</h3><ul>\n<li><a href=\"https://gitee.com/kekingcn/file-online-preview\" target=\"_blank\" rel=\"noopener\">文件文档在线预览</a></li>\n</ul>\n<h4 id=\"微服务\"><a href=\"#微服务\" class=\"headerlink\" title=\"微服务\"></a>微服务</h4><ul>\n<li><a href=\"https://gitee.com/shuzheng/zheng\" target=\"_blank\" rel=\"noopener\">后台管理框架-zheng</a></li>\n</ul>\n<h3 id=\"学习网站\"><a href=\"#学习网站\" class=\"headerlink\" title=\"学习网站\"></a>学习网站</h3><ul>\n<li><a href=\"/2019/01/18/Java开发知名网站/\">Java开发知名网站</a></li>\n</ul>\n<h3 id=\"博客建站\"><a href=\"#博客建站\" class=\"headerlink\" title=\"博客建站\"></a>博客建站</h3><ul>\n<li><a href=\"https://docsify.js.org\" target=\"_blank\" rel=\"noopener\">docsify</a></li>\n</ul>\n"},{"title":"friends","date":"2018-12-30T04:09:29.000Z","_content":"","source":"friends/index.md","raw":"---\ntitle: friends\ndate: 2018-12-30 12:09:29\n---\n","updated":"2019-01-02T09:56:51.228Z","path":"friends/index.html","comments":1,"layout":"page","_id":"cjs17mi0b002upwgtyxv3mfcl","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"tags","date":"2018-12-30T04:23:38.000Z","type":"tags","layout":"tags","_content":"\n\n","source":"tags/index.md","raw":"---\ntitle: tags\ndate: 2018-12-30 12:23:38\ntype: \"tags\"\nlayout: \"tags\"\n---\n\n\n","updated":"2019-01-02T09:56:51.234Z","path":"tags/index.html","comments":1,"_id":"cjs17mi0e002xpwgt9oipmczp","content":"","site":{"data":{}},"excerpt":"","more":""}],"Post":[{"title":"GitHub搭建Hexo","author":"Asia Cui","top":true,"date":"2018-12-29T05:24:00.000Z","_content":"### 安装简介\n\n- Git\n- Node.js\n- hexo-cli\n\n\n\n### 安装Git\n\nGit 各平台安装包下载地址为：<http://git-scm.com/downloads>\n\n### 安装Node.js\n\n- windows安装node.js\n\nNode.js 安装包及源码下载地址为：<https://nodejs.org/en/download/>\n\n安装完毕测试：\n\n```bash\n$ node -v\n```\n\n### 安装hexo-cli客户端\n\n`hexo-cli` 客户端可以执行 `hexo` 命令。\n\n```bash\n$ npm install hexo-cli -g\n```\n\n### 创建博客目录\n\n创建一个 `hexo` 文件夹，进入到该目录中初始化。\n```bash\n#初始化\n$ hexo init\n#清理项目\n$ hexo clean\n#生成文章\n$ hexo g\n#启动hexo\n$ hexo s\n```\n### 博客安装主题\n进入到 `hexo` 的 `theme` 目录中，使用 `gitbash` 执行命令\n```bash\n#git下载主题\n$ git clone https://github.com/blinkfox/hexo-theme-matery.git\n```\n下载完毕后修改 `hexo` 目录下的  `_config.yml` 配置，把 `theme` 的值修改为主题文件夹的名称\n\n```yaml\ntheme: hexo-theme-matery\n```\n### 主题配置\n代码高亮安装[hexo-prism-plugin]( https://github.com/ele828/hexo-prism-plugin)插件\n\n```bash\n$ npm i -S hexo-prism-plugin\n```\n\n然后修改`hexo` 目录下的  `_config.yml`的值`highlight.enable`为`false`，并添加`prism`插件如下：\n```yaml\n#修改为false\nhighlight:\n  enable: false\n#添加插件配置\nprism_plugin:\n  mode: preprocess\n  theme: base16-ateliersulphurpool.light #代码高亮主题\n  line_number: false    # default false\n  custom_css:\n```\n\n其中支持的代码高亮主题有如下几种：\n```yaml\ntheme:\n  - default\n  - coy\n  - dark\n  - funky\n  - okaidia\n  - solarizedlight\n  - tomorrow\n  - twilight\n  - atom-dark\n  - base16-ateliersulphurpool.light\n  - cb\n  - duotone-dark\n  - duotone-earth\n  - duotone-forest\n  - duotone-light\n  - duotone-sea\n  - duotone-space\n  - ghcolors\n  - hopscotch\n  - pojoaque\n  - vs\n  - xonokai\n```\n### 安装搜索插件\n使用Hexo插件 `hexo-generator-search` 搜索内容，安装命令如下：\n```bash\n$ npm install hexo-generator-search --save\n```\n然后在 `hexo` 目录下的 `_config.yml` 添加配置，如下所示：\n```yaml\nsearch:\n  path: search.xml\n  field: post\n```\n### 安装Hexo-admin插件\n本地安装完，只能在本地使用，上传github访问不到\n```bash\n#安装\n$ npm install --save hexo-admin\n#启动\n$ hexo server -d\n```\n访问 `http://localhost:4000/admin`即可。\n### GitHub发布\n#### 创建仓库\n在github创建一个仓库 `asiacuityz/asiacuityz.github.io`，注意 `/` 前后的`asiacuityz` 一定要保持一致，加个后缀`.github.io`即可。\n#### SSH生成添加\n[GithubSSH文档](https://help.github.com/articles/connecting-to-github-with-ssh/)\n根据邮箱生成SSH，然后会提示输入密码之类的操作，具体命令如下：\n```bash\n#生成SSH\n$ ssh-keygen -t rsa -b 4096 -C \"your_email@example.com\"\n#添加SSH\n$ ssh-add ~/.ssh/id_rsa\n```\n执行完命令，窗口会显示key文件生成目录在`.ssh`下，然后把文件`id_rsa.pub`里的内容添加到GitHub账户中。添加完毕之后在`_config.yml`配置如下：\n```yaml\ndeploy:\n  type: git\n  repository: git@github.com:asiacuityz/asiacuityz.github.io.git\n  branch: master\n```\n然后就可以执行`hexo d`发布到GitHub，访问路径`https://asiacuityz.github.io/`就可以看到页面了。\n\n\n\n### 安装出现问题\n\n- centos32位出现问题\n\n  执行`npm install -g hexo`命令出现如下错误\n\n  ```bash\n  npm ERR! Error: CERT_UNTRUSTED\n  npm ERR!    at SecurePair.<anonymous> (tls.js:1430:32)\n  npm ERR!    at SecurePair.emit (events.js:92:17)\n  npm ERR!    at SecurePair.maybeInitFinished (tls.js:1029:10)\n  npm ERR!    at CleartextStream.read [as _read] (tls.js:521:13)\n  npm ERR!    at CleartextStream.Readable.read (_stream_readable.js:341:10)\n  npm ERR!    at EncryptedStream.write [as _write] (tls.js:418:25)\n  npm ERR!    at doWrite (_stream_writable.js:226:10)\n  npm ERR!    at writeOrBuffer (_stream_writable.js:216:5)\n  npm ERR!    at EncryptedStream.Writable.write (_stream_writable.js:183:11)\n  npm ERR!    at write (_stream_readable.js:602:24)\n  npm ERR! If you need help, you may report this log at:\n  npm ERR!    <http://github.com/isaacs/npm/issues>\n  npm ERR! or email it to:\n  npm ERR!    <npm-@googlegroups.com>\n  npm ERR! System Linux 2.6.32-696.18.7.el6.x86_64\n  npm ERR! command \"node\" \"/usr/bin/npm\" \"install\" \"-g\" \"hexo\"\n  npm ERR! cwd /root/github/kingty.github.io\n  npm ERR! node -v v0.10.48\n  npm ERR! npm -v 1.3.6\n  npm ERR! \n  npm ERR! Additional logging details can be found in:\n  npm ERR!    /root/github/kingty.github.io/npm-debug.log\n  npm ERR! not ok code 0\n  ```\n\n这是因为npm用https导致的，解决办法是：\n\n```bash\nnpm config set strict-ssl false\n```\n\n执行hexo init 出现如下错误：\n\n```bash\n/usr/lib/node_modules/hexo/node_modules/hexo-cli/lib/hexo.js:13\nclass HexoNotFoundError extends Error {}\n^^^^^\nSyntaxError: Unexpected reserved word\n    at Module._compile (module.js:439:25)\n    at Object.Module._extensions..js (module.js:474:10)\n    at Module.load (module.js:356:32)\n    at Function.Module._load (module.js:312:12)\n    at Module.require (module.js:364:17)\n    at require (module.js:380:17)\n    at Object.<anonymous> (/usr/lib/node_modules/hexo/bin/hexo:5:1)\n    at Module._compile (module.js:456:26)\n    at Object.Module._extensions..js (module.js:474:10)\n    at Module.load (module.js:356:32)\n\n```\n\n原因是`node`的版本过低，需要update 一下`node`到最新版\n\n```bash\nsudo npm cache clean -f\nsudo npm install -g n\n#装哪个版本就v版本号\nsudo n v9\n```\n\n","source":"_posts/GitHub搭建Hexo.md","raw":"title: GitHub搭建Hexo\nauthor: Asia Cui\ntop: true\ntags:\n\n  - 安装教程\ncategories:\n  - GitHub搭建Hexo\ndate: 2018-12-29 13:24:00\n---\n### 安装简介\n\n- Git\n- Node.js\n- hexo-cli\n\n\n\n### 安装Git\n\nGit 各平台安装包下载地址为：<http://git-scm.com/downloads>\n\n### 安装Node.js\n\n- windows安装node.js\n\nNode.js 安装包及源码下载地址为：<https://nodejs.org/en/download/>\n\n安装完毕测试：\n\n```bash\n$ node -v\n```\n\n### 安装hexo-cli客户端\n\n`hexo-cli` 客户端可以执行 `hexo` 命令。\n\n```bash\n$ npm install hexo-cli -g\n```\n\n### 创建博客目录\n\n创建一个 `hexo` 文件夹，进入到该目录中初始化。\n```bash\n#初始化\n$ hexo init\n#清理项目\n$ hexo clean\n#生成文章\n$ hexo g\n#启动hexo\n$ hexo s\n```\n### 博客安装主题\n进入到 `hexo` 的 `theme` 目录中，使用 `gitbash` 执行命令\n```bash\n#git下载主题\n$ git clone https://github.com/blinkfox/hexo-theme-matery.git\n```\n下载完毕后修改 `hexo` 目录下的  `_config.yml` 配置，把 `theme` 的值修改为主题文件夹的名称\n\n```yaml\ntheme: hexo-theme-matery\n```\n### 主题配置\n代码高亮安装[hexo-prism-plugin]( https://github.com/ele828/hexo-prism-plugin)插件\n\n```bash\n$ npm i -S hexo-prism-plugin\n```\n\n然后修改`hexo` 目录下的  `_config.yml`的值`highlight.enable`为`false`，并添加`prism`插件如下：\n```yaml\n#修改为false\nhighlight:\n  enable: false\n#添加插件配置\nprism_plugin:\n  mode: preprocess\n  theme: base16-ateliersulphurpool.light #代码高亮主题\n  line_number: false    # default false\n  custom_css:\n```\n\n其中支持的代码高亮主题有如下几种：\n```yaml\ntheme:\n  - default\n  - coy\n  - dark\n  - funky\n  - okaidia\n  - solarizedlight\n  - tomorrow\n  - twilight\n  - atom-dark\n  - base16-ateliersulphurpool.light\n  - cb\n  - duotone-dark\n  - duotone-earth\n  - duotone-forest\n  - duotone-light\n  - duotone-sea\n  - duotone-space\n  - ghcolors\n  - hopscotch\n  - pojoaque\n  - vs\n  - xonokai\n```\n### 安装搜索插件\n使用Hexo插件 `hexo-generator-search` 搜索内容，安装命令如下：\n```bash\n$ npm install hexo-generator-search --save\n```\n然后在 `hexo` 目录下的 `_config.yml` 添加配置，如下所示：\n```yaml\nsearch:\n  path: search.xml\n  field: post\n```\n### 安装Hexo-admin插件\n本地安装完，只能在本地使用，上传github访问不到\n```bash\n#安装\n$ npm install --save hexo-admin\n#启动\n$ hexo server -d\n```\n访问 `http://localhost:4000/admin`即可。\n### GitHub发布\n#### 创建仓库\n在github创建一个仓库 `asiacuityz/asiacuityz.github.io`，注意 `/` 前后的`asiacuityz` 一定要保持一致，加个后缀`.github.io`即可。\n#### SSH生成添加\n[GithubSSH文档](https://help.github.com/articles/connecting-to-github-with-ssh/)\n根据邮箱生成SSH，然后会提示输入密码之类的操作，具体命令如下：\n```bash\n#生成SSH\n$ ssh-keygen -t rsa -b 4096 -C \"your_email@example.com\"\n#添加SSH\n$ ssh-add ~/.ssh/id_rsa\n```\n执行完命令，窗口会显示key文件生成目录在`.ssh`下，然后把文件`id_rsa.pub`里的内容添加到GitHub账户中。添加完毕之后在`_config.yml`配置如下：\n```yaml\ndeploy:\n  type: git\n  repository: git@github.com:asiacuityz/asiacuityz.github.io.git\n  branch: master\n```\n然后就可以执行`hexo d`发布到GitHub，访问路径`https://asiacuityz.github.io/`就可以看到页面了。\n\n\n\n### 安装出现问题\n\n- centos32位出现问题\n\n  执行`npm install -g hexo`命令出现如下错误\n\n  ```bash\n  npm ERR! Error: CERT_UNTRUSTED\n  npm ERR!    at SecurePair.<anonymous> (tls.js:1430:32)\n  npm ERR!    at SecurePair.emit (events.js:92:17)\n  npm ERR!    at SecurePair.maybeInitFinished (tls.js:1029:10)\n  npm ERR!    at CleartextStream.read [as _read] (tls.js:521:13)\n  npm ERR!    at CleartextStream.Readable.read (_stream_readable.js:341:10)\n  npm ERR!    at EncryptedStream.write [as _write] (tls.js:418:25)\n  npm ERR!    at doWrite (_stream_writable.js:226:10)\n  npm ERR!    at writeOrBuffer (_stream_writable.js:216:5)\n  npm ERR!    at EncryptedStream.Writable.write (_stream_writable.js:183:11)\n  npm ERR!    at write (_stream_readable.js:602:24)\n  npm ERR! If you need help, you may report this log at:\n  npm ERR!    <http://github.com/isaacs/npm/issues>\n  npm ERR! or email it to:\n  npm ERR!    <npm-@googlegroups.com>\n  npm ERR! System Linux 2.6.32-696.18.7.el6.x86_64\n  npm ERR! command \"node\" \"/usr/bin/npm\" \"install\" \"-g\" \"hexo\"\n  npm ERR! cwd /root/github/kingty.github.io\n  npm ERR! node -v v0.10.48\n  npm ERR! npm -v 1.3.6\n  npm ERR! \n  npm ERR! Additional logging details can be found in:\n  npm ERR!    /root/github/kingty.github.io/npm-debug.log\n  npm ERR! not ok code 0\n  ```\n\n这是因为npm用https导致的，解决办法是：\n\n```bash\nnpm config set strict-ssl false\n```\n\n执行hexo init 出现如下错误：\n\n```bash\n/usr/lib/node_modules/hexo/node_modules/hexo-cli/lib/hexo.js:13\nclass HexoNotFoundError extends Error {}\n^^^^^\nSyntaxError: Unexpected reserved word\n    at Module._compile (module.js:439:25)\n    at Object.Module._extensions..js (module.js:474:10)\n    at Module.load (module.js:356:32)\n    at Function.Module._load (module.js:312:12)\n    at Module.require (module.js:364:17)\n    at require (module.js:380:17)\n    at Object.<anonymous> (/usr/lib/node_modules/hexo/bin/hexo:5:1)\n    at Module._compile (module.js:456:26)\n    at Object.Module._extensions..js (module.js:474:10)\n    at Module.load (module.js:356:32)\n\n```\n\n原因是`node`的版本过低，需要update 一下`node`到最新版\n\n```bash\nsudo npm cache clean -f\nsudo npm install -g n\n#装哪个版本就v版本号\nsudo n v9\n```\n\n","slug":"GitHub搭建Hexo","published":1,"updated":"2019-02-12T03:30:55.531Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjs17mhwv0000pwgtbiej17tw","content":"<h3 id=\"安装简介\"><a href=\"#安装简介\" class=\"headerlink\" title=\"安装简介\"></a>安装简介</h3><ul>\n<li>Git</li>\n<li>Node.js</li>\n<li>hexo-cli</li>\n</ul>\n<h3 id=\"安装Git\"><a href=\"#安装Git\" class=\"headerlink\" title=\"安装Git\"></a>安装Git</h3><p>Git 各平台安装包下载地址为：<a href=\"http://git-scm.com/downloads\" target=\"_blank\" rel=\"noopener\">http://git-scm.com/downloads</a></p>\n<h3 id=\"安装Node-js\"><a href=\"#安装Node-js\" class=\"headerlink\" title=\"安装Node.js\"></a>安装Node.js</h3><ul>\n<li>windows安装node.js</li>\n</ul>\n<p>Node.js 安装包及源码下载地址为：<a href=\"https://nodejs.org/en/download/\" target=\"_blank\" rel=\"noopener\">https://nodejs.org/en/download/</a></p>\n<p>安装完毕测试：</p>\n<pre class=\"line-numbers language-bash\"><code class=\"language-bash\">$ node -v\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h3 id=\"安装hexo-cli客户端\"><a href=\"#安装hexo-cli客户端\" class=\"headerlink\" title=\"安装hexo-cli客户端\"></a>安装hexo-cli客户端</h3><p><code>hexo-cli</code> 客户端可以执行 <code>hexo</code> 命令。</p>\n<pre class=\"line-numbers language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">npm</span> <span class=\"token function\">install</span> hexo-cli -g\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h3 id=\"创建博客目录\"><a href=\"#创建博客目录\" class=\"headerlink\" title=\"创建博客目录\"></a>创建博客目录</h3><p>创建一个 <code>hexo</code> 文件夹，进入到该目录中初始化。</p>\n<pre class=\"line-numbers language-bash\"><code class=\"language-bash\"><span class=\"token comment\" spellcheck=\"true\">#初始化</span>\n$ hexo init\n<span class=\"token comment\" spellcheck=\"true\">#清理项目</span>\n$ hexo clean\n<span class=\"token comment\" spellcheck=\"true\">#生成文章</span>\n$ hexo g\n<span class=\"token comment\" spellcheck=\"true\">#启动hexo</span>\n$ hexo s\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"博客安装主题\"><a href=\"#博客安装主题\" class=\"headerlink\" title=\"博客安装主题\"></a>博客安装主题</h3><p>进入到 <code>hexo</code> 的 <code>theme</code> 目录中，使用 <code>gitbash</code> 执行命令</p>\n<pre class=\"line-numbers language-bash\"><code class=\"language-bash\"><span class=\"token comment\" spellcheck=\"true\">#git下载主题</span>\n$ <span class=\"token function\">git</span> clone https://github.com/blinkfox/hexo-theme-matery.git\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>下载完毕后修改 <code>hexo</code> 目录下的  <code>_config.yml</code> 配置，把 <code>theme</code> 的值修改为主题文件夹的名称</p>\n<pre class=\"line-numbers language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">theme</span><span class=\"token punctuation\">:</span> hexo<span class=\"token punctuation\">-</span>theme<span class=\"token punctuation\">-</span>matery\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h3 id=\"主题配置\"><a href=\"#主题配置\" class=\"headerlink\" title=\"主题配置\"></a>主题配置</h3><p>代码高亮安装<a href=\"https://github.com/ele828/hexo-prism-plugin\" target=\"_blank\" rel=\"noopener\">hexo-prism-plugin</a>插件</p>\n<pre class=\"line-numbers language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">npm</span> i -S hexo-prism-plugin\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>然后修改<code>hexo</code> 目录下的  <code>_config.yml</code>的值<code>highlight.enable</code>为<code>false</code>，并添加<code>prism</code>插件如下：</p>\n<pre class=\"line-numbers language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\" spellcheck=\"true\">#修改为false</span>\n<span class=\"token key atrule\">highlight</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">enable</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n<span class=\"token comment\" spellcheck=\"true\">#添加插件配置</span>\n<span class=\"token key atrule\">prism_plugin</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">mode</span><span class=\"token punctuation\">:</span> preprocess\n  <span class=\"token key atrule\">theme</span><span class=\"token punctuation\">:</span> base16<span class=\"token punctuation\">-</span>ateliersulphurpool.light <span class=\"token comment\" spellcheck=\"true\">#代码高亮主题</span>\n  <span class=\"token key atrule\">line_number</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false    </span><span class=\"token comment\" spellcheck=\"true\"># default false</span>\n  <span class=\"token key atrule\">custom_css</span><span class=\"token punctuation\">:</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>其中支持的代码高亮主题有如下几种：</p>\n<pre class=\"line-numbers language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">theme</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> default\n  <span class=\"token punctuation\">-</span> coy\n  <span class=\"token punctuation\">-</span> dark\n  <span class=\"token punctuation\">-</span> funky\n  <span class=\"token punctuation\">-</span> okaidia\n  <span class=\"token punctuation\">-</span> solarizedlight\n  <span class=\"token punctuation\">-</span> tomorrow\n  <span class=\"token punctuation\">-</span> twilight\n  <span class=\"token punctuation\">-</span> atom<span class=\"token punctuation\">-</span>dark\n  <span class=\"token punctuation\">-</span> base16<span class=\"token punctuation\">-</span>ateliersulphurpool.light\n  <span class=\"token punctuation\">-</span> cb\n  <span class=\"token punctuation\">-</span> duotone<span class=\"token punctuation\">-</span>dark\n  <span class=\"token punctuation\">-</span> duotone<span class=\"token punctuation\">-</span>earth\n  <span class=\"token punctuation\">-</span> duotone<span class=\"token punctuation\">-</span>forest\n  <span class=\"token punctuation\">-</span> duotone<span class=\"token punctuation\">-</span>light\n  <span class=\"token punctuation\">-</span> duotone<span class=\"token punctuation\">-</span>sea\n  <span class=\"token punctuation\">-</span> duotone<span class=\"token punctuation\">-</span>space\n  <span class=\"token punctuation\">-</span> ghcolors\n  <span class=\"token punctuation\">-</span> hopscotch\n  <span class=\"token punctuation\">-</span> pojoaque\n  <span class=\"token punctuation\">-</span> vs\n  <span class=\"token punctuation\">-</span> xonokai\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"安装搜索插件\"><a href=\"#安装搜索插件\" class=\"headerlink\" title=\"安装搜索插件\"></a>安装搜索插件</h3><p>使用Hexo插件 <code>hexo-generator-search</code> 搜索内容，安装命令如下：</p>\n<pre class=\"line-numbers language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">npm</span> <span class=\"token function\">install</span> hexo-generator-search --save\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>然后在 <code>hexo</code> 目录下的 <code>_config.yml</code> 添加配置，如下所示：</p>\n<pre class=\"line-numbers language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">search</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> search.xml\n  <span class=\"token key atrule\">field</span><span class=\"token punctuation\">:</span> post\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"安装Hexo-admin插件\"><a href=\"#安装Hexo-admin插件\" class=\"headerlink\" title=\"安装Hexo-admin插件\"></a>安装Hexo-admin插件</h3><p>本地安装完，只能在本地使用，上传github访问不到</p>\n<pre class=\"line-numbers language-bash\"><code class=\"language-bash\"><span class=\"token comment\" spellcheck=\"true\">#安装</span>\n$ <span class=\"token function\">npm</span> <span class=\"token function\">install</span> --save hexo-admin\n<span class=\"token comment\" spellcheck=\"true\">#启动</span>\n$ hexo server -d\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<p>访问 <code>http://localhost:4000/admin</code>即可。</p>\n<h3 id=\"GitHub发布\"><a href=\"#GitHub发布\" class=\"headerlink\" title=\"GitHub发布\"></a>GitHub发布</h3><h4 id=\"创建仓库\"><a href=\"#创建仓库\" class=\"headerlink\" title=\"创建仓库\"></a>创建仓库</h4><p>在github创建一个仓库 <code>asiacuityz/asiacuityz.github.io</code>，注意 <code>/</code> 前后的<code>asiacuityz</code> 一定要保持一致，加个后缀<code>.github.io</code>即可。</p>\n<h4 id=\"SSH生成添加\"><a href=\"#SSH生成添加\" class=\"headerlink\" title=\"SSH生成添加\"></a>SSH生成添加</h4><p><a href=\"https://help.github.com/articles/connecting-to-github-with-ssh/\" target=\"_blank\" rel=\"noopener\">GithubSSH文档</a><br>根据邮箱生成SSH，然后会提示输入密码之类的操作，具体命令如下：</p>\n<pre class=\"line-numbers language-bash\"><code class=\"language-bash\"><span class=\"token comment\" spellcheck=\"true\">#生成SSH</span>\n$ ssh-keygen -t rsa -b 4096 -C <span class=\"token string\">\"your_email@example.com\"</span>\n<span class=\"token comment\" spellcheck=\"true\">#添加SSH</span>\n$ ssh-add ~/.ssh/id_rsa\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<p>执行完命令，窗口会显示key文件生成目录在<code>.ssh</code>下，然后把文件<code>id_rsa.pub</code>里的内容添加到GitHub账户中。添加完毕之后在<code>_config.yml</code>配置如下：</p>\n<pre class=\"line-numbers language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">deploy</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> git\n  <span class=\"token key atrule\">repository</span><span class=\"token punctuation\">:</span> git@github.com<span class=\"token punctuation\">:</span>asiacuityz/asiacuityz.github.io.git\n  <span class=\"token key atrule\">branch</span><span class=\"token punctuation\">:</span> master\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<p>然后就可以执行<code>hexo d</code>发布到GitHub，访问路径<code>https://asiacuityz.github.io/</code>就可以看到页面了。</p>\n<h3 id=\"安装出现问题\"><a href=\"#安装出现问题\" class=\"headerlink\" title=\"安装出现问题\"></a>安装出现问题</h3><ul>\n<li><p>centos32位出现问题</p>\n<p>执行<code>npm install -g hexo</code>命令出现如下错误</p>\n<pre class=\"line-numbers language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> ERR<span class=\"token operator\">!</span> Error: CERT_UNTRUSTED\n<span class=\"token function\">npm</span> ERR<span class=\"token operator\">!</span>    at SecurePair.<span class=\"token operator\">&lt;</span>anonymous<span class=\"token operator\">></span> <span class=\"token punctuation\">(</span>tls.js:1430:32<span class=\"token punctuation\">)</span>\n<span class=\"token function\">npm</span> ERR<span class=\"token operator\">!</span>    at SecurePair.emit <span class=\"token punctuation\">(</span>events.js:92:17<span class=\"token punctuation\">)</span>\n<span class=\"token function\">npm</span> ERR<span class=\"token operator\">!</span>    at SecurePair.maybeInitFinished <span class=\"token punctuation\">(</span>tls.js:1029:10<span class=\"token punctuation\">)</span>\n<span class=\"token function\">npm</span> ERR<span class=\"token operator\">!</span>    at CleartextStream.read <span class=\"token punctuation\">[</span>as _read<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">(</span>tls.js:521:13<span class=\"token punctuation\">)</span>\n<span class=\"token function\">npm</span> ERR<span class=\"token operator\">!</span>    at CleartextStream.Readable.read <span class=\"token punctuation\">(</span>_stream_readable.js:341:10<span class=\"token punctuation\">)</span>\n<span class=\"token function\">npm</span> ERR<span class=\"token operator\">!</span>    at EncryptedStream.write <span class=\"token punctuation\">[</span>as _write<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">(</span>tls.js:418:25<span class=\"token punctuation\">)</span>\n<span class=\"token function\">npm</span> ERR<span class=\"token operator\">!</span>    at doWrite <span class=\"token punctuation\">(</span>_stream_writable.js:226:10<span class=\"token punctuation\">)</span>\n<span class=\"token function\">npm</span> ERR<span class=\"token operator\">!</span>    at writeOrBuffer <span class=\"token punctuation\">(</span>_stream_writable.js:216:5<span class=\"token punctuation\">)</span>\n<span class=\"token function\">npm</span> ERR<span class=\"token operator\">!</span>    at EncryptedStream.Writable.write <span class=\"token punctuation\">(</span>_stream_writable.js:183:11<span class=\"token punctuation\">)</span>\n<span class=\"token function\">npm</span> ERR<span class=\"token operator\">!</span>    at <span class=\"token function\">write</span> <span class=\"token punctuation\">(</span>_stream_readable.js:602:24<span class=\"token punctuation\">)</span>\n<span class=\"token function\">npm</span> ERR<span class=\"token operator\">!</span> If you need help, you may report this log at:\n<span class=\"token function\">npm</span> ERR<span class=\"token operator\">!</span>    <span class=\"token operator\">&lt;</span>http://github.com/isaacs/npm/issues<span class=\"token operator\">></span>\n<span class=\"token function\">npm</span> ERR<span class=\"token operator\">!</span> or email it to:\n<span class=\"token function\">npm</span> ERR<span class=\"token operator\">!</span>    <span class=\"token operator\">&lt;</span>npm-@googlegroups.com<span class=\"token operator\">></span>\n<span class=\"token function\">npm</span> ERR<span class=\"token operator\">!</span> System Linux 2.6.32-696.18.7.el6.x86_64\n<span class=\"token function\">npm</span> ERR<span class=\"token operator\">!</span> <span class=\"token function\">command</span> <span class=\"token string\">\"node\"</span> <span class=\"token string\">\"/usr/bin/npm\"</span> <span class=\"token string\">\"install\"</span> <span class=\"token string\">\"-g\"</span> <span class=\"token string\">\"hexo\"</span>\n<span class=\"token function\">npm</span> ERR<span class=\"token operator\">!</span> cwd /root/github/kingty.github.io\n<span class=\"token function\">npm</span> ERR<span class=\"token operator\">!</span> node -v v0.10.48\n<span class=\"token function\">npm</span> ERR<span class=\"token operator\">!</span> <span class=\"token function\">npm</span> -v 1.3.6\n<span class=\"token function\">npm</span> ERR<span class=\"token operator\">!</span> \n<span class=\"token function\">npm</span> ERR<span class=\"token operator\">!</span> Additional logging details can be found in:\n<span class=\"token function\">npm</span> ERR<span class=\"token operator\">!</span>    /root/github/kingty.github.io/npm-debug.log\n<span class=\"token function\">npm</span> ERR<span class=\"token operator\">!</span> not ok code 0\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n</li>\n</ul>\n<p>这是因为npm用https导致的，解决办法是：</p>\n<pre class=\"line-numbers language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> config <span class=\"token keyword\">set</span> strict-ssl <span class=\"token boolean\">false</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>执行hexo init 出现如下错误：</p>\n<pre class=\"line-numbers language-bash\"><code class=\"language-bash\">/usr/lib/node_modules/hexo/node_modules/hexo-cli/lib/hexo.js:13\nclass HexoNotFoundError extends Error <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n^^^^^\nSyntaxError: Unexpected reserved word\n    at Module._compile <span class=\"token punctuation\">(</span>module.js:439:25<span class=\"token punctuation\">)</span>\n    at Object.Module._extensions<span class=\"token punctuation\">..</span>js <span class=\"token punctuation\">(</span>module.js:474:10<span class=\"token punctuation\">)</span>\n    at Module.load <span class=\"token punctuation\">(</span>module.js:356:32<span class=\"token punctuation\">)</span>\n    at Function.Module._load <span class=\"token punctuation\">(</span>module.js:312:12<span class=\"token punctuation\">)</span>\n    at Module.require <span class=\"token punctuation\">(</span>module.js:364:17<span class=\"token punctuation\">)</span>\n    at require <span class=\"token punctuation\">(</span>module.js:380:17<span class=\"token punctuation\">)</span>\n    at Object.<span class=\"token operator\">&lt;</span>anonymous<span class=\"token operator\">></span> <span class=\"token punctuation\">(</span>/usr/lib/node_modules/hexo/bin/hexo:5:1<span class=\"token punctuation\">)</span>\n    at Module._compile <span class=\"token punctuation\">(</span>module.js:456:26<span class=\"token punctuation\">)</span>\n    at Object.Module._extensions<span class=\"token punctuation\">..</span>js <span class=\"token punctuation\">(</span>module.js:474:10<span class=\"token punctuation\">)</span>\n    at Module.load <span class=\"token punctuation\">(</span>module.js:356:32<span class=\"token punctuation\">)</span>\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>原因是<code>node</code>的版本过低，需要update 一下<code>node</code>到最新版</p>\n<pre class=\"line-numbers language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">npm</span> cache clean -f\n<span class=\"token function\">sudo</span> <span class=\"token function\">npm</span> <span class=\"token function\">install</span> -g n\n<span class=\"token comment\" spellcheck=\"true\">#装哪个版本就v版本号</span>\n<span class=\"token function\">sudo</span> n v9\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"安装简介\"><a href=\"#安装简介\" class=\"headerlink\" title=\"安装简介\"></a>安装简介</h3><ul>\n<li>Git</li>\n<li>Node.js</li>\n<li>hexo-cli</li>\n</ul>\n<h3 id=\"安装Git\"><a href=\"#安装Git\" class=\"headerlink\" title=\"安装Git\"></a>安装Git</h3><p>Git 各平台安装包下载地址为：<a href=\"http://git-scm.com/downloads\" target=\"_blank\" rel=\"noopener\">http://git-scm.com/downloads</a></p>\n<h3 id=\"安装Node-js\"><a href=\"#安装Node-js\" class=\"headerlink\" title=\"安装Node.js\"></a>安装Node.js</h3><ul>\n<li>windows安装node.js</li>\n</ul>\n<p>Node.js 安装包及源码下载地址为：<a href=\"https://nodejs.org/en/download/\" target=\"_blank\" rel=\"noopener\">https://nodejs.org/en/download/</a></p>\n<p>安装完毕测试：</p>\n<pre><code class=\"bash\">$ node -v\n</code></pre>\n<h3 id=\"安装hexo-cli客户端\"><a href=\"#安装hexo-cli客户端\" class=\"headerlink\" title=\"安装hexo-cli客户端\"></a>安装hexo-cli客户端</h3><p><code>hexo-cli</code> 客户端可以执行 <code>hexo</code> 命令。</p>\n<pre><code class=\"bash\">$ npm install hexo-cli -g\n</code></pre>\n<h3 id=\"创建博客目录\"><a href=\"#创建博客目录\" class=\"headerlink\" title=\"创建博客目录\"></a>创建博客目录</h3><p>创建一个 <code>hexo</code> 文件夹，进入到该目录中初始化。</p>\n<pre><code class=\"bash\">#初始化\n$ hexo init\n#清理项目\n$ hexo clean\n#生成文章\n$ hexo g\n#启动hexo\n$ hexo s\n</code></pre>\n<h3 id=\"博客安装主题\"><a href=\"#博客安装主题\" class=\"headerlink\" title=\"博客安装主题\"></a>博客安装主题</h3><p>进入到 <code>hexo</code> 的 <code>theme</code> 目录中，使用 <code>gitbash</code> 执行命令</p>\n<pre><code class=\"bash\">#git下载主题\n$ git clone https://github.com/blinkfox/hexo-theme-matery.git\n</code></pre>\n<p>下载完毕后修改 <code>hexo</code> 目录下的  <code>_config.yml</code> 配置，把 <code>theme</code> 的值修改为主题文件夹的名称</p>\n<pre><code class=\"yaml\">theme: hexo-theme-matery\n</code></pre>\n<h3 id=\"主题配置\"><a href=\"#主题配置\" class=\"headerlink\" title=\"主题配置\"></a>主题配置</h3><p>代码高亮安装<a href=\"https://github.com/ele828/hexo-prism-plugin\" target=\"_blank\" rel=\"noopener\">hexo-prism-plugin</a>插件</p>\n<pre><code class=\"bash\">$ npm i -S hexo-prism-plugin\n</code></pre>\n<p>然后修改<code>hexo</code> 目录下的  <code>_config.yml</code>的值<code>highlight.enable</code>为<code>false</code>，并添加<code>prism</code>插件如下：</p>\n<pre><code class=\"yaml\">#修改为false\nhighlight:\n  enable: false\n#添加插件配置\nprism_plugin:\n  mode: preprocess\n  theme: base16-ateliersulphurpool.light #代码高亮主题\n  line_number: false    # default false\n  custom_css:\n</code></pre>\n<p>其中支持的代码高亮主题有如下几种：</p>\n<pre><code class=\"yaml\">theme:\n  - default\n  - coy\n  - dark\n  - funky\n  - okaidia\n  - solarizedlight\n  - tomorrow\n  - twilight\n  - atom-dark\n  - base16-ateliersulphurpool.light\n  - cb\n  - duotone-dark\n  - duotone-earth\n  - duotone-forest\n  - duotone-light\n  - duotone-sea\n  - duotone-space\n  - ghcolors\n  - hopscotch\n  - pojoaque\n  - vs\n  - xonokai\n</code></pre>\n<h3 id=\"安装搜索插件\"><a href=\"#安装搜索插件\" class=\"headerlink\" title=\"安装搜索插件\"></a>安装搜索插件</h3><p>使用Hexo插件 <code>hexo-generator-search</code> 搜索内容，安装命令如下：</p>\n<pre><code class=\"bash\">$ npm install hexo-generator-search --save\n</code></pre>\n<p>然后在 <code>hexo</code> 目录下的 <code>_config.yml</code> 添加配置，如下所示：</p>\n<pre><code class=\"yaml\">search:\n  path: search.xml\n  field: post\n</code></pre>\n<h3 id=\"安装Hexo-admin插件\"><a href=\"#安装Hexo-admin插件\" class=\"headerlink\" title=\"安装Hexo-admin插件\"></a>安装Hexo-admin插件</h3><p>本地安装完，只能在本地使用，上传github访问不到</p>\n<pre><code class=\"bash\">#安装\n$ npm install --save hexo-admin\n#启动\n$ hexo server -d\n</code></pre>\n<p>访问 <code>http://localhost:4000/admin</code>即可。</p>\n<h3 id=\"GitHub发布\"><a href=\"#GitHub发布\" class=\"headerlink\" title=\"GitHub发布\"></a>GitHub发布</h3><h4 id=\"创建仓库\"><a href=\"#创建仓库\" class=\"headerlink\" title=\"创建仓库\"></a>创建仓库</h4><p>在github创建一个仓库 <code>asiacuityz/asiacuityz.github.io</code>，注意 <code>/</code> 前后的<code>asiacuityz</code> 一定要保持一致，加个后缀<code>.github.io</code>即可。</p>\n<h4 id=\"SSH生成添加\"><a href=\"#SSH生成添加\" class=\"headerlink\" title=\"SSH生成添加\"></a>SSH生成添加</h4><p><a href=\"https://help.github.com/articles/connecting-to-github-with-ssh/\" target=\"_blank\" rel=\"noopener\">GithubSSH文档</a><br>根据邮箱生成SSH，然后会提示输入密码之类的操作，具体命令如下：</p>\n<pre><code class=\"bash\">#生成SSH\n$ ssh-keygen -t rsa -b 4096 -C &quot;your_email@example.com&quot;\n#添加SSH\n$ ssh-add ~/.ssh/id_rsa\n</code></pre>\n<p>执行完命令，窗口会显示key文件生成目录在<code>.ssh</code>下，然后把文件<code>id_rsa.pub</code>里的内容添加到GitHub账户中。添加完毕之后在<code>_config.yml</code>配置如下：</p>\n<pre><code class=\"yaml\">deploy:\n  type: git\n  repository: git@github.com:asiacuityz/asiacuityz.github.io.git\n  branch: master\n</code></pre>\n<p>然后就可以执行<code>hexo d</code>发布到GitHub，访问路径<code>https://asiacuityz.github.io/</code>就可以看到页面了。</p>\n<h3 id=\"安装出现问题\"><a href=\"#安装出现问题\" class=\"headerlink\" title=\"安装出现问题\"></a>安装出现问题</h3><ul>\n<li><p>centos32位出现问题</p>\n<p>执行<code>npm install -g hexo</code>命令出现如下错误</p>\n<pre><code class=\"bash\">npm ERR! Error: CERT_UNTRUSTED\nnpm ERR!    at SecurePair.&lt;anonymous&gt; (tls.js:1430:32)\nnpm ERR!    at SecurePair.emit (events.js:92:17)\nnpm ERR!    at SecurePair.maybeInitFinished (tls.js:1029:10)\nnpm ERR!    at CleartextStream.read [as _read] (tls.js:521:13)\nnpm ERR!    at CleartextStream.Readable.read (_stream_readable.js:341:10)\nnpm ERR!    at EncryptedStream.write [as _write] (tls.js:418:25)\nnpm ERR!    at doWrite (_stream_writable.js:226:10)\nnpm ERR!    at writeOrBuffer (_stream_writable.js:216:5)\nnpm ERR!    at EncryptedStream.Writable.write (_stream_writable.js:183:11)\nnpm ERR!    at write (_stream_readable.js:602:24)\nnpm ERR! If you need help, you may report this log at:\nnpm ERR!    &lt;http://github.com/isaacs/npm/issues&gt;\nnpm ERR! or email it to:\nnpm ERR!    &lt;npm-@googlegroups.com&gt;\nnpm ERR! System Linux 2.6.32-696.18.7.el6.x86_64\nnpm ERR! command &quot;node&quot; &quot;/usr/bin/npm&quot; &quot;install&quot; &quot;-g&quot; &quot;hexo&quot;\nnpm ERR! cwd /root/github/kingty.github.io\nnpm ERR! node -v v0.10.48\nnpm ERR! npm -v 1.3.6\nnpm ERR! \nnpm ERR! Additional logging details can be found in:\nnpm ERR!    /root/github/kingty.github.io/npm-debug.log\nnpm ERR! not ok code 0\n</code></pre>\n</li>\n</ul>\n<p>这是因为npm用https导致的，解决办法是：</p>\n<pre><code class=\"bash\">npm config set strict-ssl false\n</code></pre>\n<p>执行hexo init 出现如下错误：</p>\n<pre><code class=\"bash\">/usr/lib/node_modules/hexo/node_modules/hexo-cli/lib/hexo.js:13\nclass HexoNotFoundError extends Error {}\n^^^^^\nSyntaxError: Unexpected reserved word\n    at Module._compile (module.js:439:25)\n    at Object.Module._extensions..js (module.js:474:10)\n    at Module.load (module.js:356:32)\n    at Function.Module._load (module.js:312:12)\n    at Module.require (module.js:364:17)\n    at require (module.js:380:17)\n    at Object.&lt;anonymous&gt; (/usr/lib/node_modules/hexo/bin/hexo:5:1)\n    at Module._compile (module.js:456:26)\n    at Object.Module._extensions..js (module.js:474:10)\n    at Module.load (module.js:356:32)\n\n</code></pre>\n<p>原因是<code>node</code>的版本过低，需要update 一下<code>node</code>到最新版</p>\n<pre><code class=\"bash\">sudo npm cache clean -f\nsudo npm install -g n\n#装哪个版本就v版本号\nsudo n v9\n</code></pre>\n"},{"title":"Git流","author":"Asia Cui","date":"2019-01-09T10:24:00.000Z","_content":"## Git流\n   ![](/images/git/Git流.png)\n\n1. 工作区\n  进行文档编写的工作目录。\n\n2. 暂存区\n  一般存放在 \".git目录下\" 下的index文件（.git/index）中，所以我们把暂存区有时也叫作索引（index）。工作区的文档编辑完，使用`git add`就是提交到暂存区。\n\n3. 本地版本仓库\n  工作区有一个隐藏目录.git，这个不算工作区，而是Git的版本库。使用`git commit`把暂存区的文档提交到本地仓库版本。\n\n4. 远程版本仓库\n\n   在线存储文档仓库，本地仓库版本使用`git push`即可提交到远程仓库，在此之前需要有远程仓库账号、设置`SSH key`，然后把本地仓库和远程仓库关联才可提交。\n\n\n## Git远程仓库\n\n连接远程仓库需要有git账户，并在本地生成公钥，添加到git账户中。\n\n1. 本地生成SSH key\n\n   ```bash\n   #替换git账户绑定的邮箱，然后一路回车执行\n   ssh-keygen -t rsa -C \"youremail@qq.com\"\n   ```\n\n   执行完毕后会在 `C:\\Users\\Admin\\.ssh` 目录生成三个文件：`id_rsa` `id_rsa.pub` `known_hosts`，把`id_rsa.pub`的内容粘贴到git的ssh key设置中。\n\n\n2. 测试是否和远程git连通\n  ```bash\n  #查看当前是否可以和git远程仓库连通,成功会有successful字样\n  ssh -T git@github.com\n  ```\n\n3. 远程仓库和本地仓库关联\n\n   ```bash\n   #替换git仓库的连接地址\n   git remote add origin https://gitee.com/asiagod/your.git\n   ```\n\n## 本地项目提交远程仓库\n\n1. Git远程创建仓库\n\n   登录Git账户创建仓库。\n\n2. ssh key设置\n\n   生成ssh key并添加到git账户\n\n   ```bash\n   # 替换git账户绑定的邮箱，然后一路回车执行\n   ssh-keygen -t rsa -C \"youremail@qq.com\"\n   ```\n\n   > 如果本地连接了多个Git远程仓库，如github.com、gitee.com，在生成ssh key的时候会覆盖之前的，所以需要配置多个git账户。具体配置如下\n\n   ```bash\n   #全局配置git账户\n   git config user.email \"youremail@qq.com\"\n   #使用此命令生成key，注意指定了文件名为id_rsa.another避免和默认生成的id_rsa重名导致覆盖\n   ssh-keygen -t rsa -f ~/.ssh/id_rsa.another -C \"youremail@qq.com\"\n   \n   #配置所有git账户，在~/.ssh目录创建config文件\n   touch ~/.ssh/config\n   #在config文件中配置多个git账户信息如下\n   Host gitee.com\n       IdentityFile ~/.ssh/id_rsa.another\n       User 476494273@qq.com\n   Host github.com\n       IdentityFile ~/.ssh/id_rsa\n       User asiacuiyz@gmail.com  \n   ```\n   参数详解：\n\n   > - Host：远程Git仓库域名\n   > - IdentityFile：对应的id_rsa文件（私钥）\n   > - User：生成私钥的邮箱或者用户名\n\n3. 远程关联\n\n  ```bash\n  # 替换git仓库的连接地址\n  git remote add origin https://gitee.com/asiagod/your.git\n  ```\n\n4. 本地操作\n   进入到要提交项目目录，执行`pull`命令，把仓库中的文件拉取下来，才能执行`push`，直接执行`push`会报错\n\n   ```bash\n   git pull --rebase origin master\n   ```\n\n   > 注意：第一次必须使用git pull --rebase origin master命令，以后就可以使用git pull命令\n\n5. 项目提交\n\n  ```bash\n  #将文件添加到暂存区\n  git add <文件名或文件夹>\n  #提交暂存区到本地版本库\n  git commit -m \"commit msg\"\n  #提交到远程仓库\n  git push -u origin master\n  \n  ```\n\n","source":"_posts/Git流.md","raw":"title: Git流\nauthor: Asia Cui\ntags:\n  - Git\ncategories:\n  - Git流\ndate: 2019-01-09 18:24:00\n---\n## Git流\n   ![](/images/git/Git流.png)\n\n1. 工作区\n  进行文档编写的工作目录。\n\n2. 暂存区\n  一般存放在 \".git目录下\" 下的index文件（.git/index）中，所以我们把暂存区有时也叫作索引（index）。工作区的文档编辑完，使用`git add`就是提交到暂存区。\n\n3. 本地版本仓库\n  工作区有一个隐藏目录.git，这个不算工作区，而是Git的版本库。使用`git commit`把暂存区的文档提交到本地仓库版本。\n\n4. 远程版本仓库\n\n   在线存储文档仓库，本地仓库版本使用`git push`即可提交到远程仓库，在此之前需要有远程仓库账号、设置`SSH key`，然后把本地仓库和远程仓库关联才可提交。\n\n\n## Git远程仓库\n\n连接远程仓库需要有git账户，并在本地生成公钥，添加到git账户中。\n\n1. 本地生成SSH key\n\n   ```bash\n   #替换git账户绑定的邮箱，然后一路回车执行\n   ssh-keygen -t rsa -C \"youremail@qq.com\"\n   ```\n\n   执行完毕后会在 `C:\\Users\\Admin\\.ssh` 目录生成三个文件：`id_rsa` `id_rsa.pub` `known_hosts`，把`id_rsa.pub`的内容粘贴到git的ssh key设置中。\n\n\n2. 测试是否和远程git连通\n  ```bash\n  #查看当前是否可以和git远程仓库连通,成功会有successful字样\n  ssh -T git@github.com\n  ```\n\n3. 远程仓库和本地仓库关联\n\n   ```bash\n   #替换git仓库的连接地址\n   git remote add origin https://gitee.com/asiagod/your.git\n   ```\n\n## 本地项目提交远程仓库\n\n1. Git远程创建仓库\n\n   登录Git账户创建仓库。\n\n2. ssh key设置\n\n   生成ssh key并添加到git账户\n\n   ```bash\n   # 替换git账户绑定的邮箱，然后一路回车执行\n   ssh-keygen -t rsa -C \"youremail@qq.com\"\n   ```\n\n   > 如果本地连接了多个Git远程仓库，如github.com、gitee.com，在生成ssh key的时候会覆盖之前的，所以需要配置多个git账户。具体配置如下\n\n   ```bash\n   #全局配置git账户\n   git config user.email \"youremail@qq.com\"\n   #使用此命令生成key，注意指定了文件名为id_rsa.another避免和默认生成的id_rsa重名导致覆盖\n   ssh-keygen -t rsa -f ~/.ssh/id_rsa.another -C \"youremail@qq.com\"\n   \n   #配置所有git账户，在~/.ssh目录创建config文件\n   touch ~/.ssh/config\n   #在config文件中配置多个git账户信息如下\n   Host gitee.com\n       IdentityFile ~/.ssh/id_rsa.another\n       User 476494273@qq.com\n   Host github.com\n       IdentityFile ~/.ssh/id_rsa\n       User asiacuiyz@gmail.com  \n   ```\n   参数详解：\n\n   > - Host：远程Git仓库域名\n   > - IdentityFile：对应的id_rsa文件（私钥）\n   > - User：生成私钥的邮箱或者用户名\n\n3. 远程关联\n\n  ```bash\n  # 替换git仓库的连接地址\n  git remote add origin https://gitee.com/asiagod/your.git\n  ```\n\n4. 本地操作\n   进入到要提交项目目录，执行`pull`命令，把仓库中的文件拉取下来，才能执行`push`，直接执行`push`会报错\n\n   ```bash\n   git pull --rebase origin master\n   ```\n\n   > 注意：第一次必须使用git pull --rebase origin master命令，以后就可以使用git pull命令\n\n5. 项目提交\n\n  ```bash\n  #将文件添加到暂存区\n  git add <文件名或文件夹>\n  #提交暂存区到本地版本库\n  git commit -m \"commit msg\"\n  #提交到远程仓库\n  git push -u origin master\n  \n  ```\n\n","slug":"Git流","published":1,"updated":"2019-01-10T07:28:46.181Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjs17mhx70002pwgtoh6yd5uy","content":"<h2 id=\"Git流\"><a href=\"#Git流\" class=\"headerlink\" title=\"Git流\"></a>Git流</h2><p>   <img src=\"/images/git/Git流.png\" alt=\"\"></p>\n<ol>\n<li><p>工作区<br>进行文档编写的工作目录。</p>\n</li>\n<li><p>暂存区<br>一般存放在 “.git目录下” 下的index文件（.git/index）中，所以我们把暂存区有时也叫作索引（index）。工作区的文档编辑完，使用<code>git add</code>就是提交到暂存区。</p>\n</li>\n<li><p>本地版本仓库<br>工作区有一个隐藏目录.git，这个不算工作区，而是Git的版本库。使用<code>git commit</code>把暂存区的文档提交到本地仓库版本。</p>\n</li>\n<li><p>远程版本仓库</p>\n<p>在线存储文档仓库，本地仓库版本使用<code>git push</code>即可提交到远程仓库，在此之前需要有远程仓库账号、设置<code>SSH key</code>，然后把本地仓库和远程仓库关联才可提交。</p>\n</li>\n</ol>\n<h2 id=\"Git远程仓库\"><a href=\"#Git远程仓库\" class=\"headerlink\" title=\"Git远程仓库\"></a>Git远程仓库</h2><p>连接远程仓库需要有git账户，并在本地生成公钥，添加到git账户中。</p>\n<ol>\n<li><p>本地生成SSH key</p>\n<pre class=\"line-numbers language-bash\"><code class=\"language-bash\"><span class=\"token comment\" spellcheck=\"true\">#替换git账户绑定的邮箱，然后一路回车执行</span>\nssh-keygen -t rsa -C <span class=\"token string\">\"youremail@qq.com\"</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>执行完毕后会在 <code>C:\\Users\\Admin\\.ssh</code> 目录生成三个文件：<code>id_rsa</code> <code>id_rsa.pub</code> <code>known_hosts</code>，把<code>id_rsa.pub</code>的内容粘贴到git的ssh key设置中。</p>\n</li>\n</ol>\n<ol start=\"2\">\n<li><p>测试是否和远程git连通</p>\n<pre class=\"line-numbers language-bash\"><code class=\"language-bash\"><span class=\"token comment\" spellcheck=\"true\">#查看当前是否可以和git远程仓库连通,成功会有successful字样</span>\n<span class=\"token function\">ssh</span> -T git@github.com\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n</li>\n<li><p>远程仓库和本地仓库关联</p>\n<pre class=\"line-numbers language-bash\"><code class=\"language-bash\"><span class=\"token comment\" spellcheck=\"true\">#替换git仓库的连接地址</span>\n<span class=\"token function\">git</span> remote add origin https://gitee.com/asiagod/your.git\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n</li>\n</ol>\n<h2 id=\"本地项目提交远程仓库\"><a href=\"#本地项目提交远程仓库\" class=\"headerlink\" title=\"本地项目提交远程仓库\"></a>本地项目提交远程仓库</h2><ol>\n<li><p>Git远程创建仓库</p>\n<p>登录Git账户创建仓库。</p>\n</li>\n<li><p>ssh key设置</p>\n<p>生成ssh key并添加到git账户</p>\n<pre class=\"line-numbers language-bash\"><code class=\"language-bash\"><span class=\"token comment\" spellcheck=\"true\"># 替换git账户绑定的邮箱，然后一路回车执行</span>\nssh-keygen -t rsa -C <span class=\"token string\">\"youremail@qq.com\"</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<blockquote>\n<p>如果本地连接了多个Git远程仓库，如github.com、gitee.com，在生成ssh key的时候会覆盖之前的，所以需要配置多个git账户。具体配置如下</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\"><code class=\"language-bash\"><span class=\"token comment\" spellcheck=\"true\">#全局配置git账户</span>\n<span class=\"token function\">git</span> config user.email <span class=\"token string\">\"youremail@qq.com\"</span>\n<span class=\"token comment\" spellcheck=\"true\">#使用此命令生成key，注意指定了文件名为id_rsa.another避免和默认生成的id_rsa重名导致覆盖</span>\nssh-keygen -t rsa -f ~/.ssh/id_rsa.another -C <span class=\"token string\">\"youremail@qq.com\"</span>\n\n<span class=\"token comment\" spellcheck=\"true\">#配置所有git账户，在~/.ssh目录创建config文件</span>\n<span class=\"token function\">touch</span> ~/.ssh/config\n<span class=\"token comment\" spellcheck=\"true\">#在config文件中配置多个git账户信息如下</span>\nHost gitee.com\n    IdentityFile ~/.ssh/id_rsa.another\n    User 476494273@qq.com\nHost github.com\n    IdentityFile ~/.ssh/id_rsa\n    User asiacuiyz@gmail.com  \n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>参数详解：</p>\n<blockquote>\n<ul>\n<li>Host：远程Git仓库域名</li>\n<li>IdentityFile：对应的id_rsa文件（私钥）</li>\n<li>User：生成私钥的邮箱或者用户名</li>\n</ul>\n</blockquote>\n</li>\n<li><p>远程关联</p>\n<pre class=\"line-numbers language-bash\"><code class=\"language-bash\"><span class=\"token comment\" spellcheck=\"true\"># 替换git仓库的连接地址</span>\n<span class=\"token function\">git</span> remote add origin https://gitee.com/asiagod/your.git\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n</li>\n<li><p>本地操作<br>进入到要提交项目目录，执行<code>pull</code>命令，把仓库中的文件拉取下来，才能执行<code>push</code>，直接执行<code>push</code>会报错</p>\n<pre class=\"line-numbers language-bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> pull --rebase origin master\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<blockquote>\n<p>注意：第一次必须使用git pull –rebase origin master命令，以后就可以使用git pull命令</p>\n</blockquote>\n</li>\n<li><p>项目提交</p>\n<pre class=\"line-numbers language-bash\"><code class=\"language-bash\"><span class=\"token comment\" spellcheck=\"true\">#将文件添加到暂存区</span>\n<span class=\"token function\">git</span> add <span class=\"token operator\">&lt;</span>文件名或文件夹<span class=\"token operator\">></span>\n<span class=\"token comment\" spellcheck=\"true\">#提交暂存区到本地版本库</span>\n<span class=\"token function\">git</span> commit -m <span class=\"token string\">\"commit msg\"</span>\n<span class=\"token comment\" spellcheck=\"true\">#提交到远程仓库</span>\n<span class=\"token function\">git</span> push -u origin master\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n</li>\n</ol>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"Git流\"><a href=\"#Git流\" class=\"headerlink\" title=\"Git流\"></a>Git流</h2><p>   <img src=\"/images/git/Git流.png\" alt=\"\"></p>\n<ol>\n<li><p>工作区<br>进行文档编写的工作目录。</p>\n</li>\n<li><p>暂存区<br>一般存放在 “.git目录下” 下的index文件（.git/index）中，所以我们把暂存区有时也叫作索引（index）。工作区的文档编辑完，使用<code>git add</code>就是提交到暂存区。</p>\n</li>\n<li><p>本地版本仓库<br>工作区有一个隐藏目录.git，这个不算工作区，而是Git的版本库。使用<code>git commit</code>把暂存区的文档提交到本地仓库版本。</p>\n</li>\n<li><p>远程版本仓库</p>\n<p>在线存储文档仓库，本地仓库版本使用<code>git push</code>即可提交到远程仓库，在此之前需要有远程仓库账号、设置<code>SSH key</code>，然后把本地仓库和远程仓库关联才可提交。</p>\n</li>\n</ol>\n<h2 id=\"Git远程仓库\"><a href=\"#Git远程仓库\" class=\"headerlink\" title=\"Git远程仓库\"></a>Git远程仓库</h2><p>连接远程仓库需要有git账户，并在本地生成公钥，添加到git账户中。</p>\n<ol>\n<li><p>本地生成SSH key</p>\n<pre><code class=\"bash\">#替换git账户绑定的邮箱，然后一路回车执行\nssh-keygen -t rsa -C &quot;youremail@qq.com&quot;\n</code></pre>\n<p>执行完毕后会在 <code>C:\\Users\\Admin\\.ssh</code> 目录生成三个文件：<code>id_rsa</code> <code>id_rsa.pub</code> <code>known_hosts</code>，把<code>id_rsa.pub</code>的内容粘贴到git的ssh key设置中。</p>\n</li>\n</ol>\n<ol start=\"2\">\n<li><p>测试是否和远程git连通</p>\n<pre><code class=\"bash\">#查看当前是否可以和git远程仓库连通,成功会有successful字样\nssh -T git@github.com\n</code></pre>\n</li>\n<li><p>远程仓库和本地仓库关联</p>\n<pre><code class=\"bash\">#替换git仓库的连接地址\ngit remote add origin https://gitee.com/asiagod/your.git\n</code></pre>\n</li>\n</ol>\n<h2 id=\"本地项目提交远程仓库\"><a href=\"#本地项目提交远程仓库\" class=\"headerlink\" title=\"本地项目提交远程仓库\"></a>本地项目提交远程仓库</h2><ol>\n<li><p>Git远程创建仓库</p>\n<p>登录Git账户创建仓库。</p>\n</li>\n<li><p>ssh key设置</p>\n<p>生成ssh key并添加到git账户</p>\n<pre><code class=\"bash\"># 替换git账户绑定的邮箱，然后一路回车执行\nssh-keygen -t rsa -C &quot;youremail@qq.com&quot;\n</code></pre>\n<blockquote>\n<p>如果本地连接了多个Git远程仓库，如github.com、gitee.com，在生成ssh key的时候会覆盖之前的，所以需要配置多个git账户。具体配置如下</p>\n</blockquote>\n<pre><code class=\"bash\">#全局配置git账户\ngit config user.email &quot;youremail@qq.com&quot;\n#使用此命令生成key，注意指定了文件名为id_rsa.another避免和默认生成的id_rsa重名导致覆盖\nssh-keygen -t rsa -f ~/.ssh/id_rsa.another -C &quot;youremail@qq.com&quot;\n\n#配置所有git账户，在~/.ssh目录创建config文件\ntouch ~/.ssh/config\n#在config文件中配置多个git账户信息如下\nHost gitee.com\n    IdentityFile ~/.ssh/id_rsa.another\n    User 476494273@qq.com\nHost github.com\n    IdentityFile ~/.ssh/id_rsa\n    User asiacuiyz@gmail.com  \n</code></pre>\n<p>参数详解：</p>\n<blockquote>\n<ul>\n<li>Host：远程Git仓库域名</li>\n<li>IdentityFile：对应的id_rsa文件（私钥）</li>\n<li>User：生成私钥的邮箱或者用户名</li>\n</ul>\n</blockquote>\n</li>\n<li><p>远程关联</p>\n<pre><code class=\"bash\"># 替换git仓库的连接地址\ngit remote add origin https://gitee.com/asiagod/your.git\n</code></pre>\n</li>\n<li><p>本地操作<br>进入到要提交项目目录，执行<code>pull</code>命令，把仓库中的文件拉取下来，才能执行<code>push</code>，直接执行<code>push</code>会报错</p>\n<pre><code class=\"bash\">git pull --rebase origin master\n</code></pre>\n<blockquote>\n<p>注意：第一次必须使用git pull –rebase origin master命令，以后就可以使用git pull命令</p>\n</blockquote>\n</li>\n<li><p>项目提交</p>\n<pre><code class=\"bash\">#将文件添加到暂存区\ngit add &lt;文件名或文件夹&gt;\n#提交暂存区到本地版本库\ngit commit -m &quot;commit msg&quot;\n#提交到远程仓库\ngit push -u origin master\n\n</code></pre>\n</li>\n</ol>\n"},{"title":"JNI 加载本地dll类库","author":"Asia Cui","date":"2018-12-31T04:22:00.000Z","_content":"```java\nimport java.io.File;\nimport java.io.FileOutputStream;\nimport java.io.IOException;\nimport java.io.InputStream;\nimport java.text.SimpleDateFormat;\nimport java.util.Date;\n\n/**\n * 加载本地dll类库，调用实例<code>Library.load(\"IESNlp.dll\");</code>\n * try {\n * \t\tJniLibrary.loadLibrary(\"IESNlp.dll\",\"2018-03-13\");\n * } finally {\n *      System.out.println(\"Loading \" + \"IESNlp.dll\");\n * }\n */\npublic class JniLibrary {\n\n\tstatic final String SEPARATOR;\n\n\tstatic {\n\t\tSEPARATOR = System.getProperty(\"file.separator\");\n\t}\n\n\t/**\n\t * <p>\n\t * 重jar文件中抽取出dll文件\n\t * </p>\n\t * \n\t * @param fileName\n\t *            ：抽取文件名，包含路径\n\t * @param mappedName\n\t *            ： dll文件名\n\t * @return\n\t */\n\tprivate static boolean extract(String fileName, String mappedName) {\n\t\tFileOutputStream os = null;\n\t\tInputStream is = null;\n\t\tFile file = new File(fileName);\n\t\ttry {\n\t\t\t// 如果文件存在则先进行删除操作\n\t\t\tif (file.exists()) {\n\t\t\t\tfile.delete();\n\t\t\t}\n\t\t\t// 从jar文件中读取dll文件\n\t\t\tis = JniLibrary.class.getResourceAsStream(\"/resources/\" + mappedName);\n\t\t\tif (is != null) {\n\t\t\t\tint read;\n\t\t\t\tbyte[] buffer = new byte[4096];\n\t\t\t\tos = new FileOutputStream(fileName);\n\t\t\t\twhile ((read = is.read(buffer)) != -1) {\n\t\t\t\t\tos.write(buffer, 0, read);\n\t\t\t\t}\n\t\t\t\tos.close();\n\t\t\t\tis.close();\n\t\t\t\treturn true;\n\t\t\t}\n\t\t} catch (Throwable e) {\n\t\t\ttry {\n\t\t\t\tif (os != null)\n\t\t\t\t\tos.close();\n\t\t\t\tif (is != null)\n\t\t\t\t\tis.close();\n\t\t\t} catch (IOException e1) {\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tprivate static boolean load(String libName) {\n\t\ttry {\n\t\t\tif (libName.indexOf(SEPARATOR) != -1) {\n\t\t\t\tSystem.load(libName);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t} catch (UnsatisfiedLinkError e) {\n\t\t\te.printStackTrace();\n\t\t}\n\t\treturn false;\n\t}\n\n\tpublic static void extract(String name) {\n\t\tString libName = name;\n\t\t// 尝试从系统临时目录加载该文件\n\t\tString path = System.getProperty(\"java.io.tmpdir\"); //$NON-NLS-1$\n\t\tif (path != null) {\n\t\t\t// 创建jni文件夹\n\t\t\tpath = path + \"jni\";\n\t\t\tFile file = new File(path);\n\t\t\tpath = file.getAbsolutePath();\n\t\t\t// 文件夹是否存在\n\t\t\tif (!file.exists()) {\n\t\t\t\tif (!file.mkdirs()) {\n\t\t\t\t\tthrow new UnsatisfiedLinkError(\"创建文件夹\" + path + \"失败\");\n\t\t\t\t}\n\t\t\t}\n\t\t\tString fileName = path + SEPARATOR + libName;\n\t\t\tfile = new File(fileName);\n\t\t\tif (!file.exists()) {\n\t\t\t\textract(fileName, libName);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * 加载类库\n\t * \n\t * @param name: dll名称\n\t * @param expdate: dll最后修改日期.格式为:yyyy-MM-dd.如:2009-06-11\n\t */\n\tpublic static void loadLibrary(String name, String expdate) {\n\t\tString libName = name;\n\t\t// 尝试从系统临时目录加载该文件\n\t\tString path = System.getProperty(\"java.io.tmpdir\"); //$NON-NLS-1$\n\t\tif (path != null) {\n\t\t\t// 创建jni文件夹\n\t\t\tpath = path + \"jni\";\n\t\t\tFile file = new File(path);\n\t\t\tpath = file.getAbsolutePath();\n\t\t\t// 文件夹是否存在\n\t\t\tif (!file.exists()) {\n\t\t\t\tif (!file.mkdirs()) {\n\t\t\t\t\tthrow new UnsatisfiedLinkError(\"创建文件夹\" + path + \"失败\");\n\t\t\t\t}\n\t\t\t}\n\t\t\tString fileName = path + SEPARATOR + libName;\n\t\t\tfile = new File(fileName);\n\t\t\t// 判断文件是否存在，不存在进行重新生成\n\t\t\tDate date = new Date(file.lastModified());\n\t\t\tSimpleDateFormat sdf = new SimpleDateFormat(\"yyyy-MM-dd\");\n\t\t\tString modifyDate = sdf.format(date);\n\t\t\tif (!file.exists() || !modifyDate.equals(expdate)) {\n\t\t\t\tif (extract(fileName, libName)) {\n\t\t\t\t\tload(fileName);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (load(fileName))\n\t\t\t\treturn;\n\t\t}\n\t\t// 加载失败，从临时目录和jar文件都都没有找到该文件\n\t\tthrow new UnsatisfiedLinkError(\"no \" + libName + \" in java.io.tmpdir or the jar file\");\n\t}\n\n}\n\n```","source":"_posts/JNI-加载本地dll类库.md","raw":"title: JNI 加载本地dll类库\nauthor: Asia Cui\ntags:\n  - Java工具类\ncategories:\n  - JNI 加载本地dll类库\ndate: 2018-12-31 12:22:00\n---\n```java\nimport java.io.File;\nimport java.io.FileOutputStream;\nimport java.io.IOException;\nimport java.io.InputStream;\nimport java.text.SimpleDateFormat;\nimport java.util.Date;\n\n/**\n * 加载本地dll类库，调用实例<code>Library.load(\"IESNlp.dll\");</code>\n * try {\n * \t\tJniLibrary.loadLibrary(\"IESNlp.dll\",\"2018-03-13\");\n * } finally {\n *      System.out.println(\"Loading \" + \"IESNlp.dll\");\n * }\n */\npublic class JniLibrary {\n\n\tstatic final String SEPARATOR;\n\n\tstatic {\n\t\tSEPARATOR = System.getProperty(\"file.separator\");\n\t}\n\n\t/**\n\t * <p>\n\t * 重jar文件中抽取出dll文件\n\t * </p>\n\t * \n\t * @param fileName\n\t *            ：抽取文件名，包含路径\n\t * @param mappedName\n\t *            ： dll文件名\n\t * @return\n\t */\n\tprivate static boolean extract(String fileName, String mappedName) {\n\t\tFileOutputStream os = null;\n\t\tInputStream is = null;\n\t\tFile file = new File(fileName);\n\t\ttry {\n\t\t\t// 如果文件存在则先进行删除操作\n\t\t\tif (file.exists()) {\n\t\t\t\tfile.delete();\n\t\t\t}\n\t\t\t// 从jar文件中读取dll文件\n\t\t\tis = JniLibrary.class.getResourceAsStream(\"/resources/\" + mappedName);\n\t\t\tif (is != null) {\n\t\t\t\tint read;\n\t\t\t\tbyte[] buffer = new byte[4096];\n\t\t\t\tos = new FileOutputStream(fileName);\n\t\t\t\twhile ((read = is.read(buffer)) != -1) {\n\t\t\t\t\tos.write(buffer, 0, read);\n\t\t\t\t}\n\t\t\t\tos.close();\n\t\t\t\tis.close();\n\t\t\t\treturn true;\n\t\t\t}\n\t\t} catch (Throwable e) {\n\t\t\ttry {\n\t\t\t\tif (os != null)\n\t\t\t\t\tos.close();\n\t\t\t\tif (is != null)\n\t\t\t\t\tis.close();\n\t\t\t} catch (IOException e1) {\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tprivate static boolean load(String libName) {\n\t\ttry {\n\t\t\tif (libName.indexOf(SEPARATOR) != -1) {\n\t\t\t\tSystem.load(libName);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t} catch (UnsatisfiedLinkError e) {\n\t\t\te.printStackTrace();\n\t\t}\n\t\treturn false;\n\t}\n\n\tpublic static void extract(String name) {\n\t\tString libName = name;\n\t\t// 尝试从系统临时目录加载该文件\n\t\tString path = System.getProperty(\"java.io.tmpdir\"); //$NON-NLS-1$\n\t\tif (path != null) {\n\t\t\t// 创建jni文件夹\n\t\t\tpath = path + \"jni\";\n\t\t\tFile file = new File(path);\n\t\t\tpath = file.getAbsolutePath();\n\t\t\t// 文件夹是否存在\n\t\t\tif (!file.exists()) {\n\t\t\t\tif (!file.mkdirs()) {\n\t\t\t\t\tthrow new UnsatisfiedLinkError(\"创建文件夹\" + path + \"失败\");\n\t\t\t\t}\n\t\t\t}\n\t\t\tString fileName = path + SEPARATOR + libName;\n\t\t\tfile = new File(fileName);\n\t\t\tif (!file.exists()) {\n\t\t\t\textract(fileName, libName);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * 加载类库\n\t * \n\t * @param name: dll名称\n\t * @param expdate: dll最后修改日期.格式为:yyyy-MM-dd.如:2009-06-11\n\t */\n\tpublic static void loadLibrary(String name, String expdate) {\n\t\tString libName = name;\n\t\t// 尝试从系统临时目录加载该文件\n\t\tString path = System.getProperty(\"java.io.tmpdir\"); //$NON-NLS-1$\n\t\tif (path != null) {\n\t\t\t// 创建jni文件夹\n\t\t\tpath = path + \"jni\";\n\t\t\tFile file = new File(path);\n\t\t\tpath = file.getAbsolutePath();\n\t\t\t// 文件夹是否存在\n\t\t\tif (!file.exists()) {\n\t\t\t\tif (!file.mkdirs()) {\n\t\t\t\t\tthrow new UnsatisfiedLinkError(\"创建文件夹\" + path + \"失败\");\n\t\t\t\t}\n\t\t\t}\n\t\t\tString fileName = path + SEPARATOR + libName;\n\t\t\tfile = new File(fileName);\n\t\t\t// 判断文件是否存在，不存在进行重新生成\n\t\t\tDate date = new Date(file.lastModified());\n\t\t\tSimpleDateFormat sdf = new SimpleDateFormat(\"yyyy-MM-dd\");\n\t\t\tString modifyDate = sdf.format(date);\n\t\t\tif (!file.exists() || !modifyDate.equals(expdate)) {\n\t\t\t\tif (extract(fileName, libName)) {\n\t\t\t\t\tload(fileName);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (load(fileName))\n\t\t\t\treturn;\n\t\t}\n\t\t// 加载失败，从临时目录和jar文件都都没有找到该文件\n\t\tthrow new UnsatisfiedLinkError(\"no \" + libName + \" in java.io.tmpdir or the jar file\");\n\t}\n\n}\n\n```","slug":"JNI-加载本地dll类库","published":1,"updated":"2019-01-02T09:56:51.164Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjs17mhxf0005pwgtt93vndu4","content":"<pre class=\"line-numbers language-java\"><code class=\"language-java\"><span class=\"token keyword\">import</span> java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span>File<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span>FileOutputStream<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span>IOException<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span>InputStream<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> java<span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">.</span>SimpleDateFormat<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span>Date<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\" spellcheck=\"true\">/**\n * 加载本地dll类库，调用实例&lt;code>Library.load(\"IESNlp.dll\");&lt;/code>\n * try {\n *         JniLibrary.loadLibrary(\"IESNlp.dll\",\"2018-03-13\");\n * } finally {\n *      System.out.println(\"Loading \" + \"IESNlp.dll\");\n * }\n */</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">JniLibrary</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> String SEPARATOR<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">static</span> <span class=\"token punctuation\">{</span>\n        SEPARATOR <span class=\"token operator\">=</span> System<span class=\"token punctuation\">.</span><span class=\"token function\">getProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"file.separator\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">/**\n     * &lt;p>\n     * 重jar文件中抽取出dll文件\n     * &lt;/p>\n     * \n     * @param fileName\n     *            ：抽取文件名，包含路径\n     * @param mappedName\n     *            ： dll文件名\n     * @return\n     */</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">extract</span><span class=\"token punctuation\">(</span>String fileName<span class=\"token punctuation\">,</span> String mappedName<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        FileOutputStream os <span class=\"token operator\">=</span> null<span class=\"token punctuation\">;</span>\n        InputStream is <span class=\"token operator\">=</span> null<span class=\"token punctuation\">;</span>\n        File file <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">File</span><span class=\"token punctuation\">(</span>fileName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\" spellcheck=\"true\">// 如果文件存在则先进行删除操作</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">.</span><span class=\"token function\">exists</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                file<span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token comment\" spellcheck=\"true\">// 从jar文件中读取dll文件</span>\n            is <span class=\"token operator\">=</span> JniLibrary<span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">.</span><span class=\"token function\">getResourceAsStream</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/resources/\"</span> <span class=\"token operator\">+</span> mappedName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>is <span class=\"token operator\">!=</span> null<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">int</span> read<span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> buffer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">byte</span><span class=\"token punctuation\">[</span><span class=\"token number\">4096</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n                os <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileOutputStream</span><span class=\"token punctuation\">(</span>fileName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>read <span class=\"token operator\">=</span> is<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    os<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> read<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n                os<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                is<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Throwable</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>os <span class=\"token operator\">!=</span> null<span class=\"token punctuation\">)</span>\n                    os<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>is <span class=\"token operator\">!=</span> null<span class=\"token punctuation\">)</span>\n                    is<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e1<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">load</span><span class=\"token punctuation\">(</span>String libName<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>libName<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span>SEPARATOR<span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                System<span class=\"token punctuation\">.</span><span class=\"token function\">load</span><span class=\"token punctuation\">(</span>libName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">UnsatisfiedLinkError</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">extract</span><span class=\"token punctuation\">(</span>String name<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        String libName <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span>\n        <span class=\"token comment\" spellcheck=\"true\">// 尝试从系统临时目录加载该文件</span>\n        String path <span class=\"token operator\">=</span> System<span class=\"token punctuation\">.</span><span class=\"token function\">getProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"java.io.tmpdir\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\" spellcheck=\"true\">//$NON-NLS-1$</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>path <span class=\"token operator\">!=</span> null<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\" spellcheck=\"true\">// 创建jni文件夹</span>\n            path <span class=\"token operator\">=</span> path <span class=\"token operator\">+</span> <span class=\"token string\">\"jni\"</span><span class=\"token punctuation\">;</span>\n            File file <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">File</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            path <span class=\"token operator\">=</span> file<span class=\"token punctuation\">.</span><span class=\"token function\">getAbsolutePath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token comment\" spellcheck=\"true\">// 文件夹是否存在</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>file<span class=\"token punctuation\">.</span><span class=\"token function\">exists</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>file<span class=\"token punctuation\">.</span><span class=\"token function\">mkdirs</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">UnsatisfiedLinkError</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"创建文件夹\"</span> <span class=\"token operator\">+</span> path <span class=\"token operator\">+</span> <span class=\"token string\">\"失败\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n            String fileName <span class=\"token operator\">=</span> path <span class=\"token operator\">+</span> SEPARATOR <span class=\"token operator\">+</span> libName<span class=\"token punctuation\">;</span>\n            file <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">File</span><span class=\"token punctuation\">(</span>fileName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>file<span class=\"token punctuation\">.</span><span class=\"token function\">exists</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token function\">extract</span><span class=\"token punctuation\">(</span>fileName<span class=\"token punctuation\">,</span> libName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">/**\n     * 加载类库\n     * \n     * @param name: dll名称\n     * @param expdate: dll最后修改日期.格式为:yyyy-MM-dd.如:2009-06-11\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">loadLibrary</span><span class=\"token punctuation\">(</span>String name<span class=\"token punctuation\">,</span> String expdate<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        String libName <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span>\n        <span class=\"token comment\" spellcheck=\"true\">// 尝试从系统临时目录加载该文件</span>\n        String path <span class=\"token operator\">=</span> System<span class=\"token punctuation\">.</span><span class=\"token function\">getProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"java.io.tmpdir\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\" spellcheck=\"true\">//$NON-NLS-1$</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>path <span class=\"token operator\">!=</span> null<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\" spellcheck=\"true\">// 创建jni文件夹</span>\n            path <span class=\"token operator\">=</span> path <span class=\"token operator\">+</span> <span class=\"token string\">\"jni\"</span><span class=\"token punctuation\">;</span>\n            File file <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">File</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            path <span class=\"token operator\">=</span> file<span class=\"token punctuation\">.</span><span class=\"token function\">getAbsolutePath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token comment\" spellcheck=\"true\">// 文件夹是否存在</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>file<span class=\"token punctuation\">.</span><span class=\"token function\">exists</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>file<span class=\"token punctuation\">.</span><span class=\"token function\">mkdirs</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">UnsatisfiedLinkError</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"创建文件夹\"</span> <span class=\"token operator\">+</span> path <span class=\"token operator\">+</span> <span class=\"token string\">\"失败\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n            String fileName <span class=\"token operator\">=</span> path <span class=\"token operator\">+</span> SEPARATOR <span class=\"token operator\">+</span> libName<span class=\"token punctuation\">;</span>\n            file <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">File</span><span class=\"token punctuation\">(</span>fileName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token comment\" spellcheck=\"true\">// 判断文件是否存在，不存在进行重新生成</span>\n            Date date <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">.</span><span class=\"token function\">lastModified</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            SimpleDateFormat sdf <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SimpleDateFormat</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"yyyy-MM-dd\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            String modifyDate <span class=\"token operator\">=</span> sdf<span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span>date<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>file<span class=\"token punctuation\">.</span><span class=\"token function\">exists</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token operator\">!</span>modifyDate<span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>expdate<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">extract</span><span class=\"token punctuation\">(</span>fileName<span class=\"token punctuation\">,</span> libName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token function\">load</span><span class=\"token punctuation\">(</span>fileName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">load</span><span class=\"token punctuation\">(</span>fileName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token comment\" spellcheck=\"true\">// 加载失败，从临时目录和jar文件都都没有找到该文件</span>\n        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">UnsatisfiedLinkError</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"no \"</span> <span class=\"token operator\">+</span> libName <span class=\"token operator\">+</span> <span class=\"token string\">\" in java.io.tmpdir or the jar file\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span>\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n","site":{"data":{}},"excerpt":"","more":"<pre><code class=\"java\">import java.io.File;\nimport java.io.FileOutputStream;\nimport java.io.IOException;\nimport java.io.InputStream;\nimport java.text.SimpleDateFormat;\nimport java.util.Date;\n\n/**\n * 加载本地dll类库，调用实例&lt;code&gt;Library.load(&quot;IESNlp.dll&quot;);&lt;/code&gt;\n * try {\n *         JniLibrary.loadLibrary(&quot;IESNlp.dll&quot;,&quot;2018-03-13&quot;);\n * } finally {\n *      System.out.println(&quot;Loading &quot; + &quot;IESNlp.dll&quot;);\n * }\n */\npublic class JniLibrary {\n\n    static final String SEPARATOR;\n\n    static {\n        SEPARATOR = System.getProperty(&quot;file.separator&quot;);\n    }\n\n    /**\n     * &lt;p&gt;\n     * 重jar文件中抽取出dll文件\n     * &lt;/p&gt;\n     * \n     * @param fileName\n     *            ：抽取文件名，包含路径\n     * @param mappedName\n     *            ： dll文件名\n     * @return\n     */\n    private static boolean extract(String fileName, String mappedName) {\n        FileOutputStream os = null;\n        InputStream is = null;\n        File file = new File(fileName);\n        try {\n            // 如果文件存在则先进行删除操作\n            if (file.exists()) {\n                file.delete();\n            }\n            // 从jar文件中读取dll文件\n            is = JniLibrary.class.getResourceAsStream(&quot;/resources/&quot; + mappedName);\n            if (is != null) {\n                int read;\n                byte[] buffer = new byte[4096];\n                os = new FileOutputStream(fileName);\n                while ((read = is.read(buffer)) != -1) {\n                    os.write(buffer, 0, read);\n                }\n                os.close();\n                is.close();\n                return true;\n            }\n        } catch (Throwable e) {\n            try {\n                if (os != null)\n                    os.close();\n                if (is != null)\n                    is.close();\n            } catch (IOException e1) {\n            }\n        }\n        return false;\n    }\n\n    private static boolean load(String libName) {\n        try {\n            if (libName.indexOf(SEPARATOR) != -1) {\n                System.load(libName);\n                return true;\n            }\n        } catch (UnsatisfiedLinkError e) {\n            e.printStackTrace();\n        }\n        return false;\n    }\n\n    public static void extract(String name) {\n        String libName = name;\n        // 尝试从系统临时目录加载该文件\n        String path = System.getProperty(&quot;java.io.tmpdir&quot;); //$NON-NLS-1$\n        if (path != null) {\n            // 创建jni文件夹\n            path = path + &quot;jni&quot;;\n            File file = new File(path);\n            path = file.getAbsolutePath();\n            // 文件夹是否存在\n            if (!file.exists()) {\n                if (!file.mkdirs()) {\n                    throw new UnsatisfiedLinkError(&quot;创建文件夹&quot; + path + &quot;失败&quot;);\n                }\n            }\n            String fileName = path + SEPARATOR + libName;\n            file = new File(fileName);\n            if (!file.exists()) {\n                extract(fileName, libName);\n            }\n        }\n    }\n\n    /**\n     * 加载类库\n     * \n     * @param name: dll名称\n     * @param expdate: dll最后修改日期.格式为:yyyy-MM-dd.如:2009-06-11\n     */\n    public static void loadLibrary(String name, String expdate) {\n        String libName = name;\n        // 尝试从系统临时目录加载该文件\n        String path = System.getProperty(&quot;java.io.tmpdir&quot;); //$NON-NLS-1$\n        if (path != null) {\n            // 创建jni文件夹\n            path = path + &quot;jni&quot;;\n            File file = new File(path);\n            path = file.getAbsolutePath();\n            // 文件夹是否存在\n            if (!file.exists()) {\n                if (!file.mkdirs()) {\n                    throw new UnsatisfiedLinkError(&quot;创建文件夹&quot; + path + &quot;失败&quot;);\n                }\n            }\n            String fileName = path + SEPARATOR + libName;\n            file = new File(fileName);\n            // 判断文件是否存在，不存在进行重新生成\n            Date date = new Date(file.lastModified());\n            SimpleDateFormat sdf = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);\n            String modifyDate = sdf.format(date);\n            if (!file.exists() || !modifyDate.equals(expdate)) {\n                if (extract(fileName, libName)) {\n                    load(fileName);\n                    return;\n                }\n            }\n            if (load(fileName))\n                return;\n        }\n        // 加载失败，从临时目录和jar文件都都没有找到该文件\n        throw new UnsatisfiedLinkError(&quot;no &quot; + libName + &quot; in java.io.tmpdir or the jar file&quot;);\n    }\n\n}\n\n</code></pre>\n"},{"title":"Js模板","author":"Asia Cui","date":"2019-01-18T01:53:00.000Z","_content":"## 第一种模板\n\n```javascript\nvar demo = {\n\t/**\n\t* 数据域\n\t**/\n    url: {\n        host:\"localhost\",\n        port: \"80\",\n        uri: \"/demo/user/get\"\n    },\n\t/**\n\t* 初始化操作\n\t**/\n    init: function () {\n       //调用function\n\t   demo.handle(demo.url.host);\n    },\n\t/**\n\t* 业务处理\n\t**/\n\thandle :function(data){\n\t\t//do...\n\t\treturn data;\n\t}\n};\njQuery(document).ready(function () {\n    //方法入口\n    demo.init();\n});\n\n```\n\n## 第二种模板\n\n### 实体类\n\n```javascript\n/**\n * 部门实体类\n */\nvar Dept = {\n    id: \"\",\t//表格id\n    name: null\n};\n\n```\n\n### 函数体\n\n```javascript\n/**\n * 初始化\n */\nDept.init = function () {\n    //do...\n    return null;\n};\n/**\n * 删除操作\n */\nDept.delete = function () {\n    //do...\n};\n\n/**\n * 函数调用\n */\n$(function () {\n    Dept.init();\n    Dept.delete();\n});\n\n```\n\n","source":"_posts/Js模板.md","raw":"title: Js模板\nauthor: Asia Cui\ntags:\n  - Js\ncategories:\n  - Js模板\ndate: 2019-01-18 09:53:00\n---\n## 第一种模板\n\n```javascript\nvar demo = {\n\t/**\n\t* 数据域\n\t**/\n    url: {\n        host:\"localhost\",\n        port: \"80\",\n        uri: \"/demo/user/get\"\n    },\n\t/**\n\t* 初始化操作\n\t**/\n    init: function () {\n       //调用function\n\t   demo.handle(demo.url.host);\n    },\n\t/**\n\t* 业务处理\n\t**/\n\thandle :function(data){\n\t\t//do...\n\t\treturn data;\n\t}\n};\njQuery(document).ready(function () {\n    //方法入口\n    demo.init();\n});\n\n```\n\n## 第二种模板\n\n### 实体类\n\n```javascript\n/**\n * 部门实体类\n */\nvar Dept = {\n    id: \"\",\t//表格id\n    name: null\n};\n\n```\n\n### 函数体\n\n```javascript\n/**\n * 初始化\n */\nDept.init = function () {\n    //do...\n    return null;\n};\n/**\n * 删除操作\n */\nDept.delete = function () {\n    //do...\n};\n\n/**\n * 函数调用\n */\n$(function () {\n    Dept.init();\n    Dept.delete();\n});\n\n```\n\n","slug":"Js模板","published":1,"updated":"2019-01-18T01:54:25.779Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjs17mhxh0006pwgt02t19za6","content":"<h2 id=\"第一种模板\"><a href=\"#第一种模板\" class=\"headerlink\" title=\"第一种模板\"></a>第一种模板</h2><pre class=\"line-numbers language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> demo <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\" spellcheck=\"true\">/**\n    * 数据域\n    **/</span>\n    url<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        host<span class=\"token punctuation\">:</span><span class=\"token string\">\"localhost\"</span><span class=\"token punctuation\">,</span>\n        port<span class=\"token punctuation\">:</span> <span class=\"token string\">\"80\"</span><span class=\"token punctuation\">,</span>\n        uri<span class=\"token punctuation\">:</span> <span class=\"token string\">\"/demo/user/get\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\" spellcheck=\"true\">/**\n    * 初始化操作\n    **/</span>\n    init<span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n       <span class=\"token comment\" spellcheck=\"true\">//调用function</span>\n       demo<span class=\"token punctuation\">.</span><span class=\"token function\">handle</span><span class=\"token punctuation\">(</span>demo<span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">.</span>host<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\" spellcheck=\"true\">/**\n    * 业务处理\n    **/</span>\n    handle <span class=\"token punctuation\">:</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token comment\" spellcheck=\"true\">//do...</span>\n        <span class=\"token keyword\">return</span> data<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">jQuery</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">ready</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\" spellcheck=\"true\">//方法入口</span>\n    demo<span class=\"token punctuation\">.</span><span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h2 id=\"第二种模板\"><a href=\"#第二种模板\" class=\"headerlink\" title=\"第二种模板\"></a>第二种模板</h2><h3 id=\"实体类\"><a href=\"#实体类\" class=\"headerlink\" title=\"实体类\"></a>实体类</h3><pre class=\"line-numbers language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\" spellcheck=\"true\">/**\n * 部门实体类\n */</span>\n<span class=\"token keyword\">var</span> Dept <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    id<span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>    <span class=\"token comment\" spellcheck=\"true\">//表格id</span>\n    name<span class=\"token punctuation\">:</span> <span class=\"token keyword\">null</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"函数体\"><a href=\"#函数体\" class=\"headerlink\" title=\"函数体\"></a>函数体</h3><pre class=\"line-numbers language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\" spellcheck=\"true\">/**\n * 初始化\n */</span>\nDept<span class=\"token punctuation\">.</span>init <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\" spellcheck=\"true\">//do...</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\" spellcheck=\"true\">/**\n * 删除操作\n */</span>\nDept<span class=\"token punctuation\">.</span><span class=\"token keyword\">delete</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\" spellcheck=\"true\">//do...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\" spellcheck=\"true\">/**\n * 函数调用\n */</span>\n<span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    Dept<span class=\"token punctuation\">.</span><span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    Dept<span class=\"token punctuation\">.</span><span class=\"token keyword\">delete</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"第一种模板\"><a href=\"#第一种模板\" class=\"headerlink\" title=\"第一种模板\"></a>第一种模板</h2><pre><code class=\"javascript\">var demo = {\n    /**\n    * 数据域\n    **/\n    url: {\n        host:&quot;localhost&quot;,\n        port: &quot;80&quot;,\n        uri: &quot;/demo/user/get&quot;\n    },\n    /**\n    * 初始化操作\n    **/\n    init: function () {\n       //调用function\n       demo.handle(demo.url.host);\n    },\n    /**\n    * 业务处理\n    **/\n    handle :function(data){\n        //do...\n        return data;\n    }\n};\njQuery(document).ready(function () {\n    //方法入口\n    demo.init();\n});\n\n</code></pre>\n<h2 id=\"第二种模板\"><a href=\"#第二种模板\" class=\"headerlink\" title=\"第二种模板\"></a>第二种模板</h2><h3 id=\"实体类\"><a href=\"#实体类\" class=\"headerlink\" title=\"实体类\"></a>实体类</h3><pre><code class=\"javascript\">/**\n * 部门实体类\n */\nvar Dept = {\n    id: &quot;&quot;,    //表格id\n    name: null\n};\n\n</code></pre>\n<h3 id=\"函数体\"><a href=\"#函数体\" class=\"headerlink\" title=\"函数体\"></a>函数体</h3><pre><code class=\"javascript\">/**\n * 初始化\n */\nDept.init = function () {\n    //do...\n    return null;\n};\n/**\n * 删除操作\n */\nDept.delete = function () {\n    //do...\n};\n\n/**\n * 函数调用\n */\n$(function () {\n    Dept.init();\n    Dept.delete();\n});\n\n</code></pre>\n"},{"title":"Linux命令","author":"Asia Cui","date":"2019-01-18T01:37:00.000Z","_content":"## 文件操作\n\n*   文件移动、删除、复制\n\n```bash\n//查看倒数100行的文件内容\ntail -100f <file_name>\n\n//移动a.text文件到/home/app目录\nmv a.txt /home/app \n\n//移动a.txt并把名字改成b.txt\nmv a.txt /home/app/b.txt\n\n//把当前目录下的a.txt复制到/home/app 目录下\ncp a.txt /home/app\n\n//删除文件夹或文件\nrm -rf  /asia \n-r:强制删除文件或目录\n-f：删除的时候递归处理，目录下所有子目录里的都删除\n\n```\n\n*   解压和压缩\n\n```bash\n//解压tar包，file.tar到当前目录\ntar –xzvf file.tar \n\n//解压zip包，project.war解压到指定文件夹asia\nunzip -oq  project.war -d /asia\n\n//压缩tar包单个文件压缩，把file1压缩成一个名字是abc.tar包中\ntar -czvf abc.tar file_name\n//多个文件压缩\ntar -czvf abc.tar file1 file2\n//压缩目录,把目录dir1压缩成abc.tar中\ntar -czvf abc.tar dir1\n//压缩多个目录,把目录dir1和dir2压缩成abc.tar中\ntar -czvf abc.tar dir1 dir2\n\n//压缩成zip包,单个文件压缩，把file1压缩成一个名字是abc.zip包中\nzip -r abc.zip file1\n//多个文件压缩,把文件file1和file2压缩到一个名字是abc.zip包中\nzip -r abc.zip file1 file2\n//单个目录压缩,把目录dir1压缩成abc.zip中\nzip -r abc.zip dir1\n//多个目录压缩把目录dir1和dir2压缩成abc.zip中\nzip -r abc.zip dir1 dir2\n\n```\n\n*   日志查看\n\n```bash\ntail -f test.log //打印最后几行，同时如果有也会滚动显示最新的日志\ntail -F test.log //和f区别：例如test.log文件大小达到上限，自动创建一个test.log.1区存储日志，F能自动跟踪到新的文件显示日志\ntail -n 100 test.log //显示最后100行\ntail -n +100 test.log //从100行开始显示\ntail -n -100 test.log //显示100行之前的\n\ncat test.log  //一次显示日志全部内容\ncat -n test.log\n参数：\n-n 或 --number 由 1 开始对所有输出的行数编号\n-b 或 --number-nonblank 和 -n 相似，只不过对于空白行不编号\n-s 或 --squeeze-blank 当遇到有连续两行以上的空白行，就代换为一行的空白行\n-v 或 --show-nonprinting\n\nmore test.log  //分页查看，一次显示一页\n空格表示显示下一页 ，b返回上一页，退出按q \n\nless test.log   //一行或一页的查看(中文显示可能有问题)，另带搜索功能\n使用上下键控制上一行和下一行，使用空格和b可以一页一页的翻\n按’/’+匹配字符，然后回车搜索，再按n表示下一个匹配到的位置\n\ngrep 13253638359 test.log  //在test.log文件中搜索这个手机号字段\n\n```\n\n## 权限\n\n```bash\n#修改file文件的权限为最高级\n修改文件权限： chmod 777 file_name   \n#给文件增加执行权限\nchmod +X file_name\n\n```\n\n## 系统操作\n\n```bash\n//存储查看\ndf -h\n\n//查看内存使用情况\ntop\ncat /proc/meminfo |more\n\n//查看指定目录的存储大小\ndu                   不指定目录的话，默认是当前目录下所有目录和目录下的子目录的存储大小，单位是kb\ndu /logs            查看当前目录下的logs目录的存储大小，如果logs目录下有子目录的话，也会显示出子目录的存储大小\ndu -sh  *           查看当前目录下的各个文件或目录的大小，不显示子目录，单位是Mb,  *可以替换成指定目录 \n\n//切换用户\nsu  root //切换到root用户\n\n//查看Java进程\njps  //输出结果是：端口+进程名称\n\n//查看应用对应端口\nnetstat -nltp\n\n```","source":"_posts/Linux命令.md","raw":"title: Linux命令\nauthor: Asia Cui\ntags:\n  - Linux\ncategories:\n  - Linux命令\ndate: 2019-01-18 09:37:00\n---\n## 文件操作\n\n*   文件移动、删除、复制\n\n```bash\n//查看倒数100行的文件内容\ntail -100f <file_name>\n\n//移动a.text文件到/home/app目录\nmv a.txt /home/app \n\n//移动a.txt并把名字改成b.txt\nmv a.txt /home/app/b.txt\n\n//把当前目录下的a.txt复制到/home/app 目录下\ncp a.txt /home/app\n\n//删除文件夹或文件\nrm -rf  /asia \n-r:强制删除文件或目录\n-f：删除的时候递归处理，目录下所有子目录里的都删除\n\n```\n\n*   解压和压缩\n\n```bash\n//解压tar包，file.tar到当前目录\ntar –xzvf file.tar \n\n//解压zip包，project.war解压到指定文件夹asia\nunzip -oq  project.war -d /asia\n\n//压缩tar包单个文件压缩，把file1压缩成一个名字是abc.tar包中\ntar -czvf abc.tar file_name\n//多个文件压缩\ntar -czvf abc.tar file1 file2\n//压缩目录,把目录dir1压缩成abc.tar中\ntar -czvf abc.tar dir1\n//压缩多个目录,把目录dir1和dir2压缩成abc.tar中\ntar -czvf abc.tar dir1 dir2\n\n//压缩成zip包,单个文件压缩，把file1压缩成一个名字是abc.zip包中\nzip -r abc.zip file1\n//多个文件压缩,把文件file1和file2压缩到一个名字是abc.zip包中\nzip -r abc.zip file1 file2\n//单个目录压缩,把目录dir1压缩成abc.zip中\nzip -r abc.zip dir1\n//多个目录压缩把目录dir1和dir2压缩成abc.zip中\nzip -r abc.zip dir1 dir2\n\n```\n\n*   日志查看\n\n```bash\ntail -f test.log //打印最后几行，同时如果有也会滚动显示最新的日志\ntail -F test.log //和f区别：例如test.log文件大小达到上限，自动创建一个test.log.1区存储日志，F能自动跟踪到新的文件显示日志\ntail -n 100 test.log //显示最后100行\ntail -n +100 test.log //从100行开始显示\ntail -n -100 test.log //显示100行之前的\n\ncat test.log  //一次显示日志全部内容\ncat -n test.log\n参数：\n-n 或 --number 由 1 开始对所有输出的行数编号\n-b 或 --number-nonblank 和 -n 相似，只不过对于空白行不编号\n-s 或 --squeeze-blank 当遇到有连续两行以上的空白行，就代换为一行的空白行\n-v 或 --show-nonprinting\n\nmore test.log  //分页查看，一次显示一页\n空格表示显示下一页 ，b返回上一页，退出按q \n\nless test.log   //一行或一页的查看(中文显示可能有问题)，另带搜索功能\n使用上下键控制上一行和下一行，使用空格和b可以一页一页的翻\n按’/’+匹配字符，然后回车搜索，再按n表示下一个匹配到的位置\n\ngrep 13253638359 test.log  //在test.log文件中搜索这个手机号字段\n\n```\n\n## 权限\n\n```bash\n#修改file文件的权限为最高级\n修改文件权限： chmod 777 file_name   \n#给文件增加执行权限\nchmod +X file_name\n\n```\n\n## 系统操作\n\n```bash\n//存储查看\ndf -h\n\n//查看内存使用情况\ntop\ncat /proc/meminfo |more\n\n//查看指定目录的存储大小\ndu                   不指定目录的话，默认是当前目录下所有目录和目录下的子目录的存储大小，单位是kb\ndu /logs            查看当前目录下的logs目录的存储大小，如果logs目录下有子目录的话，也会显示出子目录的存储大小\ndu -sh  *           查看当前目录下的各个文件或目录的大小，不显示子目录，单位是Mb,  *可以替换成指定目录 \n\n//切换用户\nsu  root //切换到root用户\n\n//查看Java进程\njps  //输出结果是：端口+进程名称\n\n//查看应用对应端口\nnetstat -nltp\n\n```","slug":"Linux命令","published":1,"updated":"2019-01-18T01:39:18.285Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjs17mhxj0007pwgtootdppb8","content":"<h2 id=\"文件操作\"><a href=\"#文件操作\" class=\"headerlink\" title=\"文件操作\"></a>文件操作</h2><ul>\n<li>文件移动、删除、复制</li>\n</ul>\n<pre class=\"line-numbers language-bash\"><code class=\"language-bash\">//查看倒数100行的文件内容\n<span class=\"token function\">tail</span> -100f <span class=\"token operator\">&lt;</span>file_name<span class=\"token operator\">></span>\n\n//移动a.text文件到/home/app目录\n<span class=\"token function\">mv</span> a.txt /home/app \n\n//移动a.txt并把名字改成b.txt\n<span class=\"token function\">mv</span> a.txt /home/app/b.txt\n\n//把当前目录下的a.txt复制到/home/app 目录下\n<span class=\"token function\">cp</span> a.txt /home/app\n\n//删除文件夹或文件\n<span class=\"token function\">rm</span> -rf  /asia \n-r:强制删除文件或目录\n-f：删除的时候递归处理，目录下所有子目录里的都删除\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<ul>\n<li>解压和压缩</li>\n</ul>\n<pre class=\"line-numbers language-bash\"><code class=\"language-bash\">//解压tar包，file.tar到当前目录\n<span class=\"token function\">tar</span> –xzvf file.tar \n\n//解压zip包，project.war解压到指定文件夹asia\nunzip -oq  project.war -d /asia\n\n//压缩tar包单个文件压缩，把file1压缩成一个名字是abc.tar包中\n<span class=\"token function\">tar</span> -czvf abc.tar file_name\n//多个文件压缩\n<span class=\"token function\">tar</span> -czvf abc.tar file1 file2\n//压缩目录,把目录dir1压缩成abc.tar中\n<span class=\"token function\">tar</span> -czvf abc.tar dir1\n//压缩多个目录,把目录dir1和dir2压缩成abc.tar中\n<span class=\"token function\">tar</span> -czvf abc.tar dir1 dir2\n\n//压缩成zip包,单个文件压缩，把file1压缩成一个名字是abc.zip包中\n<span class=\"token function\">zip</span> -r abc.zip file1\n//多个文件压缩,把文件file1和file2压缩到一个名字是abc.zip包中\n<span class=\"token function\">zip</span> -r abc.zip file1 file2\n//单个目录压缩,把目录dir1压缩成abc.zip中\n<span class=\"token function\">zip</span> -r abc.zip dir1\n//多个目录压缩把目录dir1和dir2压缩成abc.zip中\n<span class=\"token function\">zip</span> -r abc.zip dir1 dir2\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<ul>\n<li>日志查看</li>\n</ul>\n<pre class=\"line-numbers language-bash\"><code class=\"language-bash\"><span class=\"token function\">tail</span> -f test.log //打印最后几行，同时如果有也会滚动显示最新的日志\n<span class=\"token function\">tail</span> -F test.log //和f区别：例如test.log文件大小达到上限，自动创建一个test.log.1区存储日志，F能自动跟踪到新的文件显示日志\n<span class=\"token function\">tail</span> -n 100 test.log //显示最后100行\n<span class=\"token function\">tail</span> -n +100 test.log //从100行开始显示\n<span class=\"token function\">tail</span> -n -100 test.log //显示100行之前的\n\n<span class=\"token function\">cat</span> test.log  //一次显示日志全部内容\n<span class=\"token function\">cat</span> -n test.log\n参数：\n-n 或 --number 由 1 开始对所有输出的行数编号\n-b 或 --number-nonblank 和 -n 相似，只不过对于空白行不编号\n-s 或 --squeeze-blank 当遇到有连续两行以上的空白行，就代换为一行的空白行\n-v 或 --show-nonprinting\n\n<span class=\"token function\">more</span> test.log  //分页查看，一次显示一页\n空格表示显示下一页 ，b返回上一页，退出按q \n\n<span class=\"token function\">less</span> test.log   //一行或一页的查看<span class=\"token punctuation\">(</span>中文显示可能有问题<span class=\"token punctuation\">)</span>，另带搜索功能\n使用上下键控制上一行和下一行，使用空格和b可以一页一页的翻\n按’/’+匹配字符，然后回车搜索，再按n表示下一个匹配到的位置\n\n<span class=\"token function\">grep</span> 13253638359 test.log  //在test.log文件中搜索这个手机号字段\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h2 id=\"权限\"><a href=\"#权限\" class=\"headerlink\" title=\"权限\"></a>权限</h2><pre class=\"line-numbers language-bash\"><code class=\"language-bash\"><span class=\"token comment\" spellcheck=\"true\">#修改file文件的权限为最高级</span>\n修改文件权限： <span class=\"token function\">chmod</span> 777 file_name   \n<span class=\"token comment\" spellcheck=\"true\">#给文件增加执行权限</span>\n<span class=\"token function\">chmod</span> +X file_name\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h2 id=\"系统操作\"><a href=\"#系统操作\" class=\"headerlink\" title=\"系统操作\"></a>系统操作</h2><pre class=\"line-numbers language-bash\"><code class=\"language-bash\">//存储查看\n<span class=\"token function\">df</span> -h\n\n//查看内存使用情况\n<span class=\"token function\">top</span>\n<span class=\"token function\">cat</span> /proc/meminfo <span class=\"token operator\">|</span><span class=\"token function\">more</span>\n\n//查看指定目录的存储大小\n<span class=\"token function\">du</span>                   不指定目录的话，默认是当前目录下所有目录和目录下的子目录的存储大小，单位是kb\n<span class=\"token function\">du</span> /logs            查看当前目录下的logs目录的存储大小，如果logs目录下有子目录的话，也会显示出子目录的存储大小\n<span class=\"token function\">du</span> -sh  *           查看当前目录下的各个文件或目录的大小，不显示子目录，单位是Mb,  *可以替换成指定目录 \n\n//切换用户\n<span class=\"token function\">su</span>  root //切换到root用户\n\n//查看Java进程\njps  //输出结果是：端口+进程名称\n\n//查看应用对应端口\n<span class=\"token function\">netstat</span> -nltp\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"文件操作\"><a href=\"#文件操作\" class=\"headerlink\" title=\"文件操作\"></a>文件操作</h2><ul>\n<li>文件移动、删除、复制</li>\n</ul>\n<pre><code class=\"bash\">//查看倒数100行的文件内容\ntail -100f &lt;file_name&gt;\n\n//移动a.text文件到/home/app目录\nmv a.txt /home/app \n\n//移动a.txt并把名字改成b.txt\nmv a.txt /home/app/b.txt\n\n//把当前目录下的a.txt复制到/home/app 目录下\ncp a.txt /home/app\n\n//删除文件夹或文件\nrm -rf  /asia \n-r:强制删除文件或目录\n-f：删除的时候递归处理，目录下所有子目录里的都删除\n\n</code></pre>\n<ul>\n<li>解压和压缩</li>\n</ul>\n<pre><code class=\"bash\">//解压tar包，file.tar到当前目录\ntar –xzvf file.tar \n\n//解压zip包，project.war解压到指定文件夹asia\nunzip -oq  project.war -d /asia\n\n//压缩tar包单个文件压缩，把file1压缩成一个名字是abc.tar包中\ntar -czvf abc.tar file_name\n//多个文件压缩\ntar -czvf abc.tar file1 file2\n//压缩目录,把目录dir1压缩成abc.tar中\ntar -czvf abc.tar dir1\n//压缩多个目录,把目录dir1和dir2压缩成abc.tar中\ntar -czvf abc.tar dir1 dir2\n\n//压缩成zip包,单个文件压缩，把file1压缩成一个名字是abc.zip包中\nzip -r abc.zip file1\n//多个文件压缩,把文件file1和file2压缩到一个名字是abc.zip包中\nzip -r abc.zip file1 file2\n//单个目录压缩,把目录dir1压缩成abc.zip中\nzip -r abc.zip dir1\n//多个目录压缩把目录dir1和dir2压缩成abc.zip中\nzip -r abc.zip dir1 dir2\n\n</code></pre>\n<ul>\n<li>日志查看</li>\n</ul>\n<pre><code class=\"bash\">tail -f test.log //打印最后几行，同时如果有也会滚动显示最新的日志\ntail -F test.log //和f区别：例如test.log文件大小达到上限，自动创建一个test.log.1区存储日志，F能自动跟踪到新的文件显示日志\ntail -n 100 test.log //显示最后100行\ntail -n +100 test.log //从100行开始显示\ntail -n -100 test.log //显示100行之前的\n\ncat test.log  //一次显示日志全部内容\ncat -n test.log\n参数：\n-n 或 --number 由 1 开始对所有输出的行数编号\n-b 或 --number-nonblank 和 -n 相似，只不过对于空白行不编号\n-s 或 --squeeze-blank 当遇到有连续两行以上的空白行，就代换为一行的空白行\n-v 或 --show-nonprinting\n\nmore test.log  //分页查看，一次显示一页\n空格表示显示下一页 ，b返回上一页，退出按q \n\nless test.log   //一行或一页的查看(中文显示可能有问题)，另带搜索功能\n使用上下键控制上一行和下一行，使用空格和b可以一页一页的翻\n按’/’+匹配字符，然后回车搜索，再按n表示下一个匹配到的位置\n\ngrep 13253638359 test.log  //在test.log文件中搜索这个手机号字段\n\n</code></pre>\n<h2 id=\"权限\"><a href=\"#权限\" class=\"headerlink\" title=\"权限\"></a>权限</h2><pre><code class=\"bash\">#修改file文件的权限为最高级\n修改文件权限： chmod 777 file_name   \n#给文件增加执行权限\nchmod +X file_name\n\n</code></pre>\n<h2 id=\"系统操作\"><a href=\"#系统操作\" class=\"headerlink\" title=\"系统操作\"></a>系统操作</h2><pre><code class=\"bash\">//存储查看\ndf -h\n\n//查看内存使用情况\ntop\ncat /proc/meminfo |more\n\n//查看指定目录的存储大小\ndu                   不指定目录的话，默认是当前目录下所有目录和目录下的子目录的存储大小，单位是kb\ndu /logs            查看当前目录下的logs目录的存储大小，如果logs目录下有子目录的话，也会显示出子目录的存储大小\ndu -sh  *           查看当前目录下的各个文件或目录的大小，不显示子目录，单位是Mb,  *可以替换成指定目录 \n\n//切换用户\nsu  root //切换到root用户\n\n//查看Java进程\njps  //输出结果是：端口+进程名称\n\n//查看应用对应端口\nnetstat -nltp\n\n</code></pre>\n"},{"title":"Linux目录结构","author":"Asia Cui","date":"2019-01-18T01:44:00.000Z","_content":"![Linux目录结构.png](/images/Linux/linux目录结构.png)\n\n| 目录 | 说明 |\n| --- | --- |\n| bin | 存放二进制可执行文件 (ls,cat,mkdir 等) |\n| boot | 存放用于系统引导时使用的各种文件 |\n| dev | 用于存放设备文件 |\n| etc | 存放系统配置文件 |\n| home | 存放所有用户文件的根目录 |\n| lib | 存放跟文件系统中的程序运行所需要的共享库及内核模块 |\n| mnt | 系统管理员安装临时文件系统的安装点 |\n| opt | 额外安装的可选应用程序包所放置的位置 |\n| proc | 虚拟文件系统，存放当前内存的映射 |\n| root | 超级用户目录 |\n| sbin | 存放二进制可执行文件，只有 root 才能访问 |\n| tmp | 用于存放各种临时文件 |\n| usr | 用于存放系统应用程序，比较重要的目录 / usr/local 本地管理员软件安装目录 |\n| var | 用于存放运行时需要改变数据的文件 |","source":"_posts/Linux目录结构.md","raw":"title: Linux目录结构\nauthor: Asia Cui\ntags:\n  - Linux\ncategories:\n  - Linux目录结构\ndate: 2019-01-18 09:44:00\n---\n![Linux目录结构.png](/images/Linux/linux目录结构.png)\n\n| 目录 | 说明 |\n| --- | --- |\n| bin | 存放二进制可执行文件 (ls,cat,mkdir 等) |\n| boot | 存放用于系统引导时使用的各种文件 |\n| dev | 用于存放设备文件 |\n| etc | 存放系统配置文件 |\n| home | 存放所有用户文件的根目录 |\n| lib | 存放跟文件系统中的程序运行所需要的共享库及内核模块 |\n| mnt | 系统管理员安装临时文件系统的安装点 |\n| opt | 额外安装的可选应用程序包所放置的位置 |\n| proc | 虚拟文件系统，存放当前内存的映射 |\n| root | 超级用户目录 |\n| sbin | 存放二进制可执行文件，只有 root 才能访问 |\n| tmp | 用于存放各种临时文件 |\n| usr | 用于存放系统应用程序，比较重要的目录 / usr/local 本地管理员软件安装目录 |\n| var | 用于存放运行时需要改变数据的文件 |","slug":"Linux目录结构","published":1,"updated":"2019-01-18T01:49:24.747Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjs17mhxm000bpwgt59zib5x7","content":"<p><img src=\"/images/Linux/linux目录结构.png\" alt=\"Linux目录结构.png\"></p>\n<table>\n<thead>\n<tr>\n<th>目录</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>bin</td>\n<td>存放二进制可执行文件 (ls,cat,mkdir 等)</td>\n</tr>\n<tr>\n<td>boot</td>\n<td>存放用于系统引导时使用的各种文件</td>\n</tr>\n<tr>\n<td>dev</td>\n<td>用于存放设备文件</td>\n</tr>\n<tr>\n<td>etc</td>\n<td>存放系统配置文件</td>\n</tr>\n<tr>\n<td>home</td>\n<td>存放所有用户文件的根目录</td>\n</tr>\n<tr>\n<td>lib</td>\n<td>存放跟文件系统中的程序运行所需要的共享库及内核模块</td>\n</tr>\n<tr>\n<td>mnt</td>\n<td>系统管理员安装临时文件系统的安装点</td>\n</tr>\n<tr>\n<td>opt</td>\n<td>额外安装的可选应用程序包所放置的位置</td>\n</tr>\n<tr>\n<td>proc</td>\n<td>虚拟文件系统，存放当前内存的映射</td>\n</tr>\n<tr>\n<td>root</td>\n<td>超级用户目录</td>\n</tr>\n<tr>\n<td>sbin</td>\n<td>存放二进制可执行文件，只有 root 才能访问</td>\n</tr>\n<tr>\n<td>tmp</td>\n<td>用于存放各种临时文件</td>\n</tr>\n<tr>\n<td>usr</td>\n<td>用于存放系统应用程序，比较重要的目录 / usr/local 本地管理员软件安装目录</td>\n</tr>\n<tr>\n<td>var</td>\n<td>用于存放运行时需要改变数据的文件</td>\n</tr>\n</tbody>\n</table>\n","site":{"data":{}},"excerpt":"","more":"<p><img src=\"/images/Linux/linux目录结构.png\" alt=\"Linux目录结构.png\"></p>\n<table>\n<thead>\n<tr>\n<th>目录</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>bin</td>\n<td>存放二进制可执行文件 (ls,cat,mkdir 等)</td>\n</tr>\n<tr>\n<td>boot</td>\n<td>存放用于系统引导时使用的各种文件</td>\n</tr>\n<tr>\n<td>dev</td>\n<td>用于存放设备文件</td>\n</tr>\n<tr>\n<td>etc</td>\n<td>存放系统配置文件</td>\n</tr>\n<tr>\n<td>home</td>\n<td>存放所有用户文件的根目录</td>\n</tr>\n<tr>\n<td>lib</td>\n<td>存放跟文件系统中的程序运行所需要的共享库及内核模块</td>\n</tr>\n<tr>\n<td>mnt</td>\n<td>系统管理员安装临时文件系统的安装点</td>\n</tr>\n<tr>\n<td>opt</td>\n<td>额外安装的可选应用程序包所放置的位置</td>\n</tr>\n<tr>\n<td>proc</td>\n<td>虚拟文件系统，存放当前内存的映射</td>\n</tr>\n<tr>\n<td>root</td>\n<td>超级用户目录</td>\n</tr>\n<tr>\n<td>sbin</td>\n<td>存放二进制可执行文件，只有 root 才能访问</td>\n</tr>\n<tr>\n<td>tmp</td>\n<td>用于存放各种临时文件</td>\n</tr>\n<tr>\n<td>usr</td>\n<td>用于存放系统应用程序，比较重要的目录 / usr/local 本地管理员软件安装目录</td>\n</tr>\n<tr>\n<td>var</td>\n<td>用于存放运行时需要改变数据的文件</td>\n</tr>\n</tbody>\n</table>\n"},{"title":"Maven依赖机制","author":"Asia Cui","date":"2019-01-15T09:31:00.000Z","_content":"## pom.xml解析\n\n### 依赖范围\n```xml\n<dependency>\n    <groupId>junit</groupId>\n    <artifactId>junit</artifactId>\n    <version>4.12</version>\n    <scope>test</scope>\n</dependency>\n```\nscope:该标签指定依赖的作用域。\n### 依赖传递\n\n### 依赖冲突\n- 依赖路径最短优先\n- pom中谁写在前面谁优先\n\n\n```\ngraph LR\nA-->B\nB-->C\nC-->common-2.0.jar\n```\n\n```\ngraph LR\nA-->B\nB-->common-3.0.jar\n```\n介绍：项目依赖了两个版本的common.jar，在打包时会采用依赖路径最短的common.3.0.jar。\n\n### 项目聚合\n把多个模块聚合到一块。\n\n```xml\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n    <modelVersion>4.0.0</modelVersion>\n    <groupId>com.asia</groupId>\n    <artifactId>demo-parent</artifactId>\n    <version>1.0.0-SNAPSHOT</version>\n\n    <name>demo-parent</name>\n    <!--为pom-->\n    <packaging>pom</packaging>\n\n<!--demo-parent聚合demo1、demo2、demo3、demo4模块-->\n    <modules>\n        <module>../demo1</module>\n        <module>../demo2</module>\n        <module>../demo3</module>\n        <module>../demo4</module>\n    </modules>\n</project>\n\n```\n### 依赖继承\n把各个模块公用的依赖抽取成父类，供子模块继承使用。\n- 父pom\n\n```xml\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n    <modelVersion>4.0.0</modelVersion>\n    <groupId>com.asia</groupId>\n    <artifactId>demo-parent</artifactId>\n    <version>1.0.0-SNAPSHOT</version>\n\n    <name>demo-parent</name>\n    <packaging>pom</packaging>\n    \n    <!--版本管理-->\n    <properties>\n        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n        <project.reporting.outputEncoding>UTF-8</project.reporting.outputEncoding>\n        <!--mysql驱动依赖-->\n        <mysql-connector-java.version>5.1.38</mysql-connector-java.version>\n    </properties>\n\n    <!--dependencyManagement:管理父类的依赖，把版本号抽取出来放到properties标签中统一管理-->\n    <dependencyManagement>\n        <dependencies>\n            <dependency>\n                <groupId>mysql</groupId>\n                <artifactId>mysql-connector-java</artifactId>\n                <version>${mysql-connector-java.version}</version>\n            </dependency>\n        </dependencies>\n    </dependencyManagement>\n</project>\n\n```\n\n- 子pom\n\n```xml\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n    <modelVersion>4.0.0</modelVersion>\n    <!--子类的坐标-->\n    <groupId>com.asia</groupId>\n    <artifactId>demo-children</artifactId>\n    <version>1.0.0-SNAPSHOT</version>\n    <name>demo-children</name>\n    <packaging>pom</packaging>\n\n    <!--继承父类的pom依赖-->\n    <parent>\n        <groupId>com.asia</groupId>\n        <artifactId>demo-parent</artifactId>\n        <version>1.0.0-SNAPSHOT</version>\n    </parent>\n</project>\n```\n\n\n## 其他依赖标签介绍\n依赖传递排除\n```xml\n<dependency>\n    <groupId>org.apache.shiro</groupId>\n        <artifactId>shiro-spring</artifactId>\n        <version>${shiro.version}</version>\n        <!--排除依赖传递列表 -->\n        <exclusions>\n            <exclusion>\n                        \n            </exclusion>\n        </exclusions>\n</dependency>\n```\n构建行为列表，bulid标签配置maven构建项目时的需要执行的各种行为，一般都是maven的插件\n\n```xml\n<build>\n        <pluginManagement>\n            <plugins>\n                <plugin> <groupId>org.apache.maven.plugins</groupId>\n                    <artifactId>maven-compiler-plugin</artifactId>\n                    <version>3.1</version>\n                    <configuration>\n                      <source>${java.version}</source>\n                        <target>${java.version}</target>\n                    </configuration>\n                </plugin>\n        </pluginManagement>\n    </build>\n```\n\n# maven的使用\n\n\n`demo-parent`为父工程，聚合如下四个子工程：\n\n```xml\n  //demo-parent下的子工程，同事子工程之间存在相互依赖，demo-admin依赖demo-core\n  <modules>\n        <module>../demo-admin</module>\n        <module>../demo-core</module>\n        <module>../demo-rest</module>\n        <module>../demo-generator</module>\n    </modules>\n```\n\n## package\n`demo-admin` 依赖 `demo-core`，如果在 `demo-core` 未打包的情况下，单独打包子工程 `demo-admin`，此时会报错，说找不到 `demo-core`，因为打包的时候通过pom去maven仓库寻找 `demo-core`，因 `demo-core` 不存在所以报错。<br>\n如果给 `demo-core` 执行package命令后，去给 `demo-core` 打包还会报同样的错，因为package命令仅仅是在 `demo-core` 的target目录下生成jar包，并未放入到maven仓库中，所以还是找不到。<br>\n所以最终解决方案是执行完package命令后，在执行insetall命令，此时会把jar安装到maven仓库中。\n\n## maven仓库分类\n\n在maven中，仓库可以分为：<br>\n本地仓库、远程仓库。 \n- 远程仓库可以分为：中央仓库、私服仓库。 \n中央仓库是maven官方指定的仓库，可以理解为“寻找的最后一站”。 \n- 私服仓库可以是自己建的，也可以是其它主体建的（比如aliyun的maven仓库，jboss的maven仓库等）。 \n私服可以分为：全局应用的私服仓库、应用到项目自身的私服仓库。\n\nmaven寻找得顺序大致可以理解为： \n```\ngraph LR\n本地仓库-->私服\n私服-->远程仓库\n```\n1. 在本地仓库中寻找，如果没有则进入下一步。 \n2. 在全局应用的私服仓库中寻找，如果没有则进入下一步。\n3. 在项目自身的私服仓库中寻找，如果没有则进入下一步。 \n4. 在中央仓库中寻找，如果没有则终止寻找。\n\n## maven常用命令\n- package命令完成了项目编译、单元测试、打包功能，但没有把打好的可执行jar包（war包或其它形式的包）布署到本地maven仓库和远程maven私服仓库\n- install命令完成了项目编译、单元测试、打包功能，同时把打好的可执行jar包（war包或其它形式的包）布署到本地maven仓库，==但没有布署到远程maven私服仓库==\n- deploy命令完成了项目编译、单元测试、打包功能，同时把打好的可执行jar包（war包或其它形式的包）布署到==本地maven仓库和远程maven私服仓库==　　\n\n> 后一个命令会覆盖前一个命令的操作\n\n```bash\n//分别是打包、安装、发布跳过测试命令\nmvn package -Dmaven.test.skip=true\nmvn install -Dmaven.test.skip=true\nmvn deploy -Dmaven.test.skip=true\n```","source":"_posts/Maven依赖机制.md","raw":"title: Maven依赖机制\nauthor: Asia Cui\ntags:\n  - Maven\ncategories:\n  - Maven依赖机制\ndate: 2019-01-15 17:31:00\n---\n## pom.xml解析\n\n### 依赖范围\n```xml\n<dependency>\n    <groupId>junit</groupId>\n    <artifactId>junit</artifactId>\n    <version>4.12</version>\n    <scope>test</scope>\n</dependency>\n```\nscope:该标签指定依赖的作用域。\n### 依赖传递\n\n### 依赖冲突\n- 依赖路径最短优先\n- pom中谁写在前面谁优先\n\n\n```\ngraph LR\nA-->B\nB-->C\nC-->common-2.0.jar\n```\n\n```\ngraph LR\nA-->B\nB-->common-3.0.jar\n```\n介绍：项目依赖了两个版本的common.jar，在打包时会采用依赖路径最短的common.3.0.jar。\n\n### 项目聚合\n把多个模块聚合到一块。\n\n```xml\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n    <modelVersion>4.0.0</modelVersion>\n    <groupId>com.asia</groupId>\n    <artifactId>demo-parent</artifactId>\n    <version>1.0.0-SNAPSHOT</version>\n\n    <name>demo-parent</name>\n    <!--为pom-->\n    <packaging>pom</packaging>\n\n<!--demo-parent聚合demo1、demo2、demo3、demo4模块-->\n    <modules>\n        <module>../demo1</module>\n        <module>../demo2</module>\n        <module>../demo3</module>\n        <module>../demo4</module>\n    </modules>\n</project>\n\n```\n### 依赖继承\n把各个模块公用的依赖抽取成父类，供子模块继承使用。\n- 父pom\n\n```xml\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n    <modelVersion>4.0.0</modelVersion>\n    <groupId>com.asia</groupId>\n    <artifactId>demo-parent</artifactId>\n    <version>1.0.0-SNAPSHOT</version>\n\n    <name>demo-parent</name>\n    <packaging>pom</packaging>\n    \n    <!--版本管理-->\n    <properties>\n        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n        <project.reporting.outputEncoding>UTF-8</project.reporting.outputEncoding>\n        <!--mysql驱动依赖-->\n        <mysql-connector-java.version>5.1.38</mysql-connector-java.version>\n    </properties>\n\n    <!--dependencyManagement:管理父类的依赖，把版本号抽取出来放到properties标签中统一管理-->\n    <dependencyManagement>\n        <dependencies>\n            <dependency>\n                <groupId>mysql</groupId>\n                <artifactId>mysql-connector-java</artifactId>\n                <version>${mysql-connector-java.version}</version>\n            </dependency>\n        </dependencies>\n    </dependencyManagement>\n</project>\n\n```\n\n- 子pom\n\n```xml\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n    <modelVersion>4.0.0</modelVersion>\n    <!--子类的坐标-->\n    <groupId>com.asia</groupId>\n    <artifactId>demo-children</artifactId>\n    <version>1.0.0-SNAPSHOT</version>\n    <name>demo-children</name>\n    <packaging>pom</packaging>\n\n    <!--继承父类的pom依赖-->\n    <parent>\n        <groupId>com.asia</groupId>\n        <artifactId>demo-parent</artifactId>\n        <version>1.0.0-SNAPSHOT</version>\n    </parent>\n</project>\n```\n\n\n## 其他依赖标签介绍\n依赖传递排除\n```xml\n<dependency>\n    <groupId>org.apache.shiro</groupId>\n        <artifactId>shiro-spring</artifactId>\n        <version>${shiro.version}</version>\n        <!--排除依赖传递列表 -->\n        <exclusions>\n            <exclusion>\n                        \n            </exclusion>\n        </exclusions>\n</dependency>\n```\n构建行为列表，bulid标签配置maven构建项目时的需要执行的各种行为，一般都是maven的插件\n\n```xml\n<build>\n        <pluginManagement>\n            <plugins>\n                <plugin> <groupId>org.apache.maven.plugins</groupId>\n                    <artifactId>maven-compiler-plugin</artifactId>\n                    <version>3.1</version>\n                    <configuration>\n                      <source>${java.version}</source>\n                        <target>${java.version}</target>\n                    </configuration>\n                </plugin>\n        </pluginManagement>\n    </build>\n```\n\n# maven的使用\n\n\n`demo-parent`为父工程，聚合如下四个子工程：\n\n```xml\n  //demo-parent下的子工程，同事子工程之间存在相互依赖，demo-admin依赖demo-core\n  <modules>\n        <module>../demo-admin</module>\n        <module>../demo-core</module>\n        <module>../demo-rest</module>\n        <module>../demo-generator</module>\n    </modules>\n```\n\n## package\n`demo-admin` 依赖 `demo-core`，如果在 `demo-core` 未打包的情况下，单独打包子工程 `demo-admin`，此时会报错，说找不到 `demo-core`，因为打包的时候通过pom去maven仓库寻找 `demo-core`，因 `demo-core` 不存在所以报错。<br>\n如果给 `demo-core` 执行package命令后，去给 `demo-core` 打包还会报同样的错，因为package命令仅仅是在 `demo-core` 的target目录下生成jar包，并未放入到maven仓库中，所以还是找不到。<br>\n所以最终解决方案是执行完package命令后，在执行insetall命令，此时会把jar安装到maven仓库中。\n\n## maven仓库分类\n\n在maven中，仓库可以分为：<br>\n本地仓库、远程仓库。 \n- 远程仓库可以分为：中央仓库、私服仓库。 \n中央仓库是maven官方指定的仓库，可以理解为“寻找的最后一站”。 \n- 私服仓库可以是自己建的，也可以是其它主体建的（比如aliyun的maven仓库，jboss的maven仓库等）。 \n私服可以分为：全局应用的私服仓库、应用到项目自身的私服仓库。\n\nmaven寻找得顺序大致可以理解为： \n```\ngraph LR\n本地仓库-->私服\n私服-->远程仓库\n```\n1. 在本地仓库中寻找，如果没有则进入下一步。 \n2. 在全局应用的私服仓库中寻找，如果没有则进入下一步。\n3. 在项目自身的私服仓库中寻找，如果没有则进入下一步。 \n4. 在中央仓库中寻找，如果没有则终止寻找。\n\n## maven常用命令\n- package命令完成了项目编译、单元测试、打包功能，但没有把打好的可执行jar包（war包或其它形式的包）布署到本地maven仓库和远程maven私服仓库\n- install命令完成了项目编译、单元测试、打包功能，同时把打好的可执行jar包（war包或其它形式的包）布署到本地maven仓库，==但没有布署到远程maven私服仓库==\n- deploy命令完成了项目编译、单元测试、打包功能，同时把打好的可执行jar包（war包或其它形式的包）布署到==本地maven仓库和远程maven私服仓库==　　\n\n> 后一个命令会覆盖前一个命令的操作\n\n```bash\n//分别是打包、安装、发布跳过测试命令\nmvn package -Dmaven.test.skip=true\nmvn install -Dmaven.test.skip=true\nmvn deploy -Dmaven.test.skip=true\n```","slug":"Maven依赖机制","published":1,"updated":"2019-01-15T09:34:22.342Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjs17mhxo000cpwgtw26wjzj0","content":"<h2 id=\"pom-xml解析\"><a href=\"#pom-xml解析\" class=\"headerlink\" title=\"pom.xml解析\"></a>pom.xml解析</h2><h3 id=\"依赖范围\"><a href=\"#依赖范围\" class=\"headerlink\" title=\"依赖范围\"></a>依赖范围</h3><pre class=\"line-numbers language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>junit<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>junit<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>4.12<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>scope</span><span class=\"token punctuation\">></span></span>test<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>scope</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>scope:该标签指定依赖的作用域。</p>\n<h3 id=\"依赖传递\"><a href=\"#依赖传递\" class=\"headerlink\" title=\"依赖传递\"></a>依赖传递</h3><h3 id=\"依赖冲突\"><a href=\"#依赖冲突\" class=\"headerlink\" title=\"依赖冲突\"></a>依赖冲突</h3><ul>\n<li>依赖路径最短优先</li>\n<li>pom中谁写在前面谁优先</li>\n</ul>\n<pre><code>graph LR\nA--&gt;B\nB--&gt;C\nC--&gt;common-2.0.jar\n</code></pre><pre><code>graph LR\nA--&gt;B\nB--&gt;common-3.0.jar\n</code></pre><p>介绍：项目依赖了两个版本的common.jar，在打包时会采用依赖路径最短的common.3.0.jar。</p>\n<h3 id=\"项目聚合\"><a href=\"#项目聚合\" class=\"headerlink\" title=\"项目聚合\"></a>项目聚合</h3><p>把多个模块聚合到一块。</p>\n<pre class=\"line-numbers language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>project</span> <span class=\"token attr-name\">xmlns</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>http://maven.apache.org/POM/4.0.0<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">xmlns:</span>xsi</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>http://www.w3.org/2001/XMLSchema-instance<span class=\"token punctuation\">\"</span></span>\n         <span class=\"token attr-name\"><span class=\"token namespace\">xsi:</span>schemaLocation</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>modelVersion</span><span class=\"token punctuation\">></span></span>4.0.0<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>modelVersion</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.asia<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>demo-parent<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>1.0.0-SNAPSHOT<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span>\n\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>name</span><span class=\"token punctuation\">></span></span>demo-parent<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>name</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token comment\" spellcheck=\"true\">&lt;!--为pom--></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>packaging</span><span class=\"token punctuation\">></span></span>pom<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>packaging</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token comment\" spellcheck=\"true\">&lt;!--demo-parent聚合demo1、demo2、demo3、demo4模块--></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>modules</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>module</span><span class=\"token punctuation\">></span></span>../demo1<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>module</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>module</span><span class=\"token punctuation\">></span></span>../demo2<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>module</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>module</span><span class=\"token punctuation\">></span></span>../demo3<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>module</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>module</span><span class=\"token punctuation\">></span></span>../demo4<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>module</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>modules</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>project</span><span class=\"token punctuation\">></span></span>\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"依赖继承\"><a href=\"#依赖继承\" class=\"headerlink\" title=\"依赖继承\"></a>依赖继承</h3><p>把各个模块公用的依赖抽取成父类，供子模块继承使用。</p>\n<ul>\n<li>父pom</li>\n</ul>\n<pre class=\"line-numbers language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>project</span> <span class=\"token attr-name\">xmlns</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>http://maven.apache.org/POM/4.0.0<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">xmlns:</span>xsi</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>http://www.w3.org/2001/XMLSchema-instance<span class=\"token punctuation\">\"</span></span>\n         <span class=\"token attr-name\"><span class=\"token namespace\">xsi:</span>schemaLocation</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>modelVersion</span><span class=\"token punctuation\">></span></span>4.0.0<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>modelVersion</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.asia<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>demo-parent<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>1.0.0-SNAPSHOT<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span>\n\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>name</span><span class=\"token punctuation\">></span></span>demo-parent<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>name</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>packaging</span><span class=\"token punctuation\">></span></span>pom<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>packaging</span><span class=\"token punctuation\">></span></span>\n\n    <span class=\"token comment\" spellcheck=\"true\">&lt;!--版本管理--></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>properties</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>project.build.sourceEncoding</span><span class=\"token punctuation\">></span></span>UTF-8<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>project.build.sourceEncoding</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>project.reporting.outputEncoding</span><span class=\"token punctuation\">></span></span>UTF-8<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>project.reporting.outputEncoding</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token comment\" spellcheck=\"true\">&lt;!--mysql驱动依赖--></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mysql-connector-java.version</span><span class=\"token punctuation\">></span></span>5.1.38<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>mysql-connector-java.version</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>properties</span><span class=\"token punctuation\">></span></span>\n\n    <span class=\"token comment\" spellcheck=\"true\">&lt;!--dependencyManagement:管理父类的依赖，把版本号抽取出来放到properties标签中统一管理--></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependencyManagement</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependencies</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>mysql<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>mysql-connector-java<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>${mysql-connector-java.version}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependencies</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependencyManagement</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>project</span><span class=\"token punctuation\">></span></span>\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<ul>\n<li>子pom</li>\n</ul>\n<pre class=\"line-numbers language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>project</span> <span class=\"token attr-name\">xmlns</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>http://maven.apache.org/POM/4.0.0<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">xmlns:</span>xsi</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>http://www.w3.org/2001/XMLSchema-instance<span class=\"token punctuation\">\"</span></span>\n         <span class=\"token attr-name\"><span class=\"token namespace\">xsi:</span>schemaLocation</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>modelVersion</span><span class=\"token punctuation\">></span></span>4.0.0<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>modelVersion</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token comment\" spellcheck=\"true\">&lt;!--子类的坐标--></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.asia<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>demo-children<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>1.0.0-SNAPSHOT<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>name</span><span class=\"token punctuation\">></span></span>demo-children<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>name</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>packaging</span><span class=\"token punctuation\">></span></span>pom<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>packaging</span><span class=\"token punctuation\">></span></span>\n\n    <span class=\"token comment\" spellcheck=\"true\">&lt;!--继承父类的pom依赖--></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>parent</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.asia<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>demo-parent<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>1.0.0-SNAPSHOT<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>parent</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>project</span><span class=\"token punctuation\">></span></span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h2 id=\"其他依赖标签介绍\"><a href=\"#其他依赖标签介绍\" class=\"headerlink\" title=\"其他依赖标签介绍\"></a>其他依赖标签介绍</h2><p>依赖传递排除</p>\n<pre class=\"line-numbers language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.apache.shiro<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>shiro-spring<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>${shiro.version}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token comment\" spellcheck=\"true\">&lt;!--排除依赖传递列表 --></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>exclusions</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>exclusion</span><span class=\"token punctuation\">></span></span>\n\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>exclusion</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>exclusions</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>构建行为列表，bulid标签配置maven构建项目时的需要执行的各种行为，一般都是maven的插件</p>\n<pre class=\"line-numbers language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>build</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>pluginManagement</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>plugins</span><span class=\"token punctuation\">></span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>plugin</span><span class=\"token punctuation\">></span></span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.apache.maven.plugins<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span>\n                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>maven-compiler-plugin<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span>\n                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>3.1<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span>\n                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>configuration</span><span class=\"token punctuation\">></span></span>\n                      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>source</span><span class=\"token punctuation\">></span></span>${java.version}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>source</span><span class=\"token punctuation\">></span></span>\n                        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>target</span><span class=\"token punctuation\">></span></span>${java.version}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>target</span><span class=\"token punctuation\">></span></span>\n                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>configuration</span><span class=\"token punctuation\">></span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>plugin</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>pluginManagement</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>build</span><span class=\"token punctuation\">></span></span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h1 id=\"maven的使用\"><a href=\"#maven的使用\" class=\"headerlink\" title=\"maven的使用\"></a>maven的使用</h1><p><code>demo-parent</code>为父工程，聚合如下四个子工程：</p>\n<pre class=\"line-numbers language-xml\"><code class=\"language-xml\">  //demo-parent下的子工程，同事子工程之间存在相互依赖，demo-admin依赖demo-core\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>modules</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>module</span><span class=\"token punctuation\">></span></span>../demo-admin<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>module</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>module</span><span class=\"token punctuation\">></span></span>../demo-core<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>module</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>module</span><span class=\"token punctuation\">></span></span>../demo-rest<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>module</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>module</span><span class=\"token punctuation\">></span></span>../demo-generator<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>module</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>modules</span><span class=\"token punctuation\">></span></span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h2 id=\"package\"><a href=\"#package\" class=\"headerlink\" title=\"package\"></a>package</h2><p><code>demo-admin</code> 依赖 <code>demo-core</code>，如果在 <code>demo-core</code> 未打包的情况下，单独打包子工程 <code>demo-admin</code>，此时会报错，说找不到 <code>demo-core</code>，因为打包的时候通过pom去maven仓库寻找 <code>demo-core</code>，因 <code>demo-core</code> 不存在所以报错。<br><br>如果给 <code>demo-core</code> 执行package命令后，去给 <code>demo-core</code> 打包还会报同样的错，因为package命令仅仅是在 <code>demo-core</code> 的target目录下生成jar包，并未放入到maven仓库中，所以还是找不到。<br><br>所以最终解决方案是执行完package命令后，在执行insetall命令，此时会把jar安装到maven仓库中。</p>\n<h2 id=\"maven仓库分类\"><a href=\"#maven仓库分类\" class=\"headerlink\" title=\"maven仓库分类\"></a>maven仓库分类</h2><p>在maven中，仓库可以分为：<br><br>本地仓库、远程仓库。 </p>\n<ul>\n<li>远程仓库可以分为：中央仓库、私服仓库。<br>中央仓库是maven官方指定的仓库，可以理解为“寻找的最后一站”。 </li>\n<li>私服仓库可以是自己建的，也可以是其它主体建的（比如aliyun的maven仓库，jboss的maven仓库等）。<br>私服可以分为：全局应用的私服仓库、应用到项目自身的私服仓库。</li>\n</ul>\n<p>maven寻找得顺序大致可以理解为： </p>\n<pre><code>graph LR\n本地仓库--&gt;私服\n私服--&gt;远程仓库\n</code></pre><ol>\n<li>在本地仓库中寻找，如果没有则进入下一步。 </li>\n<li>在全局应用的私服仓库中寻找，如果没有则进入下一步。</li>\n<li>在项目自身的私服仓库中寻找，如果没有则进入下一步。 </li>\n<li>在中央仓库中寻找，如果没有则终止寻找。</li>\n</ol>\n<h2 id=\"maven常用命令\"><a href=\"#maven常用命令\" class=\"headerlink\" title=\"maven常用命令\"></a>maven常用命令</h2><ul>\n<li>package命令完成了项目编译、单元测试、打包功能，但没有把打好的可执行jar包（war包或其它形式的包）布署到本地maven仓库和远程maven私服仓库</li>\n<li>install命令完成了项目编译、单元测试、打包功能，同时把打好的可执行jar包（war包或其它形式的包）布署到本地maven仓库，==但没有布署到远程maven私服仓库==</li>\n<li>deploy命令完成了项目编译、单元测试、打包功能，同时把打好的可执行jar包（war包或其它形式的包）布署到==本地maven仓库和远程maven私服仓库==　　</li>\n</ul>\n<blockquote>\n<p>后一个命令会覆盖前一个命令的操作</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\"><code class=\"language-bash\">//分别是打包、安装、发布跳过测试命令\nmvn package -Dmaven.test.skip<span class=\"token operator\">=</span>true\nmvn <span class=\"token function\">install</span> -Dmaven.test.skip<span class=\"token operator\">=</span>true\nmvn deploy -Dmaven.test.skip<span class=\"token operator\">=</span>true\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"pom-xml解析\"><a href=\"#pom-xml解析\" class=\"headerlink\" title=\"pom.xml解析\"></a>pom.xml解析</h2><h3 id=\"依赖范围\"><a href=\"#依赖范围\" class=\"headerlink\" title=\"依赖范围\"></a>依赖范围</h3><pre><code class=\"xml\">&lt;dependency&gt;\n    &lt;groupId&gt;junit&lt;/groupId&gt;\n    &lt;artifactId&gt;junit&lt;/artifactId&gt;\n    &lt;version&gt;4.12&lt;/version&gt;\n    &lt;scope&gt;test&lt;/scope&gt;\n&lt;/dependency&gt;\n</code></pre>\n<p>scope:该标签指定依赖的作用域。</p>\n<h3 id=\"依赖传递\"><a href=\"#依赖传递\" class=\"headerlink\" title=\"依赖传递\"></a>依赖传递</h3><h3 id=\"依赖冲突\"><a href=\"#依赖冲突\" class=\"headerlink\" title=\"依赖冲突\"></a>依赖冲突</h3><ul>\n<li>依赖路径最短优先</li>\n<li>pom中谁写在前面谁优先</li>\n</ul>\n<pre><code>graph LR\nA--&gt;B\nB--&gt;C\nC--&gt;common-2.0.jar\n</code></pre><pre><code>graph LR\nA--&gt;B\nB--&gt;common-3.0.jar\n</code></pre><p>介绍：项目依赖了两个版本的common.jar，在打包时会采用依赖路径最短的common.3.0.jar。</p>\n<h3 id=\"项目聚合\"><a href=\"#项目聚合\" class=\"headerlink\" title=\"项目聚合\"></a>项目聚合</h3><p>把多个模块聚合到一块。</p>\n<pre><code class=\"xml\">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;\n         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;\n    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;\n    &lt;groupId&gt;com.asia&lt;/groupId&gt;\n    &lt;artifactId&gt;demo-parent&lt;/artifactId&gt;\n    &lt;version&gt;1.0.0-SNAPSHOT&lt;/version&gt;\n\n    &lt;name&gt;demo-parent&lt;/name&gt;\n    &lt;!--为pom--&gt;\n    &lt;packaging&gt;pom&lt;/packaging&gt;\n\n&lt;!--demo-parent聚合demo1、demo2、demo3、demo4模块--&gt;\n    &lt;modules&gt;\n        &lt;module&gt;../demo1&lt;/module&gt;\n        &lt;module&gt;../demo2&lt;/module&gt;\n        &lt;module&gt;../demo3&lt;/module&gt;\n        &lt;module&gt;../demo4&lt;/module&gt;\n    &lt;/modules&gt;\n&lt;/project&gt;\n\n</code></pre>\n<h3 id=\"依赖继承\"><a href=\"#依赖继承\" class=\"headerlink\" title=\"依赖继承\"></a>依赖继承</h3><p>把各个模块公用的依赖抽取成父类，供子模块继承使用。</p>\n<ul>\n<li>父pom</li>\n</ul>\n<pre><code class=\"xml\">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;\n         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;\n    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;\n    &lt;groupId&gt;com.asia&lt;/groupId&gt;\n    &lt;artifactId&gt;demo-parent&lt;/artifactId&gt;\n    &lt;version&gt;1.0.0-SNAPSHOT&lt;/version&gt;\n\n    &lt;name&gt;demo-parent&lt;/name&gt;\n    &lt;packaging&gt;pom&lt;/packaging&gt;\n\n    &lt;!--版本管理--&gt;\n    &lt;properties&gt;\n        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;\n        &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt;\n        &lt;!--mysql驱动依赖--&gt;\n        &lt;mysql-connector-java.version&gt;5.1.38&lt;/mysql-connector-java.version&gt;\n    &lt;/properties&gt;\n\n    &lt;!--dependencyManagement:管理父类的依赖，把版本号抽取出来放到properties标签中统一管理--&gt;\n    &lt;dependencyManagement&gt;\n        &lt;dependencies&gt;\n            &lt;dependency&gt;\n                &lt;groupId&gt;mysql&lt;/groupId&gt;\n                &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;\n                &lt;version&gt;${mysql-connector-java.version}&lt;/version&gt;\n            &lt;/dependency&gt;\n        &lt;/dependencies&gt;\n    &lt;/dependencyManagement&gt;\n&lt;/project&gt;\n\n</code></pre>\n<ul>\n<li>子pom</li>\n</ul>\n<pre><code class=\"xml\">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;\n         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;\n    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;\n    &lt;!--子类的坐标--&gt;\n    &lt;groupId&gt;com.asia&lt;/groupId&gt;\n    &lt;artifactId&gt;demo-children&lt;/artifactId&gt;\n    &lt;version&gt;1.0.0-SNAPSHOT&lt;/version&gt;\n    &lt;name&gt;demo-children&lt;/name&gt;\n    &lt;packaging&gt;pom&lt;/packaging&gt;\n\n    &lt;!--继承父类的pom依赖--&gt;\n    &lt;parent&gt;\n        &lt;groupId&gt;com.asia&lt;/groupId&gt;\n        &lt;artifactId&gt;demo-parent&lt;/artifactId&gt;\n        &lt;version&gt;1.0.0-SNAPSHOT&lt;/version&gt;\n    &lt;/parent&gt;\n&lt;/project&gt;\n</code></pre>\n<h2 id=\"其他依赖标签介绍\"><a href=\"#其他依赖标签介绍\" class=\"headerlink\" title=\"其他依赖标签介绍\"></a>其他依赖标签介绍</h2><p>依赖传递排除</p>\n<pre><code class=\"xml\">&lt;dependency&gt;\n    &lt;groupId&gt;org.apache.shiro&lt;/groupId&gt;\n        &lt;artifactId&gt;shiro-spring&lt;/artifactId&gt;\n        &lt;version&gt;${shiro.version}&lt;/version&gt;\n        &lt;!--排除依赖传递列表 --&gt;\n        &lt;exclusions&gt;\n            &lt;exclusion&gt;\n\n            &lt;/exclusion&gt;\n        &lt;/exclusions&gt;\n&lt;/dependency&gt;\n</code></pre>\n<p>构建行为列表，bulid标签配置maven构建项目时的需要执行的各种行为，一般都是maven的插件</p>\n<pre><code class=\"xml\">&lt;build&gt;\n        &lt;pluginManagement&gt;\n            &lt;plugins&gt;\n                &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n                    &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;\n                    &lt;version&gt;3.1&lt;/version&gt;\n                    &lt;configuration&gt;\n                      &lt;source&gt;${java.version}&lt;/source&gt;\n                        &lt;target&gt;${java.version}&lt;/target&gt;\n                    &lt;/configuration&gt;\n                &lt;/plugin&gt;\n        &lt;/pluginManagement&gt;\n    &lt;/build&gt;\n</code></pre>\n<h1 id=\"maven的使用\"><a href=\"#maven的使用\" class=\"headerlink\" title=\"maven的使用\"></a>maven的使用</h1><p><code>demo-parent</code>为父工程，聚合如下四个子工程：</p>\n<pre><code class=\"xml\">  //demo-parent下的子工程，同事子工程之间存在相互依赖，demo-admin依赖demo-core\n  &lt;modules&gt;\n        &lt;module&gt;../demo-admin&lt;/module&gt;\n        &lt;module&gt;../demo-core&lt;/module&gt;\n        &lt;module&gt;../demo-rest&lt;/module&gt;\n        &lt;module&gt;../demo-generator&lt;/module&gt;\n    &lt;/modules&gt;\n</code></pre>\n<h2 id=\"package\"><a href=\"#package\" class=\"headerlink\" title=\"package\"></a>package</h2><p><code>demo-admin</code> 依赖 <code>demo-core</code>，如果在 <code>demo-core</code> 未打包的情况下，单独打包子工程 <code>demo-admin</code>，此时会报错，说找不到 <code>demo-core</code>，因为打包的时候通过pom去maven仓库寻找 <code>demo-core</code>，因 <code>demo-core</code> 不存在所以报错。<br><br>如果给 <code>demo-core</code> 执行package命令后，去给 <code>demo-core</code> 打包还会报同样的错，因为package命令仅仅是在 <code>demo-core</code> 的target目录下生成jar包，并未放入到maven仓库中，所以还是找不到。<br><br>所以最终解决方案是执行完package命令后，在执行insetall命令，此时会把jar安装到maven仓库中。</p>\n<h2 id=\"maven仓库分类\"><a href=\"#maven仓库分类\" class=\"headerlink\" title=\"maven仓库分类\"></a>maven仓库分类</h2><p>在maven中，仓库可以分为：<br><br>本地仓库、远程仓库。 </p>\n<ul>\n<li>远程仓库可以分为：中央仓库、私服仓库。<br>中央仓库是maven官方指定的仓库，可以理解为“寻找的最后一站”。 </li>\n<li>私服仓库可以是自己建的，也可以是其它主体建的（比如aliyun的maven仓库，jboss的maven仓库等）。<br>私服可以分为：全局应用的私服仓库、应用到项目自身的私服仓库。</li>\n</ul>\n<p>maven寻找得顺序大致可以理解为： </p>\n<pre><code>graph LR\n本地仓库--&gt;私服\n私服--&gt;远程仓库\n</code></pre><ol>\n<li>在本地仓库中寻找，如果没有则进入下一步。 </li>\n<li>在全局应用的私服仓库中寻找，如果没有则进入下一步。</li>\n<li>在项目自身的私服仓库中寻找，如果没有则进入下一步。 </li>\n<li>在中央仓库中寻找，如果没有则终止寻找。</li>\n</ol>\n<h2 id=\"maven常用命令\"><a href=\"#maven常用命令\" class=\"headerlink\" title=\"maven常用命令\"></a>maven常用命令</h2><ul>\n<li>package命令完成了项目编译、单元测试、打包功能，但没有把打好的可执行jar包（war包或其它形式的包）布署到本地maven仓库和远程maven私服仓库</li>\n<li>install命令完成了项目编译、单元测试、打包功能，同时把打好的可执行jar包（war包或其它形式的包）布署到本地maven仓库，==但没有布署到远程maven私服仓库==</li>\n<li>deploy命令完成了项目编译、单元测试、打包功能，同时把打好的可执行jar包（war包或其它形式的包）布署到==本地maven仓库和远程maven私服仓库==　　</li>\n</ul>\n<blockquote>\n<p>后一个命令会覆盖前一个命令的操作</p>\n</blockquote>\n<pre><code class=\"bash\">//分别是打包、安装、发布跳过测试命令\nmvn package -Dmaven.test.skip=true\nmvn install -Dmaven.test.skip=true\nmvn deploy -Dmaven.test.skip=true\n</code></pre>\n"},{"title":"RESTful API 的幂等性","author":"Asia Cui","date":"2019-01-18T01:21:00.000Z","_content":"## 什么是幂等性\n\nHTTP 幂等方法，是指无论调用多少次都不会有不同结果的 HTTP 方法。不管你调用一次，还是调用一百次，一千次，结果都是相同的。\n\n```bash\nGET     /tickets       # 获取ticket列表\nGET     /tickets/12    # 查看某个具体的ticket\nPOST    /tickets       # 新建一个ticket\nPUT     /tickets/12    # 更新ticket 12\nPATCH   /tickets/12    # 更新ticket 12\nDELETE  /tickets/12    # 删除ticekt 12\n\n```\n\n###HTTP GET 方法\n\nHTTP GET 方法，用于获取资源，不管调用多少次接口，结果都不会改变，所以是幂等的。\n\n```bash\nGET     /tickets       # 获取ticket列表\nGET     /tickets/12    # 查看某个具体的ticket\n\n```\n\n只是查询数据，不会影响到资源的变化，因此我们认为它幂等。\n\n值得注意，幂等性指的是作用于结果而非资源本身。怎么理解呢？例如，这个 HTTP GET 方法可能会每次得到不同的返回内容，但并不影响资源。\n\n可能你会问有这种情况么？当然有咯。例如，我们有一个接口获取当前时间，我们就应该设计成\n\n```bash\nGET     /service_time # 获取服务器当前时间\n\n```\n\n它本身不会对资源本身产生影响，因此满足幂等性。\n\n###HTTP POST 方法\n\nHTTP POST 方法是一个非幂等方法，因为调用多次，都将产生新的资源。\n\n```bash\nPOST    /tickets       # 新建一个ticket\n\n```\n\n因为它会对资源本身产生影响，每次调用都会有新的资源产生，因此不满足幂等性。\n\n### HTTP PUT 方法\n\nHTTP PUT 方法是不是幂等的呢？我们来看下\n\n```bash\nPUT     /tickets/12    # 更新ticket 12\n\n```\n\n因为它直接把实体部分的数据替换到服务器的资源，我们多次调用它，只会产生一次影响，但是有相同结果的 HTTP 方法，所以满足幂等性。\n\n### HTTP PATCH 方法\n\nHTTP PATCH 方法是非幂等的。HTTP POST 方法和 HTTP PUT 方法可能比较好理解，但是 HTTP PATCH 方法只是更新部分资源，怎么是非幂等的呢?\n\n因为，PATCH 提供的实体则需要根据程序或其它协议的定义，解析后在服务器上执行，以此来修改服务器上的资源。换句话说，PATCH 请求是会执行某个程序的，如果重复提交，程序可能执行多次，对服务器上的资源就可能造成额外的影响，这就可以解释它为什么是非幂等的了。\n\n可能你还不能理解这点。我们举个例子\n\n```bash\nPATCH   /tickets/12    # 更新ticket 12\n\n```\n\n此时，我们服务端对方法的处理是，当调用一次方法，更新部分字段，将这条 ticket 记录的操作记录加一，这次，每次调用的资源是不是变了呢，所以它是有可能是非幂等的操作。\n\n### HTTP DELETE 方法\n\nHTTP DELETE 方法用于删除资源，会将资源删除。\n\n```bash\nDELETE  /tickets/12    # 删除ticekt 12\n\n```\n\n调用一次和多次对资源产生影响是相同的，所以也满足幂等性。\n\n## 如何设计符合幂等性的高质量 RESTful API\n\n### HTTP GET vs HTTP POST\n\n也许，你会想起一个面试题。**HTTP 请求的 GET 与 POST 方式有什么区别？** 你可能会回答到：GET 方式通过 URL 提交数据，数据在 URL 中可以看到；POST 方式，数据放置在 HTML HEADER 内提交。但是，我们现在从 RESTful 的资源角度来看待问题，HTTP GET 方法是幂等的，所以它适合作为查询操作，HTTP POST 方法是非幂等的，所以用来表示新增操作。\n\n但是，也有例外，我们有的时候可能需要把查询方法改造成 HTTP POST 方法。比如，超长（1k）的 GET URL 使用 POST 方法来替代，因为 GET 受到 URL 长度的限制。虽然，它不符合幂等性，但是它是一种折中的方案。\n\n### HTTP POST vs HTTP PUT\n\n对于 HTTP POST 方法和 HTTP PUT 方法，我们一般的理解是 POST 表示创建资源，PUT 表示更新资源。当然，这个是正确的理解。\n\n但是，实际上，两个方法都用于创建资源，更为本质的差别是在幂等性。HTTP POST 方法是非幂等，所以用来表示创建资源，HTTP PUT 方法是幂等的，因此表示更新资源更加贴切。\n\n### HTTP PUT vs HTTP PATCH\n\n此时，你看会有另外一个问题。HTTP PUT 方法和 HTTP PATCH 方法，都是用来表述更新资源，它们之间有什么区别呢？我们一般的理解是 PUT 表示更新全部资源，PATCH 表示更新部分资源。首先，这个是我们遵守的第一准则。根据上面的描述，PATCH 方法是非幂等的，因此我们在设计我们服务端的 RESTful API 的时候，也需要考虑。如果，我们想要明确的告诉调用者我们的资源是幂等的，我的设计更倾向于使用 HTTP PUT 方法。","source":"_posts/RESTful-API-的幂等性.md","raw":"title: RESTful API 的幂等性\nauthor: Asia Cui\ntags:\n  - RESTful\ncategories:\n  - RESTful API 的幂等性\ndate: 2019-01-18 09:21:00\n---\n## 什么是幂等性\n\nHTTP 幂等方法，是指无论调用多少次都不会有不同结果的 HTTP 方法。不管你调用一次，还是调用一百次，一千次，结果都是相同的。\n\n```bash\nGET     /tickets       # 获取ticket列表\nGET     /tickets/12    # 查看某个具体的ticket\nPOST    /tickets       # 新建一个ticket\nPUT     /tickets/12    # 更新ticket 12\nPATCH   /tickets/12    # 更新ticket 12\nDELETE  /tickets/12    # 删除ticekt 12\n\n```\n\n###HTTP GET 方法\n\nHTTP GET 方法，用于获取资源，不管调用多少次接口，结果都不会改变，所以是幂等的。\n\n```bash\nGET     /tickets       # 获取ticket列表\nGET     /tickets/12    # 查看某个具体的ticket\n\n```\n\n只是查询数据，不会影响到资源的变化，因此我们认为它幂等。\n\n值得注意，幂等性指的是作用于结果而非资源本身。怎么理解呢？例如，这个 HTTP GET 方法可能会每次得到不同的返回内容，但并不影响资源。\n\n可能你会问有这种情况么？当然有咯。例如，我们有一个接口获取当前时间，我们就应该设计成\n\n```bash\nGET     /service_time # 获取服务器当前时间\n\n```\n\n它本身不会对资源本身产生影响，因此满足幂等性。\n\n###HTTP POST 方法\n\nHTTP POST 方法是一个非幂等方法，因为调用多次，都将产生新的资源。\n\n```bash\nPOST    /tickets       # 新建一个ticket\n\n```\n\n因为它会对资源本身产生影响，每次调用都会有新的资源产生，因此不满足幂等性。\n\n### HTTP PUT 方法\n\nHTTP PUT 方法是不是幂等的呢？我们来看下\n\n```bash\nPUT     /tickets/12    # 更新ticket 12\n\n```\n\n因为它直接把实体部分的数据替换到服务器的资源，我们多次调用它，只会产生一次影响，但是有相同结果的 HTTP 方法，所以满足幂等性。\n\n### HTTP PATCH 方法\n\nHTTP PATCH 方法是非幂等的。HTTP POST 方法和 HTTP PUT 方法可能比较好理解，但是 HTTP PATCH 方法只是更新部分资源，怎么是非幂等的呢?\n\n因为，PATCH 提供的实体则需要根据程序或其它协议的定义，解析后在服务器上执行，以此来修改服务器上的资源。换句话说，PATCH 请求是会执行某个程序的，如果重复提交，程序可能执行多次，对服务器上的资源就可能造成额外的影响，这就可以解释它为什么是非幂等的了。\n\n可能你还不能理解这点。我们举个例子\n\n```bash\nPATCH   /tickets/12    # 更新ticket 12\n\n```\n\n此时，我们服务端对方法的处理是，当调用一次方法，更新部分字段，将这条 ticket 记录的操作记录加一，这次，每次调用的资源是不是变了呢，所以它是有可能是非幂等的操作。\n\n### HTTP DELETE 方法\n\nHTTP DELETE 方法用于删除资源，会将资源删除。\n\n```bash\nDELETE  /tickets/12    # 删除ticekt 12\n\n```\n\n调用一次和多次对资源产生影响是相同的，所以也满足幂等性。\n\n## 如何设计符合幂等性的高质量 RESTful API\n\n### HTTP GET vs HTTP POST\n\n也许，你会想起一个面试题。**HTTP 请求的 GET 与 POST 方式有什么区别？** 你可能会回答到：GET 方式通过 URL 提交数据，数据在 URL 中可以看到；POST 方式，数据放置在 HTML HEADER 内提交。但是，我们现在从 RESTful 的资源角度来看待问题，HTTP GET 方法是幂等的，所以它适合作为查询操作，HTTP POST 方法是非幂等的，所以用来表示新增操作。\n\n但是，也有例外，我们有的时候可能需要把查询方法改造成 HTTP POST 方法。比如，超长（1k）的 GET URL 使用 POST 方法来替代，因为 GET 受到 URL 长度的限制。虽然，它不符合幂等性，但是它是一种折中的方案。\n\n### HTTP POST vs HTTP PUT\n\n对于 HTTP POST 方法和 HTTP PUT 方法，我们一般的理解是 POST 表示创建资源，PUT 表示更新资源。当然，这个是正确的理解。\n\n但是，实际上，两个方法都用于创建资源，更为本质的差别是在幂等性。HTTP POST 方法是非幂等，所以用来表示创建资源，HTTP PUT 方法是幂等的，因此表示更新资源更加贴切。\n\n### HTTP PUT vs HTTP PATCH\n\n此时，你看会有另外一个问题。HTTP PUT 方法和 HTTP PATCH 方法，都是用来表述更新资源，它们之间有什么区别呢？我们一般的理解是 PUT 表示更新全部资源，PATCH 表示更新部分资源。首先，这个是我们遵守的第一准则。根据上面的描述，PATCH 方法是非幂等的，因此我们在设计我们服务端的 RESTful API 的时候，也需要考虑。如果，我们想要明确的告诉调用者我们的资源是幂等的，我的设计更倾向于使用 HTTP PUT 方法。","slug":"RESTful-API-的幂等性","published":1,"updated":"2019-01-18T01:23:20.578Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjs17mhxr000gpwgt24q2cb2h","content":"<h2 id=\"什么是幂等性\"><a href=\"#什么是幂等性\" class=\"headerlink\" title=\"什么是幂等性\"></a>什么是幂等性</h2><p>HTTP 幂等方法，是指无论调用多少次都不会有不同结果的 HTTP 方法。不管你调用一次，还是调用一百次，一千次，结果都是相同的。</p>\n<pre class=\"line-numbers language-bash\"><code class=\"language-bash\">GET     /tickets       <span class=\"token comment\" spellcheck=\"true\"># 获取ticket列表</span>\nGET     /tickets/12    <span class=\"token comment\" spellcheck=\"true\"># 查看某个具体的ticket</span>\nPOST    /tickets       <span class=\"token comment\" spellcheck=\"true\"># 新建一个ticket</span>\nPUT     /tickets/12    <span class=\"token comment\" spellcheck=\"true\"># 更新ticket 12</span>\nPATCH   /tickets/12    <span class=\"token comment\" spellcheck=\"true\"># 更新ticket 12</span>\nDELETE  /tickets/12    <span class=\"token comment\" spellcheck=\"true\"># 删除ticekt 12</span>\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>###HTTP GET 方法</p>\n<p>HTTP GET 方法，用于获取资源，不管调用多少次接口，结果都不会改变，所以是幂等的。</p>\n<pre class=\"line-numbers language-bash\"><code class=\"language-bash\">GET     /tickets       <span class=\"token comment\" spellcheck=\"true\"># 获取ticket列表</span>\nGET     /tickets/12    <span class=\"token comment\" spellcheck=\"true\"># 查看某个具体的ticket</span>\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<p>只是查询数据，不会影响到资源的变化，因此我们认为它幂等。</p>\n<p>值得注意，幂等性指的是作用于结果而非资源本身。怎么理解呢？例如，这个 HTTP GET 方法可能会每次得到不同的返回内容，但并不影响资源。</p>\n<p>可能你会问有这种情况么？当然有咯。例如，我们有一个接口获取当前时间，我们就应该设计成</p>\n<pre class=\"line-numbers language-bash\"><code class=\"language-bash\">GET     /service_time <span class=\"token comment\" spellcheck=\"true\"># 获取服务器当前时间</span>\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>它本身不会对资源本身产生影响，因此满足幂等性。</p>\n<p>###HTTP POST 方法</p>\n<p>HTTP POST 方法是一个非幂等方法，因为调用多次，都将产生新的资源。</p>\n<pre class=\"line-numbers language-bash\"><code class=\"language-bash\">POST    /tickets       <span class=\"token comment\" spellcheck=\"true\"># 新建一个ticket</span>\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>因为它会对资源本身产生影响，每次调用都会有新的资源产生，因此不满足幂等性。</p>\n<h3 id=\"HTTP-PUT-方法\"><a href=\"#HTTP-PUT-方法\" class=\"headerlink\" title=\"HTTP PUT 方法\"></a>HTTP PUT 方法</h3><p>HTTP PUT 方法是不是幂等的呢？我们来看下</p>\n<pre class=\"line-numbers language-bash\"><code class=\"language-bash\">PUT     /tickets/12    <span class=\"token comment\" spellcheck=\"true\"># 更新ticket 12</span>\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>因为它直接把实体部分的数据替换到服务器的资源，我们多次调用它，只会产生一次影响，但是有相同结果的 HTTP 方法，所以满足幂等性。</p>\n<h3 id=\"HTTP-PATCH-方法\"><a href=\"#HTTP-PATCH-方法\" class=\"headerlink\" title=\"HTTP PATCH 方法\"></a>HTTP PATCH 方法</h3><p>HTTP PATCH 方法是非幂等的。HTTP POST 方法和 HTTP PUT 方法可能比较好理解，但是 HTTP PATCH 方法只是更新部分资源，怎么是非幂等的呢?</p>\n<p>因为，PATCH 提供的实体则需要根据程序或其它协议的定义，解析后在服务器上执行，以此来修改服务器上的资源。换句话说，PATCH 请求是会执行某个程序的，如果重复提交，程序可能执行多次，对服务器上的资源就可能造成额外的影响，这就可以解释它为什么是非幂等的了。</p>\n<p>可能你还不能理解这点。我们举个例子</p>\n<pre class=\"line-numbers language-bash\"><code class=\"language-bash\">PATCH   /tickets/12    <span class=\"token comment\" spellcheck=\"true\"># 更新ticket 12</span>\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>此时，我们服务端对方法的处理是，当调用一次方法，更新部分字段，将这条 ticket 记录的操作记录加一，这次，每次调用的资源是不是变了呢，所以它是有可能是非幂等的操作。</p>\n<h3 id=\"HTTP-DELETE-方法\"><a href=\"#HTTP-DELETE-方法\" class=\"headerlink\" title=\"HTTP DELETE 方法\"></a>HTTP DELETE 方法</h3><p>HTTP DELETE 方法用于删除资源，会将资源删除。</p>\n<pre class=\"line-numbers language-bash\"><code class=\"language-bash\">DELETE  /tickets/12    <span class=\"token comment\" spellcheck=\"true\"># 删除ticekt 12</span>\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>调用一次和多次对资源产生影响是相同的，所以也满足幂等性。</p>\n<h2 id=\"如何设计符合幂等性的高质量-RESTful-API\"><a href=\"#如何设计符合幂等性的高质量-RESTful-API\" class=\"headerlink\" title=\"如何设计符合幂等性的高质量 RESTful API\"></a>如何设计符合幂等性的高质量 RESTful API</h2><h3 id=\"HTTP-GET-vs-HTTP-POST\"><a href=\"#HTTP-GET-vs-HTTP-POST\" class=\"headerlink\" title=\"HTTP GET vs HTTP POST\"></a>HTTP GET vs HTTP POST</h3><p>也许，你会想起一个面试题。<strong>HTTP 请求的 GET 与 POST 方式有什么区别？</strong> 你可能会回答到：GET 方式通过 URL 提交数据，数据在 URL 中可以看到；POST 方式，数据放置在 HTML HEADER 内提交。但是，我们现在从 RESTful 的资源角度来看待问题，HTTP GET 方法是幂等的，所以它适合作为查询操作，HTTP POST 方法是非幂等的，所以用来表示新增操作。</p>\n<p>但是，也有例外，我们有的时候可能需要把查询方法改造成 HTTP POST 方法。比如，超长（1k）的 GET URL 使用 POST 方法来替代，因为 GET 受到 URL 长度的限制。虽然，它不符合幂等性，但是它是一种折中的方案。</p>\n<h3 id=\"HTTP-POST-vs-HTTP-PUT\"><a href=\"#HTTP-POST-vs-HTTP-PUT\" class=\"headerlink\" title=\"HTTP POST vs HTTP PUT\"></a>HTTP POST vs HTTP PUT</h3><p>对于 HTTP POST 方法和 HTTP PUT 方法，我们一般的理解是 POST 表示创建资源，PUT 表示更新资源。当然，这个是正确的理解。</p>\n<p>但是，实际上，两个方法都用于创建资源，更为本质的差别是在幂等性。HTTP POST 方法是非幂等，所以用来表示创建资源，HTTP PUT 方法是幂等的，因此表示更新资源更加贴切。</p>\n<h3 id=\"HTTP-PUT-vs-HTTP-PATCH\"><a href=\"#HTTP-PUT-vs-HTTP-PATCH\" class=\"headerlink\" title=\"HTTP PUT vs HTTP PATCH\"></a>HTTP PUT vs HTTP PATCH</h3><p>此时，你看会有另外一个问题。HTTP PUT 方法和 HTTP PATCH 方法，都是用来表述更新资源，它们之间有什么区别呢？我们一般的理解是 PUT 表示更新全部资源，PATCH 表示更新部分资源。首先，这个是我们遵守的第一准则。根据上面的描述，PATCH 方法是非幂等的，因此我们在设计我们服务端的 RESTful API 的时候，也需要考虑。如果，我们想要明确的告诉调用者我们的资源是幂等的，我的设计更倾向于使用 HTTP PUT 方法。</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"什么是幂等性\"><a href=\"#什么是幂等性\" class=\"headerlink\" title=\"什么是幂等性\"></a>什么是幂等性</h2><p>HTTP 幂等方法，是指无论调用多少次都不会有不同结果的 HTTP 方法。不管你调用一次，还是调用一百次，一千次，结果都是相同的。</p>\n<pre><code class=\"bash\">GET     /tickets       # 获取ticket列表\nGET     /tickets/12    # 查看某个具体的ticket\nPOST    /tickets       # 新建一个ticket\nPUT     /tickets/12    # 更新ticket 12\nPATCH   /tickets/12    # 更新ticket 12\nDELETE  /tickets/12    # 删除ticekt 12\n\n</code></pre>\n<p>###HTTP GET 方法</p>\n<p>HTTP GET 方法，用于获取资源，不管调用多少次接口，结果都不会改变，所以是幂等的。</p>\n<pre><code class=\"bash\">GET     /tickets       # 获取ticket列表\nGET     /tickets/12    # 查看某个具体的ticket\n\n</code></pre>\n<p>只是查询数据，不会影响到资源的变化，因此我们认为它幂等。</p>\n<p>值得注意，幂等性指的是作用于结果而非资源本身。怎么理解呢？例如，这个 HTTP GET 方法可能会每次得到不同的返回内容，但并不影响资源。</p>\n<p>可能你会问有这种情况么？当然有咯。例如，我们有一个接口获取当前时间，我们就应该设计成</p>\n<pre><code class=\"bash\">GET     /service_time # 获取服务器当前时间\n\n</code></pre>\n<p>它本身不会对资源本身产生影响，因此满足幂等性。</p>\n<p>###HTTP POST 方法</p>\n<p>HTTP POST 方法是一个非幂等方法，因为调用多次，都将产生新的资源。</p>\n<pre><code class=\"bash\">POST    /tickets       # 新建一个ticket\n\n</code></pre>\n<p>因为它会对资源本身产生影响，每次调用都会有新的资源产生，因此不满足幂等性。</p>\n<h3 id=\"HTTP-PUT-方法\"><a href=\"#HTTP-PUT-方法\" class=\"headerlink\" title=\"HTTP PUT 方法\"></a>HTTP PUT 方法</h3><p>HTTP PUT 方法是不是幂等的呢？我们来看下</p>\n<pre><code class=\"bash\">PUT     /tickets/12    # 更新ticket 12\n\n</code></pre>\n<p>因为它直接把实体部分的数据替换到服务器的资源，我们多次调用它，只会产生一次影响，但是有相同结果的 HTTP 方法，所以满足幂等性。</p>\n<h3 id=\"HTTP-PATCH-方法\"><a href=\"#HTTP-PATCH-方法\" class=\"headerlink\" title=\"HTTP PATCH 方法\"></a>HTTP PATCH 方法</h3><p>HTTP PATCH 方法是非幂等的。HTTP POST 方法和 HTTP PUT 方法可能比较好理解，但是 HTTP PATCH 方法只是更新部分资源，怎么是非幂等的呢?</p>\n<p>因为，PATCH 提供的实体则需要根据程序或其它协议的定义，解析后在服务器上执行，以此来修改服务器上的资源。换句话说，PATCH 请求是会执行某个程序的，如果重复提交，程序可能执行多次，对服务器上的资源就可能造成额外的影响，这就可以解释它为什么是非幂等的了。</p>\n<p>可能你还不能理解这点。我们举个例子</p>\n<pre><code class=\"bash\">PATCH   /tickets/12    # 更新ticket 12\n\n</code></pre>\n<p>此时，我们服务端对方法的处理是，当调用一次方法，更新部分字段，将这条 ticket 记录的操作记录加一，这次，每次调用的资源是不是变了呢，所以它是有可能是非幂等的操作。</p>\n<h3 id=\"HTTP-DELETE-方法\"><a href=\"#HTTP-DELETE-方法\" class=\"headerlink\" title=\"HTTP DELETE 方法\"></a>HTTP DELETE 方法</h3><p>HTTP DELETE 方法用于删除资源，会将资源删除。</p>\n<pre><code class=\"bash\">DELETE  /tickets/12    # 删除ticekt 12\n\n</code></pre>\n<p>调用一次和多次对资源产生影响是相同的，所以也满足幂等性。</p>\n<h2 id=\"如何设计符合幂等性的高质量-RESTful-API\"><a href=\"#如何设计符合幂等性的高质量-RESTful-API\" class=\"headerlink\" title=\"如何设计符合幂等性的高质量 RESTful API\"></a>如何设计符合幂等性的高质量 RESTful API</h2><h3 id=\"HTTP-GET-vs-HTTP-POST\"><a href=\"#HTTP-GET-vs-HTTP-POST\" class=\"headerlink\" title=\"HTTP GET vs HTTP POST\"></a>HTTP GET vs HTTP POST</h3><p>也许，你会想起一个面试题。<strong>HTTP 请求的 GET 与 POST 方式有什么区别？</strong> 你可能会回答到：GET 方式通过 URL 提交数据，数据在 URL 中可以看到；POST 方式，数据放置在 HTML HEADER 内提交。但是，我们现在从 RESTful 的资源角度来看待问题，HTTP GET 方法是幂等的，所以它适合作为查询操作，HTTP POST 方法是非幂等的，所以用来表示新增操作。</p>\n<p>但是，也有例外，我们有的时候可能需要把查询方法改造成 HTTP POST 方法。比如，超长（1k）的 GET URL 使用 POST 方法来替代，因为 GET 受到 URL 长度的限制。虽然，它不符合幂等性，但是它是一种折中的方案。</p>\n<h3 id=\"HTTP-POST-vs-HTTP-PUT\"><a href=\"#HTTP-POST-vs-HTTP-PUT\" class=\"headerlink\" title=\"HTTP POST vs HTTP PUT\"></a>HTTP POST vs HTTP PUT</h3><p>对于 HTTP POST 方法和 HTTP PUT 方法，我们一般的理解是 POST 表示创建资源，PUT 表示更新资源。当然，这个是正确的理解。</p>\n<p>但是，实际上，两个方法都用于创建资源，更为本质的差别是在幂等性。HTTP POST 方法是非幂等，所以用来表示创建资源，HTTP PUT 方法是幂等的，因此表示更新资源更加贴切。</p>\n<h3 id=\"HTTP-PUT-vs-HTTP-PATCH\"><a href=\"#HTTP-PUT-vs-HTTP-PATCH\" class=\"headerlink\" title=\"HTTP PUT vs HTTP PATCH\"></a>HTTP PUT vs HTTP PATCH</h3><p>此时，你看会有另外一个问题。HTTP PUT 方法和 HTTP PATCH 方法，都是用来表述更新资源，它们之间有什么区别呢？我们一般的理解是 PUT 表示更新全部资源，PATCH 表示更新部分资源。首先，这个是我们遵守的第一准则。根据上面的描述，PATCH 方法是非幂等的，因此我们在设计我们服务端的 RESTful API 的时候，也需要考虑。如果，我们想要明确的告诉调用者我们的资源是幂等的，我的设计更倾向于使用 HTTP PUT 方法。</p>\n"},{"title":"Mysql命令","author":"Asia Cui","date":"2019-01-09T03:54:00.000Z","_content":"> 此文针对MySQL5.7版本，5.7以上版本可能有不支持情况。\n\n## MySQL命令\n\n\n\n```bash\n#控制台登录mysql的root用户，linux如果执行命令不存在，未把mysql添加到bin目录下\nmysql -uroot -p\n\n#选择操作的数据库名称\nuse mysql;\n#查看所有的库\nshow database;\n#查看所有的表，需要在选择库之后才能使用\nshow tables;\n\n#执行脚本文件\nsource /usr/test.sql\n\n#退出mysql控制台\nexit;\n\n#查看行锁的竞争状态\nshow status like 'innodb_row_lock%';\n```\n\n## MySQL配置\n\n- 修改密码\n\n  ```bash\n  #知道密码情况下，修改密码\n  use mysql;\n  update user set password=passworD(\"123456\") where user='root';\n  \n  #忘记密码情况下，修改密码\n  首先，你必须要有操作系统的root权限了，找到my.conf编辑，把skip-grant-tables粘贴到[mysqld]选项中\n  ```\n\n- mysql创建用户\n\n  ```bash\n  #创建用户\n  use mysql;\n  CREATE USER 'username'@'host' IDENTIFIED BY 'password';\n  - username：创建的用户名\n  - host：指定该用户在哪个主机上可以登陆，为\"localhost\"指该用户只能在本地登录，将\"localhost\"改为\"%\"，表示在任何一台电脑上都可以登录;也可以指定某台机器可以远程登录;\n  - password:用户的密码。\n  \n  #例：\n  CREATE USER 'dog'@'localhost' IDENTIFIED BY '123456';\n  ```\n\n## CURD\n\n```sql\n#查询语句\nselect * from sys_user where id = 1;\n#更新语句\nupdate sys_user set name='admin' where id = 1;\n```\n## 索引\n\n```sql\n#给表A的name字段添加唯一索引\nalter table A add unique(name);\n```\n","source":"_posts/Mysql命令.md","raw":"title: Mysql命令\nauthor: Asia Cui\ntags:\n  - MySQL\ncategories:\n  - MySQL命令\ndate: 2019-01-09 11:54:00\n---\n> 此文针对MySQL5.7版本，5.7以上版本可能有不支持情况。\n\n## MySQL命令\n\n\n\n```bash\n#控制台登录mysql的root用户，linux如果执行命令不存在，未把mysql添加到bin目录下\nmysql -uroot -p\n\n#选择操作的数据库名称\nuse mysql;\n#查看所有的库\nshow database;\n#查看所有的表，需要在选择库之后才能使用\nshow tables;\n\n#执行脚本文件\nsource /usr/test.sql\n\n#退出mysql控制台\nexit;\n\n#查看行锁的竞争状态\nshow status like 'innodb_row_lock%';\n```\n\n## MySQL配置\n\n- 修改密码\n\n  ```bash\n  #知道密码情况下，修改密码\n  use mysql;\n  update user set password=passworD(\"123456\") where user='root';\n  \n  #忘记密码情况下，修改密码\n  首先，你必须要有操作系统的root权限了，找到my.conf编辑，把skip-grant-tables粘贴到[mysqld]选项中\n  ```\n\n- mysql创建用户\n\n  ```bash\n  #创建用户\n  use mysql;\n  CREATE USER 'username'@'host' IDENTIFIED BY 'password';\n  - username：创建的用户名\n  - host：指定该用户在哪个主机上可以登陆，为\"localhost\"指该用户只能在本地登录，将\"localhost\"改为\"%\"，表示在任何一台电脑上都可以登录;也可以指定某台机器可以远程登录;\n  - password:用户的密码。\n  \n  #例：\n  CREATE USER 'dog'@'localhost' IDENTIFIED BY '123456';\n  ```\n\n## CURD\n\n```sql\n#查询语句\nselect * from sys_user where id = 1;\n#更新语句\nupdate sys_user set name='admin' where id = 1;\n```\n## 索引\n\n```sql\n#给表A的name字段添加唯一索引\nalter table A add unique(name);\n```\n","slug":"Mysql命令","published":1,"updated":"2019-01-09T05:51:02.263Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjs17mhxw000ipwgt9cvnayhd","content":"<blockquote>\n<p>此文针对MySQL5.7版本，5.7以上版本可能有不支持情况。</p>\n</blockquote>\n<h2 id=\"MySQL命令\"><a href=\"#MySQL命令\" class=\"headerlink\" title=\"MySQL命令\"></a>MySQL命令</h2><pre class=\"line-numbers language-bash\"><code class=\"language-bash\"><span class=\"token comment\" spellcheck=\"true\">#控制台登录mysql的root用户，linux如果执行命令不存在，未把mysql添加到bin目录下</span>\nmysql -uroot -p\n\n<span class=\"token comment\" spellcheck=\"true\">#选择操作的数据库名称</span>\nuse mysql<span class=\"token punctuation\">;</span>\n<span class=\"token comment\" spellcheck=\"true\">#查看所有的库</span>\nshow database<span class=\"token punctuation\">;</span>\n<span class=\"token comment\" spellcheck=\"true\">#查看所有的表，需要在选择库之后才能使用</span>\nshow tables<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\" spellcheck=\"true\">#执行脚本文件</span>\n<span class=\"token function\">source</span> /usr/test.sql\n\n<span class=\"token comment\" spellcheck=\"true\">#退出mysql控制台</span>\n<span class=\"token keyword\">exit</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\" spellcheck=\"true\">#查看行锁的竞争状态</span>\nshow status like <span class=\"token string\">'innodb_row_lock%'</span><span class=\"token punctuation\">;</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h2 id=\"MySQL配置\"><a href=\"#MySQL配置\" class=\"headerlink\" title=\"MySQL配置\"></a>MySQL配置</h2><ul>\n<li><p>修改密码</p>\n<pre class=\"line-numbers language-bash\"><code class=\"language-bash\"><span class=\"token comment\" spellcheck=\"true\">#知道密码情况下，修改密码</span>\nuse mysql<span class=\"token punctuation\">;</span>\nupdate user <span class=\"token keyword\">set</span> password<span class=\"token operator\">=</span>passworD<span class=\"token punctuation\">(</span><span class=\"token string\">\"123456\"</span><span class=\"token punctuation\">)</span> where user<span class=\"token operator\">=</span><span class=\"token string\">'root'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\" spellcheck=\"true\">#忘记密码情况下，修改密码</span>\n首先，你必须要有操作系统的root权限了，找到my.conf编辑，把skip-grant-tables粘贴到<span class=\"token punctuation\">[</span>mysqld<span class=\"token punctuation\">]</span>选项中\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n</li>\n<li><p>mysql创建用户</p>\n<pre class=\"line-numbers language-bash\"><code class=\"language-bash\"><span class=\"token comment\" spellcheck=\"true\">#创建用户</span>\nuse mysql<span class=\"token punctuation\">;</span>\nCREATE USER <span class=\"token string\">'username'</span>@<span class=\"token string\">'host'</span> IDENTIFIED BY <span class=\"token string\">'password'</span><span class=\"token punctuation\">;</span>\n- username：创建的用户名\n- host：指定该用户在哪个主机上可以登陆，为<span class=\"token string\">\"localhost\"</span>指该用户只能在本地登录，将<span class=\"token string\">\"localhost\"</span>改为<span class=\"token string\">\"%\"</span>，表示在任何一台电脑上都可以登录<span class=\"token punctuation\">;</span>也可以指定某台机器可以远程登录<span class=\"token punctuation\">;</span>\n- password:用户的密码。\n\n<span class=\"token comment\" spellcheck=\"true\">#例：</span>\nCREATE USER <span class=\"token string\">'dog'</span>@<span class=\"token string\">'localhost'</span> IDENTIFIED BY <span class=\"token string\">'123456'</span><span class=\"token punctuation\">;</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n</li>\n</ul>\n<h2 id=\"CURD\"><a href=\"#CURD\" class=\"headerlink\" title=\"CURD\"></a>CURD</h2><pre class=\"line-numbers language-sql\"><code class=\"language-sql\"><span class=\"token comment\" spellcheck=\"true\">#查询语句</span>\n<span class=\"token keyword\">select</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">from</span> sys_user <span class=\"token keyword\">where</span> id <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\" spellcheck=\"true\">#更新语句</span>\n<span class=\"token keyword\">update</span> sys_user <span class=\"token keyword\">set</span> name<span class=\"token operator\">=</span><span class=\"token string\">'admin'</span> <span class=\"token keyword\">where</span> id <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<h2 id=\"索引\"><a href=\"#索引\" class=\"headerlink\" title=\"索引\"></a>索引</h2><pre class=\"line-numbers language-sql\"><code class=\"language-sql\"><span class=\"token comment\" spellcheck=\"true\">#给表A的name字段添加唯一索引</span>\n<span class=\"token keyword\">alter</span> <span class=\"token keyword\">table</span> A <span class=\"token keyword\">add</span> <span class=\"token keyword\">unique</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p>此文针对MySQL5.7版本，5.7以上版本可能有不支持情况。</p>\n</blockquote>\n<h2 id=\"MySQL命令\"><a href=\"#MySQL命令\" class=\"headerlink\" title=\"MySQL命令\"></a>MySQL命令</h2><pre><code class=\"bash\">#控制台登录mysql的root用户，linux如果执行命令不存在，未把mysql添加到bin目录下\nmysql -uroot -p\n\n#选择操作的数据库名称\nuse mysql;\n#查看所有的库\nshow database;\n#查看所有的表，需要在选择库之后才能使用\nshow tables;\n\n#执行脚本文件\nsource /usr/test.sql\n\n#退出mysql控制台\nexit;\n\n#查看行锁的竞争状态\nshow status like &#39;innodb_row_lock%&#39;;\n</code></pre>\n<h2 id=\"MySQL配置\"><a href=\"#MySQL配置\" class=\"headerlink\" title=\"MySQL配置\"></a>MySQL配置</h2><ul>\n<li><p>修改密码</p>\n<pre><code class=\"bash\">#知道密码情况下，修改密码\nuse mysql;\nupdate user set password=passworD(&quot;123456&quot;) where user=&#39;root&#39;;\n\n#忘记密码情况下，修改密码\n首先，你必须要有操作系统的root权限了，找到my.conf编辑，把skip-grant-tables粘贴到[mysqld]选项中\n</code></pre>\n</li>\n<li><p>mysql创建用户</p>\n<pre><code class=\"bash\">#创建用户\nuse mysql;\nCREATE USER &#39;username&#39;@&#39;host&#39; IDENTIFIED BY &#39;password&#39;;\n- username：创建的用户名\n- host：指定该用户在哪个主机上可以登陆，为&quot;localhost&quot;指该用户只能在本地登录，将&quot;localhost&quot;改为&quot;%&quot;，表示在任何一台电脑上都可以登录;也可以指定某台机器可以远程登录;\n- password:用户的密码。\n\n#例：\nCREATE USER &#39;dog&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;123456&#39;;\n</code></pre>\n</li>\n</ul>\n<h2 id=\"CURD\"><a href=\"#CURD\" class=\"headerlink\" title=\"CURD\"></a>CURD</h2><pre><code class=\"sql\">#查询语句\nselect * from sys_user where id = 1;\n#更新语句\nupdate sys_user set name=&#39;admin&#39; where id = 1;\n</code></pre>\n<h2 id=\"索引\"><a href=\"#索引\" class=\"headerlink\" title=\"索引\"></a>索引</h2><pre><code class=\"sql\">#给表A的name字段添加唯一索引\nalter table A add unique(name);\n</code></pre>\n"},{"title":"SnowFlake雪花算法","author":"Asia Cui","date":"2019-01-22T01:43:00.000Z","_content":"## snowflake 算法\n\nsnowflake 算法是 twitter 开源的分布式 id 生成算法，就是把一个 64 位的 long 型的 id，1 个 bit 是不用的，用其中的 41 bit 作为毫秒数，用 10 bit 作为工作机器 id，12 bit 作为序列号。\n\n*   1 bit：不用，为啥呢？因为二进制里第一个 bit 为如果是 1，那么都是负数，但是我们生成的 id 都是正数，所以第一个 bit 统一都是 0。\n\n*   41 bit：表示的是时间戳，单位是毫秒。41 bit 可以表示的数字多达 2^41 - 1，也就是可以标识 2^41 - 1 个毫秒值，换算成年就是表示 69 年的时间。\n\n*   10 bit：记录工作机器 id，代表的是这个服务最多可以部署在 2^10 台机器上哪，也就是 1024 台机器。但是 10 bit 里 5 个 bit 代表机房 id，5 个 bit 代表机器 id。意思就是最多代表 2^5 个机房（32 个机房），每个机房里可以代表 2^5 个机器（32 台机器）。\n\n*   12 bit：这个是用来记录同一个毫秒内产生的不同 id，12 bit 可以代表的最大正整数是 2^12 - 1 = 4096，也就是说可以用这个 12 bit 代表的数字来区分同一个毫秒内的 4096 个不同的 id。\n\n> 0 | 0001100 10100010 10111110 10001001 01011100 00 | 10001 | 1 1001 | 0000 00000000\n\n## 工具类源代码\n\n```java\npackage com.ifly.inquiry.base;\n\n/**\n * <p>DESCRIPTION:</p>\n *\n * @author AsiaCui\n * @version: 1.0.0\n * @create 2019-01-22 9:32\n **/\npublic class IdWorker {\n\n    private long workerId;\n    private long datacenterId;\n    private long sequence;\n\n    public IdWorker(long workerId, long datacenterId, long sequence) {\n        //sanitycheckforworkerId\n        //这儿不就检查了一下，要求就是你传递进来的机房id和机器id不能超过32，不能小于0\n        if (workerId > maxWorkerId || workerId < 0) {\n            throw new IllegalArgumentException(\n                    String.format(\"workerIdcan'tbegreaterthan%dorlessthan0\", maxWorkerId));\n        }\n        if (datacenterId > maxDatacenterId || datacenterId < 0) {\n            throw new IllegalArgumentException(\n                    String.format(\"datacenterIdcan'tbegreaterthan%dorlessthan0\", maxDatacenterId));\n        }\n        System.out.printf(\n                \"workerstarting.timestampleftshift%d,datacenteridbits%d,workeridbits%d,sequencebits%d,workerid%d\",\n                timestampLeftShift, datacenterIdBits, workerIdBits, sequenceBits, workerId);\n        this.workerId = workerId;\n        this.datacenterId = datacenterId;\n        this.sequence = sequence;\n    }\n\n    private long twepoch = 1288834974657L;\n    private long workerIdBits = 5L;\n    private long datacenterIdBits = 5L;\n    //这个是二进制运算，就是5bit最多只能有31个数字，也就是说机器id最多只能是32以内\n    private long maxWorkerId = -1L ^ (-1L << workerIdBits);\n    //这个是一个意思，就是5bit最多只能有31个数字，机房id最多只能是32以内\n    private long maxDatacenterId = -1L ^ (-1L << datacenterIdBits);\n    private long sequenceBits = 12L;\n    private long workerIdShift = sequenceBits;\n    private long datacenterIdShift = sequenceBits + workerIdBits;\n    private long timestampLeftShift = sequenceBits + workerIdBits + datacenterIdBits;\n    private long sequenceMask = -1L ^ (-1L << sequenceBits);\n    private long lastTimestamp = -1L;\n\n    public long getWorkerId() {\n        return workerId;\n    }\n\n    public long getDatacenterId() {\n        return datacenterId;\n    }\n\n    public long getTimestamp() {\n        return System.currentTimeMillis();\n    }\n\n    public synchronized long nextId() {\n        //这儿就是获取当前时间戳，单位是毫秒\n        long timestamp = timeGen();\n        if (timestamp < lastTimestamp) {\n            System.err.printf(\"clockismovingbackwards. Rejectingrequestsuntil%d.\", lastTimestamp);\n            throw new RuntimeException(String.format(\"Clockmovedbackwards. Refusingtogenerateidfor%dmilliseconds\", lastTimestamp - timestamp));\n        }\n        if (lastTimestamp == timestamp) {\n            //这个意思是说一个毫秒内最多只能有4096个数字\n            //无论你传递多少进来，这个位运算保证始终就是在4096这个范围内，避免你自己传递个sequence超过了4096这个范围\n            sequence = (sequence + 1) & sequenceMask;\n            if (sequence == 0) {\n                timestamp = tilNextMillis(lastTimestamp);\n            }\n        } else {\n            sequence = 0;\n        }\n        //这儿记录一下最近一次生成id的时间戳，单位是毫秒\n        lastTimestamp = timestamp;\n        //这儿就是将时间戳左移，放到41bit那儿；\n        //将机房id左移放到5bit那儿；\n        //将机器id左移放到5bit那儿；将序号放最后12bit；\n        //最后拼接起来成一个64bit的二进制数字，转换成10进制就是个long型\n        return ((timestamp - twepoch) << timestampLeftShift) | (datacenterId << datacenterIdShift)\n                | (workerId << workerIdShift) | sequence;\n    }\n\n    private long tilNextMillis(long lastTimestamp) {\n        long timestamp = timeGen();\n        while (timestamp <= lastTimestamp) {\n            timestamp = timeGen();\n        }\n        return timestamp;\n    }\n\n    private long timeGen() {\n        return System.currentTimeMillis();\n    }\n\n    //---------------测试---------------\n    public static void main(String[] args) {\n        IdWorker worker = new IdWorker(1, 1, 1);\n        for (int i = 0; i < 30; i++) {\n            System.out.println(worker.nextId());\n        }\n    }\n}\n\n```\n\n怎么说呢，大概这个意思吧，就是说 41 bit 是当前毫秒单位的一个时间戳，就这意思；然后 5 bit 是你传递进来的一个机房 id（但是最大只能是 32 以内），另外 5 bit 是你传递进来的机器 id（但是最大只能是 32 以内），剩下的那个 12 bit 序列号，就是如果跟你上次生成 id 的时间还在一个毫秒内，那么会把顺序给你累加，最多在 4096 个序号以内。\n\n所以你自己利用这个工具类，自己搞一个服务，然后对每个机房的每个机器都初始化这么一个东西，刚开始这个机房的这个机器的序号就是 0。然后每次接收到一个请求，说这个机房的这个机器要生成一个 id，你就找到对应的 Worker 生成。\n\n利用这个 snowflake 算法，你可以开发自己公司的服务，甚至对于机房 id 和机器 id，反正给你预留了 5 bit + 5 bit，你换成别的有业务含义的东西也可以的。\n\n这个 snowflake 算法相对来说还是比较靠谱的，所以你要真是搞分布式 id 生成，如果是高并发啥的，那么用这个应该性能比较好，一般每秒几万并发的场景，也足够你用了。","source":"_posts/SnowFlake雪花算法.md","raw":"title: SnowFlake雪花算法\nauthor: Asia Cui\ntags:\n  - Java工具类\ncategories:\n  - 雪花算法\ndate: 2019-01-22 09:43:00\n---\n## snowflake 算法\n\nsnowflake 算法是 twitter 开源的分布式 id 生成算法，就是把一个 64 位的 long 型的 id，1 个 bit 是不用的，用其中的 41 bit 作为毫秒数，用 10 bit 作为工作机器 id，12 bit 作为序列号。\n\n*   1 bit：不用，为啥呢？因为二进制里第一个 bit 为如果是 1，那么都是负数，但是我们生成的 id 都是正数，所以第一个 bit 统一都是 0。\n\n*   41 bit：表示的是时间戳，单位是毫秒。41 bit 可以表示的数字多达 2^41 - 1，也就是可以标识 2^41 - 1 个毫秒值，换算成年就是表示 69 年的时间。\n\n*   10 bit：记录工作机器 id，代表的是这个服务最多可以部署在 2^10 台机器上哪，也就是 1024 台机器。但是 10 bit 里 5 个 bit 代表机房 id，5 个 bit 代表机器 id。意思就是最多代表 2^5 个机房（32 个机房），每个机房里可以代表 2^5 个机器（32 台机器）。\n\n*   12 bit：这个是用来记录同一个毫秒内产生的不同 id，12 bit 可以代表的最大正整数是 2^12 - 1 = 4096，也就是说可以用这个 12 bit 代表的数字来区分同一个毫秒内的 4096 个不同的 id。\n\n> 0 | 0001100 10100010 10111110 10001001 01011100 00 | 10001 | 1 1001 | 0000 00000000\n\n## 工具类源代码\n\n```java\npackage com.ifly.inquiry.base;\n\n/**\n * <p>DESCRIPTION:</p>\n *\n * @author AsiaCui\n * @version: 1.0.0\n * @create 2019-01-22 9:32\n **/\npublic class IdWorker {\n\n    private long workerId;\n    private long datacenterId;\n    private long sequence;\n\n    public IdWorker(long workerId, long datacenterId, long sequence) {\n        //sanitycheckforworkerId\n        //这儿不就检查了一下，要求就是你传递进来的机房id和机器id不能超过32，不能小于0\n        if (workerId > maxWorkerId || workerId < 0) {\n            throw new IllegalArgumentException(\n                    String.format(\"workerIdcan'tbegreaterthan%dorlessthan0\", maxWorkerId));\n        }\n        if (datacenterId > maxDatacenterId || datacenterId < 0) {\n            throw new IllegalArgumentException(\n                    String.format(\"datacenterIdcan'tbegreaterthan%dorlessthan0\", maxDatacenterId));\n        }\n        System.out.printf(\n                \"workerstarting.timestampleftshift%d,datacenteridbits%d,workeridbits%d,sequencebits%d,workerid%d\",\n                timestampLeftShift, datacenterIdBits, workerIdBits, sequenceBits, workerId);\n        this.workerId = workerId;\n        this.datacenterId = datacenterId;\n        this.sequence = sequence;\n    }\n\n    private long twepoch = 1288834974657L;\n    private long workerIdBits = 5L;\n    private long datacenterIdBits = 5L;\n    //这个是二进制运算，就是5bit最多只能有31个数字，也就是说机器id最多只能是32以内\n    private long maxWorkerId = -1L ^ (-1L << workerIdBits);\n    //这个是一个意思，就是5bit最多只能有31个数字，机房id最多只能是32以内\n    private long maxDatacenterId = -1L ^ (-1L << datacenterIdBits);\n    private long sequenceBits = 12L;\n    private long workerIdShift = sequenceBits;\n    private long datacenterIdShift = sequenceBits + workerIdBits;\n    private long timestampLeftShift = sequenceBits + workerIdBits + datacenterIdBits;\n    private long sequenceMask = -1L ^ (-1L << sequenceBits);\n    private long lastTimestamp = -1L;\n\n    public long getWorkerId() {\n        return workerId;\n    }\n\n    public long getDatacenterId() {\n        return datacenterId;\n    }\n\n    public long getTimestamp() {\n        return System.currentTimeMillis();\n    }\n\n    public synchronized long nextId() {\n        //这儿就是获取当前时间戳，单位是毫秒\n        long timestamp = timeGen();\n        if (timestamp < lastTimestamp) {\n            System.err.printf(\"clockismovingbackwards. Rejectingrequestsuntil%d.\", lastTimestamp);\n            throw new RuntimeException(String.format(\"Clockmovedbackwards. Refusingtogenerateidfor%dmilliseconds\", lastTimestamp - timestamp));\n        }\n        if (lastTimestamp == timestamp) {\n            //这个意思是说一个毫秒内最多只能有4096个数字\n            //无论你传递多少进来，这个位运算保证始终就是在4096这个范围内，避免你自己传递个sequence超过了4096这个范围\n            sequence = (sequence + 1) & sequenceMask;\n            if (sequence == 0) {\n                timestamp = tilNextMillis(lastTimestamp);\n            }\n        } else {\n            sequence = 0;\n        }\n        //这儿记录一下最近一次生成id的时间戳，单位是毫秒\n        lastTimestamp = timestamp;\n        //这儿就是将时间戳左移，放到41bit那儿；\n        //将机房id左移放到5bit那儿；\n        //将机器id左移放到5bit那儿；将序号放最后12bit；\n        //最后拼接起来成一个64bit的二进制数字，转换成10进制就是个long型\n        return ((timestamp - twepoch) << timestampLeftShift) | (datacenterId << datacenterIdShift)\n                | (workerId << workerIdShift) | sequence;\n    }\n\n    private long tilNextMillis(long lastTimestamp) {\n        long timestamp = timeGen();\n        while (timestamp <= lastTimestamp) {\n            timestamp = timeGen();\n        }\n        return timestamp;\n    }\n\n    private long timeGen() {\n        return System.currentTimeMillis();\n    }\n\n    //---------------测试---------------\n    public static void main(String[] args) {\n        IdWorker worker = new IdWorker(1, 1, 1);\n        for (int i = 0; i < 30; i++) {\n            System.out.println(worker.nextId());\n        }\n    }\n}\n\n```\n\n怎么说呢，大概这个意思吧，就是说 41 bit 是当前毫秒单位的一个时间戳，就这意思；然后 5 bit 是你传递进来的一个机房 id（但是最大只能是 32 以内），另外 5 bit 是你传递进来的机器 id（但是最大只能是 32 以内），剩下的那个 12 bit 序列号，就是如果跟你上次生成 id 的时间还在一个毫秒内，那么会把顺序给你累加，最多在 4096 个序号以内。\n\n所以你自己利用这个工具类，自己搞一个服务，然后对每个机房的每个机器都初始化这么一个东西，刚开始这个机房的这个机器的序号就是 0。然后每次接收到一个请求，说这个机房的这个机器要生成一个 id，你就找到对应的 Worker 生成。\n\n利用这个 snowflake 算法，你可以开发自己公司的服务，甚至对于机房 id 和机器 id，反正给你预留了 5 bit + 5 bit，你换成别的有业务含义的东西也可以的。\n\n这个 snowflake 算法相对来说还是比较靠谱的，所以你要真是搞分布式 id 生成，如果是高并发啥的，那么用这个应该性能比较好，一般每秒几万并发的场景，也足够你用了。","slug":"SnowFlake雪花算法","published":1,"updated":"2019-01-22T02:05:58.044Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjs17mhxz000mpwgtqe3n8elr","content":"<h2 id=\"snowflake-算法\"><a href=\"#snowflake-算法\" class=\"headerlink\" title=\"snowflake 算法\"></a>snowflake 算法</h2><p>snowflake 算法是 twitter 开源的分布式 id 生成算法，就是把一个 64 位的 long 型的 id，1 个 bit 是不用的，用其中的 41 bit 作为毫秒数，用 10 bit 作为工作机器 id，12 bit 作为序列号。</p>\n<ul>\n<li><p>1 bit：不用，为啥呢？因为二进制里第一个 bit 为如果是 1，那么都是负数，但是我们生成的 id 都是正数，所以第一个 bit 统一都是 0。</p>\n</li>\n<li><p>41 bit：表示的是时间戳，单位是毫秒。41 bit 可以表示的数字多达 2^41 - 1，也就是可以标识 2^41 - 1 个毫秒值，换算成年就是表示 69 年的时间。</p>\n</li>\n<li><p>10 bit：记录工作机器 id，代表的是这个服务最多可以部署在 2^10 台机器上哪，也就是 1024 台机器。但是 10 bit 里 5 个 bit 代表机房 id，5 个 bit 代表机器 id。意思就是最多代表 2^5 个机房（32 个机房），每个机房里可以代表 2^5 个机器（32 台机器）。</p>\n</li>\n<li><p>12 bit：这个是用来记录同一个毫秒内产生的不同 id，12 bit 可以代表的最大正整数是 2^12 - 1 = 4096，也就是说可以用这个 12 bit 代表的数字来区分同一个毫秒内的 4096 个不同的 id。</p>\n</li>\n</ul>\n<blockquote>\n<p>0 | 0001100 10100010 10111110 10001001 01011100 00 | 10001 | 1 1001 | 0000 00000000</p>\n</blockquote>\n<h2 id=\"工具类源代码\"><a href=\"#工具类源代码\" class=\"headerlink\" title=\"工具类源代码\"></a>工具类源代码</h2><pre class=\"line-numbers language-java\"><code class=\"language-java\"><span class=\"token keyword\">package</span> com<span class=\"token punctuation\">.</span>ifly<span class=\"token punctuation\">.</span>inquiry<span class=\"token punctuation\">.</span>base<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\" spellcheck=\"true\">/**\n * &lt;p>DESCRIPTION:&lt;/p>\n *\n * @author AsiaCui\n * @version: 1.0.0\n * @create 2019-01-22 9:32\n **/</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">IdWorker</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">long</span> workerId<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">long</span> datacenterId<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">long</span> sequence<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token function\">IdWorker</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">long</span> workerId<span class=\"token punctuation\">,</span> <span class=\"token keyword\">long</span> datacenterId<span class=\"token punctuation\">,</span> <span class=\"token keyword\">long</span> sequence<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\" spellcheck=\"true\">//sanitycheckforworkerId</span>\n        <span class=\"token comment\" spellcheck=\"true\">//这儿不就检查了一下，要求就是你传递进来的机房id和机器id不能超过32，不能小于0</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>workerId <span class=\"token operator\">></span> maxWorkerId <span class=\"token operator\">||</span> workerId <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalArgumentException</span><span class=\"token punctuation\">(</span>\n                    String<span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"workerIdcan'tbegreaterthan%dorlessthan0\"</span><span class=\"token punctuation\">,</span> maxWorkerId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>datacenterId <span class=\"token operator\">></span> maxDatacenterId <span class=\"token operator\">||</span> datacenterId <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalArgumentException</span><span class=\"token punctuation\">(</span>\n                    String<span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"datacenterIdcan'tbegreaterthan%dorlessthan0\"</span><span class=\"token punctuation\">,</span> maxDatacenterId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        System<span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">printf</span><span class=\"token punctuation\">(</span>\n                <span class=\"token string\">\"workerstarting.timestampleftshift%d,datacenteridbits%d,workeridbits%d,sequencebits%d,workerid%d\"</span><span class=\"token punctuation\">,</span>\n                timestampLeftShift<span class=\"token punctuation\">,</span> datacenterIdBits<span class=\"token punctuation\">,</span> workerIdBits<span class=\"token punctuation\">,</span> sequenceBits<span class=\"token punctuation\">,</span> workerId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>workerId <span class=\"token operator\">=</span> workerId<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>datacenterId <span class=\"token operator\">=</span> datacenterId<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>sequence <span class=\"token operator\">=</span> sequence<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">long</span> twepoch <span class=\"token operator\">=</span> 1288834974657L<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">long</span> workerIdBits <span class=\"token operator\">=</span> 5L<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">long</span> datacenterIdBits <span class=\"token operator\">=</span> 5L<span class=\"token punctuation\">;</span>\n    <span class=\"token comment\" spellcheck=\"true\">//这个是二进制运算，就是5bit最多只能有31个数字，也就是说机器id最多只能是32以内</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">long</span> maxWorkerId <span class=\"token operator\">=</span> <span class=\"token operator\">-</span>1L <span class=\"token operator\">^</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">-</span>1L <span class=\"token operator\">&lt;&lt;</span> workerIdBits<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\" spellcheck=\"true\">//这个是一个意思，就是5bit最多只能有31个数字，机房id最多只能是32以内</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">long</span> maxDatacenterId <span class=\"token operator\">=</span> <span class=\"token operator\">-</span>1L <span class=\"token operator\">^</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">-</span>1L <span class=\"token operator\">&lt;&lt;</span> datacenterIdBits<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">long</span> sequenceBits <span class=\"token operator\">=</span> 12L<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">long</span> workerIdShift <span class=\"token operator\">=</span> sequenceBits<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">long</span> datacenterIdShift <span class=\"token operator\">=</span> sequenceBits <span class=\"token operator\">+</span> workerIdBits<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">long</span> timestampLeftShift <span class=\"token operator\">=</span> sequenceBits <span class=\"token operator\">+</span> workerIdBits <span class=\"token operator\">+</span> datacenterIdBits<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">long</span> sequenceMask <span class=\"token operator\">=</span> <span class=\"token operator\">-</span>1L <span class=\"token operator\">^</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">-</span>1L <span class=\"token operator\">&lt;&lt;</span> sequenceBits<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">long</span> lastTimestamp <span class=\"token operator\">=</span> <span class=\"token operator\">-</span>1L<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">long</span> <span class=\"token function\">getWorkerId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> workerId<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">long</span> <span class=\"token function\">getDatacenterId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> datacenterId<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">long</span> <span class=\"token function\">getTimestamp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> System<span class=\"token punctuation\">.</span><span class=\"token function\">currentTimeMillis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">synchronized</span> <span class=\"token keyword\">long</span> <span class=\"token function\">nextId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\" spellcheck=\"true\">//这儿就是获取当前时间戳，单位是毫秒</span>\n        <span class=\"token keyword\">long</span> timestamp <span class=\"token operator\">=</span> <span class=\"token function\">timeGen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>timestamp <span class=\"token operator\">&lt;</span> lastTimestamp<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            System<span class=\"token punctuation\">.</span>err<span class=\"token punctuation\">.</span><span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"clockismovingbackwards. Rejectingrequestsuntil%d.\"</span><span class=\"token punctuation\">,</span> lastTimestamp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>String<span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Clockmovedbackwards. Refusingtogenerateidfor%dmilliseconds\"</span><span class=\"token punctuation\">,</span> lastTimestamp <span class=\"token operator\">-</span> timestamp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>lastTimestamp <span class=\"token operator\">==</span> timestamp<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\" spellcheck=\"true\">//这个意思是说一个毫秒内最多只能有4096个数字</span>\n            <span class=\"token comment\" spellcheck=\"true\">//无论你传递多少进来，这个位运算保证始终就是在4096这个范围内，避免你自己传递个sequence超过了4096这个范围</span>\n            sequence <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>sequence <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;</span> sequenceMask<span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>sequence <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                timestamp <span class=\"token operator\">=</span> <span class=\"token function\">tilNextMillis</span><span class=\"token punctuation\">(</span>lastTimestamp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            sequence <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token comment\" spellcheck=\"true\">//这儿记录一下最近一次生成id的时间戳，单位是毫秒</span>\n        lastTimestamp <span class=\"token operator\">=</span> timestamp<span class=\"token punctuation\">;</span>\n        <span class=\"token comment\" spellcheck=\"true\">//这儿就是将时间戳左移，放到41bit那儿；</span>\n        <span class=\"token comment\" spellcheck=\"true\">//将机房id左移放到5bit那儿；</span>\n        <span class=\"token comment\" spellcheck=\"true\">//将机器id左移放到5bit那儿；将序号放最后12bit；</span>\n        <span class=\"token comment\" spellcheck=\"true\">//最后拼接起来成一个64bit的二进制数字，转换成10进制就是个long型</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>timestamp <span class=\"token operator\">-</span> twepoch<span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;&lt;</span> timestampLeftShift<span class=\"token punctuation\">)</span> <span class=\"token operator\">|</span> <span class=\"token punctuation\">(</span>datacenterId <span class=\"token operator\">&lt;&lt;</span> datacenterIdShift<span class=\"token punctuation\">)</span>\n                <span class=\"token operator\">|</span> <span class=\"token punctuation\">(</span>workerId <span class=\"token operator\">&lt;&lt;</span> workerIdShift<span class=\"token punctuation\">)</span> <span class=\"token operator\">|</span> sequence<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">long</span> <span class=\"token function\">tilNextMillis</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">long</span> lastTimestamp<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">long</span> timestamp <span class=\"token operator\">=</span> <span class=\"token function\">timeGen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>timestamp <span class=\"token operator\">&lt;=</span> lastTimestamp<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            timestamp <span class=\"token operator\">=</span> <span class=\"token function\">timeGen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span> timestamp<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">long</span> <span class=\"token function\">timeGen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> System<span class=\"token punctuation\">.</span><span class=\"token function\">currentTimeMillis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">//---------------测试---------------</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span>String<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        IdWorker worker <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IdWorker</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">30</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            System<span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>worker<span class=\"token punctuation\">.</span><span class=\"token function\">nextId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>怎么说呢，大概这个意思吧，就是说 41 bit 是当前毫秒单位的一个时间戳，就这意思；然后 5 bit 是你传递进来的一个机房 id（但是最大只能是 32 以内），另外 5 bit 是你传递进来的机器 id（但是最大只能是 32 以内），剩下的那个 12 bit 序列号，就是如果跟你上次生成 id 的时间还在一个毫秒内，那么会把顺序给你累加，最多在 4096 个序号以内。</p>\n<p>所以你自己利用这个工具类，自己搞一个服务，然后对每个机房的每个机器都初始化这么一个东西，刚开始这个机房的这个机器的序号就是 0。然后每次接收到一个请求，说这个机房的这个机器要生成一个 id，你就找到对应的 Worker 生成。</p>\n<p>利用这个 snowflake 算法，你可以开发自己公司的服务，甚至对于机房 id 和机器 id，反正给你预留了 5 bit + 5 bit，你换成别的有业务含义的东西也可以的。</p>\n<p>这个 snowflake 算法相对来说还是比较靠谱的，所以你要真是搞分布式 id 生成，如果是高并发啥的，那么用这个应该性能比较好，一般每秒几万并发的场景，也足够你用了。</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"snowflake-算法\"><a href=\"#snowflake-算法\" class=\"headerlink\" title=\"snowflake 算法\"></a>snowflake 算法</h2><p>snowflake 算法是 twitter 开源的分布式 id 生成算法，就是把一个 64 位的 long 型的 id，1 个 bit 是不用的，用其中的 41 bit 作为毫秒数，用 10 bit 作为工作机器 id，12 bit 作为序列号。</p>\n<ul>\n<li><p>1 bit：不用，为啥呢？因为二进制里第一个 bit 为如果是 1，那么都是负数，但是我们生成的 id 都是正数，所以第一个 bit 统一都是 0。</p>\n</li>\n<li><p>41 bit：表示的是时间戳，单位是毫秒。41 bit 可以表示的数字多达 2^41 - 1，也就是可以标识 2^41 - 1 个毫秒值，换算成年就是表示 69 年的时间。</p>\n</li>\n<li><p>10 bit：记录工作机器 id，代表的是这个服务最多可以部署在 2^10 台机器上哪，也就是 1024 台机器。但是 10 bit 里 5 个 bit 代表机房 id，5 个 bit 代表机器 id。意思就是最多代表 2^5 个机房（32 个机房），每个机房里可以代表 2^5 个机器（32 台机器）。</p>\n</li>\n<li><p>12 bit：这个是用来记录同一个毫秒内产生的不同 id，12 bit 可以代表的最大正整数是 2^12 - 1 = 4096，也就是说可以用这个 12 bit 代表的数字来区分同一个毫秒内的 4096 个不同的 id。</p>\n</li>\n</ul>\n<blockquote>\n<p>0 | 0001100 10100010 10111110 10001001 01011100 00 | 10001 | 1 1001 | 0000 00000000</p>\n</blockquote>\n<h2 id=\"工具类源代码\"><a href=\"#工具类源代码\" class=\"headerlink\" title=\"工具类源代码\"></a>工具类源代码</h2><pre><code class=\"java\">package com.ifly.inquiry.base;\n\n/**\n * &lt;p&gt;DESCRIPTION:&lt;/p&gt;\n *\n * @author AsiaCui\n * @version: 1.0.0\n * @create 2019-01-22 9:32\n **/\npublic class IdWorker {\n\n    private long workerId;\n    private long datacenterId;\n    private long sequence;\n\n    public IdWorker(long workerId, long datacenterId, long sequence) {\n        //sanitycheckforworkerId\n        //这儿不就检查了一下，要求就是你传递进来的机房id和机器id不能超过32，不能小于0\n        if (workerId &gt; maxWorkerId || workerId &lt; 0) {\n            throw new IllegalArgumentException(\n                    String.format(&quot;workerIdcan&#39;tbegreaterthan%dorlessthan0&quot;, maxWorkerId));\n        }\n        if (datacenterId &gt; maxDatacenterId || datacenterId &lt; 0) {\n            throw new IllegalArgumentException(\n                    String.format(&quot;datacenterIdcan&#39;tbegreaterthan%dorlessthan0&quot;, maxDatacenterId));\n        }\n        System.out.printf(\n                &quot;workerstarting.timestampleftshift%d,datacenteridbits%d,workeridbits%d,sequencebits%d,workerid%d&quot;,\n                timestampLeftShift, datacenterIdBits, workerIdBits, sequenceBits, workerId);\n        this.workerId = workerId;\n        this.datacenterId = datacenterId;\n        this.sequence = sequence;\n    }\n\n    private long twepoch = 1288834974657L;\n    private long workerIdBits = 5L;\n    private long datacenterIdBits = 5L;\n    //这个是二进制运算，就是5bit最多只能有31个数字，也就是说机器id最多只能是32以内\n    private long maxWorkerId = -1L ^ (-1L &lt;&lt; workerIdBits);\n    //这个是一个意思，就是5bit最多只能有31个数字，机房id最多只能是32以内\n    private long maxDatacenterId = -1L ^ (-1L &lt;&lt; datacenterIdBits);\n    private long sequenceBits = 12L;\n    private long workerIdShift = sequenceBits;\n    private long datacenterIdShift = sequenceBits + workerIdBits;\n    private long timestampLeftShift = sequenceBits + workerIdBits + datacenterIdBits;\n    private long sequenceMask = -1L ^ (-1L &lt;&lt; sequenceBits);\n    private long lastTimestamp = -1L;\n\n    public long getWorkerId() {\n        return workerId;\n    }\n\n    public long getDatacenterId() {\n        return datacenterId;\n    }\n\n    public long getTimestamp() {\n        return System.currentTimeMillis();\n    }\n\n    public synchronized long nextId() {\n        //这儿就是获取当前时间戳，单位是毫秒\n        long timestamp = timeGen();\n        if (timestamp &lt; lastTimestamp) {\n            System.err.printf(&quot;clockismovingbackwards. Rejectingrequestsuntil%d.&quot;, lastTimestamp);\n            throw new RuntimeException(String.format(&quot;Clockmovedbackwards. Refusingtogenerateidfor%dmilliseconds&quot;, lastTimestamp - timestamp));\n        }\n        if (lastTimestamp == timestamp) {\n            //这个意思是说一个毫秒内最多只能有4096个数字\n            //无论你传递多少进来，这个位运算保证始终就是在4096这个范围内，避免你自己传递个sequence超过了4096这个范围\n            sequence = (sequence + 1) &amp; sequenceMask;\n            if (sequence == 0) {\n                timestamp = tilNextMillis(lastTimestamp);\n            }\n        } else {\n            sequence = 0;\n        }\n        //这儿记录一下最近一次生成id的时间戳，单位是毫秒\n        lastTimestamp = timestamp;\n        //这儿就是将时间戳左移，放到41bit那儿；\n        //将机房id左移放到5bit那儿；\n        //将机器id左移放到5bit那儿；将序号放最后12bit；\n        //最后拼接起来成一个64bit的二进制数字，转换成10进制就是个long型\n        return ((timestamp - twepoch) &lt;&lt; timestampLeftShift) | (datacenterId &lt;&lt; datacenterIdShift)\n                | (workerId &lt;&lt; workerIdShift) | sequence;\n    }\n\n    private long tilNextMillis(long lastTimestamp) {\n        long timestamp = timeGen();\n        while (timestamp &lt;= lastTimestamp) {\n            timestamp = timeGen();\n        }\n        return timestamp;\n    }\n\n    private long timeGen() {\n        return System.currentTimeMillis();\n    }\n\n    //---------------测试---------------\n    public static void main(String[] args) {\n        IdWorker worker = new IdWorker(1, 1, 1);\n        for (int i = 0; i &lt; 30; i++) {\n            System.out.println(worker.nextId());\n        }\n    }\n}\n\n</code></pre>\n<p>怎么说呢，大概这个意思吧，就是说 41 bit 是当前毫秒单位的一个时间戳，就这意思；然后 5 bit 是你传递进来的一个机房 id（但是最大只能是 32 以内），另外 5 bit 是你传递进来的机器 id（但是最大只能是 32 以内），剩下的那个 12 bit 序列号，就是如果跟你上次生成 id 的时间还在一个毫秒内，那么会把顺序给你累加，最多在 4096 个序号以内。</p>\n<p>所以你自己利用这个工具类，自己搞一个服务，然后对每个机房的每个机器都初始化这么一个东西，刚开始这个机房的这个机器的序号就是 0。然后每次接收到一个请求，说这个机房的这个机器要生成一个 id，你就找到对应的 Worker 生成。</p>\n<p>利用这个 snowflake 算法，你可以开发自己公司的服务，甚至对于机房 id 和机器 id，反正给你预留了 5 bit + 5 bit，你换成别的有业务含义的东西也可以的。</p>\n<p>这个 snowflake 算法相对来说还是比较靠谱的，所以你要真是搞分布式 id 生成，如果是高并发啥的，那么用这个应该性能比较好，一般每秒几万并发的场景，也足够你用了。</p>\n"},{"title":"Session一致性","author":"Asia Cui","date":"2019-01-08T02:31:00.000Z","_content":"## session的概念\n\n### 什么是session？\n\n服务器为每个用户创建一个会话，存储用户的相关信息，以便多次请求能够定位到同一个上下文。这样，当用户在应用程序的 Web 页之间跳转时，存储在 Session 对象中的变量将不会丢失，而是在整个用户会话中一直存在下去。当用户请求来自应用程序的 Web 页时，如果该用户还没有会话，则 Web 服务器将自动创建一个 Session 对象。当会话过期或被放弃后，服务器将终止该会话。\n\nWeb开发中，web-server可以自动为同一个浏览器的访问用户自动创建session，提供数据存储功能。最常见的，会把用户的登录信息、用户信息存储在session中，以保持登录状态。\n\n### 什么是session一致性问题？\n\n只要用户不重启浏览器，每次http短连接请求，理论上服务端都能定位到session，保持会话。\n\n### 分布式session\n\n单服务器web应用中，session信息只需存在该服务器中，这是我们前几年最常接触的方式，但是近几年随着分布式系统的流行，单系统已经不能满足日益增长的百万级用户的需求，集群方式部署服务器已在很多公司运用起来，当高并发量的请求到达服务端的时候通过负载均衡的方式分发到集群中的某个服务器，这样就有可能导致同一个用户的多次请求被分发到集群的不同服务器上，就会出现取不到session数据的情况，于是session的共享就成了一个问题。\n\n![](/images/926638-20171117190525546-1072349257.png)\n\n如上图，假设用户包含登录信息的session都记录在第一台web-server上，反向代理如果将请求路由到另一台web-server上，可能就找不到相关信息，而导致用户需要重新登录。\n\n## 解决方案\n\n### Session同步\n\n![](/images/道/926638-20171117190609421-1278140860.png)\n\n- 简介\n\n  > 多台应用服务器之间相互同步复制Session，这样每个服务器都有全部的Session\n\n- 优点\n\n  > 应用程序不需要修改代码。\n\n- 缺点\n\n  > - Session同步占用内网带宽，而且有延迟。\n  >\n  >\n  > - 每台机器包含所有的Session会受到内存的限制。\n\n### 客户端存储法 \n\n![](/images/道/926638-20171117191245265-301978953.png)\n\n- 简介\n\n  > 服务端存储所有用户的session，内存占用较大，可以将session存储到浏览器cookie中，每个端只要存储一个用户的数据了。\n\n- 优点\n\n  > 服务端不需要存储\n\n- 缺点\n\n  > - 每次http请求都携带session，占**外网带宽**\n  > - 数据存储在端上，并在网络传输，存在泄漏、篡改、窃取等安全隐患\n  > - session存储的数据大小受cookie限制\n### 反向代理hash一致性\n\n![](/images/道/926638-20171117191245265-301978953.png)\n\n- 简介\n\n  > web-server为了保证高可用，有多台冗余，反向代理层能不能做一些事情，让同一个用户的请求保证落在一台web-server上呢？\n  >\n  > - 反向代理层使用用户ip来做hash，以保证同一个ip的请求落在同一个web-server上\n  > - 反向代理使用http协议中的某些业务属性来做hash，例如sid，city_id，user_id等，能够更加灵活的实施hash策略，以保证同一个浏览器用户的请求落在同一个web-server上\n\n- 优点\n\n  > - 只需要改nginx配置，不需要修改应用代码\n  > - 负载均衡，只要hash属性是均匀的，多台web-server的负载是均衡的\n  > - 可以支持web-server水平扩展（session同步法是不行的，受内存限制）\n\n- 缺点\n\n  > - 如果web-server重启，一部分session会丢失，产生业务影响，例如部分用户重新登录\n  > - 如果web-server水平扩展，**rehash**后session重新分布，也会有一部分用户路由不到正确的session\n  >\n  > session一般是有有效期的，所有不足中的两点，可以认为等同于部分session失效，一般问题不大。\n  >\n  > 对于四层hash还是七层hash，个人推荐前者：**让专业的软件做专业的事情**，反向代理就负责转发，尽量不要引入应用层业务属性，除非不得不这么做（例如，有时候多机房多活需要按照业务属性路由到不同机房的web-server）。\n\n### 后端统一集中存储\n\n![](/images/道/926638-20171117190914734-312299182.png)\n\n- 简介\n\n  > 将session存储在web-server后端的存储层，数据库或者缓存\n\n- 优点\n\n  > - 没有安全隐患\n  > - 可以水平扩展，数据库/缓存水平切分即可\n  > - web-server重启或者扩容都不会有session丢失\n\n- 缺点\n\n  > 增加了一次网络调用，并且需要修改应用代码。对于db存储还是cache，个人推荐后者：session读取的频率会很高，数据库压力会比较大。如果有session高可用需求，cache可以做高可用，但大部分情况下session可以丢失，一般也不需要考虑高可用。\n\n## 总结\n\n**保证session一致性**的架构设计常见方法：\n\n- **session同步法**：多台web-server相互同步数据\n- **客户端存储法：**一个用户只存储自己的数据\n- **反向代理hash一致性：**四层hash和七层hash都可以做，保证一个用户的请求落在一台web-server上\n- **后端统一存储：**web-server重启和扩容，session也不会丢失\n\n \n\n对于方案3和方案4，个人建议推荐后者：\n\n- **web层、service层无状态是大规模分布式系统设计原则之一**，session属于状态，不宜放在web层\n- **让专业的软件做专业的事情**，web-server存session？还是让cache去做这样的事情吧。","source":"_posts/Session一致性.md","raw":"title: Session一致性\nauthor: Asia Cui\ntags:\n  - 道\ncategories:\n  - Session\ndate: 2019-01-08 10:31:00\n---\n## session的概念\n\n### 什么是session？\n\n服务器为每个用户创建一个会话，存储用户的相关信息，以便多次请求能够定位到同一个上下文。这样，当用户在应用程序的 Web 页之间跳转时，存储在 Session 对象中的变量将不会丢失，而是在整个用户会话中一直存在下去。当用户请求来自应用程序的 Web 页时，如果该用户还没有会话，则 Web 服务器将自动创建一个 Session 对象。当会话过期或被放弃后，服务器将终止该会话。\n\nWeb开发中，web-server可以自动为同一个浏览器的访问用户自动创建session，提供数据存储功能。最常见的，会把用户的登录信息、用户信息存储在session中，以保持登录状态。\n\n### 什么是session一致性问题？\n\n只要用户不重启浏览器，每次http短连接请求，理论上服务端都能定位到session，保持会话。\n\n### 分布式session\n\n单服务器web应用中，session信息只需存在该服务器中，这是我们前几年最常接触的方式，但是近几年随着分布式系统的流行，单系统已经不能满足日益增长的百万级用户的需求，集群方式部署服务器已在很多公司运用起来，当高并发量的请求到达服务端的时候通过负载均衡的方式分发到集群中的某个服务器，这样就有可能导致同一个用户的多次请求被分发到集群的不同服务器上，就会出现取不到session数据的情况，于是session的共享就成了一个问题。\n\n![](/images/926638-20171117190525546-1072349257.png)\n\n如上图，假设用户包含登录信息的session都记录在第一台web-server上，反向代理如果将请求路由到另一台web-server上，可能就找不到相关信息，而导致用户需要重新登录。\n\n## 解决方案\n\n### Session同步\n\n![](/images/道/926638-20171117190609421-1278140860.png)\n\n- 简介\n\n  > 多台应用服务器之间相互同步复制Session，这样每个服务器都有全部的Session\n\n- 优点\n\n  > 应用程序不需要修改代码。\n\n- 缺点\n\n  > - Session同步占用内网带宽，而且有延迟。\n  >\n  >\n  > - 每台机器包含所有的Session会受到内存的限制。\n\n### 客户端存储法 \n\n![](/images/道/926638-20171117191245265-301978953.png)\n\n- 简介\n\n  > 服务端存储所有用户的session，内存占用较大，可以将session存储到浏览器cookie中，每个端只要存储一个用户的数据了。\n\n- 优点\n\n  > 服务端不需要存储\n\n- 缺点\n\n  > - 每次http请求都携带session，占**外网带宽**\n  > - 数据存储在端上，并在网络传输，存在泄漏、篡改、窃取等安全隐患\n  > - session存储的数据大小受cookie限制\n### 反向代理hash一致性\n\n![](/images/道/926638-20171117191245265-301978953.png)\n\n- 简介\n\n  > web-server为了保证高可用，有多台冗余，反向代理层能不能做一些事情，让同一个用户的请求保证落在一台web-server上呢？\n  >\n  > - 反向代理层使用用户ip来做hash，以保证同一个ip的请求落在同一个web-server上\n  > - 反向代理使用http协议中的某些业务属性来做hash，例如sid，city_id，user_id等，能够更加灵活的实施hash策略，以保证同一个浏览器用户的请求落在同一个web-server上\n\n- 优点\n\n  > - 只需要改nginx配置，不需要修改应用代码\n  > - 负载均衡，只要hash属性是均匀的，多台web-server的负载是均衡的\n  > - 可以支持web-server水平扩展（session同步法是不行的，受内存限制）\n\n- 缺点\n\n  > - 如果web-server重启，一部分session会丢失，产生业务影响，例如部分用户重新登录\n  > - 如果web-server水平扩展，**rehash**后session重新分布，也会有一部分用户路由不到正确的session\n  >\n  > session一般是有有效期的，所有不足中的两点，可以认为等同于部分session失效，一般问题不大。\n  >\n  > 对于四层hash还是七层hash，个人推荐前者：**让专业的软件做专业的事情**，反向代理就负责转发，尽量不要引入应用层业务属性，除非不得不这么做（例如，有时候多机房多活需要按照业务属性路由到不同机房的web-server）。\n\n### 后端统一集中存储\n\n![](/images/道/926638-20171117190914734-312299182.png)\n\n- 简介\n\n  > 将session存储在web-server后端的存储层，数据库或者缓存\n\n- 优点\n\n  > - 没有安全隐患\n  > - 可以水平扩展，数据库/缓存水平切分即可\n  > - web-server重启或者扩容都不会有session丢失\n\n- 缺点\n\n  > 增加了一次网络调用，并且需要修改应用代码。对于db存储还是cache，个人推荐后者：session读取的频率会很高，数据库压力会比较大。如果有session高可用需求，cache可以做高可用，但大部分情况下session可以丢失，一般也不需要考虑高可用。\n\n## 总结\n\n**保证session一致性**的架构设计常见方法：\n\n- **session同步法**：多台web-server相互同步数据\n- **客户端存储法：**一个用户只存储自己的数据\n- **反向代理hash一致性：**四层hash和七层hash都可以做，保证一个用户的请求落在一台web-server上\n- **后端统一存储：**web-server重启和扩容，session也不会丢失\n\n \n\n对于方案3和方案4，个人建议推荐后者：\n\n- **web层、service层无状态是大规模分布式系统设计原则之一**，session属于状态，不宜放在web层\n- **让专业的软件做专业的事情**，web-server存session？还是让cache去做这样的事情吧。","slug":"Session一致性","published":1,"updated":"2019-01-08T05:28:47.418Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjs17mhy2000opwgtaus3nga7","content":"<h2 id=\"session的概念\"><a href=\"#session的概念\" class=\"headerlink\" title=\"session的概念\"></a>session的概念</h2><h3 id=\"什么是session？\"><a href=\"#什么是session？\" class=\"headerlink\" title=\"什么是session？\"></a>什么是session？</h3><p>服务器为每个用户创建一个会话，存储用户的相关信息，以便多次请求能够定位到同一个上下文。这样，当用户在应用程序的 Web 页之间跳转时，存储在 Session 对象中的变量将不会丢失，而是在整个用户会话中一直存在下去。当用户请求来自应用程序的 Web 页时，如果该用户还没有会话，则 Web 服务器将自动创建一个 Session 对象。当会话过期或被放弃后，服务器将终止该会话。</p>\n<p>Web开发中，web-server可以自动为同一个浏览器的访问用户自动创建session，提供数据存储功能。最常见的，会把用户的登录信息、用户信息存储在session中，以保持登录状态。</p>\n<h3 id=\"什么是session一致性问题？\"><a href=\"#什么是session一致性问题？\" class=\"headerlink\" title=\"什么是session一致性问题？\"></a>什么是session一致性问题？</h3><p>只要用户不重启浏览器，每次http短连接请求，理论上服务端都能定位到session，保持会话。</p>\n<h3 id=\"分布式session\"><a href=\"#分布式session\" class=\"headerlink\" title=\"分布式session\"></a>分布式session</h3><p>单服务器web应用中，session信息只需存在该服务器中，这是我们前几年最常接触的方式，但是近几年随着分布式系统的流行，单系统已经不能满足日益增长的百万级用户的需求，集群方式部署服务器已在很多公司运用起来，当高并发量的请求到达服务端的时候通过负载均衡的方式分发到集群中的某个服务器，这样就有可能导致同一个用户的多次请求被分发到集群的不同服务器上，就会出现取不到session数据的情况，于是session的共享就成了一个问题。</p>\n<p><img src=\"/images/926638-20171117190525546-1072349257.png\" alt=\"\"></p>\n<p>如上图，假设用户包含登录信息的session都记录在第一台web-server上，反向代理如果将请求路由到另一台web-server上，可能就找不到相关信息，而导致用户需要重新登录。</p>\n<h2 id=\"解决方案\"><a href=\"#解决方案\" class=\"headerlink\" title=\"解决方案\"></a>解决方案</h2><h3 id=\"Session同步\"><a href=\"#Session同步\" class=\"headerlink\" title=\"Session同步\"></a>Session同步</h3><p><img src=\"/images/道/926638-20171117190609421-1278140860.png\" alt=\"\"></p>\n<ul>\n<li><p>简介</p>\n<blockquote>\n<p>多台应用服务器之间相互同步复制Session，这样每个服务器都有全部的Session</p>\n</blockquote>\n</li>\n<li><p>优点</p>\n<blockquote>\n<p>应用程序不需要修改代码。</p>\n</blockquote>\n</li>\n<li><p>缺点</p>\n<blockquote>\n<ul>\n<li>Session同步占用内网带宽，而且有延迟。</li>\n</ul>\n<ul>\n<li>每台机器包含所有的Session会受到内存的限制。</li>\n</ul>\n</blockquote>\n</li>\n</ul>\n<h3 id=\"客户端存储法\"><a href=\"#客户端存储法\" class=\"headerlink\" title=\"客户端存储法\"></a>客户端存储法</h3><p><img src=\"/images/道/926638-20171117191245265-301978953.png\" alt=\"\"></p>\n<ul>\n<li><p>简介</p>\n<blockquote>\n<p>服务端存储所有用户的session，内存占用较大，可以将session存储到浏览器cookie中，每个端只要存储一个用户的数据了。</p>\n</blockquote>\n</li>\n<li><p>优点</p>\n<blockquote>\n<p>服务端不需要存储</p>\n</blockquote>\n</li>\n<li><p>缺点</p>\n<blockquote>\n<ul>\n<li>每次http请求都携带session，占<strong>外网带宽</strong></li>\n<li>数据存储在端上，并在网络传输，存在泄漏、篡改、窃取等安全隐患</li>\n<li>session存储的数据大小受cookie限制</li>\n</ul>\n</blockquote>\n<h3 id=\"反向代理hash一致性\"><a href=\"#反向代理hash一致性\" class=\"headerlink\" title=\"反向代理hash一致性\"></a>反向代理hash一致性</h3></li>\n</ul>\n<p><img src=\"/images/道/926638-20171117191245265-301978953.png\" alt=\"\"></p>\n<ul>\n<li><p>简介</p>\n<blockquote>\n<p>web-server为了保证高可用，有多台冗余，反向代理层能不能做一些事情，让同一个用户的请求保证落在一台web-server上呢？</p>\n<ul>\n<li>反向代理层使用用户ip来做hash，以保证同一个ip的请求落在同一个web-server上</li>\n<li>反向代理使用http协议中的某些业务属性来做hash，例如sid，city_id，user_id等，能够更加灵活的实施hash策略，以保证同一个浏览器用户的请求落在同一个web-server上</li>\n</ul>\n</blockquote>\n</li>\n<li><p>优点</p>\n<blockquote>\n<ul>\n<li>只需要改nginx配置，不需要修改应用代码</li>\n<li>负载均衡，只要hash属性是均匀的，多台web-server的负载是均衡的</li>\n<li>可以支持web-server水平扩展（session同步法是不行的，受内存限制）</li>\n</ul>\n</blockquote>\n</li>\n<li><p>缺点</p>\n<blockquote>\n<ul>\n<li>如果web-server重启，一部分session会丢失，产生业务影响，例如部分用户重新登录</li>\n<li>如果web-server水平扩展，<strong>rehash</strong>后session重新分布，也会有一部分用户路由不到正确的session</li>\n</ul>\n<p>session一般是有有效期的，所有不足中的两点，可以认为等同于部分session失效，一般问题不大。</p>\n<p>对于四层hash还是七层hash，个人推荐前者：<strong>让专业的软件做专业的事情</strong>，反向代理就负责转发，尽量不要引入应用层业务属性，除非不得不这么做（例如，有时候多机房多活需要按照业务属性路由到不同机房的web-server）。</p>\n</blockquote>\n</li>\n</ul>\n<h3 id=\"后端统一集中存储\"><a href=\"#后端统一集中存储\" class=\"headerlink\" title=\"后端统一集中存储\"></a>后端统一集中存储</h3><p><img src=\"/images/道/926638-20171117190914734-312299182.png\" alt=\"\"></p>\n<ul>\n<li><p>简介</p>\n<blockquote>\n<p>将session存储在web-server后端的存储层，数据库或者缓存</p>\n</blockquote>\n</li>\n<li><p>优点</p>\n<blockquote>\n<ul>\n<li>没有安全隐患</li>\n<li>可以水平扩展，数据库/缓存水平切分即可</li>\n<li>web-server重启或者扩容都不会有session丢失</li>\n</ul>\n</blockquote>\n</li>\n<li><p>缺点</p>\n<blockquote>\n<p>增加了一次网络调用，并且需要修改应用代码。对于db存储还是cache，个人推荐后者：session读取的频率会很高，数据库压力会比较大。如果有session高可用需求，cache可以做高可用，但大部分情况下session可以丢失，一般也不需要考虑高可用。</p>\n</blockquote>\n</li>\n</ul>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p><strong>保证session一致性</strong>的架构设计常见方法：</p>\n<ul>\n<li><strong>session同步法</strong>：多台web-server相互同步数据</li>\n<li><strong>客户端存储法：</strong>一个用户只存储自己的数据</li>\n<li><strong>反向代理hash一致性：</strong>四层hash和七层hash都可以做，保证一个用户的请求落在一台web-server上</li>\n<li><strong>后端统一存储：</strong>web-server重启和扩容，session也不会丢失</li>\n</ul>\n<p>对于方案3和方案4，个人建议推荐后者：</p>\n<ul>\n<li><strong>web层、service层无状态是大规模分布式系统设计原则之一</strong>，session属于状态，不宜放在web层</li>\n<li><strong>让专业的软件做专业的事情</strong>，web-server存session？还是让cache去做这样的事情吧。</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"session的概念\"><a href=\"#session的概念\" class=\"headerlink\" title=\"session的概念\"></a>session的概念</h2><h3 id=\"什么是session？\"><a href=\"#什么是session？\" class=\"headerlink\" title=\"什么是session？\"></a>什么是session？</h3><p>服务器为每个用户创建一个会话，存储用户的相关信息，以便多次请求能够定位到同一个上下文。这样，当用户在应用程序的 Web 页之间跳转时，存储在 Session 对象中的变量将不会丢失，而是在整个用户会话中一直存在下去。当用户请求来自应用程序的 Web 页时，如果该用户还没有会话，则 Web 服务器将自动创建一个 Session 对象。当会话过期或被放弃后，服务器将终止该会话。</p>\n<p>Web开发中，web-server可以自动为同一个浏览器的访问用户自动创建session，提供数据存储功能。最常见的，会把用户的登录信息、用户信息存储在session中，以保持登录状态。</p>\n<h3 id=\"什么是session一致性问题？\"><a href=\"#什么是session一致性问题？\" class=\"headerlink\" title=\"什么是session一致性问题？\"></a>什么是session一致性问题？</h3><p>只要用户不重启浏览器，每次http短连接请求，理论上服务端都能定位到session，保持会话。</p>\n<h3 id=\"分布式session\"><a href=\"#分布式session\" class=\"headerlink\" title=\"分布式session\"></a>分布式session</h3><p>单服务器web应用中，session信息只需存在该服务器中，这是我们前几年最常接触的方式，但是近几年随着分布式系统的流行，单系统已经不能满足日益增长的百万级用户的需求，集群方式部署服务器已在很多公司运用起来，当高并发量的请求到达服务端的时候通过负载均衡的方式分发到集群中的某个服务器，这样就有可能导致同一个用户的多次请求被分发到集群的不同服务器上，就会出现取不到session数据的情况，于是session的共享就成了一个问题。</p>\n<p><img src=\"/images/926638-20171117190525546-1072349257.png\" alt=\"\"></p>\n<p>如上图，假设用户包含登录信息的session都记录在第一台web-server上，反向代理如果将请求路由到另一台web-server上，可能就找不到相关信息，而导致用户需要重新登录。</p>\n<h2 id=\"解决方案\"><a href=\"#解决方案\" class=\"headerlink\" title=\"解决方案\"></a>解决方案</h2><h3 id=\"Session同步\"><a href=\"#Session同步\" class=\"headerlink\" title=\"Session同步\"></a>Session同步</h3><p><img src=\"/images/道/926638-20171117190609421-1278140860.png\" alt=\"\"></p>\n<ul>\n<li><p>简介</p>\n<blockquote>\n<p>多台应用服务器之间相互同步复制Session，这样每个服务器都有全部的Session</p>\n</blockquote>\n</li>\n<li><p>优点</p>\n<blockquote>\n<p>应用程序不需要修改代码。</p>\n</blockquote>\n</li>\n<li><p>缺点</p>\n<blockquote>\n<ul>\n<li>Session同步占用内网带宽，而且有延迟。</li>\n</ul>\n<ul>\n<li>每台机器包含所有的Session会受到内存的限制。</li>\n</ul>\n</blockquote>\n</li>\n</ul>\n<h3 id=\"客户端存储法\"><a href=\"#客户端存储法\" class=\"headerlink\" title=\"客户端存储法\"></a>客户端存储法</h3><p><img src=\"/images/道/926638-20171117191245265-301978953.png\" alt=\"\"></p>\n<ul>\n<li><p>简介</p>\n<blockquote>\n<p>服务端存储所有用户的session，内存占用较大，可以将session存储到浏览器cookie中，每个端只要存储一个用户的数据了。</p>\n</blockquote>\n</li>\n<li><p>优点</p>\n<blockquote>\n<p>服务端不需要存储</p>\n</blockquote>\n</li>\n<li><p>缺点</p>\n<blockquote>\n<ul>\n<li>每次http请求都携带session，占<strong>外网带宽</strong></li>\n<li>数据存储在端上，并在网络传输，存在泄漏、篡改、窃取等安全隐患</li>\n<li>session存储的数据大小受cookie限制</li>\n</ul>\n</blockquote>\n<h3 id=\"反向代理hash一致性\"><a href=\"#反向代理hash一致性\" class=\"headerlink\" title=\"反向代理hash一致性\"></a>反向代理hash一致性</h3></li>\n</ul>\n<p><img src=\"/images/道/926638-20171117191245265-301978953.png\" alt=\"\"></p>\n<ul>\n<li><p>简介</p>\n<blockquote>\n<p>web-server为了保证高可用，有多台冗余，反向代理层能不能做一些事情，让同一个用户的请求保证落在一台web-server上呢？</p>\n<ul>\n<li>反向代理层使用用户ip来做hash，以保证同一个ip的请求落在同一个web-server上</li>\n<li>反向代理使用http协议中的某些业务属性来做hash，例如sid，city_id，user_id等，能够更加灵活的实施hash策略，以保证同一个浏览器用户的请求落在同一个web-server上</li>\n</ul>\n</blockquote>\n</li>\n<li><p>优点</p>\n<blockquote>\n<ul>\n<li>只需要改nginx配置，不需要修改应用代码</li>\n<li>负载均衡，只要hash属性是均匀的，多台web-server的负载是均衡的</li>\n<li>可以支持web-server水平扩展（session同步法是不行的，受内存限制）</li>\n</ul>\n</blockquote>\n</li>\n<li><p>缺点</p>\n<blockquote>\n<ul>\n<li>如果web-server重启，一部分session会丢失，产生业务影响，例如部分用户重新登录</li>\n<li>如果web-server水平扩展，<strong>rehash</strong>后session重新分布，也会有一部分用户路由不到正确的session</li>\n</ul>\n<p>session一般是有有效期的，所有不足中的两点，可以认为等同于部分session失效，一般问题不大。</p>\n<p>对于四层hash还是七层hash，个人推荐前者：<strong>让专业的软件做专业的事情</strong>，反向代理就负责转发，尽量不要引入应用层业务属性，除非不得不这么做（例如，有时候多机房多活需要按照业务属性路由到不同机房的web-server）。</p>\n</blockquote>\n</li>\n</ul>\n<h3 id=\"后端统一集中存储\"><a href=\"#后端统一集中存储\" class=\"headerlink\" title=\"后端统一集中存储\"></a>后端统一集中存储</h3><p><img src=\"/images/道/926638-20171117190914734-312299182.png\" alt=\"\"></p>\n<ul>\n<li><p>简介</p>\n<blockquote>\n<p>将session存储在web-server后端的存储层，数据库或者缓存</p>\n</blockquote>\n</li>\n<li><p>优点</p>\n<blockquote>\n<ul>\n<li>没有安全隐患</li>\n<li>可以水平扩展，数据库/缓存水平切分即可</li>\n<li>web-server重启或者扩容都不会有session丢失</li>\n</ul>\n</blockquote>\n</li>\n<li><p>缺点</p>\n<blockquote>\n<p>增加了一次网络调用，并且需要修改应用代码。对于db存储还是cache，个人推荐后者：session读取的频率会很高，数据库压力会比较大。如果有session高可用需求，cache可以做高可用，但大部分情况下session可以丢失，一般也不需要考虑高可用。</p>\n</blockquote>\n</li>\n</ul>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p><strong>保证session一致性</strong>的架构设计常见方法：</p>\n<ul>\n<li><strong>session同步法</strong>：多台web-server相互同步数据</li>\n<li><strong>客户端存储法：</strong>一个用户只存储自己的数据</li>\n<li><strong>反向代理hash一致性：</strong>四层hash和七层hash都可以做，保证一个用户的请求落在一台web-server上</li>\n<li><strong>后端统一存储：</strong>web-server重启和扩容，session也不会丢失</li>\n</ul>\n<p>对于方案3和方案4，个人建议推荐后者：</p>\n<ul>\n<li><strong>web层、service层无状态是大规模分布式系统设计原则之一</strong>，session属于状态，不宜放在web层</li>\n<li><strong>让专业的软件做专业的事情</strong>，web-server存session？还是让cache去做这样的事情吧。</li>\n</ul>\n"},{"title":"Java开发知名网站","author":"Asia Cui","date":"2019-01-18T06:09:00.000Z","_content":"1. https://stackoverflow.com\n\n\n![](http://p3.pstatp.com/large/pgc-image/af335d4e1a2840758f4daf158e2686ea)\n\n里面包含各种开发遇到的问题及答案，质量比较高。\n\n\n2. https://github.com/\n\n![](http://p3.pstatp.com/large/pgc-image/d019dd56b8a54be9ac5f9f2e34fee499)\n\n免费的开源代码托管网站，包括了许多开源的项目及示例项目等。\n\n3. https://dzone.com/\n\n![](http://p3.pstatp.com/large/pgc-image/0d0e9d5715bb4d83a6ddb1115772f33a)\n\n提供技术新闻、编程教程、及各种工具、开发者的博客等。\n\n4. http://www.programcreek.com/\n\n![](http://p1.pstatp.com/large/pgc-image/5b46729ccbcc420aa54d8545f34d02c7)\n\n一个非常优秀的 Java 博客，包含很多精选文集。\n\n5. https://gitlab.com/\n\n![](http://p1.pstatp.com/large/pgc-image/ac24d005843d40f18e69a28fb178bdb3)\n\n免费代码托管网站，可以用来做私服，和 GitHub 最大区别是 GitLab 可以有私有项目。\n\n6. https://www.ibm.com/developerworks/learn/java/index.html\n\n![](http://p1.pstatp.com/large/pgc-image/75ca7ffaba244777805bad3a40ba960d)\n\nIBM 的 JAVA 开发者网站，很多干货。\n\n7. http://www.javaworld.com/\n\n![](http://p1.pstatp.com/large/pgc-image/4ddbb7e6420345f7ab65841ed7cf52c9)\n\n一个不错的综合性的 java 网站。\n\n8. http://www.onjava.com/\n\n![](http://p1.pstatp.com/large/pgc-image/9f195691c4a84cd7b645afba9a2fa9b4)\n\n某位国外大神的网站。\n\n\n","source":"_posts/Java开发知名网站.md","raw":"title: Java开发知名网站\nauthor: Asia Cui\ntags:\n  - 干货\ncategories:\n  - 学习网站\ndate: 2019-01-18 14:09:00\n---\n1. https://stackoverflow.com\n\n\n![](http://p3.pstatp.com/large/pgc-image/af335d4e1a2840758f4daf158e2686ea)\n\n里面包含各种开发遇到的问题及答案，质量比较高。\n\n\n2. https://github.com/\n\n![](http://p3.pstatp.com/large/pgc-image/d019dd56b8a54be9ac5f9f2e34fee499)\n\n免费的开源代码托管网站，包括了许多开源的项目及示例项目等。\n\n3. https://dzone.com/\n\n![](http://p3.pstatp.com/large/pgc-image/0d0e9d5715bb4d83a6ddb1115772f33a)\n\n提供技术新闻、编程教程、及各种工具、开发者的博客等。\n\n4. http://www.programcreek.com/\n\n![](http://p1.pstatp.com/large/pgc-image/5b46729ccbcc420aa54d8545f34d02c7)\n\n一个非常优秀的 Java 博客，包含很多精选文集。\n\n5. https://gitlab.com/\n\n![](http://p1.pstatp.com/large/pgc-image/ac24d005843d40f18e69a28fb178bdb3)\n\n免费代码托管网站，可以用来做私服，和 GitHub 最大区别是 GitLab 可以有私有项目。\n\n6. https://www.ibm.com/developerworks/learn/java/index.html\n\n![](http://p1.pstatp.com/large/pgc-image/75ca7ffaba244777805bad3a40ba960d)\n\nIBM 的 JAVA 开发者网站，很多干货。\n\n7. http://www.javaworld.com/\n\n![](http://p1.pstatp.com/large/pgc-image/4ddbb7e6420345f7ab65841ed7cf52c9)\n\n一个不错的综合性的 java 网站。\n\n8. http://www.onjava.com/\n\n![](http://p1.pstatp.com/large/pgc-image/9f195691c4a84cd7b645afba9a2fa9b4)\n\n某位国外大神的网站。\n\n\n","slug":"Java开发知名网站","published":1,"updated":"2019-01-18T06:10:37.310Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjs17mhy5000tpwgthxwpk01k","content":"<ol>\n<li><a href=\"https://stackoverflow.com\" target=\"_blank\" rel=\"noopener\">https://stackoverflow.com</a></li>\n</ol>\n<p><img src=\"http://p3.pstatp.com/large/pgc-image/af335d4e1a2840758f4daf158e2686ea\" alt=\"\"></p>\n<p>里面包含各种开发遇到的问题及答案，质量比较高。</p>\n<ol start=\"2\">\n<li><a href=\"https://github.com/\" target=\"_blank\" rel=\"noopener\">https://github.com/</a></li>\n</ol>\n<p><img src=\"http://p3.pstatp.com/large/pgc-image/d019dd56b8a54be9ac5f9f2e34fee499\" alt=\"\"></p>\n<p>免费的开源代码托管网站，包括了许多开源的项目及示例项目等。</p>\n<ol start=\"3\">\n<li><a href=\"https://dzone.com/\" target=\"_blank\" rel=\"noopener\">https://dzone.com/</a></li>\n</ol>\n<p><img src=\"http://p3.pstatp.com/large/pgc-image/0d0e9d5715bb4d83a6ddb1115772f33a\" alt=\"\"></p>\n<p>提供技术新闻、编程教程、及各种工具、开发者的博客等。</p>\n<ol start=\"4\">\n<li><a href=\"http://www.programcreek.com/\" target=\"_blank\" rel=\"noopener\">http://www.programcreek.com/</a></li>\n</ol>\n<p><img src=\"http://p1.pstatp.com/large/pgc-image/5b46729ccbcc420aa54d8545f34d02c7\" alt=\"\"></p>\n<p>一个非常优秀的 Java 博客，包含很多精选文集。</p>\n<ol start=\"5\">\n<li><a href=\"https://gitlab.com/\" target=\"_blank\" rel=\"noopener\">https://gitlab.com/</a></li>\n</ol>\n<p><img src=\"http://p1.pstatp.com/large/pgc-image/ac24d005843d40f18e69a28fb178bdb3\" alt=\"\"></p>\n<p>免费代码托管网站，可以用来做私服，和 GitHub 最大区别是 GitLab 可以有私有项目。</p>\n<ol start=\"6\">\n<li><a href=\"https://www.ibm.com/developerworks/learn/java/index.html\" target=\"_blank\" rel=\"noopener\">https://www.ibm.com/developerworks/learn/java/index.html</a></li>\n</ol>\n<p><img src=\"http://p1.pstatp.com/large/pgc-image/75ca7ffaba244777805bad3a40ba960d\" alt=\"\"></p>\n<p>IBM 的 JAVA 开发者网站，很多干货。</p>\n<ol start=\"7\">\n<li><a href=\"http://www.javaworld.com/\" target=\"_blank\" rel=\"noopener\">http://www.javaworld.com/</a></li>\n</ol>\n<p><img src=\"http://p1.pstatp.com/large/pgc-image/4ddbb7e6420345f7ab65841ed7cf52c9\" alt=\"\"></p>\n<p>一个不错的综合性的 java 网站。</p>\n<ol start=\"8\">\n<li><a href=\"http://www.onjava.com/\" target=\"_blank\" rel=\"noopener\">http://www.onjava.com/</a></li>\n</ol>\n<p><img src=\"http://p1.pstatp.com/large/pgc-image/9f195691c4a84cd7b645afba9a2fa9b4\" alt=\"\"></p>\n<p>某位国外大神的网站。</p>\n","site":{"data":{}},"excerpt":"","more":"<ol>\n<li><a href=\"https://stackoverflow.com\" target=\"_blank\" rel=\"noopener\">https://stackoverflow.com</a></li>\n</ol>\n<p><img src=\"http://p3.pstatp.com/large/pgc-image/af335d4e1a2840758f4daf158e2686ea\" alt=\"\"></p>\n<p>里面包含各种开发遇到的问题及答案，质量比较高。</p>\n<ol start=\"2\">\n<li><a href=\"https://github.com/\" target=\"_blank\" rel=\"noopener\">https://github.com/</a></li>\n</ol>\n<p><img src=\"http://p3.pstatp.com/large/pgc-image/d019dd56b8a54be9ac5f9f2e34fee499\" alt=\"\"></p>\n<p>免费的开源代码托管网站，包括了许多开源的项目及示例项目等。</p>\n<ol start=\"3\">\n<li><a href=\"https://dzone.com/\" target=\"_blank\" rel=\"noopener\">https://dzone.com/</a></li>\n</ol>\n<p><img src=\"http://p3.pstatp.com/large/pgc-image/0d0e9d5715bb4d83a6ddb1115772f33a\" alt=\"\"></p>\n<p>提供技术新闻、编程教程、及各种工具、开发者的博客等。</p>\n<ol start=\"4\">\n<li><a href=\"http://www.programcreek.com/\" target=\"_blank\" rel=\"noopener\">http://www.programcreek.com/</a></li>\n</ol>\n<p><img src=\"http://p1.pstatp.com/large/pgc-image/5b46729ccbcc420aa54d8545f34d02c7\" alt=\"\"></p>\n<p>一个非常优秀的 Java 博客，包含很多精选文集。</p>\n<ol start=\"5\">\n<li><a href=\"https://gitlab.com/\" target=\"_blank\" rel=\"noopener\">https://gitlab.com/</a></li>\n</ol>\n<p><img src=\"http://p1.pstatp.com/large/pgc-image/ac24d005843d40f18e69a28fb178bdb3\" alt=\"\"></p>\n<p>免费代码托管网站，可以用来做私服，和 GitHub 最大区别是 GitLab 可以有私有项目。</p>\n<ol start=\"6\">\n<li><a href=\"https://www.ibm.com/developerworks/learn/java/index.html\" target=\"_blank\" rel=\"noopener\">https://www.ibm.com/developerworks/learn/java/index.html</a></li>\n</ol>\n<p><img src=\"http://p1.pstatp.com/large/pgc-image/75ca7ffaba244777805bad3a40ba960d\" alt=\"\"></p>\n<p>IBM 的 JAVA 开发者网站，很多干货。</p>\n<ol start=\"7\">\n<li><a href=\"http://www.javaworld.com/\" target=\"_blank\" rel=\"noopener\">http://www.javaworld.com/</a></li>\n</ol>\n<p><img src=\"http://p1.pstatp.com/large/pgc-image/4ddbb7e6420345f7ab65841ed7cf52c9\" alt=\"\"></p>\n<p>一个不错的综合性的 java 网站。</p>\n<ol start=\"8\">\n<li><a href=\"http://www.onjava.com/\" target=\"_blank\" rel=\"noopener\">http://www.onjava.com/</a></li>\n</ol>\n<p><img src=\"http://p1.pstatp.com/large/pgc-image/9f195691c4a84cd7b645afba9a2fa9b4\" alt=\"\"></p>\n<p>某位国外大神的网站。</p>\n"},{"title":"Spring Boot默认配置源码","author":"Asia Cui","date":"2018-12-30T06:51:00.000Z","_content":"### 源码位置\n`Spring Boot` 默认自动配置绑定在 `ServerProperties` 类上，源码中所在位置如下：\n\n```\n|-- spring-boot-project\n    |-- spring-boot-autoconfigure\n        |-- src/main/java\n            |-- org.springframework.boot.autoconfigure\n                |-- web\n                    |-- ServerProperties  \n```","source":"_posts/Spring-Boot默认配置源码.md","raw":"title: Spring Boot默认配置源码\nauthor: Asia Cui\ntags:\n  - Spring Boot\ncategories:\n  - Spring Boot默认配置源码\ndate: 2018-12-30 14:51:00\n---\n### 源码位置\n`Spring Boot` 默认自动配置绑定在 `ServerProperties` 类上，源码中所在位置如下：\n\n```\n|-- spring-boot-project\n    |-- spring-boot-autoconfigure\n        |-- src/main/java\n            |-- org.springframework.boot.autoconfigure\n                |-- web\n                    |-- ServerProperties  \n```","slug":"Spring-Boot默认配置源码","published":1,"updated":"2019-01-02T09:56:51.168Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjs17mhy7000vpwgt1l8udfpo","content":"<h3 id=\"源码位置\"><a href=\"#源码位置\" class=\"headerlink\" title=\"源码位置\"></a>源码位置</h3><p><code>Spring Boot</code> 默认自动配置绑定在 <code>ServerProperties</code> 类上，源码中所在位置如下：</p>\n<pre><code>|-- spring-boot-project\n    |-- spring-boot-autoconfigure\n        |-- src/main/java\n            |-- org.springframework.boot.autoconfigure\n                |-- web\n                    |-- ServerProperties  \n</code></pre>","site":{"data":{}},"excerpt":"","more":"<h3 id=\"源码位置\"><a href=\"#源码位置\" class=\"headerlink\" title=\"源码位置\"></a>源码位置</h3><p><code>Spring Boot</code> 默认自动配置绑定在 <code>ServerProperties</code> 类上，源码中所在位置如下：</p>\n<pre><code>|-- spring-boot-project\n    |-- spring-boot-autoconfigure\n        |-- src/main/java\n            |-- org.springframework.boot.autoconfigure\n                |-- web\n                    |-- ServerProperties  \n</code></pre>"},{"title":"idea同步配置到Git","author":"Asia Cui","date":"2019-01-23T01:58:00.000Z","_content":"\n\n## 软件安装\n\n- IntelliJ IDEA\n- [ToolBox](https://www.jetbrains.com/toolbox/app/?fromMenu)\n- Git\n\n## 同步步骤\n\n同步之前，现在GitHub上创建存储配置仓库，创建完仓库设置`token`，设置步骤是GitHub的`Settings`->`Developer settings`->`Personal access tokens`->`Generate new token`，点击创建`token`，如下图所示：\n\n![1548208510812](/images/idea/1548208510812.png)\n\n进入`idea`界面，点击`File`->`Settings Repositorys`，输入`Git`的`URL`，点击`Overwrite Remote`即可。","source":"_posts/idea同步配置到Git.md","raw":"title: idea同步配置到Git\nauthor: Asia Cui\ntags:\n  - idea\ncategories:\n  - 同步配置\ndate: 2019-01-23 09:58:00\n---\n\n\n## 软件安装\n\n- IntelliJ IDEA\n- [ToolBox](https://www.jetbrains.com/toolbox/app/?fromMenu)\n- Git\n\n## 同步步骤\n\n同步之前，现在GitHub上创建存储配置仓库，创建完仓库设置`token`，设置步骤是GitHub的`Settings`->`Developer settings`->`Personal access tokens`->`Generate new token`，点击创建`token`，如下图所示：\n\n![1548208510812](/images/idea/1548208510812.png)\n\n进入`idea`界面，点击`File`->`Settings Repositorys`，输入`Git`的`URL`，点击`Overwrite Remote`即可。","slug":"idea同步配置到Git","published":1,"updated":"2019-01-23T01:59:23.857Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjs17mhyb000xpwgtulk0ghv1","content":"<h2 id=\"软件安装\"><a href=\"#软件安装\" class=\"headerlink\" title=\"软件安装\"></a>软件安装</h2><ul>\n<li>IntelliJ IDEA</li>\n<li><a href=\"https://www.jetbrains.com/toolbox/app/?fromMenu\" target=\"_blank\" rel=\"noopener\">ToolBox</a></li>\n<li>Git</li>\n</ul>\n<h2 id=\"同步步骤\"><a href=\"#同步步骤\" class=\"headerlink\" title=\"同步步骤\"></a>同步步骤</h2><p>同步之前，现在GitHub上创建存储配置仓库，创建完仓库设置<code>token</code>，设置步骤是GitHub的<code>Settings</code>-&gt;<code>Developer settings</code>-&gt;<code>Personal access tokens</code>-&gt;<code>Generate new token</code>，点击创建<code>token</code>，如下图所示：</p>\n<p><img src=\"/images/idea/1548208510812.png\" alt=\"1548208510812\"></p>\n<p>进入<code>idea</code>界面，点击<code>File</code>-&gt;<code>Settings Repositorys</code>，输入<code>Git</code>的<code>URL</code>，点击<code>Overwrite Remote</code>即可。</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"软件安装\"><a href=\"#软件安装\" class=\"headerlink\" title=\"软件安装\"></a>软件安装</h2><ul>\n<li>IntelliJ IDEA</li>\n<li><a href=\"https://www.jetbrains.com/toolbox/app/?fromMenu\" target=\"_blank\" rel=\"noopener\">ToolBox</a></li>\n<li>Git</li>\n</ul>\n<h2 id=\"同步步骤\"><a href=\"#同步步骤\" class=\"headerlink\" title=\"同步步骤\"></a>同步步骤</h2><p>同步之前，现在GitHub上创建存储配置仓库，创建完仓库设置<code>token</code>，设置步骤是GitHub的<code>Settings</code>-&gt;<code>Developer settings</code>-&gt;<code>Personal access tokens</code>-&gt;<code>Generate new token</code>，点击创建<code>token</code>，如下图所示：</p>\n<p><img src=\"/images/idea/1548208510812.png\" alt=\"1548208510812\"></p>\n<p>进入<code>idea</code>界面，点击<code>File</code>-&gt;<code>Settings Repositorys</code>，输入<code>Git</code>的<code>URL</code>，点击<code>Overwrite Remote</code>即可。</p>\n"},{"title":"XML工具类","author":"Asia Cui","date":"2019-01-02T05:15:00.000Z","_content":"## Features\n\n* 将 Object 转换为 xml 格式字符串\n* 将 xml 格式的 String 字符串转换为 Object\n\n```java\n/**\n * xml工具类\n * @author AsiaCui\n */\nimport java.io.StringReader;\nimport java.io.StringWriter;\n\nimport javax.xml.bind.JAXBContext;\nimport javax.xml.bind.Marshaller;\nimport javax.xml.bind.Unmarshaller;\n\npublic class XMLUtil {\n\n    /**\n     * 将javabean转换为xml格式字符串\n     * @param obj\n     * @return\n     */\n     public static String toXmlString(Object obj) {\n            String result;\n            try {\n                JAXBContext context = JAXBContext.newInstance(obj.getClass());\n                Marshaller marshaller = context.createMarshaller();\n                StringWriter writer = new StringWriter();\n                marshaller.marshal(obj, writer);\n                result = writer.toString();\n            } catch (Exception e) {\n                throw new RuntimeException(e);\n            }\n            return result;\n        }\n\n     /**\n      * 将xml格式的String字符串转换为javabeen\n      * @param input xml格式字符串\n      * @param claaz\n      * @return\n      */\n        @SuppressWarnings(\"unchecked\")\n        public static <T> T parseObject(String input, Class<T> claaz) {\n            Object result;\n            try {\n                JAXBContext context = JAXBContext.newInstance(claaz);\n                Unmarshaller unmarshaller = context.createUnmarshaller();\n                result = unmarshaller.unmarshal(new StringReader(input));\n            } catch (Exception e) {\n                throw new RuntimeException(e);\n            }\n            return (T) result;\n        }\n\n}\n\n```","source":"_posts/XML工具类.md","raw":"title: XML工具类\nauthor: Asia Cui\ntags:\n  - Java工具类\ncategories:\n  - XML工具类\ndate: 2019-01-02 13:15:00\n---\n## Features\n\n* 将 Object 转换为 xml 格式字符串\n* 将 xml 格式的 String 字符串转换为 Object\n\n```java\n/**\n * xml工具类\n * @author AsiaCui\n */\nimport java.io.StringReader;\nimport java.io.StringWriter;\n\nimport javax.xml.bind.JAXBContext;\nimport javax.xml.bind.Marshaller;\nimport javax.xml.bind.Unmarshaller;\n\npublic class XMLUtil {\n\n    /**\n     * 将javabean转换为xml格式字符串\n     * @param obj\n     * @return\n     */\n     public static String toXmlString(Object obj) {\n            String result;\n            try {\n                JAXBContext context = JAXBContext.newInstance(obj.getClass());\n                Marshaller marshaller = context.createMarshaller();\n                StringWriter writer = new StringWriter();\n                marshaller.marshal(obj, writer);\n                result = writer.toString();\n            } catch (Exception e) {\n                throw new RuntimeException(e);\n            }\n            return result;\n        }\n\n     /**\n      * 将xml格式的String字符串转换为javabeen\n      * @param input xml格式字符串\n      * @param claaz\n      * @return\n      */\n        @SuppressWarnings(\"unchecked\")\n        public static <T> T parseObject(String input, Class<T> claaz) {\n            Object result;\n            try {\n                JAXBContext context = JAXBContext.newInstance(claaz);\n                Unmarshaller unmarshaller = context.createUnmarshaller();\n                result = unmarshaller.unmarshal(new StringReader(input));\n            } catch (Exception e) {\n                throw new RuntimeException(e);\n            }\n            return (T) result;\n        }\n\n}\n\n```","slug":"XML工具类","published":1,"updated":"2019-01-02T09:56:51.172Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjs17mhye0011pwgtq2josenk","content":"<h2 id=\"Features\"><a href=\"#Features\" class=\"headerlink\" title=\"Features\"></a>Features</h2><ul>\n<li>将 Object 转换为 xml 格式字符串</li>\n<li>将 xml 格式的 String 字符串转换为 Object</li>\n</ul>\n<pre class=\"line-numbers language-java\"><code class=\"language-java\"><span class=\"token comment\" spellcheck=\"true\">/**\n * xml工具类\n * @author AsiaCui\n */</span>\n<span class=\"token keyword\">import</span> java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span>StringReader<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span>StringWriter<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> javax<span class=\"token punctuation\">.</span>xml<span class=\"token punctuation\">.</span>bind<span class=\"token punctuation\">.</span>JAXBContext<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> javax<span class=\"token punctuation\">.</span>xml<span class=\"token punctuation\">.</span>bind<span class=\"token punctuation\">.</span>Marshaller<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> javax<span class=\"token punctuation\">.</span>xml<span class=\"token punctuation\">.</span>bind<span class=\"token punctuation\">.</span>Unmarshaller<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">XMLUtil</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">/**\n     * 将javabean转换为xml格式字符串\n     * @param obj\n     * @return\n     */</span>\n     <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> String <span class=\"token function\">toXmlString</span><span class=\"token punctuation\">(</span>Object obj<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            String result<span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n                JAXBContext context <span class=\"token operator\">=</span> JAXBContext<span class=\"token punctuation\">.</span><span class=\"token function\">newInstance</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">.</span><span class=\"token function\">getClass</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                Marshaller marshaller <span class=\"token operator\">=</span> context<span class=\"token punctuation\">.</span><span class=\"token function\">createMarshaller</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                StringWriter writer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">StringWriter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                marshaller<span class=\"token punctuation\">.</span><span class=\"token function\">marshal</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">,</span> writer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                result <span class=\"token operator\">=</span> writer<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token keyword\">return</span> result<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n     <span class=\"token comment\" spellcheck=\"true\">/**\n      * 将xml格式的String字符串转换为javabeen\n      * @param input xml格式字符串\n      * @param claaz\n      * @return\n      */</span>\n        <span class=\"token annotation punctuation\">@SuppressWarnings</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"unchecked\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token operator\">&lt;</span>T<span class=\"token operator\">></span> T <span class=\"token function\">parseObject</span><span class=\"token punctuation\">(</span>String input<span class=\"token punctuation\">,</span> Class<span class=\"token operator\">&lt;</span>T<span class=\"token operator\">></span> claaz<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            Object result<span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n                JAXBContext context <span class=\"token operator\">=</span> JAXBContext<span class=\"token punctuation\">.</span><span class=\"token function\">newInstance</span><span class=\"token punctuation\">(</span>claaz<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                Unmarshaller unmarshaller <span class=\"token operator\">=</span> context<span class=\"token punctuation\">.</span><span class=\"token function\">createUnmarshaller</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                result <span class=\"token operator\">=</span> unmarshaller<span class=\"token punctuation\">.</span><span class=\"token function\">unmarshal</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">StringReader</span><span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>T<span class=\"token punctuation\">)</span> result<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span>\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"Features\"><a href=\"#Features\" class=\"headerlink\" title=\"Features\"></a>Features</h2><ul>\n<li>将 Object 转换为 xml 格式字符串</li>\n<li>将 xml 格式的 String 字符串转换为 Object</li>\n</ul>\n<pre><code class=\"java\">/**\n * xml工具类\n * @author AsiaCui\n */\nimport java.io.StringReader;\nimport java.io.StringWriter;\n\nimport javax.xml.bind.JAXBContext;\nimport javax.xml.bind.Marshaller;\nimport javax.xml.bind.Unmarshaller;\n\npublic class XMLUtil {\n\n    /**\n     * 将javabean转换为xml格式字符串\n     * @param obj\n     * @return\n     */\n     public static String toXmlString(Object obj) {\n            String result;\n            try {\n                JAXBContext context = JAXBContext.newInstance(obj.getClass());\n                Marshaller marshaller = context.createMarshaller();\n                StringWriter writer = new StringWriter();\n                marshaller.marshal(obj, writer);\n                result = writer.toString();\n            } catch (Exception e) {\n                throw new RuntimeException(e);\n            }\n            return result;\n        }\n\n     /**\n      * 将xml格式的String字符串转换为javabeen\n      * @param input xml格式字符串\n      * @param claaz\n      * @return\n      */\n        @SuppressWarnings(&quot;unchecked&quot;)\n        public static &lt;T&gt; T parseObject(String input, Class&lt;T&gt; claaz) {\n            Object result;\n            try {\n                JAXBContext context = JAXBContext.newInstance(claaz);\n                Unmarshaller unmarshaller = context.createUnmarshaller();\n                result = unmarshaller.unmarshal(new StringReader(input));\n            } catch (Exception e) {\n                throw new RuntimeException(e);\n            }\n            return (T) result;\n        }\n\n}\n\n</code></pre>\n"},{"title":"20个常用正则表达式","author":"Asia Cui","date":"2019-01-18T05:58:00.000Z","_content":"**正则表达式在线测试工具**\n\n> http://tool.oschina.net/regex/\n\n**1 . 校验密码强度**\n\n密码的强度必须是包含大小写字母和数字的组合，不能使用特殊字符，长度在 8-10 之间。\n\n> ^(?=.*\\d)(?=.*[a-z])(?=.*[A-Z]).{8,10}$\n\n**2\\. 校验中文**\n\n字符串仅能是中文。\n\n> ^[\\ 一 -\\ 龥]{0,}$\n\n**3\\. 由数字、26 个英文字母或下划线组成的字符串**\n\n> ^\\w+$\n\n**4\\. 校验 E-Mail 地址**\n\n同密码一样，下面是 E-mail 地址合规性的正则检查语句。\n\n> [\\w!#$%&'*+/=?^_`{|}~-]+(?:\\.[\\w!#$%&'*+/=?^_`{|}~-]+)*@(?:[\\w](?:[\\w-]*[\\w])?\\.)+[\\w](?:[\\w-]*[\\w])?\n\n**5\\. 校验身份证号码**\n\n下面是身份证号码的正则校验。15 或 18 位。\n\n15 位：\n\n> ^[1-9]\\d{7}((0\\d)|(1[0-2]))(([0|1|2]\\d)|3[0-1])\\d{3}$\n\n18 位：\n\n> ^[1-9]\\d{5}[1-9]\\d{3}((0\\d)|(1[0-2]))(([0|1|2]\\d)|3[0-1])\\d{3}([0-9]|X)$\n\n**6\\. 校验日期**\n\n“yyyy-mm-dd“ 格式的日期校验，已考虑平闰年。\n\n> ^(?:(?!0000)[0-9]{4}-(?:(?:0[1-9]|1[0-2])-(?:0[1-9]|1[0-9]|2[0-8])|(?:0[13-9]|1[0-2])-(?:29|30)|(?:0[13578]|1[02])-31)|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)-02-29)$\n\n**7\\. 校验金额**\n\n金额校验，精确到 2 位小数。\n\n> ^[0-9]+(.[0-9]{2})?$\n\n**8\\. 校验手机号**\n\n下面是国内 13、15、18 开头的手机号正则表达式。（可根据目前国内收集号扩展前两位开头号码）\n\n> ^(13[0-9]|14[5|7]|15[0|1|2|3|5|6|7|8|9]|18[0|1|2|3|5|6|7|8|9])\\d{8}$\n\n**9\\. 判断 IE 的版本**\n\nIE 目前还没被完全取代，很多页面还是需要做版本兼容，下面是 IE 版本检查的表达式。\n\n> ^.*MSIE [5-8](?:\\.[0-9]+)?(?!.*Trident\\/[5-9]\\.0).*$\n\n**10\\. 校验 IP-v4 地址**\n\nIP4 正则语句。\n\n> \\b(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\b\n\n**11\\. 校验 IP-v6 地址**\n\nIP6 正则语句。\n\n> (([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\n\n**12\\. 检查 URL 的前缀**\n\n应用开发中很多时候需要区分请求是 HTTPS 还是 HTTP，通过下面的表达式可以取出一个 url 的前缀然后再逻辑判断。\n\n> if (!s.match(/^[a-zA-Z]+:\\/\\//)){ s = 'http://' + s;}\n\n**13\\. 提取 URL 链接**\n\n下面的这个表达式可以筛选出一段文本中的 URL。\n\n> ^(f|ht){1}(tp|tps):\\/\\/([\\w-]+\\.)+[\\w-]+(\\/[\\w- ./?%&=]*)?\n\n**14\\. 文件路径及扩展名校验**\n\n验证 windows 下文件路径和扩展名（下面的例子中为. txt 文件）\n\n> ^([a-zA-Z]\\:|\\\\)\\\\([^\\\\]+\\\\)*[^\\/:*?\"<>|]+\\.txt(l)?$\n\n**15\\. 提取 Color Hex Codes**\n\n有时需要抽取网页中的颜色代码，可以使用下面的表达式。\n\n> ^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$\n\n**16\\. 提取网页图片**\n\n假若你想提取网页中所有图片信息，可以利用下面的表达式。\n\n> \\<*[img][^\\\\>]*[src] *= *[\\\"\\']{0,1}([^\\\"\\'\\ >]*)\n\n**17\\. 提取页面超链接**\n\n提取 html 中的超链接。\n\n> (<a\\s*(?!.*\\brel=)[^>]*)(href=\"https?:\\/\\/)((?!(?:(?:www\\.)?'.implode('|(?:www\\.)?', $follow_list).'))[^\"]+)\"((?!.*\\brel=)[^>]*)(?:[^>]*)>\n\n**18\\. 查找 CSS 属性**\n\n通过下面的表达式，可以搜索到相匹配的 CSS 属性。\n\n> ^\\s*[a-zA-Z\\-]+\\s*[:]{1}\\s[a-zA-Z0-9\\s.#]+[;]{1}\n\n**19\\. 抽取注释**\n\n如果你需要移除 HMTL 中的注释，可以使用如下的表达式。\n\n> <!--(.*?)-->\n\n**20\\. 匹配 HTML 标签**\n\n通过下面的表达式可以匹配出 HTML 中的标签属性。\n\n> <\\/?\\w+((\\s+\\w+(\\s*=\\s*(?:\".*?\"|'.*?'|[\\^'\">\\s]+))?)+\\s*|\\s*)\\/?>\n","source":"_posts/正则表达式.md","raw":"title: 20个常用正则表达式\nauthor: Asia Cui\ntags:\n  - 干货\ncategories:\n  - 正则\ndate: 2019-01-18 13:58:00\n---\n**正则表达式在线测试工具**\n\n> http://tool.oschina.net/regex/\n\n**1 . 校验密码强度**\n\n密码的强度必须是包含大小写字母和数字的组合，不能使用特殊字符，长度在 8-10 之间。\n\n> ^(?=.*\\d)(?=.*[a-z])(?=.*[A-Z]).{8,10}$\n\n**2\\. 校验中文**\n\n字符串仅能是中文。\n\n> ^[\\ 一 -\\ 龥]{0,}$\n\n**3\\. 由数字、26 个英文字母或下划线组成的字符串**\n\n> ^\\w+$\n\n**4\\. 校验 E-Mail 地址**\n\n同密码一样，下面是 E-mail 地址合规性的正则检查语句。\n\n> [\\w!#$%&'*+/=?^_`{|}~-]+(?:\\.[\\w!#$%&'*+/=?^_`{|}~-]+)*@(?:[\\w](?:[\\w-]*[\\w])?\\.)+[\\w](?:[\\w-]*[\\w])?\n\n**5\\. 校验身份证号码**\n\n下面是身份证号码的正则校验。15 或 18 位。\n\n15 位：\n\n> ^[1-9]\\d{7}((0\\d)|(1[0-2]))(([0|1|2]\\d)|3[0-1])\\d{3}$\n\n18 位：\n\n> ^[1-9]\\d{5}[1-9]\\d{3}((0\\d)|(1[0-2]))(([0|1|2]\\d)|3[0-1])\\d{3}([0-9]|X)$\n\n**6\\. 校验日期**\n\n“yyyy-mm-dd“ 格式的日期校验，已考虑平闰年。\n\n> ^(?:(?!0000)[0-9]{4}-(?:(?:0[1-9]|1[0-2])-(?:0[1-9]|1[0-9]|2[0-8])|(?:0[13-9]|1[0-2])-(?:29|30)|(?:0[13578]|1[02])-31)|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)-02-29)$\n\n**7\\. 校验金额**\n\n金额校验，精确到 2 位小数。\n\n> ^[0-9]+(.[0-9]{2})?$\n\n**8\\. 校验手机号**\n\n下面是国内 13、15、18 开头的手机号正则表达式。（可根据目前国内收集号扩展前两位开头号码）\n\n> ^(13[0-9]|14[5|7]|15[0|1|2|3|5|6|7|8|9]|18[0|1|2|3|5|6|7|8|9])\\d{8}$\n\n**9\\. 判断 IE 的版本**\n\nIE 目前还没被完全取代，很多页面还是需要做版本兼容，下面是 IE 版本检查的表达式。\n\n> ^.*MSIE [5-8](?:\\.[0-9]+)?(?!.*Trident\\/[5-9]\\.0).*$\n\n**10\\. 校验 IP-v4 地址**\n\nIP4 正则语句。\n\n> \\b(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\b\n\n**11\\. 校验 IP-v6 地址**\n\nIP6 正则语句。\n\n> (([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\n\n**12\\. 检查 URL 的前缀**\n\n应用开发中很多时候需要区分请求是 HTTPS 还是 HTTP，通过下面的表达式可以取出一个 url 的前缀然后再逻辑判断。\n\n> if (!s.match(/^[a-zA-Z]+:\\/\\//)){ s = 'http://' + s;}\n\n**13\\. 提取 URL 链接**\n\n下面的这个表达式可以筛选出一段文本中的 URL。\n\n> ^(f|ht){1}(tp|tps):\\/\\/([\\w-]+\\.)+[\\w-]+(\\/[\\w- ./?%&=]*)?\n\n**14\\. 文件路径及扩展名校验**\n\n验证 windows 下文件路径和扩展名（下面的例子中为. txt 文件）\n\n> ^([a-zA-Z]\\:|\\\\)\\\\([^\\\\]+\\\\)*[^\\/:*?\"<>|]+\\.txt(l)?$\n\n**15\\. 提取 Color Hex Codes**\n\n有时需要抽取网页中的颜色代码，可以使用下面的表达式。\n\n> ^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$\n\n**16\\. 提取网页图片**\n\n假若你想提取网页中所有图片信息，可以利用下面的表达式。\n\n> \\<*[img][^\\\\>]*[src] *= *[\\\"\\']{0,1}([^\\\"\\'\\ >]*)\n\n**17\\. 提取页面超链接**\n\n提取 html 中的超链接。\n\n> (<a\\s*(?!.*\\brel=)[^>]*)(href=\"https?:\\/\\/)((?!(?:(?:www\\.)?'.implode('|(?:www\\.)?', $follow_list).'))[^\"]+)\"((?!.*\\brel=)[^>]*)(?:[^>]*)>\n\n**18\\. 查找 CSS 属性**\n\n通过下面的表达式，可以搜索到相匹配的 CSS 属性。\n\n> ^\\s*[a-zA-Z\\-]+\\s*[:]{1}\\s[a-zA-Z0-9\\s.#]+[;]{1}\n\n**19\\. 抽取注释**\n\n如果你需要移除 HMTL 中的注释，可以使用如下的表达式。\n\n> <!--(.*?)-->\n\n**20\\. 匹配 HTML 标签**\n\n通过下面的表达式可以匹配出 HTML 中的标签属性。\n\n> <\\/?\\w+((\\s+\\w+(\\s*=\\s*(?:\".*?\"|'.*?'|[\\^'\">\\s]+))?)+\\s*|\\s*)\\/?>\n","slug":"正则表达式","published":1,"updated":"2019-01-18T06:02:44.492Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjs17mhyg0012pwgtwvpbybsf","content":"<p><strong>正则表达式在线测试工具</strong></p>\n<blockquote>\n<p><a href=\"http://tool.oschina.net/regex/\" target=\"_blank\" rel=\"noopener\">http://tool.oschina.net/regex/</a></p>\n</blockquote>\n<p><strong>1 . 校验密码强度</strong></p>\n<p>密码的强度必须是包含大小写字母和数字的组合，不能使用特殊字符，长度在 8-10 之间。</p>\n<blockquote>\n<p>^(?=.<em>\\d)(?=.</em>[a-z])(?=.*[A-Z]).{8,10}$</p>\n</blockquote>\n<p><strong>2. 校验中文</strong></p>\n<p>字符串仅能是中文。</p>\n<blockquote>\n<p>^[\\ 一 -\\ 龥]{0,}$</p>\n</blockquote>\n<p><strong>3. 由数字、26 个英文字母或下划线组成的字符串</strong></p>\n<blockquote>\n<p>^\\w+$</p>\n</blockquote>\n<p><strong>4. 校验 E-Mail 地址</strong></p>\n<p>同密码一样，下面是 E-mail 地址合规性的正则检查语句。</p>\n<blockquote>\n<p>[\\w!#$%&amp;’<em>+/=?^_`{|}~-]+(?:.[\\w!#$%&amp;’</em>+/=?^_`{|}~-]+)<em>@(?:[\\w](?:[\\w-]</em>[\\w])?.)+<a href=\"?:[\\w-]*[\\w]\">\\w</a>?</p>\n</blockquote>\n<p><strong>5. 校验身份证号码</strong></p>\n<p>下面是身份证号码的正则校验。15 或 18 位。</p>\n<p>15 位：</p>\n<blockquote>\n<p>^[1-9]\\d{7}((0\\d)|(1[0-2]))(([0|1|2]\\d)|3[0-1])\\d{3}$</p>\n</blockquote>\n<p>18 位：</p>\n<blockquote>\n<p>^[1-9]\\d{5}[1-9]\\d{3}((0\\d)|(1[0-2]))(([0|1|2]\\d)|3[0-1])\\d{3}([0-9]|X)$</p>\n</blockquote>\n<p><strong>6. 校验日期</strong></p>\n<p>“yyyy-mm-dd“ 格式的日期校验，已考虑平闰年。</p>\n<blockquote>\n<p>^(?:(?!0000)[0-9]{4}-(?:(?:0[1-9]|1[0-2])-(?:0[1-9]|1[0-9]|2[0-8])|(?:0[13-9]|1[0-2])-(?:29|30)|(?:0[13578]|1[02])-31)|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)-02-29)$</p>\n</blockquote>\n<p><strong>7. 校验金额</strong></p>\n<p>金额校验，精确到 2 位小数。</p>\n<blockquote>\n<p>^[0-9]+(.[0-9]{2})?$</p>\n</blockquote>\n<p><strong>8. 校验手机号</strong></p>\n<p>下面是国内 13、15、18 开头的手机号正则表达式。（可根据目前国内收集号扩展前两位开头号码）</p>\n<blockquote>\n<p>^(13[0-9]|14[5|7]|15[0|1|2|3|5|6|7|8|9]|18[0|1|2|3|5|6|7|8|9])\\d{8}$</p>\n</blockquote>\n<p><strong>9. 判断 IE 的版本</strong></p>\n<p>IE 目前还没被完全取代，很多页面还是需要做版本兼容，下面是 IE 版本检查的表达式。</p>\n<blockquote>\n<p>^.<em>MSIE <a href=\"?:\\.[0-9]+\">5-8</a>?(?!.</em>Trident\\/[5-9].0).*$</p>\n</blockquote>\n<p><strong>10. 校验 IP-v4 地址</strong></p>\n<p>IP4 正则语句。</p>\n<blockquote>\n<p>\\b(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?).){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\b</p>\n</blockquote>\n<p><strong>11. 校验 IP-v6 地址</strong></p>\n<p>IP6 正则语句。</p>\n<blockquote>\n<p>(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]).){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]).){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))</p>\n</blockquote>\n<p><strong>12. 检查 URL 的前缀</strong></p>\n<p>应用开发中很多时候需要区分请求是 HTTPS 还是 HTTP，通过下面的表达式可以取出一个 url 的前缀然后再逻辑判断。</p>\n<blockquote>\n<p>if (!s.match(/^[a-zA-Z]+:\\/\\//)){ s = ‘http://‘ + s;}</p>\n</blockquote>\n<p><strong>13. 提取 URL 链接</strong></p>\n<p>下面的这个表达式可以筛选出一段文本中的 URL。</p>\n<blockquote>\n<p>^(f|ht){1}(tp|tps):\\/\\/([\\w-]+.)+[\\w-]+(\\/[\\w- ./?%&amp;=]*)?</p>\n</blockquote>\n<p><strong>14. 文件路径及扩展名校验</strong></p>\n<p>验证 windows 下文件路径和扩展名（下面的例子中为. txt 文件）</p>\n<blockquote>\n<p>^([a-zA-Z]\\:|\\)\\([^\\]+\\)<em>[^\\/:</em>?”&lt;&gt;|]+.txt(l)?$</p>\n</blockquote>\n<p><strong>15. 提取 Color Hex Codes</strong></p>\n<p>有时需要抽取网页中的颜色代码，可以使用下面的表达式。</p>\n<blockquote>\n<p>^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$</p>\n</blockquote>\n<p><strong>16. 提取网页图片</strong></p>\n<p>假若你想提取网页中所有图片信息，可以利用下面的表达式。</p>\n<blockquote>\n<p>\\&lt;<em>[img][^\\&gt;]</em>[src] <em>= </em>[\\”\\’]{0,1}([^\\”\\’\\ &gt;]*)</p>\n</blockquote>\n<p><strong>17. 提取页面超链接</strong></p>\n<p>提取 html 中的超链接。</p>\n<blockquote>\n<p>(&lt;a\\s<em>(?!.</em>\\brel=)[^&gt;]<em>)(href=”https?:\\/\\/)((?!(?:(?:www.)?’.implode(‘|(?:www.)?’, $follow_list).’))[^”]+)”((?!.</em>\\brel=)[^&gt;]<em>)(?:[^&gt;]</em>)&gt;</p>\n</blockquote>\n<p><strong>18. 查找 CSS 属性</strong></p>\n<p>通过下面的表达式，可以搜索到相匹配的 CSS 属性。</p>\n<blockquote>\n<p>^\\s<em>[a-zA-Z-]+\\s</em>[:]{1}\\s[a-zA-Z0-9\\s.#]+[;]{1}</p>\n</blockquote>\n<p><strong>19. 抽取注释</strong></p>\n<p>如果你需要移除 HMTL 中的注释，可以使用如下的表达式。</p>\n<blockquote>\n<!--(.*?)-->\n</blockquote>\n<p><strong>20. 匹配 HTML 标签</strong></p>\n<p>通过下面的表达式可以匹配出 HTML 中的标签属性。</p>\n<blockquote>\n<p>&lt;\\/?\\w+((\\s+\\w+(\\s<em>=\\s</em>(?:”.<em>?”|’.</em>?’|[\\^’”&gt;\\s]+))?)+\\s<em>|\\s</em>)\\/?&gt;</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"","more":"<p><strong>正则表达式在线测试工具</strong></p>\n<blockquote>\n<p><a href=\"http://tool.oschina.net/regex/\" target=\"_blank\" rel=\"noopener\">http://tool.oschina.net/regex/</a></p>\n</blockquote>\n<p><strong>1 . 校验密码强度</strong></p>\n<p>密码的强度必须是包含大小写字母和数字的组合，不能使用特殊字符，长度在 8-10 之间。</p>\n<blockquote>\n<p>^(?=.<em>\\d)(?=.</em>[a-z])(?=.*[A-Z]).{8,10}$</p>\n</blockquote>\n<p><strong>2. 校验中文</strong></p>\n<p>字符串仅能是中文。</p>\n<blockquote>\n<p>^[\\ 一 -\\ 龥]{0,}$</p>\n</blockquote>\n<p><strong>3. 由数字、26 个英文字母或下划线组成的字符串</strong></p>\n<blockquote>\n<p>^\\w+$</p>\n</blockquote>\n<p><strong>4. 校验 E-Mail 地址</strong></p>\n<p>同密码一样，下面是 E-mail 地址合规性的正则检查语句。</p>\n<blockquote>\n<p>[\\w!#$%&amp;’<em>+/=?^_`{|}~-]+(?:.[\\w!#$%&amp;’</em>+/=?^_`{|}~-]+)<em>@(?:[\\w](?:[\\w-]</em>[\\w])?.)+<a href=\"?:[\\w-]*[\\w]\">\\w</a>?</p>\n</blockquote>\n<p><strong>5. 校验身份证号码</strong></p>\n<p>下面是身份证号码的正则校验。15 或 18 位。</p>\n<p>15 位：</p>\n<blockquote>\n<p>^[1-9]\\d{7}((0\\d)|(1[0-2]))(([0|1|2]\\d)|3[0-1])\\d{3}$</p>\n</blockquote>\n<p>18 位：</p>\n<blockquote>\n<p>^[1-9]\\d{5}[1-9]\\d{3}((0\\d)|(1[0-2]))(([0|1|2]\\d)|3[0-1])\\d{3}([0-9]|X)$</p>\n</blockquote>\n<p><strong>6. 校验日期</strong></p>\n<p>“yyyy-mm-dd“ 格式的日期校验，已考虑平闰年。</p>\n<blockquote>\n<p>^(?:(?!0000)[0-9]{4}-(?:(?:0[1-9]|1[0-2])-(?:0[1-9]|1[0-9]|2[0-8])|(?:0[13-9]|1[0-2])-(?:29|30)|(?:0[13578]|1[02])-31)|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)-02-29)$</p>\n</blockquote>\n<p><strong>7. 校验金额</strong></p>\n<p>金额校验，精确到 2 位小数。</p>\n<blockquote>\n<p>^[0-9]+(.[0-9]{2})?$</p>\n</blockquote>\n<p><strong>8. 校验手机号</strong></p>\n<p>下面是国内 13、15、18 开头的手机号正则表达式。（可根据目前国内收集号扩展前两位开头号码）</p>\n<blockquote>\n<p>^(13[0-9]|14[5|7]|15[0|1|2|3|5|6|7|8|9]|18[0|1|2|3|5|6|7|8|9])\\d{8}$</p>\n</blockquote>\n<p><strong>9. 判断 IE 的版本</strong></p>\n<p>IE 目前还没被完全取代，很多页面还是需要做版本兼容，下面是 IE 版本检查的表达式。</p>\n<blockquote>\n<p>^.<em>MSIE <a href=\"?:\\.[0-9]+\">5-8</a>?(?!.</em>Trident\\/[5-9].0).*$</p>\n</blockquote>\n<p><strong>10. 校验 IP-v4 地址</strong></p>\n<p>IP4 正则语句。</p>\n<blockquote>\n<p>\\b(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?).){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\b</p>\n</blockquote>\n<p><strong>11. 校验 IP-v6 地址</strong></p>\n<p>IP6 正则语句。</p>\n<blockquote>\n<p>(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]).){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]).){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))</p>\n</blockquote>\n<p><strong>12. 检查 URL 的前缀</strong></p>\n<p>应用开发中很多时候需要区分请求是 HTTPS 还是 HTTP，通过下面的表达式可以取出一个 url 的前缀然后再逻辑判断。</p>\n<blockquote>\n<p>if (!s.match(/^[a-zA-Z]+:\\/\\//)){ s = ‘http://‘ + s;}</p>\n</blockquote>\n<p><strong>13. 提取 URL 链接</strong></p>\n<p>下面的这个表达式可以筛选出一段文本中的 URL。</p>\n<blockquote>\n<p>^(f|ht){1}(tp|tps):\\/\\/([\\w-]+.)+[\\w-]+(\\/[\\w- ./?%&amp;=]*)?</p>\n</blockquote>\n<p><strong>14. 文件路径及扩展名校验</strong></p>\n<p>验证 windows 下文件路径和扩展名（下面的例子中为. txt 文件）</p>\n<blockquote>\n<p>^([a-zA-Z]\\:|\\)\\([^\\]+\\)<em>[^\\/:</em>?”&lt;&gt;|]+.txt(l)?$</p>\n</blockquote>\n<p><strong>15. 提取 Color Hex Codes</strong></p>\n<p>有时需要抽取网页中的颜色代码，可以使用下面的表达式。</p>\n<blockquote>\n<p>^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$</p>\n</blockquote>\n<p><strong>16. 提取网页图片</strong></p>\n<p>假若你想提取网页中所有图片信息，可以利用下面的表达式。</p>\n<blockquote>\n<p>\\&lt;<em>[img][^\\&gt;]</em>[src] <em>= </em>[\\”\\’]{0,1}([^\\”\\’\\ &gt;]*)</p>\n</blockquote>\n<p><strong>17. 提取页面超链接</strong></p>\n<p>提取 html 中的超链接。</p>\n<blockquote>\n<p>(&lt;a\\s<em>(?!.</em>\\brel=)[^&gt;]<em>)(href=”https?:\\/\\/)((?!(?:(?:www.)?’.implode(‘|(?:www.)?’, $follow_list).’))[^”]+)”((?!.</em>\\brel=)[^&gt;]<em>)(?:[^&gt;]</em>)&gt;</p>\n</blockquote>\n<p><strong>18. 查找 CSS 属性</strong></p>\n<p>通过下面的表达式，可以搜索到相匹配的 CSS 属性。</p>\n<blockquote>\n<p>^\\s<em>[a-zA-Z-]+\\s</em>[:]{1}\\s[a-zA-Z0-9\\s.#]+[;]{1}</p>\n</blockquote>\n<p><strong>19. 抽取注释</strong></p>\n<p>如果你需要移除 HMTL 中的注释，可以使用如下的表达式。</p>\n<blockquote>\n<!--(.*?)-->\n</blockquote>\n<p><strong>20. 匹配 HTML 标签</strong></p>\n<p>通过下面的表达式可以匹配出 HTML 中的标签属性。</p>\n<blockquote>\n<p>&lt;\\/?\\w+((\\s+\\w+(\\s<em>=\\s</em>(?:”.<em>?”|’.</em>?’|[\\^’”&gt;\\s]+))?)+\\s<em>|\\s</em>)\\/?&gt;</p>\n</blockquote>\n"},{"title":"解决 Maven 无法自动下载依赖的问题","author":"Asia Cui","date":"2019-01-15T09:25:00.000Z","_content":"### 现象说明\n\n无法下载依赖的情况大致有两类：\n\n*   无法通过 Maven 中央仓库提供的坐标下载（也许是网络环境导致）\n\n*   类库没有上传至中央仓库只能通过官网或其它渠道下载\n\n### 解决思路\n\n*   手动管理依赖，将依赖按传统的方式放入 `libs` 目录中。缺点是需要手动管理依赖版本。\n\n*   将依赖安装到本地仓库中，按照 Maven 下载依赖的优先级，会优先查找本地仓库中的依赖。缺点是协同开发时，其他开发人员会因为本地缺少依赖导致项目启动报错。\n\n### 解决方案\n\n以上解决思路虽然都可以解决缺少依赖的问题，但操作起来不太优雅，此时我们可以使用 Maven 提供的插件来解决这个问题\n\n`pom.xml` 增加插件配置，关键配置如下：\n\n```xml\n<build>\n    <plugins>\n        <plugin>\n            <groupId>org.apache.maven.plugins</groupId>\n            <artifactId>maven-install-plugin</artifactId>\n            <version>2.5.2</version>\n            <executions>\n                <execution>\n                    <id>install-external-kaptcha</id>\n                    <!-- 触发时机：执行 mvn clean 命令时自动触发插件 -->\n                    <phase>clean</phase>\n                    <configuration>\n                        <!-- 存放依赖文件的位置 -->\n                        <file>${project.basedir}/libs/kaptcha-2.3.jar</file>\n                        <repositoryLayout>default</repositoryLayout>\n                        <!-- 自定义 groupId -->\n                        <groupId>com.google.code.kaptcha</groupId>\n                        <!-- 自定义 artifactId -->\n                        <artifactId>kaptcha</artifactId>\n                        <!-- 自定义版本号 -->\n                        <version>2.3</version>\n                        <!-- 打包方式 -->\n                        <packaging>jar</packaging>\n                        <!-- 是否自动生成 POM -->\n                        <generatePom>true</generatePom>\n                    </configuration>\n                    <goals>\n                        <goal>install-file</goal>\n                    </goals>\n                </execution>\n            </executions>\n        </plugin>\n    </plugins>\n</build>\n\n```\n\n通过该插件，我们可以在执行 `mvn clean` 命令时将项目所需要的依赖自动安装进本地仓库","source":"_posts/解决-Maven-无法自动下载依赖的问题.md","raw":"title: 解决 Maven 无法自动下载依赖的问题\nauthor: Asia Cui\ntags:\n  - Maven\ncategories:\n  - 下载依赖\ndate: 2019-01-15 17:25:00\n---\n### 现象说明\n\n无法下载依赖的情况大致有两类：\n\n*   无法通过 Maven 中央仓库提供的坐标下载（也许是网络环境导致）\n\n*   类库没有上传至中央仓库只能通过官网或其它渠道下载\n\n### 解决思路\n\n*   手动管理依赖，将依赖按传统的方式放入 `libs` 目录中。缺点是需要手动管理依赖版本。\n\n*   将依赖安装到本地仓库中，按照 Maven 下载依赖的优先级，会优先查找本地仓库中的依赖。缺点是协同开发时，其他开发人员会因为本地缺少依赖导致项目启动报错。\n\n### 解决方案\n\n以上解决思路虽然都可以解决缺少依赖的问题，但操作起来不太优雅，此时我们可以使用 Maven 提供的插件来解决这个问题\n\n`pom.xml` 增加插件配置，关键配置如下：\n\n```xml\n<build>\n    <plugins>\n        <plugin>\n            <groupId>org.apache.maven.plugins</groupId>\n            <artifactId>maven-install-plugin</artifactId>\n            <version>2.5.2</version>\n            <executions>\n                <execution>\n                    <id>install-external-kaptcha</id>\n                    <!-- 触发时机：执行 mvn clean 命令时自动触发插件 -->\n                    <phase>clean</phase>\n                    <configuration>\n                        <!-- 存放依赖文件的位置 -->\n                        <file>${project.basedir}/libs/kaptcha-2.3.jar</file>\n                        <repositoryLayout>default</repositoryLayout>\n                        <!-- 自定义 groupId -->\n                        <groupId>com.google.code.kaptcha</groupId>\n                        <!-- 自定义 artifactId -->\n                        <artifactId>kaptcha</artifactId>\n                        <!-- 自定义版本号 -->\n                        <version>2.3</version>\n                        <!-- 打包方式 -->\n                        <packaging>jar</packaging>\n                        <!-- 是否自动生成 POM -->\n                        <generatePom>true</generatePom>\n                    </configuration>\n                    <goals>\n                        <goal>install-file</goal>\n                    </goals>\n                </execution>\n            </executions>\n        </plugin>\n    </plugins>\n</build>\n\n```\n\n通过该插件，我们可以在执行 `mvn clean` 命令时将项目所需要的依赖自动安装进本地仓库","slug":"解决-Maven-无法自动下载依赖的问题","published":1,"updated":"2019-01-15T09:27:25.256Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjs17mhyj0017pwgtor1u8hjt","content":"<h3 id=\"现象说明\"><a href=\"#现象说明\" class=\"headerlink\" title=\"现象说明\"></a>现象说明</h3><p>无法下载依赖的情况大致有两类：</p>\n<ul>\n<li><p>无法通过 Maven 中央仓库提供的坐标下载（也许是网络环境导致）</p>\n</li>\n<li><p>类库没有上传至中央仓库只能通过官网或其它渠道下载</p>\n</li>\n</ul>\n<h3 id=\"解决思路\"><a href=\"#解决思路\" class=\"headerlink\" title=\"解决思路\"></a>解决思路</h3><ul>\n<li><p>手动管理依赖，将依赖按传统的方式放入 <code>libs</code> 目录中。缺点是需要手动管理依赖版本。</p>\n</li>\n<li><p>将依赖安装到本地仓库中，按照 Maven 下载依赖的优先级，会优先查找本地仓库中的依赖。缺点是协同开发时，其他开发人员会因为本地缺少依赖导致项目启动报错。</p>\n</li>\n</ul>\n<h3 id=\"解决方案\"><a href=\"#解决方案\" class=\"headerlink\" title=\"解决方案\"></a>解决方案</h3><p>以上解决思路虽然都可以解决缺少依赖的问题，但操作起来不太优雅，此时我们可以使用 Maven 提供的插件来解决这个问题</p>\n<p><code>pom.xml</code> 增加插件配置，关键配置如下：</p>\n<pre class=\"line-numbers language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>build</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>plugins</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>plugin</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.apache.maven.plugins<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>maven-install-plugin<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>2.5.2<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>executions</span><span class=\"token punctuation\">></span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>execution</span><span class=\"token punctuation\">></span></span>\n                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>id</span><span class=\"token punctuation\">></span></span>install-external-kaptcha<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>id</span><span class=\"token punctuation\">></span></span>\n                    <span class=\"token comment\" spellcheck=\"true\">&lt;!-- 触发时机：执行 mvn clean 命令时自动触发插件 --></span>\n                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>phase</span><span class=\"token punctuation\">></span></span>clean<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>phase</span><span class=\"token punctuation\">></span></span>\n                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>configuration</span><span class=\"token punctuation\">></span></span>\n                        <span class=\"token comment\" spellcheck=\"true\">&lt;!-- 存放依赖文件的位置 --></span>\n                        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>file</span><span class=\"token punctuation\">></span></span>${project.basedir}/libs/kaptcha-2.3.jar<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>file</span><span class=\"token punctuation\">></span></span>\n                        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>repositoryLayout</span><span class=\"token punctuation\">></span></span>default<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>repositoryLayout</span><span class=\"token punctuation\">></span></span>\n                        <span class=\"token comment\" spellcheck=\"true\">&lt;!-- 自定义 groupId --></span>\n                        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.google.code.kaptcha<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span>\n                        <span class=\"token comment\" spellcheck=\"true\">&lt;!-- 自定义 artifactId --></span>\n                        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>kaptcha<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span>\n                        <span class=\"token comment\" spellcheck=\"true\">&lt;!-- 自定义版本号 --></span>\n                        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>2.3<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span>\n                        <span class=\"token comment\" spellcheck=\"true\">&lt;!-- 打包方式 --></span>\n                        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>packaging</span><span class=\"token punctuation\">></span></span>jar<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>packaging</span><span class=\"token punctuation\">></span></span>\n                        <span class=\"token comment\" spellcheck=\"true\">&lt;!-- 是否自动生成 POM --></span>\n                        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>generatePom</span><span class=\"token punctuation\">></span></span>true<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>generatePom</span><span class=\"token punctuation\">></span></span>\n                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>configuration</span><span class=\"token punctuation\">></span></span>\n                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>goals</span><span class=\"token punctuation\">></span></span>\n                        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>goal</span><span class=\"token punctuation\">></span></span>install-file<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>goal</span><span class=\"token punctuation\">></span></span>\n                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>goals</span><span class=\"token punctuation\">></span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>execution</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>executions</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>plugin</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>plugins</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>build</span><span class=\"token punctuation\">></span></span>\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>通过该插件，我们可以在执行 <code>mvn clean</code> 命令时将项目所需要的依赖自动安装进本地仓库</p>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"现象说明\"><a href=\"#现象说明\" class=\"headerlink\" title=\"现象说明\"></a>现象说明</h3><p>无法下载依赖的情况大致有两类：</p>\n<ul>\n<li><p>无法通过 Maven 中央仓库提供的坐标下载（也许是网络环境导致）</p>\n</li>\n<li><p>类库没有上传至中央仓库只能通过官网或其它渠道下载</p>\n</li>\n</ul>\n<h3 id=\"解决思路\"><a href=\"#解决思路\" class=\"headerlink\" title=\"解决思路\"></a>解决思路</h3><ul>\n<li><p>手动管理依赖，将依赖按传统的方式放入 <code>libs</code> 目录中。缺点是需要手动管理依赖版本。</p>\n</li>\n<li><p>将依赖安装到本地仓库中，按照 Maven 下载依赖的优先级，会优先查找本地仓库中的依赖。缺点是协同开发时，其他开发人员会因为本地缺少依赖导致项目启动报错。</p>\n</li>\n</ul>\n<h3 id=\"解决方案\"><a href=\"#解决方案\" class=\"headerlink\" title=\"解决方案\"></a>解决方案</h3><p>以上解决思路虽然都可以解决缺少依赖的问题，但操作起来不太优雅，此时我们可以使用 Maven 提供的插件来解决这个问题</p>\n<p><code>pom.xml</code> 增加插件配置，关键配置如下：</p>\n<pre><code class=\"xml\">&lt;build&gt;\n    &lt;plugins&gt;\n        &lt;plugin&gt;\n            &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n            &lt;artifactId&gt;maven-install-plugin&lt;/artifactId&gt;\n            &lt;version&gt;2.5.2&lt;/version&gt;\n            &lt;executions&gt;\n                &lt;execution&gt;\n                    &lt;id&gt;install-external-kaptcha&lt;/id&gt;\n                    &lt;!-- 触发时机：执行 mvn clean 命令时自动触发插件 --&gt;\n                    &lt;phase&gt;clean&lt;/phase&gt;\n                    &lt;configuration&gt;\n                        &lt;!-- 存放依赖文件的位置 --&gt;\n                        &lt;file&gt;${project.basedir}/libs/kaptcha-2.3.jar&lt;/file&gt;\n                        &lt;repositoryLayout&gt;default&lt;/repositoryLayout&gt;\n                        &lt;!-- 自定义 groupId --&gt;\n                        &lt;groupId&gt;com.google.code.kaptcha&lt;/groupId&gt;\n                        &lt;!-- 自定义 artifactId --&gt;\n                        &lt;artifactId&gt;kaptcha&lt;/artifactId&gt;\n                        &lt;!-- 自定义版本号 --&gt;\n                        &lt;version&gt;2.3&lt;/version&gt;\n                        &lt;!-- 打包方式 --&gt;\n                        &lt;packaging&gt;jar&lt;/packaging&gt;\n                        &lt;!-- 是否自动生成 POM --&gt;\n                        &lt;generatePom&gt;true&lt;/generatePom&gt;\n                    &lt;/configuration&gt;\n                    &lt;goals&gt;\n                        &lt;goal&gt;install-file&lt;/goal&gt;\n                    &lt;/goals&gt;\n                &lt;/execution&gt;\n            &lt;/executions&gt;\n        &lt;/plugin&gt;\n    &lt;/plugins&gt;\n&lt;/build&gt;\n\n</code></pre>\n<p>通过该插件，我们可以在执行 <code>mvn clean</code> 命令时将项目所需要的依赖自动安装进本地仓库</p>\n"},{"title":"新建分类示例","author":"Asia Cui","date":"2018-12-29T02:18:00.000Z","_content":"### 新建分类 categories 页\ncategories页是用来展示所有分类的页面，如果在你的博客source目录下还没有categories/index.md文件，那么你就需要新建一个，命令如下：\n\nhexo new page \"categories\"\n编辑你刚刚新建的页面文件/source/categories/index.md，至少需要以下内容：\n\n\n```yml\n---\ntitle: categories\ndate: 2018-09-30 17:25:30\ntype: \"categories\"\nlayout: \"categories\"\n---\n```\n\n\n## 新建标签 tags 页\ntags页是用来展示所有标签的页面，如果在你的博客source目录下还没有tags/index.md文件，那么你就需要新建一个，命令如下：\n\nhexo new page \"tags\"\n编辑你刚刚新建的页面文件/source/tags/index.md，至少需要以下内容：\n\n\n```yml\n---\ntitle: tags\ndate: 2018-09-30 18:23:38\ntype: \"tags\"\nlayout: \"tags\"\n---\n```\n\n# 新建关于我 about 页\nabout页是用来展示关于我和我的博客信息的页面，如果在你的博客source目录下还没有about/index.md文件，那么你就需要新建一个，命令如下：\n\nhexo new page \"about\"\n编辑你刚刚新建的页面文件/source/about/index.md，至少需要以下内容：\n\n\n```yml\n---\ntitle: about\ndate: 2018-09-30 17:25:30\ntype: \"about\"\n\nlayout: \"about\"\n---\n```\n# 代码语法高亮标识\n* .properties - properties\n* 6502 Assembly - asm6502\n* ABAP - abap\n* ActionScript - actionscript\n* Ada - ada\n* Apache Configuration - apacheconf\n* APL - apl\n* AppleScript - applescript\n* Arduino - arduino\n* ARFF - arff\n* AsciiDoc - asciidoc\n* ASP.NET (C#) - aspnet\n* AutoHotkey - autohotkey\n* AutoIt - autoit\n* Bash - bash, shell\n* BASIC - basic\n* Batch - batch\n* Bison - bison\n* Brainfuck - brainfuck\n* Bro - bro\n* C - c\n* C# - csharp, dotnet\n* C++ - cpp\n* CIL - cil\n* C-like - clike\n* Clojure - clojure\n* CoffeeScript - coffeescript\n* Content-Security-Policy - csp\n* Crystal - crystal\n* CSS - css\n* CSS Extras - css-extras\n* D - d\n* Dart - dart\n* Diff - diff\n* Django/Jinja2 - django, jinja2\n* Docker - docker, dockerfile\n* Eiffel - eiffel\n* Elixir - elixir\n* Elm - elm\n* ERB - erb\n* Erlang - erlang\n* F# - fsharp\n* Flow - flow\n* Fortran - fortran\n* GameMaker Language - gml, gamemakerlanguage\n* G-code - gcode\n* GEDCOM - gedcom\n* Gherkin - gherkin\n* Git - git\n* GLSL - glsl\n* Go - go\n* GraphQL - graphql\n* Groovy - groovy\n* Haml - haml\n* Handlebars - handlebars\n* Haskell - haskell\n* Haxe - haxe\n* HCL - hcl\n* HTTP - http\n* HTTP Public-Key-Pins - hpkp\n* HTTP Strict-Transport-Security - hsts\n* IchigoJam - ichigojam\n* Icon - icon\n* Inform 7 - inform7\n* Ini - ini\n* Io - io\n* J - j\n* Java - java\n* Java stack trace - javastacktrace\n* JavaScript - javascript, js\n* Jolie - jolie\n* JSON - json, jsonp\n* Julia - julia\n* Keyman - keyman\n* Kotlin - kotlin\n* LaTeX - latex\n* Less - less\n* Liquid - liquid\n* Lisp - lisp, emacs, elisp, emacs-lisp\n* LiveScript - livescript\n* LOLCODE - lolcode\n* Lua - lua\n* Makefile - makefile\n* Markdown - markdown\n* Markup - markup, html, xml, svg, mathml\n* Markup templating - markup-templating\n* MATLAB - matlab\n* MEL - mel\n* Mizar - mizar\n* Monkey - monkey\n* N4JS - n4js, n4jsd\n* NASM - nasm\n* nginx - nginx\n* Nim - nim\n* Nix - nix\n* NSIS - nsis\n* Objective-C - objectivec\n* OCaml - ocaml\n* OpenCL - opencl\n* Oz - oz\n* PARI/GP - parigp\n* Parser - parser\n* Pascal - pascal, objectpascal\n* Perl - perl\n* PHP - php\n* PHP Extras - php-extras\n* PL/SQL - plsql\n* PowerShell - powershell\n* Processing - processing\n* Prolog - prolog\n* Protocol Buffers - protobuf\n* Pug - pug\n* Puppet - puppet\n* Pure - pure\n* Python - python\n* Q (kdb+ database) - q\n* Qore - qore\n* R - r\n* React JSX - jsx\n* React TSX - tsx\n* Reason - reason\n* Ren'py - renpy\n* reST (reStructuredText) - rest\n* Rip - rip\n* Roboconf - roboconf\n* Ruby - ruby\n* Rust - rust\n* SAS - sas\n* Sass (Sass) - sass\n* Sass (Scss) - scss\n* Scala - scala\n* Scheme - scheme\n* Smalltalk - smalltalk\n* Smarty - smarty\n* Soy (Closure Template) - soy\n* SQL - sql\n* Stylus - stylus\n* Swift - swift\n* TAP - tap\n* Tcl - tcl\n* Template Toolkit 2 - tt2\n* Textile - textile\n* TOML - toml\n* Twig - twig\n* TypeScript - typescript, ts\n* Vala - vala\n* VB.Net - vbnet\n* Velocity - velocity\n* Verilog - verilog\n* VHDL - vhdl\n* vim - vim\n* Visual Basic - visual-basic, vb\n* WebAssembly - wasm\n* Wiki markup - wiki\n* Xeora - xeora, xeoracube\n* Xojo (REALbasic) - xojo\n* XQuery - xquery\n* YAML - yaml","source":"_posts/示例.md","raw":"title: 新建分类示例\nauthor: Asia Cui\ntags:\n  - 文章\ncategories:\n  - 新建文章格式\ndate: 2018-12-29 10:18:00\n---\n### 新建分类 categories 页\ncategories页是用来展示所有分类的页面，如果在你的博客source目录下还没有categories/index.md文件，那么你就需要新建一个，命令如下：\n\nhexo new page \"categories\"\n编辑你刚刚新建的页面文件/source/categories/index.md，至少需要以下内容：\n\n\n```yml\n---\ntitle: categories\ndate: 2018-09-30 17:25:30\ntype: \"categories\"\nlayout: \"categories\"\n---\n```\n\n\n## 新建标签 tags 页\ntags页是用来展示所有标签的页面，如果在你的博客source目录下还没有tags/index.md文件，那么你就需要新建一个，命令如下：\n\nhexo new page \"tags\"\n编辑你刚刚新建的页面文件/source/tags/index.md，至少需要以下内容：\n\n\n```yml\n---\ntitle: tags\ndate: 2018-09-30 18:23:38\ntype: \"tags\"\nlayout: \"tags\"\n---\n```\n\n# 新建关于我 about 页\nabout页是用来展示关于我和我的博客信息的页面，如果在你的博客source目录下还没有about/index.md文件，那么你就需要新建一个，命令如下：\n\nhexo new page \"about\"\n编辑你刚刚新建的页面文件/source/about/index.md，至少需要以下内容：\n\n\n```yml\n---\ntitle: about\ndate: 2018-09-30 17:25:30\ntype: \"about\"\n\nlayout: \"about\"\n---\n```\n# 代码语法高亮标识\n* .properties - properties\n* 6502 Assembly - asm6502\n* ABAP - abap\n* ActionScript - actionscript\n* Ada - ada\n* Apache Configuration - apacheconf\n* APL - apl\n* AppleScript - applescript\n* Arduino - arduino\n* ARFF - arff\n* AsciiDoc - asciidoc\n* ASP.NET (C#) - aspnet\n* AutoHotkey - autohotkey\n* AutoIt - autoit\n* Bash - bash, shell\n* BASIC - basic\n* Batch - batch\n* Bison - bison\n* Brainfuck - brainfuck\n* Bro - bro\n* C - c\n* C# - csharp, dotnet\n* C++ - cpp\n* CIL - cil\n* C-like - clike\n* Clojure - clojure\n* CoffeeScript - coffeescript\n* Content-Security-Policy - csp\n* Crystal - crystal\n* CSS - css\n* CSS Extras - css-extras\n* D - d\n* Dart - dart\n* Diff - diff\n* Django/Jinja2 - django, jinja2\n* Docker - docker, dockerfile\n* Eiffel - eiffel\n* Elixir - elixir\n* Elm - elm\n* ERB - erb\n* Erlang - erlang\n* F# - fsharp\n* Flow - flow\n* Fortran - fortran\n* GameMaker Language - gml, gamemakerlanguage\n* G-code - gcode\n* GEDCOM - gedcom\n* Gherkin - gherkin\n* Git - git\n* GLSL - glsl\n* Go - go\n* GraphQL - graphql\n* Groovy - groovy\n* Haml - haml\n* Handlebars - handlebars\n* Haskell - haskell\n* Haxe - haxe\n* HCL - hcl\n* HTTP - http\n* HTTP Public-Key-Pins - hpkp\n* HTTP Strict-Transport-Security - hsts\n* IchigoJam - ichigojam\n* Icon - icon\n* Inform 7 - inform7\n* Ini - ini\n* Io - io\n* J - j\n* Java - java\n* Java stack trace - javastacktrace\n* JavaScript - javascript, js\n* Jolie - jolie\n* JSON - json, jsonp\n* Julia - julia\n* Keyman - keyman\n* Kotlin - kotlin\n* LaTeX - latex\n* Less - less\n* Liquid - liquid\n* Lisp - lisp, emacs, elisp, emacs-lisp\n* LiveScript - livescript\n* LOLCODE - lolcode\n* Lua - lua\n* Makefile - makefile\n* Markdown - markdown\n* Markup - markup, html, xml, svg, mathml\n* Markup templating - markup-templating\n* MATLAB - matlab\n* MEL - mel\n* Mizar - mizar\n* Monkey - monkey\n* N4JS - n4js, n4jsd\n* NASM - nasm\n* nginx - nginx\n* Nim - nim\n* Nix - nix\n* NSIS - nsis\n* Objective-C - objectivec\n* OCaml - ocaml\n* OpenCL - opencl\n* Oz - oz\n* PARI/GP - parigp\n* Parser - parser\n* Pascal - pascal, objectpascal\n* Perl - perl\n* PHP - php\n* PHP Extras - php-extras\n* PL/SQL - plsql\n* PowerShell - powershell\n* Processing - processing\n* Prolog - prolog\n* Protocol Buffers - protobuf\n* Pug - pug\n* Puppet - puppet\n* Pure - pure\n* Python - python\n* Q (kdb+ database) - q\n* Qore - qore\n* R - r\n* React JSX - jsx\n* React TSX - tsx\n* Reason - reason\n* Ren'py - renpy\n* reST (reStructuredText) - rest\n* Rip - rip\n* Roboconf - roboconf\n* Ruby - ruby\n* Rust - rust\n* SAS - sas\n* Sass (Sass) - sass\n* Sass (Scss) - scss\n* Scala - scala\n* Scheme - scheme\n* Smalltalk - smalltalk\n* Smarty - smarty\n* Soy (Closure Template) - soy\n* SQL - sql\n* Stylus - stylus\n* Swift - swift\n* TAP - tap\n* Tcl - tcl\n* Template Toolkit 2 - tt2\n* Textile - textile\n* TOML - toml\n* Twig - twig\n* TypeScript - typescript, ts\n* Vala - vala\n* VB.Net - vbnet\n* Velocity - velocity\n* Verilog - verilog\n* VHDL - vhdl\n* vim - vim\n* Visual Basic - visual-basic, vb\n* WebAssembly - wasm\n* Wiki markup - wiki\n* Xeora - xeora, xeoracube\n* Xojo (REALbasic) - xojo\n* XQuery - xquery\n* YAML - yaml","slug":"示例","published":1,"updated":"2019-01-02T09:56:51.189Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjs17mhyk0019pwgtblrtjtyv","content":"<h3 id=\"新建分类-categories-页\"><a href=\"#新建分类-categories-页\" class=\"headerlink\" title=\"新建分类 categories 页\"></a>新建分类 categories 页</h3><p>categories页是用来展示所有分类的页面，如果在你的博客source目录下还没有categories/index.md文件，那么你就需要新建一个，命令如下：</p>\n<p>hexo new page “categories”<br>编辑你刚刚新建的页面文件/source/categories/index.md，至少需要以下内容：</p>\n<pre class=\"line-numbers language-yml\"><code class=\"language-yml\">---\ntitle: categories\ndate: 2018-09-30 17:25:30\ntype: \"categories\"\nlayout: \"categories\"\n---\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h2 id=\"新建标签-tags-页\"><a href=\"#新建标签-tags-页\" class=\"headerlink\" title=\"新建标签 tags 页\"></a>新建标签 tags 页</h2><p>tags页是用来展示所有标签的页面，如果在你的博客source目录下还没有tags/index.md文件，那么你就需要新建一个，命令如下：</p>\n<p>hexo new page “tags”<br>编辑你刚刚新建的页面文件/source/tags/index.md，至少需要以下内容：</p>\n<pre class=\"line-numbers language-yml\"><code class=\"language-yml\">---\ntitle: tags\ndate: 2018-09-30 18:23:38\ntype: \"tags\"\nlayout: \"tags\"\n---\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h1 id=\"新建关于我-about-页\"><a href=\"#新建关于我-about-页\" class=\"headerlink\" title=\"新建关于我 about 页\"></a>新建关于我 about 页</h1><p>about页是用来展示关于我和我的博客信息的页面，如果在你的博客source目录下还没有about/index.md文件，那么你就需要新建一个，命令如下：</p>\n<p>hexo new page “about”<br>编辑你刚刚新建的页面文件/source/about/index.md，至少需要以下内容：</p>\n<pre class=\"line-numbers language-yml\"><code class=\"language-yml\">---\ntitle: about\ndate: 2018-09-30 17:25:30\ntype: \"about\"\n\nlayout: \"about\"\n---\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h1 id=\"代码语法高亮标识\"><a href=\"#代码语法高亮标识\" class=\"headerlink\" title=\"代码语法高亮标识\"></a>代码语法高亮标识</h1><ul>\n<li>.properties - properties</li>\n<li>6502 Assembly - asm6502</li>\n<li>ABAP - abap</li>\n<li>ActionScript - actionscript</li>\n<li>Ada - ada</li>\n<li>Apache Configuration - apacheconf</li>\n<li>APL - apl</li>\n<li>AppleScript - applescript</li>\n<li>Arduino - arduino</li>\n<li>ARFF - arff</li>\n<li>AsciiDoc - asciidoc</li>\n<li>ASP.NET (C#) - aspnet</li>\n<li>AutoHotkey - autohotkey</li>\n<li>AutoIt - autoit</li>\n<li>Bash - bash, shell</li>\n<li>BASIC - basic</li>\n<li>Batch - batch</li>\n<li>Bison - bison</li>\n<li>Brainfuck - brainfuck</li>\n<li>Bro - bro</li>\n<li>C - c</li>\n<li>C# - csharp, dotnet</li>\n<li>C++ - cpp</li>\n<li>CIL - cil</li>\n<li>C-like - clike</li>\n<li>Clojure - clojure</li>\n<li>CoffeeScript - coffeescript</li>\n<li>Content-Security-Policy - csp</li>\n<li>Crystal - crystal</li>\n<li>CSS - css</li>\n<li>CSS Extras - css-extras</li>\n<li>D - d</li>\n<li>Dart - dart</li>\n<li>Diff - diff</li>\n<li>Django/Jinja2 - django, jinja2</li>\n<li>Docker - docker, dockerfile</li>\n<li>Eiffel - eiffel</li>\n<li>Elixir - elixir</li>\n<li>Elm - elm</li>\n<li>ERB - erb</li>\n<li>Erlang - erlang</li>\n<li>F# - fsharp</li>\n<li>Flow - flow</li>\n<li>Fortran - fortran</li>\n<li>GameMaker Language - gml, gamemakerlanguage</li>\n<li>G-code - gcode</li>\n<li>GEDCOM - gedcom</li>\n<li>Gherkin - gherkin</li>\n<li>Git - git</li>\n<li>GLSL - glsl</li>\n<li>Go - go</li>\n<li>GraphQL - graphql</li>\n<li>Groovy - groovy</li>\n<li>Haml - haml</li>\n<li>Handlebars - handlebars</li>\n<li>Haskell - haskell</li>\n<li>Haxe - haxe</li>\n<li>HCL - hcl</li>\n<li>HTTP - http</li>\n<li>HTTP Public-Key-Pins - hpkp</li>\n<li>HTTP Strict-Transport-Security - hsts</li>\n<li>IchigoJam - ichigojam</li>\n<li>Icon - icon</li>\n<li>Inform 7 - inform7</li>\n<li>Ini - ini</li>\n<li>Io - io</li>\n<li>J - j</li>\n<li>Java - java</li>\n<li>Java stack trace - javastacktrace</li>\n<li>JavaScript - javascript, js</li>\n<li>Jolie - jolie</li>\n<li>JSON - json, jsonp</li>\n<li>Julia - julia</li>\n<li>Keyman - keyman</li>\n<li>Kotlin - kotlin</li>\n<li>LaTeX - latex</li>\n<li>Less - less</li>\n<li>Liquid - liquid</li>\n<li>Lisp - lisp, emacs, elisp, emacs-lisp</li>\n<li>LiveScript - livescript</li>\n<li>LOLCODE - lolcode</li>\n<li>Lua - lua</li>\n<li>Makefile - makefile</li>\n<li>Markdown - markdown</li>\n<li>Markup - markup, html, xml, svg, mathml</li>\n<li>Markup templating - markup-templating</li>\n<li>MATLAB - matlab</li>\n<li>MEL - mel</li>\n<li>Mizar - mizar</li>\n<li>Monkey - monkey</li>\n<li>N4JS - n4js, n4jsd</li>\n<li>NASM - nasm</li>\n<li>nginx - nginx</li>\n<li>Nim - nim</li>\n<li>Nix - nix</li>\n<li>NSIS - nsis</li>\n<li>Objective-C - objectivec</li>\n<li>OCaml - ocaml</li>\n<li>OpenCL - opencl</li>\n<li>Oz - oz</li>\n<li>PARI/GP - parigp</li>\n<li>Parser - parser</li>\n<li>Pascal - pascal, objectpascal</li>\n<li>Perl - perl</li>\n<li>PHP - php</li>\n<li>PHP Extras - php-extras</li>\n<li>PL/SQL - plsql</li>\n<li>PowerShell - powershell</li>\n<li>Processing - processing</li>\n<li>Prolog - prolog</li>\n<li>Protocol Buffers - protobuf</li>\n<li>Pug - pug</li>\n<li>Puppet - puppet</li>\n<li>Pure - pure</li>\n<li>Python - python</li>\n<li>Q (kdb+ database) - q</li>\n<li>Qore - qore</li>\n<li>R - r</li>\n<li>React JSX - jsx</li>\n<li>React TSX - tsx</li>\n<li>Reason - reason</li>\n<li>Ren’py - renpy</li>\n<li>reST (reStructuredText) - rest</li>\n<li>Rip - rip</li>\n<li>Roboconf - roboconf</li>\n<li>Ruby - ruby</li>\n<li>Rust - rust</li>\n<li>SAS - sas</li>\n<li>Sass (Sass) - sass</li>\n<li>Sass (Scss) - scss</li>\n<li>Scala - scala</li>\n<li>Scheme - scheme</li>\n<li>Smalltalk - smalltalk</li>\n<li>Smarty - smarty</li>\n<li>Soy (Closure Template) - soy</li>\n<li>SQL - sql</li>\n<li>Stylus - stylus</li>\n<li>Swift - swift</li>\n<li>TAP - tap</li>\n<li>Tcl - tcl</li>\n<li>Template Toolkit 2 - tt2</li>\n<li>Textile - textile</li>\n<li>TOML - toml</li>\n<li>Twig - twig</li>\n<li>TypeScript - typescript, ts</li>\n<li>Vala - vala</li>\n<li>VB.Net - vbnet</li>\n<li>Velocity - velocity</li>\n<li>Verilog - verilog</li>\n<li>VHDL - vhdl</li>\n<li>vim - vim</li>\n<li>Visual Basic - visual-basic, vb</li>\n<li>WebAssembly - wasm</li>\n<li>Wiki markup - wiki</li>\n<li>Xeora - xeora, xeoracube</li>\n<li>Xojo (REALbasic) - xojo</li>\n<li>XQuery - xquery</li>\n<li>YAML - yaml</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"新建分类-categories-页\"><a href=\"#新建分类-categories-页\" class=\"headerlink\" title=\"新建分类 categories 页\"></a>新建分类 categories 页</h3><p>categories页是用来展示所有分类的页面，如果在你的博客source目录下还没有categories/index.md文件，那么你就需要新建一个，命令如下：</p>\n<p>hexo new page “categories”<br>编辑你刚刚新建的页面文件/source/categories/index.md，至少需要以下内容：</p>\n<pre><code class=\"yml\">---\ntitle: categories\ndate: 2018-09-30 17:25:30\ntype: &quot;categories&quot;\nlayout: &quot;categories&quot;\n---\n</code></pre>\n<h2 id=\"新建标签-tags-页\"><a href=\"#新建标签-tags-页\" class=\"headerlink\" title=\"新建标签 tags 页\"></a>新建标签 tags 页</h2><p>tags页是用来展示所有标签的页面，如果在你的博客source目录下还没有tags/index.md文件，那么你就需要新建一个，命令如下：</p>\n<p>hexo new page “tags”<br>编辑你刚刚新建的页面文件/source/tags/index.md，至少需要以下内容：</p>\n<pre><code class=\"yml\">---\ntitle: tags\ndate: 2018-09-30 18:23:38\ntype: &quot;tags&quot;\nlayout: &quot;tags&quot;\n---\n</code></pre>\n<h1 id=\"新建关于我-about-页\"><a href=\"#新建关于我-about-页\" class=\"headerlink\" title=\"新建关于我 about 页\"></a>新建关于我 about 页</h1><p>about页是用来展示关于我和我的博客信息的页面，如果在你的博客source目录下还没有about/index.md文件，那么你就需要新建一个，命令如下：</p>\n<p>hexo new page “about”<br>编辑你刚刚新建的页面文件/source/about/index.md，至少需要以下内容：</p>\n<pre><code class=\"yml\">---\ntitle: about\ndate: 2018-09-30 17:25:30\ntype: &quot;about&quot;\n\nlayout: &quot;about&quot;\n---\n</code></pre>\n<h1 id=\"代码语法高亮标识\"><a href=\"#代码语法高亮标识\" class=\"headerlink\" title=\"代码语法高亮标识\"></a>代码语法高亮标识</h1><ul>\n<li>.properties - properties</li>\n<li>6502 Assembly - asm6502</li>\n<li>ABAP - abap</li>\n<li>ActionScript - actionscript</li>\n<li>Ada - ada</li>\n<li>Apache Configuration - apacheconf</li>\n<li>APL - apl</li>\n<li>AppleScript - applescript</li>\n<li>Arduino - arduino</li>\n<li>ARFF - arff</li>\n<li>AsciiDoc - asciidoc</li>\n<li>ASP.NET (C#) - aspnet</li>\n<li>AutoHotkey - autohotkey</li>\n<li>AutoIt - autoit</li>\n<li>Bash - bash, shell</li>\n<li>BASIC - basic</li>\n<li>Batch - batch</li>\n<li>Bison - bison</li>\n<li>Brainfuck - brainfuck</li>\n<li>Bro - bro</li>\n<li>C - c</li>\n<li>C# - csharp, dotnet</li>\n<li>C++ - cpp</li>\n<li>CIL - cil</li>\n<li>C-like - clike</li>\n<li>Clojure - clojure</li>\n<li>CoffeeScript - coffeescript</li>\n<li>Content-Security-Policy - csp</li>\n<li>Crystal - crystal</li>\n<li>CSS - css</li>\n<li>CSS Extras - css-extras</li>\n<li>D - d</li>\n<li>Dart - dart</li>\n<li>Diff - diff</li>\n<li>Django/Jinja2 - django, jinja2</li>\n<li>Docker - docker, dockerfile</li>\n<li>Eiffel - eiffel</li>\n<li>Elixir - elixir</li>\n<li>Elm - elm</li>\n<li>ERB - erb</li>\n<li>Erlang - erlang</li>\n<li>F# - fsharp</li>\n<li>Flow - flow</li>\n<li>Fortran - fortran</li>\n<li>GameMaker Language - gml, gamemakerlanguage</li>\n<li>G-code - gcode</li>\n<li>GEDCOM - gedcom</li>\n<li>Gherkin - gherkin</li>\n<li>Git - git</li>\n<li>GLSL - glsl</li>\n<li>Go - go</li>\n<li>GraphQL - graphql</li>\n<li>Groovy - groovy</li>\n<li>Haml - haml</li>\n<li>Handlebars - handlebars</li>\n<li>Haskell - haskell</li>\n<li>Haxe - haxe</li>\n<li>HCL - hcl</li>\n<li>HTTP - http</li>\n<li>HTTP Public-Key-Pins - hpkp</li>\n<li>HTTP Strict-Transport-Security - hsts</li>\n<li>IchigoJam - ichigojam</li>\n<li>Icon - icon</li>\n<li>Inform 7 - inform7</li>\n<li>Ini - ini</li>\n<li>Io - io</li>\n<li>J - j</li>\n<li>Java - java</li>\n<li>Java stack trace - javastacktrace</li>\n<li>JavaScript - javascript, js</li>\n<li>Jolie - jolie</li>\n<li>JSON - json, jsonp</li>\n<li>Julia - julia</li>\n<li>Keyman - keyman</li>\n<li>Kotlin - kotlin</li>\n<li>LaTeX - latex</li>\n<li>Less - less</li>\n<li>Liquid - liquid</li>\n<li>Lisp - lisp, emacs, elisp, emacs-lisp</li>\n<li>LiveScript - livescript</li>\n<li>LOLCODE - lolcode</li>\n<li>Lua - lua</li>\n<li>Makefile - makefile</li>\n<li>Markdown - markdown</li>\n<li>Markup - markup, html, xml, svg, mathml</li>\n<li>Markup templating - markup-templating</li>\n<li>MATLAB - matlab</li>\n<li>MEL - mel</li>\n<li>Mizar - mizar</li>\n<li>Monkey - monkey</li>\n<li>N4JS - n4js, n4jsd</li>\n<li>NASM - nasm</li>\n<li>nginx - nginx</li>\n<li>Nim - nim</li>\n<li>Nix - nix</li>\n<li>NSIS - nsis</li>\n<li>Objective-C - objectivec</li>\n<li>OCaml - ocaml</li>\n<li>OpenCL - opencl</li>\n<li>Oz - oz</li>\n<li>PARI/GP - parigp</li>\n<li>Parser - parser</li>\n<li>Pascal - pascal, objectpascal</li>\n<li>Perl - perl</li>\n<li>PHP - php</li>\n<li>PHP Extras - php-extras</li>\n<li>PL/SQL - plsql</li>\n<li>PowerShell - powershell</li>\n<li>Processing - processing</li>\n<li>Prolog - prolog</li>\n<li>Protocol Buffers - protobuf</li>\n<li>Pug - pug</li>\n<li>Puppet - puppet</li>\n<li>Pure - pure</li>\n<li>Python - python</li>\n<li>Q (kdb+ database) - q</li>\n<li>Qore - qore</li>\n<li>R - r</li>\n<li>React JSX - jsx</li>\n<li>React TSX - tsx</li>\n<li>Reason - reason</li>\n<li>Ren’py - renpy</li>\n<li>reST (reStructuredText) - rest</li>\n<li>Rip - rip</li>\n<li>Roboconf - roboconf</li>\n<li>Ruby - ruby</li>\n<li>Rust - rust</li>\n<li>SAS - sas</li>\n<li>Sass (Sass) - sass</li>\n<li>Sass (Scss) - scss</li>\n<li>Scala - scala</li>\n<li>Scheme - scheme</li>\n<li>Smalltalk - smalltalk</li>\n<li>Smarty - smarty</li>\n<li>Soy (Closure Template) - soy</li>\n<li>SQL - sql</li>\n<li>Stylus - stylus</li>\n<li>Swift - swift</li>\n<li>TAP - tap</li>\n<li>Tcl - tcl</li>\n<li>Template Toolkit 2 - tt2</li>\n<li>Textile - textile</li>\n<li>TOML - toml</li>\n<li>Twig - twig</li>\n<li>TypeScript - typescript, ts</li>\n<li>Vala - vala</li>\n<li>VB.Net - vbnet</li>\n<li>Velocity - velocity</li>\n<li>Verilog - verilog</li>\n<li>VHDL - vhdl</li>\n<li>vim - vim</li>\n<li>Visual Basic - visual-basic, vb</li>\n<li>WebAssembly - wasm</li>\n<li>Wiki markup - wiki</li>\n<li>Xeora - xeora, xeoracube</li>\n<li>Xojo (REALbasic) - xojo</li>\n<li>XQuery - xquery</li>\n<li>YAML - yaml</li>\n</ul>\n"},{"title":"跨域解决方案","author":"Asia Cui","date":"2019-01-18T02:04:00.000Z","_content":"## 跨域简介\n在浏览器端进行 Ajax 请求时会出现跨域问题，那么什么是跨域，如何解决跨域呢？先看浏览器端出现跨域问题的现象，如下图所示\n\n![](/images/跨域/clipboard.png)\n\n## 什么是跨域问题？\n\n跨域，指的是浏览器不能执行其他网站的脚本。它是由浏览器的同源策略造成的，是浏览器对 JavaScript 施加的安全限制。\n\n## 什么是同源？\n\n所谓同源是指，域名，协议，端口均相同\n\n*   http://www.asia.com –> http://admin.asia.com 跨域\n*   http://www.asia.com –> http://www.asia.com 非跨域\n*   http://www.asia.com –> http://www.asia.com:8080 跨域\n*   http://www.asia.com –> https://www.asia.com 跨域\n\n## 如何解决跨域问题？\n\n### 使用 CORS（跨资源共享）解决跨域问题\n\nCORS 是一个 W3C 标准，全称是” 跨域资源共享”（Cross-origin resource sharing）。它允许浏览器向跨源服务器，发出 XMLHttpRequest 请求，从而克服了 AJAX 只能同源使用的限制。\n\nCORS 需要浏览器和服务器同时支持。目前，所有浏览器都支持该功能，IE 浏览器不能低于 IE10。整个 CORS 通信过程，都是浏览器自动完成，不需要用户参与。对于开发者来说，CORS 通信与同源的 AJAX 通信没有差别，代码完全一样。浏览器一旦发现 AJAX 请求跨源，就会自动添加一些附加的头信息，有时还会多出一次附加的请求，但用户不会有感觉。因此，实现 CORS 通信的关键是服务器。只要服务器实现了 CORS 接口，就可以跨源通信（在 `header` 中设置：`Access-Control-Allow-Origin`）\n\n### 使用 JSONP 解决跨域问题\n\nJSONP（JSON with Padding）是 JSON 的一种 “使用模式”，可用于解决主流浏览器的跨域数据访问的问题。由于同源策略，一般来说位于 `server1.example.com` 的网页无法与 `server2.example.com` 的服务器沟通，而 HTML 的 `<script>` 元素是一个例外。利用 `<script>` 元素的这个开放策略，网页可以得到从其他来源动态产生的 JSON 资料，而这种使用模式就是所谓的 JSONP。用 JSONP 抓到的资料并不是 JSON，而是任意的 JavaScript，用 JavaScript 直译器执行而不是用 JSON 解析器解析（需要目标服务器配合一个 `callback` 函数）。\n\n### CORS 与 JSONP 的比较\n\nCORS 与 JSONP 的使用目的相同，但是比 JSONP 更强大。\n\nJSONP 只支持 GET 请求，CORS 支持所有类型的 HTTP 请求。JSONP 的优势在于支持老式浏览器，以及可以向不支持 CORS 的网站请求数据。\n\n### 使用 Nginx 反向代理解决跨域问题\n\n以上跨域问题解决方案都需要服务器支持，当服务器无法设置 `header` 或提供 `callback` 时我们就可以采用 Nginx 反向代理的方式解决跨域问题。\n\nNginx 配置跨域案例，在 `nginx.conf` 的 `location` 中增加如下配置：\n\n```nginx\nadd_header Access-Control-Allow-Origin *或域名;\nadd_header Access-Control-Allow-Headers X-Requested-With;\nadd_header Access-Control-Allow-Methods GET,POST,OPTIONS;\n\n```\n\n如：\n\n```nginx\nuser  nginx;\nworker_processes  1;\n\nevents {\n    worker_connections  1024;\n}\n\nhttp {\n    include       mime.types;\n    default_type  application/octet-stream;\n\n    sendfile        on;\n\n    keepalive_timeout  65;\n\n    server {\n        listen 80;\n        server_name 192.168.75.128;\n        location / {\n            add_header Access-Control-Allow-Origin *;\n            add_header Access-Control-Allow-Headers X-Requested-With;\n            add_header Access-Control-Allow-Methods GET,POST,OPTIONS;\n\n            root /usr/share/nginx/wwwroot/cdn;\n            index index.jsp index.html index.htm;\n        }\n    }\n}\n\n```\n\n### Spring Boot代码配置跨域\n\n#### 使用 Java 配置的方式\n\n```java\n/**\n * 跨域配置\n * <p>Title: CorsConfiguration</p>\n * <p>Description: </p>\n *\n * @author Lusifer\n * @version 1.0.0\n * @date 2018/3/8 22:56\n */\n@Configuration\npublic class CORSConfiguration extends WebMvcConfigurerAdapter {\n    @Override\n    public void addCorsMappings(CorsRegistry registry) {\n        registry.addMapping(\"/**\").allowedOrigins(\"*\")\n                .allowedMethods(\"GET\", \"HEAD\", \"POST\", \"PUT\", \"DELETE\", \"OPTIONS\")\n                .allowCredentials(false).maxAge(3600);\n    }\n}\n```\n\n#### 使用注解的方式\n\n```java\n@CrossOrigin(origins = \"*\", maxAge = 3600)\n```\n","source":"_posts/跨域解决方案.md","raw":"title: 跨域解决方案\nauthor: Asia Cui\ntags:\n  - 跨域\ncategories:\n  - 跨域问题解决方案\ndate: 2019-01-18 10:04:00\n---\n## 跨域简介\n在浏览器端进行 Ajax 请求时会出现跨域问题，那么什么是跨域，如何解决跨域呢？先看浏览器端出现跨域问题的现象，如下图所示\n\n![](/images/跨域/clipboard.png)\n\n## 什么是跨域问题？\n\n跨域，指的是浏览器不能执行其他网站的脚本。它是由浏览器的同源策略造成的，是浏览器对 JavaScript 施加的安全限制。\n\n## 什么是同源？\n\n所谓同源是指，域名，协议，端口均相同\n\n*   http://www.asia.com –> http://admin.asia.com 跨域\n*   http://www.asia.com –> http://www.asia.com 非跨域\n*   http://www.asia.com –> http://www.asia.com:8080 跨域\n*   http://www.asia.com –> https://www.asia.com 跨域\n\n## 如何解决跨域问题？\n\n### 使用 CORS（跨资源共享）解决跨域问题\n\nCORS 是一个 W3C 标准，全称是” 跨域资源共享”（Cross-origin resource sharing）。它允许浏览器向跨源服务器，发出 XMLHttpRequest 请求，从而克服了 AJAX 只能同源使用的限制。\n\nCORS 需要浏览器和服务器同时支持。目前，所有浏览器都支持该功能，IE 浏览器不能低于 IE10。整个 CORS 通信过程，都是浏览器自动完成，不需要用户参与。对于开发者来说，CORS 通信与同源的 AJAX 通信没有差别，代码完全一样。浏览器一旦发现 AJAX 请求跨源，就会自动添加一些附加的头信息，有时还会多出一次附加的请求，但用户不会有感觉。因此，实现 CORS 通信的关键是服务器。只要服务器实现了 CORS 接口，就可以跨源通信（在 `header` 中设置：`Access-Control-Allow-Origin`）\n\n### 使用 JSONP 解决跨域问题\n\nJSONP（JSON with Padding）是 JSON 的一种 “使用模式”，可用于解决主流浏览器的跨域数据访问的问题。由于同源策略，一般来说位于 `server1.example.com` 的网页无法与 `server2.example.com` 的服务器沟通，而 HTML 的 `<script>` 元素是一个例外。利用 `<script>` 元素的这个开放策略，网页可以得到从其他来源动态产生的 JSON 资料，而这种使用模式就是所谓的 JSONP。用 JSONP 抓到的资料并不是 JSON，而是任意的 JavaScript，用 JavaScript 直译器执行而不是用 JSON 解析器解析（需要目标服务器配合一个 `callback` 函数）。\n\n### CORS 与 JSONP 的比较\n\nCORS 与 JSONP 的使用目的相同，但是比 JSONP 更强大。\n\nJSONP 只支持 GET 请求，CORS 支持所有类型的 HTTP 请求。JSONP 的优势在于支持老式浏览器，以及可以向不支持 CORS 的网站请求数据。\n\n### 使用 Nginx 反向代理解决跨域问题\n\n以上跨域问题解决方案都需要服务器支持，当服务器无法设置 `header` 或提供 `callback` 时我们就可以采用 Nginx 反向代理的方式解决跨域问题。\n\nNginx 配置跨域案例，在 `nginx.conf` 的 `location` 中增加如下配置：\n\n```nginx\nadd_header Access-Control-Allow-Origin *或域名;\nadd_header Access-Control-Allow-Headers X-Requested-With;\nadd_header Access-Control-Allow-Methods GET,POST,OPTIONS;\n\n```\n\n如：\n\n```nginx\nuser  nginx;\nworker_processes  1;\n\nevents {\n    worker_connections  1024;\n}\n\nhttp {\n    include       mime.types;\n    default_type  application/octet-stream;\n\n    sendfile        on;\n\n    keepalive_timeout  65;\n\n    server {\n        listen 80;\n        server_name 192.168.75.128;\n        location / {\n            add_header Access-Control-Allow-Origin *;\n            add_header Access-Control-Allow-Headers X-Requested-With;\n            add_header Access-Control-Allow-Methods GET,POST,OPTIONS;\n\n            root /usr/share/nginx/wwwroot/cdn;\n            index index.jsp index.html index.htm;\n        }\n    }\n}\n\n```\n\n### Spring Boot代码配置跨域\n\n#### 使用 Java 配置的方式\n\n```java\n/**\n * 跨域配置\n * <p>Title: CorsConfiguration</p>\n * <p>Description: </p>\n *\n * @author Lusifer\n * @version 1.0.0\n * @date 2018/3/8 22:56\n */\n@Configuration\npublic class CORSConfiguration extends WebMvcConfigurerAdapter {\n    @Override\n    public void addCorsMappings(CorsRegistry registry) {\n        registry.addMapping(\"/**\").allowedOrigins(\"*\")\n                .allowedMethods(\"GET\", \"HEAD\", \"POST\", \"PUT\", \"DELETE\", \"OPTIONS\")\n                .allowCredentials(false).maxAge(3600);\n    }\n}\n```\n\n#### 使用注解的方式\n\n```java\n@CrossOrigin(origins = \"*\", maxAge = 3600)\n```\n","slug":"跨域解决方案","published":1,"updated":"2019-01-18T02:12:38.131Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjs17mhyn001epwgt9tcvndgn","content":"<h2 id=\"跨域简介\"><a href=\"#跨域简介\" class=\"headerlink\" title=\"跨域简介\"></a>跨域简介</h2><p>在浏览器端进行 Ajax 请求时会出现跨域问题，那么什么是跨域，如何解决跨域呢？先看浏览器端出现跨域问题的现象，如下图所示</p>\n<p><img src=\"/images/跨域/clipboard.png\" alt=\"\"></p>\n<h2 id=\"什么是跨域问题？\"><a href=\"#什么是跨域问题？\" class=\"headerlink\" title=\"什么是跨域问题？\"></a>什么是跨域问题？</h2><p>跨域，指的是浏览器不能执行其他网站的脚本。它是由浏览器的同源策略造成的，是浏览器对 JavaScript 施加的安全限制。</p>\n<h2 id=\"什么是同源？\"><a href=\"#什么是同源？\" class=\"headerlink\" title=\"什么是同源？\"></a>什么是同源？</h2><p>所谓同源是指，域名，协议，端口均相同</p>\n<ul>\n<li><a href=\"http://www.asia.com\" target=\"_blank\" rel=\"noopener\">http://www.asia.com</a> –&gt; <a href=\"http://admin.asia.com\" target=\"_blank\" rel=\"noopener\">http://admin.asia.com</a> 跨域</li>\n<li><a href=\"http://www.asia.com\" target=\"_blank\" rel=\"noopener\">http://www.asia.com</a> –&gt; <a href=\"http://www.asia.com\" target=\"_blank\" rel=\"noopener\">http://www.asia.com</a> 非跨域</li>\n<li><a href=\"http://www.asia.com\" target=\"_blank\" rel=\"noopener\">http://www.asia.com</a> –&gt; <a href=\"http://www.asia.com:8080\" target=\"_blank\" rel=\"noopener\">http://www.asia.com:8080</a> 跨域</li>\n<li><a href=\"http://www.asia.com\" target=\"_blank\" rel=\"noopener\">http://www.asia.com</a> –&gt; <a href=\"https://www.asia.com\" target=\"_blank\" rel=\"noopener\">https://www.asia.com</a> 跨域</li>\n</ul>\n<h2 id=\"如何解决跨域问题？\"><a href=\"#如何解决跨域问题？\" class=\"headerlink\" title=\"如何解决跨域问题？\"></a>如何解决跨域问题？</h2><h3 id=\"使用-CORS（跨资源共享）解决跨域问题\"><a href=\"#使用-CORS（跨资源共享）解决跨域问题\" class=\"headerlink\" title=\"使用 CORS（跨资源共享）解决跨域问题\"></a>使用 CORS（跨资源共享）解决跨域问题</h3><p>CORS 是一个 W3C 标准，全称是” 跨域资源共享”（Cross-origin resource sharing）。它允许浏览器向跨源服务器，发出 XMLHttpRequest 请求，从而克服了 AJAX 只能同源使用的限制。</p>\n<p>CORS 需要浏览器和服务器同时支持。目前，所有浏览器都支持该功能，IE 浏览器不能低于 IE10。整个 CORS 通信过程，都是浏览器自动完成，不需要用户参与。对于开发者来说，CORS 通信与同源的 AJAX 通信没有差别，代码完全一样。浏览器一旦发现 AJAX 请求跨源，就会自动添加一些附加的头信息，有时还会多出一次附加的请求，但用户不会有感觉。因此，实现 CORS 通信的关键是服务器。只要服务器实现了 CORS 接口，就可以跨源通信（在 <code>header</code> 中设置：<code>Access-Control-Allow-Origin</code>）</p>\n<h3 id=\"使用-JSONP-解决跨域问题\"><a href=\"#使用-JSONP-解决跨域问题\" class=\"headerlink\" title=\"使用 JSONP 解决跨域问题\"></a>使用 JSONP 解决跨域问题</h3><p>JSONP（JSON with Padding）是 JSON 的一种 “使用模式”，可用于解决主流浏览器的跨域数据访问的问题。由于同源策略，一般来说位于 <code>server1.example.com</code> 的网页无法与 <code>server2.example.com</code> 的服务器沟通，而 HTML 的 <code>&lt;script&gt;</code> 元素是一个例外。利用 <code>&lt;script&gt;</code> 元素的这个开放策略，网页可以得到从其他来源动态产生的 JSON 资料，而这种使用模式就是所谓的 JSONP。用 JSONP 抓到的资料并不是 JSON，而是任意的 JavaScript，用 JavaScript 直译器执行而不是用 JSON 解析器解析（需要目标服务器配合一个 <code>callback</code> 函数）。</p>\n<h3 id=\"CORS-与-JSONP-的比较\"><a href=\"#CORS-与-JSONP-的比较\" class=\"headerlink\" title=\"CORS 与 JSONP 的比较\"></a>CORS 与 JSONP 的比较</h3><p>CORS 与 JSONP 的使用目的相同，但是比 JSONP 更强大。</p>\n<p>JSONP 只支持 GET 请求，CORS 支持所有类型的 HTTP 请求。JSONP 的优势在于支持老式浏览器，以及可以向不支持 CORS 的网站请求数据。</p>\n<h3 id=\"使用-Nginx-反向代理解决跨域问题\"><a href=\"#使用-Nginx-反向代理解决跨域问题\" class=\"headerlink\" title=\"使用 Nginx 反向代理解决跨域问题\"></a>使用 Nginx 反向代理解决跨域问题</h3><p>以上跨域问题解决方案都需要服务器支持，当服务器无法设置 <code>header</code> 或提供 <code>callback</code> 时我们就可以采用 Nginx 反向代理的方式解决跨域问题。</p>\n<p>Nginx 配置跨域案例，在 <code>nginx.conf</code> 的 <code>location</code> 中增加如下配置：</p>\n<pre class=\"line-numbers language-nginx\"><code class=\"language-nginx\"><span class=\"token keyword\">add_header</span> Access<span class=\"token operator\">-</span>Control<span class=\"token operator\">-</span><span class=\"token keyword\">Allow</span><span class=\"token operator\">-</span>Origin <span class=\"token operator\">*</span>或域名<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">add_header</span> Access<span class=\"token operator\">-</span>Control<span class=\"token operator\">-</span><span class=\"token keyword\">Allow</span><span class=\"token operator\">-</span>Headers X<span class=\"token operator\">-</span>Requested<span class=\"token operator\">-</span>With<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">add_header</span> Access<span class=\"token operator\">-</span>Control<span class=\"token operator\">-</span><span class=\"token keyword\">Allow</span><span class=\"token operator\">-</span>Methods GET<span class=\"token punctuation\">,</span>POST<span class=\"token punctuation\">,</span>OPTIONS<span class=\"token punctuation\">;</span>\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<p>如：</p>\n<pre class=\"line-numbers language-nginx\"><code class=\"language-nginx\"><span class=\"token keyword\">user</span>  nginx<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">worker_processes</span>  <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">events</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">worker_connections</span>  <span class=\"token number\">1024</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">http</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">include</span>       mime<span class=\"token punctuation\">.</span><span class=\"token keyword\">types</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">default_type</span>  application<span class=\"token operator\">/</span>octet<span class=\"token operator\">-</span>stream<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">sendfile</span>        on<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">keepalive_timeout</span>  <span class=\"token number\">65</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">server</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">listen</span> <span class=\"token number\">80</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">server_name</span> <span class=\"token number\">192.168</span><span class=\"token punctuation\">.</span><span class=\"token number\">75.128</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">location</span> <span class=\"token operator\">/</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">add_header</span> Access<span class=\"token operator\">-</span>Control<span class=\"token operator\">-</span><span class=\"token keyword\">Allow</span><span class=\"token operator\">-</span>Origin <span class=\"token operator\">*</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">add_header</span> Access<span class=\"token operator\">-</span>Control<span class=\"token operator\">-</span><span class=\"token keyword\">Allow</span><span class=\"token operator\">-</span>Headers X<span class=\"token operator\">-</span>Requested<span class=\"token operator\">-</span>With<span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">add_header</span> Access<span class=\"token operator\">-</span>Control<span class=\"token operator\">-</span><span class=\"token keyword\">Allow</span><span class=\"token operator\">-</span>Methods GET<span class=\"token punctuation\">,</span>POST<span class=\"token punctuation\">,</span>OPTIONS<span class=\"token punctuation\">;</span>\n\n            <span class=\"token keyword\">root</span> <span class=\"token operator\">/</span>usr<span class=\"token operator\">/</span>share<span class=\"token operator\">/</span>nginx<span class=\"token operator\">/</span>wwwroot<span class=\"token operator\">/</span>cdn<span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">index</span> <span class=\"token keyword\">index</span><span class=\"token punctuation\">.</span>jsp <span class=\"token keyword\">index</span><span class=\"token punctuation\">.</span>html <span class=\"token keyword\">index</span><span class=\"token punctuation\">.</span>htm<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"Spring-Boot代码配置跨域\"><a href=\"#Spring-Boot代码配置跨域\" class=\"headerlink\" title=\"Spring Boot代码配置跨域\"></a>Spring Boot代码配置跨域</h3><h4 id=\"使用-Java-配置的方式\"><a href=\"#使用-Java-配置的方式\" class=\"headerlink\" title=\"使用 Java 配置的方式\"></a>使用 Java 配置的方式</h4><pre class=\"line-numbers language-java\"><code class=\"language-java\"><span class=\"token comment\" spellcheck=\"true\">/**\n * 跨域配置\n * &lt;p>Title: CorsConfiguration&lt;/p>\n * &lt;p>Description: &lt;/p>\n *\n * @author Lusifer\n * @version 1.0.0\n * @date 2018/3/8 22:56\n */</span>\n<span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CORSConfiguration</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">WebMvcConfigurerAdapter</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">addCorsMappings</span><span class=\"token punctuation\">(</span>CorsRegistry registry<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        registry<span class=\"token punctuation\">.</span><span class=\"token function\">addMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/**\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">allowedOrigins</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"*\"</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">allowedMethods</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"GET\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"HEAD\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"POST\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"PUT\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"DELETE\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"OPTIONS\"</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">allowCredentials</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">maxAge</span><span class=\"token punctuation\">(</span><span class=\"token number\">3600</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h4 id=\"使用注解的方式\"><a href=\"#使用注解的方式\" class=\"headerlink\" title=\"使用注解的方式\"></a>使用注解的方式</h4><pre class=\"line-numbers language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@CrossOrigin</span><span class=\"token punctuation\">(</span>origins <span class=\"token operator\">=</span> <span class=\"token string\">\"*\"</span><span class=\"token punctuation\">,</span> maxAge <span class=\"token operator\">=</span> <span class=\"token number\">3600</span><span class=\"token punctuation\">)</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"跨域简介\"><a href=\"#跨域简介\" class=\"headerlink\" title=\"跨域简介\"></a>跨域简介</h2><p>在浏览器端进行 Ajax 请求时会出现跨域问题，那么什么是跨域，如何解决跨域呢？先看浏览器端出现跨域问题的现象，如下图所示</p>\n<p><img src=\"/images/跨域/clipboard.png\" alt=\"\"></p>\n<h2 id=\"什么是跨域问题？\"><a href=\"#什么是跨域问题？\" class=\"headerlink\" title=\"什么是跨域问题？\"></a>什么是跨域问题？</h2><p>跨域，指的是浏览器不能执行其他网站的脚本。它是由浏览器的同源策略造成的，是浏览器对 JavaScript 施加的安全限制。</p>\n<h2 id=\"什么是同源？\"><a href=\"#什么是同源？\" class=\"headerlink\" title=\"什么是同源？\"></a>什么是同源？</h2><p>所谓同源是指，域名，协议，端口均相同</p>\n<ul>\n<li><a href=\"http://www.asia.com\" target=\"_blank\" rel=\"noopener\">http://www.asia.com</a> –&gt; <a href=\"http://admin.asia.com\" target=\"_blank\" rel=\"noopener\">http://admin.asia.com</a> 跨域</li>\n<li><a href=\"http://www.asia.com\" target=\"_blank\" rel=\"noopener\">http://www.asia.com</a> –&gt; <a href=\"http://www.asia.com\" target=\"_blank\" rel=\"noopener\">http://www.asia.com</a> 非跨域</li>\n<li><a href=\"http://www.asia.com\" target=\"_blank\" rel=\"noopener\">http://www.asia.com</a> –&gt; <a href=\"http://www.asia.com:8080\" target=\"_blank\" rel=\"noopener\">http://www.asia.com:8080</a> 跨域</li>\n<li><a href=\"http://www.asia.com\" target=\"_blank\" rel=\"noopener\">http://www.asia.com</a> –&gt; <a href=\"https://www.asia.com\" target=\"_blank\" rel=\"noopener\">https://www.asia.com</a> 跨域</li>\n</ul>\n<h2 id=\"如何解决跨域问题？\"><a href=\"#如何解决跨域问题？\" class=\"headerlink\" title=\"如何解决跨域问题？\"></a>如何解决跨域问题？</h2><h3 id=\"使用-CORS（跨资源共享）解决跨域问题\"><a href=\"#使用-CORS（跨资源共享）解决跨域问题\" class=\"headerlink\" title=\"使用 CORS（跨资源共享）解决跨域问题\"></a>使用 CORS（跨资源共享）解决跨域问题</h3><p>CORS 是一个 W3C 标准，全称是” 跨域资源共享”（Cross-origin resource sharing）。它允许浏览器向跨源服务器，发出 XMLHttpRequest 请求，从而克服了 AJAX 只能同源使用的限制。</p>\n<p>CORS 需要浏览器和服务器同时支持。目前，所有浏览器都支持该功能，IE 浏览器不能低于 IE10。整个 CORS 通信过程，都是浏览器自动完成，不需要用户参与。对于开发者来说，CORS 通信与同源的 AJAX 通信没有差别，代码完全一样。浏览器一旦发现 AJAX 请求跨源，就会自动添加一些附加的头信息，有时还会多出一次附加的请求，但用户不会有感觉。因此，实现 CORS 通信的关键是服务器。只要服务器实现了 CORS 接口，就可以跨源通信（在 <code>header</code> 中设置：<code>Access-Control-Allow-Origin</code>）</p>\n<h3 id=\"使用-JSONP-解决跨域问题\"><a href=\"#使用-JSONP-解决跨域问题\" class=\"headerlink\" title=\"使用 JSONP 解决跨域问题\"></a>使用 JSONP 解决跨域问题</h3><p>JSONP（JSON with Padding）是 JSON 的一种 “使用模式”，可用于解决主流浏览器的跨域数据访问的问题。由于同源策略，一般来说位于 <code>server1.example.com</code> 的网页无法与 <code>server2.example.com</code> 的服务器沟通，而 HTML 的 <code>&lt;script&gt;</code> 元素是一个例外。利用 <code>&lt;script&gt;</code> 元素的这个开放策略，网页可以得到从其他来源动态产生的 JSON 资料，而这种使用模式就是所谓的 JSONP。用 JSONP 抓到的资料并不是 JSON，而是任意的 JavaScript，用 JavaScript 直译器执行而不是用 JSON 解析器解析（需要目标服务器配合一个 <code>callback</code> 函数）。</p>\n<h3 id=\"CORS-与-JSONP-的比较\"><a href=\"#CORS-与-JSONP-的比较\" class=\"headerlink\" title=\"CORS 与 JSONP 的比较\"></a>CORS 与 JSONP 的比较</h3><p>CORS 与 JSONP 的使用目的相同，但是比 JSONP 更强大。</p>\n<p>JSONP 只支持 GET 请求，CORS 支持所有类型的 HTTP 请求。JSONP 的优势在于支持老式浏览器，以及可以向不支持 CORS 的网站请求数据。</p>\n<h3 id=\"使用-Nginx-反向代理解决跨域问题\"><a href=\"#使用-Nginx-反向代理解决跨域问题\" class=\"headerlink\" title=\"使用 Nginx 反向代理解决跨域问题\"></a>使用 Nginx 反向代理解决跨域问题</h3><p>以上跨域问题解决方案都需要服务器支持，当服务器无法设置 <code>header</code> 或提供 <code>callback</code> 时我们就可以采用 Nginx 反向代理的方式解决跨域问题。</p>\n<p>Nginx 配置跨域案例，在 <code>nginx.conf</code> 的 <code>location</code> 中增加如下配置：</p>\n<pre><code class=\"nginx\">add_header Access-Control-Allow-Origin *或域名;\nadd_header Access-Control-Allow-Headers X-Requested-With;\nadd_header Access-Control-Allow-Methods GET,POST,OPTIONS;\n\n</code></pre>\n<p>如：</p>\n<pre><code class=\"nginx\">user  nginx;\nworker_processes  1;\n\nevents {\n    worker_connections  1024;\n}\n\nhttp {\n    include       mime.types;\n    default_type  application/octet-stream;\n\n    sendfile        on;\n\n    keepalive_timeout  65;\n\n    server {\n        listen 80;\n        server_name 192.168.75.128;\n        location / {\n            add_header Access-Control-Allow-Origin *;\n            add_header Access-Control-Allow-Headers X-Requested-With;\n            add_header Access-Control-Allow-Methods GET,POST,OPTIONS;\n\n            root /usr/share/nginx/wwwroot/cdn;\n            index index.jsp index.html index.htm;\n        }\n    }\n}\n\n</code></pre>\n<h3 id=\"Spring-Boot代码配置跨域\"><a href=\"#Spring-Boot代码配置跨域\" class=\"headerlink\" title=\"Spring Boot代码配置跨域\"></a>Spring Boot代码配置跨域</h3><h4 id=\"使用-Java-配置的方式\"><a href=\"#使用-Java-配置的方式\" class=\"headerlink\" title=\"使用 Java 配置的方式\"></a>使用 Java 配置的方式</h4><pre><code class=\"java\">/**\n * 跨域配置\n * &lt;p&gt;Title: CorsConfiguration&lt;/p&gt;\n * &lt;p&gt;Description: &lt;/p&gt;\n *\n * @author Lusifer\n * @version 1.0.0\n * @date 2018/3/8 22:56\n */\n@Configuration\npublic class CORSConfiguration extends WebMvcConfigurerAdapter {\n    @Override\n    public void addCorsMappings(CorsRegistry registry) {\n        registry.addMapping(&quot;/**&quot;).allowedOrigins(&quot;*&quot;)\n                .allowedMethods(&quot;GET&quot;, &quot;HEAD&quot;, &quot;POST&quot;, &quot;PUT&quot;, &quot;DELETE&quot;, &quot;OPTIONS&quot;)\n                .allowCredentials(false).maxAge(3600);\n    }\n}\n</code></pre>\n<h4 id=\"使用注解的方式\"><a href=\"#使用注解的方式\" class=\"headerlink\" title=\"使用注解的方式\"></a>使用注解的方式</h4><pre><code class=\"java\">@CrossOrigin(origins = &quot;*&quot;, maxAge = 3600)\n</code></pre>\n"},{"title":"Spring Boot Starts汇总详解","author":"Asia Cui","date":"2019-01-28T10:23:00.000Z","_content":"\n\n## Spring Boot Starters 列表\n\n[spring-boot-starters 模块列表](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters)\n\n| 名称 | 描述 | Pom |\n| --- | :-- | :-- |\n| spring-boot-starter | 核心 starter，包括自动配置支持，日志和 YAML | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter/pom.xml) |\n| spring-boot-starter-activemq | 用于使用 Apache ActiveMQ 实现 JMS 消息 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-activemq/pom.xml) |\n| spring-boot-starter-amqp | 用于使用 Spring AMQP 和 Rabbit MQ | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-amqp/pom.xml) |\n| spring-boot-starter-aop | 用于使用 Spring AOP 和 AspectJ 实现面向切面编程 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-aop/pom.xml) |\n| spring-boot-starter-artemis | 使用 Apache Artemis 实现 JMS 消息 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-artemis/pom.xml) |\n| spring-boot-starter-batch | 对 Spring Batch 的支持 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-batch/pom.xml) |\n| spring-boot-starter-cache | 用于使用 Spring 框架的缓存支持 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-cache/pom.xml) |\n| spring-boot-starter-cloud-connectors | 对 Spring Cloud Connectors 的支持，用于简化云平台下（例如 Cloud Foundry 和 Heroku）服务的连接 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-cloud-connectors/pom.xml) |\n| spring-boot-starter-data-cassandra | 用于使用分布式数据库 Cassandra 和 Spring Data Cassandra | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-data-cassandra/pom.xml) |\n| spring-boot-starter-data-cassandra-reactive | 用于使用分布式数据库 Cassandra 和 Spring Data Cassandra 的响应式支持 | [Pom](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-starters/spring-boot-starter-data-cassandra-reactive/pom.xml) |\n| spring-boot-starter-data-couchbase | 用于使用基于文档的数据库 Couchbase 和 Spring Data Couchbase | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-data-couchbase/pom.xml) |\n| spring-boot-starter-data-couchbase-reactive | 用于使用基于文档的数据库 Couchbase 和 Spring Data Couchbase 的响应式支持 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-data-couchbase-reactive/pom.xml) |\n| spring-boot-starter-data-elasticsearch | 用于使用 Elasticsearch 搜索，分析引擎和 Spring Data Elasticsearch | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-data-elasticsearch/pom.xml) |\n| spring-boot-starter-data-jpa | 用于使用 Hibernate 实现 Spring Data JPA | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-data-jpa/pom.xml) |\n| spring-boot-starter-data-ldap | Spring Boot 对 Spring Data LDAP（轻量级目录访问协议）的支持 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-data-ldap/pom.xml) |\n| spring-boot-starter-data-mongodb | 用于使用基于文档的数据库 MongoDB 和 Spring Data MongoDB | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-data-mongodb/pom.xml) |\n| spring-boot-starter-data-mongodb-reactive | 用于使用基于文档的数据库 MongoDB 和 Spring Data MongoDB 的响应式支持 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-data-mongodb-reactive/pom.xml) |\n| spring-boot-starter-data-neo4j | 用于使用图数据库 Neo4j 和 Spring Data Neo4j | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-data-neo4j/pom.xml) |\n| spring-boot-starter-data-redis | 用于使用 Spring Data Redis 和 Jedis 客户端操作键—值数据存储 Redis | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-data-redis/pom.xml) |\n| spring-boot-starter-data-redis-reactive | 用于使用 Spring Data Redis 和 Jedis 客户端操作键—值数据存储 Redis 的响应式支持 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-data-redis-reactive/pom.xml) |\n| spring-boot-starter-data-rest | 用于使用 Spring Data REST 暴露基于 REST 的 Spring Data 仓库 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-data-rest/pom.xml) |\n| spring-boot-starter-data-solr | 通过 Spring Data Solr 使用 Apache Solr 搜索平台 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-data-solr/pom.xml) |\n| spring-boot-starter-freemarker | 用于使用 FreeMarker 模板引擎构建 MVC web 应用 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-freemarker/pom.xml) |\n| spring-boot-starter-groovy-templates | 用于使用 Groovy 模板引擎构建 MVC web 应用 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-groovy-templates/pom.xml) |\n| spring-boot-starter-hateoas | 用于使用 Spring MVC 和 Spring HATEOAS 实现基于超媒体的 RESTful web 应用 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-hateoas/pom.xml) |\n| spring-boot-starter-integration | 用于使用 Spring Integration | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-integration/pom.xml) |\n| spring-boot-starter-jdbc | 对 JDBC 的支持（使用 Tomcat JDBC 连接池） | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-jdbc/pom.xml) |\n| spring-boot-starter-jersey | 用于使用 JAX-RS 和 Jersey 构建 RESTful web 应用，可使用 [spring-boot-starter-web](http://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/#spring-boot-starter-web) 替代 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-jersey/pom.xml) |\n| spring-boot-starter-jooq | 用于使用 JOOQ 访问 SQL 数据库，可使用 [spring-boot-starter-data-jpa](http://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/#spring-boot-starter-data-jpa) 或 [spring-boot-starter-jdbc](http://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/#spring-boot-starter-jdbc) 替代 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-jooq/pom.xml) |\n| spring-boot-starter-json | Spring Boot 对 Json 读写支持的组建 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-json/pom.xml) |\n| spring-boot-starter-jta-atomikos | 用于使用 Atomikos 实现 JTA 事务 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-jta-atomikos/pom.xml) |\n| spring-boot-starter-jta-bitronix | 用于使用 Bitronix 实现 JTA 事务 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-jta-bitronix/pom.xml) |\n| spring-boot-starter-jta-narayana | Spring Boot Narayana JTA Starter | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-jta-narayana/pom.xml) |\n| spring-boot-starter-mail | 用于使用 Java Mail 和 Spring 框架 email 发送支持 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-mail/pom.xml) |\n| spring-boot-starter-mustache | 用于使用 Mustache 模板引擎构建 MVC web 应用 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-mustache/pom.xml) |\n| spring-boot-starter-quartz | 用于定时任务 quartz 的支持 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-quartz/pom.xml) |\n| spring-boot-starter-security | 对 Spring Security 的支持 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-security/pom.xml) |\n| spring-boot-starter-test | 用于测试 Spring Boot 应用，支持常用测试类库，包括 JUnit, Hamcrest 和 Mockito | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-test/pom.xml) |\n| spring-boot-starter-thymeleaf | 用于使用 Thymeleaf 模板引擎构建 MVC web 应用 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-thymeleaf/pom.xml) |\n| spring-boot-starter-validation | 用于使用 Hibernate Validator 实现 Java Bean 校验 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-validation/pom.xml) |\n| spring-boot-starter-web | 用于使用 Spring MVC 构建 web 应用，包括 RESTful。Tomcat 是默认的内嵌容器 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-web/pom.xml) |\n| spring-boot-starter-web-services | 对 Spring Web 服务的支持 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-web-services/pom.xml) |\n| spring-boot-starter-webflux | 对 Spring webflux 服务的支持 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-webflux/pom.xml) |\n| spring-boot-starter-websocket | 用于使用 Spring 框架的 WebSocket 支持构建 WebSocket 应用 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-websocket/pom.xml) |\n\nSpring Boot 生产级 starters\n\n| 名称 | 描述 | Pom |\n| --- | :-- | :-- |\n| spring-boot-starter-actuator | 用于使用 Spring Boot 的 Actuator，它提供了 production ready 功能来帮助你监控和管理应用程序 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-actuator/pom.xml) |\n\n最后，Spring Boot 还包含一些用于排除或交换某些特定技术方面的 starters：\n\nSpring Boot 技术性 Starters\n\n| 名称 | 描述 | Pom |\n| --- | :-- | :-- |\n| spring-boot-starter-jetty | 用于使用 Jetty 作为内嵌 servlet 容器，可使用 [spring-boot-starter-tomcat](http://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/#spring-boot-starter-tomcat) 替代 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-jetty/pom.xml) |\n| spring-boot-starter-log4j2 | 用于使用 Log4j2 记录日志，可使用 [spring-boot-starter-logging](http://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/#spring-boot-starter-logging) 代替 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-log4j2/pom.xml) |\n| spring-boot-starter-logging | 用于使用 Logback 记录日志，默认的日志 starter | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-logging/pom.xml) |\n| spring-boot-starter-reactor-netty | 用于使用 netty 作为响应式内嵌容器 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-reactor-netty/pom.xml) |\n| spring-boot-starter-tomcat | 用于使用 Tomcat 作为内嵌 servlet 容器，[spring-boot-starter-web](http://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/#spring-boot-starter-web) 使用的默认 servlet 容器 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-tomcat/pom.xml) |\n| spring-boot-starter-undertow | 用于使用 Undertow 作为内嵌 servlet 容器，可使用 [spring-boot-starter-tomcat](http://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/#spring-boot-starter-tomcat) 替代 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-undertow/pom.xml) |","source":"_posts/Spring-Boot-Starts模块依赖详解.md","raw":"title: Spring Boot Starts汇总详解\nauthor: Asia Cui\ntags:\n  - Spring Boot\ncategories:\n  - Spring Boot Starts\ndate: 2019-01-28 18:23:00\n---\n\n\n## Spring Boot Starters 列表\n\n[spring-boot-starters 模块列表](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters)\n\n| 名称 | 描述 | Pom |\n| --- | :-- | :-- |\n| spring-boot-starter | 核心 starter，包括自动配置支持，日志和 YAML | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter/pom.xml) |\n| spring-boot-starter-activemq | 用于使用 Apache ActiveMQ 实现 JMS 消息 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-activemq/pom.xml) |\n| spring-boot-starter-amqp | 用于使用 Spring AMQP 和 Rabbit MQ | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-amqp/pom.xml) |\n| spring-boot-starter-aop | 用于使用 Spring AOP 和 AspectJ 实现面向切面编程 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-aop/pom.xml) |\n| spring-boot-starter-artemis | 使用 Apache Artemis 实现 JMS 消息 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-artemis/pom.xml) |\n| spring-boot-starter-batch | 对 Spring Batch 的支持 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-batch/pom.xml) |\n| spring-boot-starter-cache | 用于使用 Spring 框架的缓存支持 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-cache/pom.xml) |\n| spring-boot-starter-cloud-connectors | 对 Spring Cloud Connectors 的支持，用于简化云平台下（例如 Cloud Foundry 和 Heroku）服务的连接 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-cloud-connectors/pom.xml) |\n| spring-boot-starter-data-cassandra | 用于使用分布式数据库 Cassandra 和 Spring Data Cassandra | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-data-cassandra/pom.xml) |\n| spring-boot-starter-data-cassandra-reactive | 用于使用分布式数据库 Cassandra 和 Spring Data Cassandra 的响应式支持 | [Pom](https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-starters/spring-boot-starter-data-cassandra-reactive/pom.xml) |\n| spring-boot-starter-data-couchbase | 用于使用基于文档的数据库 Couchbase 和 Spring Data Couchbase | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-data-couchbase/pom.xml) |\n| spring-boot-starter-data-couchbase-reactive | 用于使用基于文档的数据库 Couchbase 和 Spring Data Couchbase 的响应式支持 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-data-couchbase-reactive/pom.xml) |\n| spring-boot-starter-data-elasticsearch | 用于使用 Elasticsearch 搜索，分析引擎和 Spring Data Elasticsearch | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-data-elasticsearch/pom.xml) |\n| spring-boot-starter-data-jpa | 用于使用 Hibernate 实现 Spring Data JPA | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-data-jpa/pom.xml) |\n| spring-boot-starter-data-ldap | Spring Boot 对 Spring Data LDAP（轻量级目录访问协议）的支持 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-data-ldap/pom.xml) |\n| spring-boot-starter-data-mongodb | 用于使用基于文档的数据库 MongoDB 和 Spring Data MongoDB | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-data-mongodb/pom.xml) |\n| spring-boot-starter-data-mongodb-reactive | 用于使用基于文档的数据库 MongoDB 和 Spring Data MongoDB 的响应式支持 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-data-mongodb-reactive/pom.xml) |\n| spring-boot-starter-data-neo4j | 用于使用图数据库 Neo4j 和 Spring Data Neo4j | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-data-neo4j/pom.xml) |\n| spring-boot-starter-data-redis | 用于使用 Spring Data Redis 和 Jedis 客户端操作键—值数据存储 Redis | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-data-redis/pom.xml) |\n| spring-boot-starter-data-redis-reactive | 用于使用 Spring Data Redis 和 Jedis 客户端操作键—值数据存储 Redis 的响应式支持 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-data-redis-reactive/pom.xml) |\n| spring-boot-starter-data-rest | 用于使用 Spring Data REST 暴露基于 REST 的 Spring Data 仓库 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-data-rest/pom.xml) |\n| spring-boot-starter-data-solr | 通过 Spring Data Solr 使用 Apache Solr 搜索平台 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-data-solr/pom.xml) |\n| spring-boot-starter-freemarker | 用于使用 FreeMarker 模板引擎构建 MVC web 应用 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-freemarker/pom.xml) |\n| spring-boot-starter-groovy-templates | 用于使用 Groovy 模板引擎构建 MVC web 应用 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-groovy-templates/pom.xml) |\n| spring-boot-starter-hateoas | 用于使用 Spring MVC 和 Spring HATEOAS 实现基于超媒体的 RESTful web 应用 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-hateoas/pom.xml) |\n| spring-boot-starter-integration | 用于使用 Spring Integration | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-integration/pom.xml) |\n| spring-boot-starter-jdbc | 对 JDBC 的支持（使用 Tomcat JDBC 连接池） | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-jdbc/pom.xml) |\n| spring-boot-starter-jersey | 用于使用 JAX-RS 和 Jersey 构建 RESTful web 应用，可使用 [spring-boot-starter-web](http://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/#spring-boot-starter-web) 替代 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-jersey/pom.xml) |\n| spring-boot-starter-jooq | 用于使用 JOOQ 访问 SQL 数据库，可使用 [spring-boot-starter-data-jpa](http://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/#spring-boot-starter-data-jpa) 或 [spring-boot-starter-jdbc](http://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/#spring-boot-starter-jdbc) 替代 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-jooq/pom.xml) |\n| spring-boot-starter-json | Spring Boot 对 Json 读写支持的组建 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-json/pom.xml) |\n| spring-boot-starter-jta-atomikos | 用于使用 Atomikos 实现 JTA 事务 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-jta-atomikos/pom.xml) |\n| spring-boot-starter-jta-bitronix | 用于使用 Bitronix 实现 JTA 事务 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-jta-bitronix/pom.xml) |\n| spring-boot-starter-jta-narayana | Spring Boot Narayana JTA Starter | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-jta-narayana/pom.xml) |\n| spring-boot-starter-mail | 用于使用 Java Mail 和 Spring 框架 email 发送支持 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-mail/pom.xml) |\n| spring-boot-starter-mustache | 用于使用 Mustache 模板引擎构建 MVC web 应用 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-mustache/pom.xml) |\n| spring-boot-starter-quartz | 用于定时任务 quartz 的支持 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-quartz/pom.xml) |\n| spring-boot-starter-security | 对 Spring Security 的支持 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-security/pom.xml) |\n| spring-boot-starter-test | 用于测试 Spring Boot 应用，支持常用测试类库，包括 JUnit, Hamcrest 和 Mockito | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-test/pom.xml) |\n| spring-boot-starter-thymeleaf | 用于使用 Thymeleaf 模板引擎构建 MVC web 应用 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-thymeleaf/pom.xml) |\n| spring-boot-starter-validation | 用于使用 Hibernate Validator 实现 Java Bean 校验 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-validation/pom.xml) |\n| spring-boot-starter-web | 用于使用 Spring MVC 构建 web 应用，包括 RESTful。Tomcat 是默认的内嵌容器 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-web/pom.xml) |\n| spring-boot-starter-web-services | 对 Spring Web 服务的支持 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-web-services/pom.xml) |\n| spring-boot-starter-webflux | 对 Spring webflux 服务的支持 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-webflux/pom.xml) |\n| spring-boot-starter-websocket | 用于使用 Spring 框架的 WebSocket 支持构建 WebSocket 应用 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-websocket/pom.xml) |\n\nSpring Boot 生产级 starters\n\n| 名称 | 描述 | Pom |\n| --- | :-- | :-- |\n| spring-boot-starter-actuator | 用于使用 Spring Boot 的 Actuator，它提供了 production ready 功能来帮助你监控和管理应用程序 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-actuator/pom.xml) |\n\n最后，Spring Boot 还包含一些用于排除或交换某些特定技术方面的 starters：\n\nSpring Boot 技术性 Starters\n\n| 名称 | 描述 | Pom |\n| --- | :-- | :-- |\n| spring-boot-starter-jetty | 用于使用 Jetty 作为内嵌 servlet 容器，可使用 [spring-boot-starter-tomcat](http://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/#spring-boot-starter-tomcat) 替代 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-jetty/pom.xml) |\n| spring-boot-starter-log4j2 | 用于使用 Log4j2 记录日志，可使用 [spring-boot-starter-logging](http://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/#spring-boot-starter-logging) 代替 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-log4j2/pom.xml) |\n| spring-boot-starter-logging | 用于使用 Logback 记录日志，默认的日志 starter | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-logging/pom.xml) |\n| spring-boot-starter-reactor-netty | 用于使用 netty 作为响应式内嵌容器 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-reactor-netty/pom.xml) |\n| spring-boot-starter-tomcat | 用于使用 Tomcat 作为内嵌 servlet 容器，[spring-boot-starter-web](http://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/#spring-boot-starter-web) 使用的默认 servlet 容器 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-tomcat/pom.xml) |\n| spring-boot-starter-undertow | 用于使用 Undertow 作为内嵌 servlet 容器，可使用 [spring-boot-starter-tomcat](http://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/#spring-boot-starter-tomcat) 替代 | [Pom](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-undertow/pom.xml) |","slug":"Spring-Boot-Starts模块依赖详解","published":1,"updated":"2019-01-28T10:24:01.216Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjs17mi04002mpwgth6ykxlda","content":"<h2 id=\"Spring-Boot-Starters-列表\"><a href=\"#Spring-Boot-Starters-列表\" class=\"headerlink\" title=\"Spring Boot Starters 列表\"></a>Spring Boot Starters 列表</h2><p><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters\" target=\"_blank\" rel=\"noopener\">spring-boot-starters 模块列表</a></p>\n<table>\n<thead>\n<tr>\n<th>名称</th>\n<th style=\"text-align:left\">描述</th>\n<th style=\"text-align:left\">Pom</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>spring-boot-starter</td>\n<td style=\"text-align:left\">核心 starter，包括自动配置支持，日志和 YAML</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-activemq</td>\n<td style=\"text-align:left\">用于使用 Apache ActiveMQ 实现 JMS 消息</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-activemq/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-amqp</td>\n<td style=\"text-align:left\">用于使用 Spring AMQP 和 Rabbit MQ</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-amqp/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-aop</td>\n<td style=\"text-align:left\">用于使用 Spring AOP 和 AspectJ 实现面向切面编程</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-aop/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-artemis</td>\n<td style=\"text-align:left\">使用 Apache Artemis 实现 JMS 消息</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-artemis/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-batch</td>\n<td style=\"text-align:left\">对 Spring Batch 的支持</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-batch/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-cache</td>\n<td style=\"text-align:left\">用于使用 Spring 框架的缓存支持</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-cache/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-cloud-connectors</td>\n<td style=\"text-align:left\">对 Spring Cloud Connectors 的支持，用于简化云平台下（例如 Cloud Foundry 和 Heroku）服务的连接</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-cloud-connectors/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-data-cassandra</td>\n<td style=\"text-align:left\">用于使用分布式数据库 Cassandra 和 Spring Data Cassandra</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-data-cassandra/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-data-cassandra-reactive</td>\n<td style=\"text-align:left\">用于使用分布式数据库 Cassandra 和 Spring Data Cassandra 的响应式支持</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-starters/spring-boot-starter-data-cassandra-reactive/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-data-couchbase</td>\n<td style=\"text-align:left\">用于使用基于文档的数据库 Couchbase 和 Spring Data Couchbase</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-data-couchbase/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-data-couchbase-reactive</td>\n<td style=\"text-align:left\">用于使用基于文档的数据库 Couchbase 和 Spring Data Couchbase 的响应式支持</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-data-couchbase-reactive/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-data-elasticsearch</td>\n<td style=\"text-align:left\">用于使用 Elasticsearch 搜索，分析引擎和 Spring Data Elasticsearch</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-data-elasticsearch/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-data-jpa</td>\n<td style=\"text-align:left\">用于使用 Hibernate 实现 Spring Data JPA</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-data-jpa/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-data-ldap</td>\n<td style=\"text-align:left\">Spring Boot 对 Spring Data LDAP（轻量级目录访问协议）的支持</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-data-ldap/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-data-mongodb</td>\n<td style=\"text-align:left\">用于使用基于文档的数据库 MongoDB 和 Spring Data MongoDB</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-data-mongodb/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-data-mongodb-reactive</td>\n<td style=\"text-align:left\">用于使用基于文档的数据库 MongoDB 和 Spring Data MongoDB 的响应式支持</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-data-mongodb-reactive/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-data-neo4j</td>\n<td style=\"text-align:left\">用于使用图数据库 Neo4j 和 Spring Data Neo4j</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-data-neo4j/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-data-redis</td>\n<td style=\"text-align:left\">用于使用 Spring Data Redis 和 Jedis 客户端操作键—值数据存储 Redis</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-data-redis/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-data-redis-reactive</td>\n<td style=\"text-align:left\">用于使用 Spring Data Redis 和 Jedis 客户端操作键—值数据存储 Redis 的响应式支持</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-data-redis-reactive/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-data-rest</td>\n<td style=\"text-align:left\">用于使用 Spring Data REST 暴露基于 REST 的 Spring Data 仓库</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-data-rest/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-data-solr</td>\n<td style=\"text-align:left\">通过 Spring Data Solr 使用 Apache Solr 搜索平台</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-data-solr/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-freemarker</td>\n<td style=\"text-align:left\">用于使用 FreeMarker 模板引擎构建 MVC web 应用</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-freemarker/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-groovy-templates</td>\n<td style=\"text-align:left\">用于使用 Groovy 模板引擎构建 MVC web 应用</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-groovy-templates/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-hateoas</td>\n<td style=\"text-align:left\">用于使用 Spring MVC 和 Spring HATEOAS 实现基于超媒体的 RESTful web 应用</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-hateoas/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-integration</td>\n<td style=\"text-align:left\">用于使用 Spring Integration</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-integration/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-jdbc</td>\n<td style=\"text-align:left\">对 JDBC 的支持（使用 Tomcat JDBC 连接池）</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-jdbc/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-jersey</td>\n<td style=\"text-align:left\">用于使用 JAX-RS 和 Jersey 构建 RESTful web 应用，可使用 <a href=\"http://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/#spring-boot-starter-web\" target=\"_blank\" rel=\"noopener\">spring-boot-starter-web</a> 替代</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-jersey/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-jooq</td>\n<td style=\"text-align:left\">用于使用 JOOQ 访问 SQL 数据库，可使用 <a href=\"http://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/#spring-boot-starter-data-jpa\" target=\"_blank\" rel=\"noopener\">spring-boot-starter-data-jpa</a> 或 <a href=\"http://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/#spring-boot-starter-jdbc\" target=\"_blank\" rel=\"noopener\">spring-boot-starter-jdbc</a> 替代</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-jooq/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-json</td>\n<td style=\"text-align:left\">Spring Boot 对 Json 读写支持的组建</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-json/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-jta-atomikos</td>\n<td style=\"text-align:left\">用于使用 Atomikos 实现 JTA 事务</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-jta-atomikos/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-jta-bitronix</td>\n<td style=\"text-align:left\">用于使用 Bitronix 实现 JTA 事务</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-jta-bitronix/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-jta-narayana</td>\n<td style=\"text-align:left\">Spring Boot Narayana JTA Starter</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-jta-narayana/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-mail</td>\n<td style=\"text-align:left\">用于使用 Java Mail 和 Spring 框架 email 发送支持</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-mail/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-mustache</td>\n<td style=\"text-align:left\">用于使用 Mustache 模板引擎构建 MVC web 应用</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-mustache/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-quartz</td>\n<td style=\"text-align:left\">用于定时任务 quartz 的支持</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-quartz/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-security</td>\n<td style=\"text-align:left\">对 Spring Security 的支持</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-security/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-test</td>\n<td style=\"text-align:left\">用于测试 Spring Boot 应用，支持常用测试类库，包括 JUnit, Hamcrest 和 Mockito</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-test/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-thymeleaf</td>\n<td style=\"text-align:left\">用于使用 Thymeleaf 模板引擎构建 MVC web 应用</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-thymeleaf/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-validation</td>\n<td style=\"text-align:left\">用于使用 Hibernate Validator 实现 Java Bean 校验</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-validation/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-web</td>\n<td style=\"text-align:left\">用于使用 Spring MVC 构建 web 应用，包括 RESTful。Tomcat 是默认的内嵌容器</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-web/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-web-services</td>\n<td style=\"text-align:left\">对 Spring Web 服务的支持</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-web-services/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-webflux</td>\n<td style=\"text-align:left\">对 Spring webflux 服务的支持</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-webflux/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-websocket</td>\n<td style=\"text-align:left\">用于使用 Spring 框架的 WebSocket 支持构建 WebSocket 应用</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-websocket/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n</tbody>\n</table>\n<p>Spring Boot 生产级 starters</p>\n<table>\n<thead>\n<tr>\n<th>名称</th>\n<th style=\"text-align:left\">描述</th>\n<th style=\"text-align:left\">Pom</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>spring-boot-starter-actuator</td>\n<td style=\"text-align:left\">用于使用 Spring Boot 的 Actuator，它提供了 production ready 功能来帮助你监控和管理应用程序</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-actuator/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n</tbody>\n</table>\n<p>最后，Spring Boot 还包含一些用于排除或交换某些特定技术方面的 starters：</p>\n<p>Spring Boot 技术性 Starters</p>\n<table>\n<thead>\n<tr>\n<th>名称</th>\n<th style=\"text-align:left\">描述</th>\n<th style=\"text-align:left\">Pom</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>spring-boot-starter-jetty</td>\n<td style=\"text-align:left\">用于使用 Jetty 作为内嵌 servlet 容器，可使用 <a href=\"http://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/#spring-boot-starter-tomcat\" target=\"_blank\" rel=\"noopener\">spring-boot-starter-tomcat</a> 替代</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-jetty/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-log4j2</td>\n<td style=\"text-align:left\">用于使用 Log4j2 记录日志，可使用 <a href=\"http://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/#spring-boot-starter-logging\" target=\"_blank\" rel=\"noopener\">spring-boot-starter-logging</a> 代替</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-log4j2/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-logging</td>\n<td style=\"text-align:left\">用于使用 Logback 记录日志，默认的日志 starter</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-logging/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-reactor-netty</td>\n<td style=\"text-align:left\">用于使用 netty 作为响应式内嵌容器</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-reactor-netty/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-tomcat</td>\n<td style=\"text-align:left\">用于使用 Tomcat 作为内嵌 servlet 容器，<a href=\"http://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/#spring-boot-starter-web\" target=\"_blank\" rel=\"noopener\">spring-boot-starter-web</a> 使用的默认 servlet 容器</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-tomcat/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-undertow</td>\n<td style=\"text-align:left\">用于使用 Undertow 作为内嵌 servlet 容器，可使用 <a href=\"http://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/#spring-boot-starter-tomcat\" target=\"_blank\" rel=\"noopener\">spring-boot-starter-tomcat</a> 替代</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-undertow/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n</tbody>\n</table>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"Spring-Boot-Starters-列表\"><a href=\"#Spring-Boot-Starters-列表\" class=\"headerlink\" title=\"Spring Boot Starters 列表\"></a>Spring Boot Starters 列表</h2><p><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters\" target=\"_blank\" rel=\"noopener\">spring-boot-starters 模块列表</a></p>\n<table>\n<thead>\n<tr>\n<th>名称</th>\n<th style=\"text-align:left\">描述</th>\n<th style=\"text-align:left\">Pom</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>spring-boot-starter</td>\n<td style=\"text-align:left\">核心 starter，包括自动配置支持，日志和 YAML</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-activemq</td>\n<td style=\"text-align:left\">用于使用 Apache ActiveMQ 实现 JMS 消息</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-activemq/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-amqp</td>\n<td style=\"text-align:left\">用于使用 Spring AMQP 和 Rabbit MQ</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-amqp/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-aop</td>\n<td style=\"text-align:left\">用于使用 Spring AOP 和 AspectJ 实现面向切面编程</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-aop/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-artemis</td>\n<td style=\"text-align:left\">使用 Apache Artemis 实现 JMS 消息</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-artemis/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-batch</td>\n<td style=\"text-align:left\">对 Spring Batch 的支持</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-batch/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-cache</td>\n<td style=\"text-align:left\">用于使用 Spring 框架的缓存支持</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-cache/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-cloud-connectors</td>\n<td style=\"text-align:left\">对 Spring Cloud Connectors 的支持，用于简化云平台下（例如 Cloud Foundry 和 Heroku）服务的连接</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-cloud-connectors/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-data-cassandra</td>\n<td style=\"text-align:left\">用于使用分布式数据库 Cassandra 和 Spring Data Cassandra</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-data-cassandra/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-data-cassandra-reactive</td>\n<td style=\"text-align:left\">用于使用分布式数据库 Cassandra 和 Spring Data Cassandra 的响应式支持</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-starters/spring-boot-starter-data-cassandra-reactive/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-data-couchbase</td>\n<td style=\"text-align:left\">用于使用基于文档的数据库 Couchbase 和 Spring Data Couchbase</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-data-couchbase/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-data-couchbase-reactive</td>\n<td style=\"text-align:left\">用于使用基于文档的数据库 Couchbase 和 Spring Data Couchbase 的响应式支持</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-data-couchbase-reactive/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-data-elasticsearch</td>\n<td style=\"text-align:left\">用于使用 Elasticsearch 搜索，分析引擎和 Spring Data Elasticsearch</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-data-elasticsearch/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-data-jpa</td>\n<td style=\"text-align:left\">用于使用 Hibernate 实现 Spring Data JPA</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-data-jpa/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-data-ldap</td>\n<td style=\"text-align:left\">Spring Boot 对 Spring Data LDAP（轻量级目录访问协议）的支持</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-data-ldap/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-data-mongodb</td>\n<td style=\"text-align:left\">用于使用基于文档的数据库 MongoDB 和 Spring Data MongoDB</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-data-mongodb/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-data-mongodb-reactive</td>\n<td style=\"text-align:left\">用于使用基于文档的数据库 MongoDB 和 Spring Data MongoDB 的响应式支持</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-data-mongodb-reactive/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-data-neo4j</td>\n<td style=\"text-align:left\">用于使用图数据库 Neo4j 和 Spring Data Neo4j</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-data-neo4j/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-data-redis</td>\n<td style=\"text-align:left\">用于使用 Spring Data Redis 和 Jedis 客户端操作键—值数据存储 Redis</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-data-redis/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-data-redis-reactive</td>\n<td style=\"text-align:left\">用于使用 Spring Data Redis 和 Jedis 客户端操作键—值数据存储 Redis 的响应式支持</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-data-redis-reactive/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-data-rest</td>\n<td style=\"text-align:left\">用于使用 Spring Data REST 暴露基于 REST 的 Spring Data 仓库</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-data-rest/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-data-solr</td>\n<td style=\"text-align:left\">通过 Spring Data Solr 使用 Apache Solr 搜索平台</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-data-solr/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-freemarker</td>\n<td style=\"text-align:left\">用于使用 FreeMarker 模板引擎构建 MVC web 应用</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-freemarker/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-groovy-templates</td>\n<td style=\"text-align:left\">用于使用 Groovy 模板引擎构建 MVC web 应用</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-groovy-templates/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-hateoas</td>\n<td style=\"text-align:left\">用于使用 Spring MVC 和 Spring HATEOAS 实现基于超媒体的 RESTful web 应用</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-hateoas/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-integration</td>\n<td style=\"text-align:left\">用于使用 Spring Integration</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-integration/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-jdbc</td>\n<td style=\"text-align:left\">对 JDBC 的支持（使用 Tomcat JDBC 连接池）</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-jdbc/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-jersey</td>\n<td style=\"text-align:left\">用于使用 JAX-RS 和 Jersey 构建 RESTful web 应用，可使用 <a href=\"http://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/#spring-boot-starter-web\" target=\"_blank\" rel=\"noopener\">spring-boot-starter-web</a> 替代</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-jersey/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-jooq</td>\n<td style=\"text-align:left\">用于使用 JOOQ 访问 SQL 数据库，可使用 <a href=\"http://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/#spring-boot-starter-data-jpa\" target=\"_blank\" rel=\"noopener\">spring-boot-starter-data-jpa</a> 或 <a href=\"http://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/#spring-boot-starter-jdbc\" target=\"_blank\" rel=\"noopener\">spring-boot-starter-jdbc</a> 替代</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-jooq/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-json</td>\n<td style=\"text-align:left\">Spring Boot 对 Json 读写支持的组建</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-json/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-jta-atomikos</td>\n<td style=\"text-align:left\">用于使用 Atomikos 实现 JTA 事务</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-jta-atomikos/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-jta-bitronix</td>\n<td style=\"text-align:left\">用于使用 Bitronix 实现 JTA 事务</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-jta-bitronix/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-jta-narayana</td>\n<td style=\"text-align:left\">Spring Boot Narayana JTA Starter</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-jta-narayana/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-mail</td>\n<td style=\"text-align:left\">用于使用 Java Mail 和 Spring 框架 email 发送支持</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-mail/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-mustache</td>\n<td style=\"text-align:left\">用于使用 Mustache 模板引擎构建 MVC web 应用</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-mustache/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-quartz</td>\n<td style=\"text-align:left\">用于定时任务 quartz 的支持</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-quartz/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-security</td>\n<td style=\"text-align:left\">对 Spring Security 的支持</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-security/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-test</td>\n<td style=\"text-align:left\">用于测试 Spring Boot 应用，支持常用测试类库，包括 JUnit, Hamcrest 和 Mockito</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-test/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-thymeleaf</td>\n<td style=\"text-align:left\">用于使用 Thymeleaf 模板引擎构建 MVC web 应用</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-thymeleaf/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-validation</td>\n<td style=\"text-align:left\">用于使用 Hibernate Validator 实现 Java Bean 校验</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-validation/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-web</td>\n<td style=\"text-align:left\">用于使用 Spring MVC 构建 web 应用，包括 RESTful。Tomcat 是默认的内嵌容器</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-web/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-web-services</td>\n<td style=\"text-align:left\">对 Spring Web 服务的支持</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-web-services/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-webflux</td>\n<td style=\"text-align:left\">对 Spring webflux 服务的支持</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-webflux/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-websocket</td>\n<td style=\"text-align:left\">用于使用 Spring 框架的 WebSocket 支持构建 WebSocket 应用</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-websocket/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n</tbody>\n</table>\n<p>Spring Boot 生产级 starters</p>\n<table>\n<thead>\n<tr>\n<th>名称</th>\n<th style=\"text-align:left\">描述</th>\n<th style=\"text-align:left\">Pom</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>spring-boot-starter-actuator</td>\n<td style=\"text-align:left\">用于使用 Spring Boot 的 Actuator，它提供了 production ready 功能来帮助你监控和管理应用程序</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-actuator/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n</tbody>\n</table>\n<p>最后，Spring Boot 还包含一些用于排除或交换某些特定技术方面的 starters：</p>\n<p>Spring Boot 技术性 Starters</p>\n<table>\n<thead>\n<tr>\n<th>名称</th>\n<th style=\"text-align:left\">描述</th>\n<th style=\"text-align:left\">Pom</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>spring-boot-starter-jetty</td>\n<td style=\"text-align:left\">用于使用 Jetty 作为内嵌 servlet 容器，可使用 <a href=\"http://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/#spring-boot-starter-tomcat\" target=\"_blank\" rel=\"noopener\">spring-boot-starter-tomcat</a> 替代</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-jetty/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-log4j2</td>\n<td style=\"text-align:left\">用于使用 Log4j2 记录日志，可使用 <a href=\"http://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/#spring-boot-starter-logging\" target=\"_blank\" rel=\"noopener\">spring-boot-starter-logging</a> 代替</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-log4j2/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-logging</td>\n<td style=\"text-align:left\">用于使用 Logback 记录日志，默认的日志 starter</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-logging/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-reactor-netty</td>\n<td style=\"text-align:left\">用于使用 netty 作为响应式内嵌容器</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-reactor-netty/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-tomcat</td>\n<td style=\"text-align:left\">用于使用 Tomcat 作为内嵌 servlet 容器，<a href=\"http://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/#spring-boot-starter-web\" target=\"_blank\" rel=\"noopener\">spring-boot-starter-web</a> 使用的默认 servlet 容器</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-tomcat/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n<tr>\n<td>spring-boot-starter-undertow</td>\n<td style=\"text-align:left\">用于使用 Undertow 作为内嵌 servlet 容器，可使用 <a href=\"http://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/#spring-boot-starter-tomcat\" target=\"_blank\" rel=\"noopener\">spring-boot-starter-tomcat</a> 替代</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/spring-boot-starter-undertow/pom.xml\" target=\"_blank\" rel=\"noopener\">Pom</a></td>\n</tr>\n</tbody>\n</table>\n"},{"title":"Spring Boot配置拦截器和过滤器","author":"Asia Cui","date":"2019-01-16T05:43:00.000Z","_content":"## 一、拦截器与过滤器\n\n　　在讲 Spring boot 之前，我们先了解一下过滤器和拦截器。这两者在功能方面很类似，但是在具体技术实现方面，差距还是比较大的。在分析两者的区别之前，我们先理解一下 AOP 的概念，AOP 不是一种具体的技术，而是一种编程思想。在面向对象编程的过程中，我们很容易通过继承、多态来解决纵向扩展。 但是对于横向的功能，比如，在所有的 service 方法中开启事务，或者统一记录日志等功能，面向对象的是无法解决的。所以 AOP——面向切面编程其实是面向对象编程思想的一个补充。而我们今天讲的过滤器和拦截器都属于面向切面编程的具体实现。而两者的主要区别包括以下几个方面：\n\n　　1、Filter 是依赖于 Servlet 容器，属于 Servlet 规范的一部分，而拦截器则是独立存在的，可以在任何情况下使用。\n\n　　2、Filter 的执行由 Servlet 容器回调完成，而拦截器通常通过动态代理的方式来执行。\n\n　　3、Filter 的生命周期由 Servlet 容器管理，而拦截器则可以通过 IoC 容器来管理，因此可以通过注入等方式来获取其他 Bean 的实例，因此使用会更方便。\n\n## 二、过滤器的配置\n\n　　现在我们通过过滤器来实现记录请求执行时间的功能，其实现如下：\n\n```java\npublic class LogCostFilter implements Filter {\n    @Override\n   public void init(FilterConfig filterConfig) throws ServletException {\n\n   }\n \n\t@Override\n\tpublic void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, \t\t\t\tFilterChain filterChain) throws IOException, ServletException {\n\t\n    \t\tlong start = System.currentTimeMillis();\n    \t\tfilterChain.doFilter(servletRequest,servletResponse);\n    \t\tSystem.out.println(\"Execute cost=\"+(System.currentTimeMillis()-start));\n\t}\n \n\t@Override\n\tpublic void destroy() {\n \n\t}\n}\n```\n\n　　这段代码的逻辑比较简单，就是在方法执行前先记录时间戳，然后通过过滤器链完成请求的执行，在返回结果之间计算执行的时间。这里需要主要，这个类必须继承 Filter 类，这个是 Servlet 的规范，这个跟以前的 Web 项目没区别。但是，有了过滤器类以后，以前的 web 项目可以在 web.xml 中进行配置，但是 spring boot 项目并没有 web.xml 这个文件，那怎么配置？在 Spring boot 中，我们需要 FilterRegistrationBean 来完成配置。其实现过程如下：\n\n```java\n@Configuration\npublic class FilterConfig {\n \n    @Bean\n    public FilterRegistrationBean registFilter() {\n        FilterRegistrationBean registration = new FilterRegistrationBean();\n        registration.setFilter(new LogCostFilter());\n        registration.addUrlPatterns(\"/*\");\n        registration.setName(\"LogCostFilter\");\n        registration.setOrder(1);\n        return registration;\n    }\n \n}\n```\n\n\n\n　　这样配置就完成了，需要配置的选项主要包括实例化 Filter 类，然后指定 url 的匹配模式，设置过滤器名称和执行顺序，这个过程和在 web.xml 中配置其实没什么区别，只是形式不同而已。现在我们可以启动服务器访问任意 URL：\n\n![](https://images2017.cnblogs.com/blog/820406/201801/820406-20180129231150312-465693715.png)\n\n　　大家可以看到上面的配置已经生效了。除了通过 FilterRegistrationBean 来配置以外，还有一种更直接的办法，直接通过注解就可以完成了：\n\n```java\n@WebFilter(urlPatterns = \"/*\", filterName = \"logFilter2\")\npublic class LogCostFilter2 implements Filter {\n    @Override\n    public void init(FilterConfig filterConfig) throws ServletException {\n \n    }\n \n    @Override\n    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {\n        long start = System.currentTimeMillis();\n        filterChain.doFilter(servletRequest, servletResponse);\n        System.out.println(\"LogFilter2 Execute cost=\" + (System.currentTimeMillis() - start));\n    }\n \n    @Override\n    public void destroy() {\n \n    }\n}\n```\n\n　　这里直接用 @WebFilter 就可以进行配置，同样，可以设置 url 匹配模式，过滤器名称等。这里需要注意一点的是 @WebFilter 这个注解是 Servlet3.0 的规范，并不是 Spring boot 提供的。除了这个注解以外，我们还需在配置类中加另外一个注解：@ServletComponetScan，指定扫描的包。\n\n```java\n@SpringBootApplication\n@MapperScan(\"com.pandy.blog.dao\")\n@ServletComponentScan(\"com.pandy.blog.filters\")\npublic class Application {\n    public static void main(String[] args) throws Exception {\n        SpringApplication.run(Application.class, args);\n    }\n}\n```\n\n　　现在，我们再来访问一下任意 URL：\n\n![](https://images2017.cnblogs.com/blog/820406/201801/820406-20180129232130046-1905239306.png)\n\n　　可以看到，我们配置的两个过滤器都生效了。细心的读者会发现，第二个 Filter 我们并没有指定执行的顺序，但是却在第一个 Filter 之前执行。这里需要解释一下，@WebFilter 这个注解并没有指定执行顺序的属性，其执行顺序依赖于 Filter 的名称，是根据 Filter 类名（注意不是配置的 filter 的名字）的字母顺序倒序排列，并且 @WebFilter 指定的过滤器优先级都高于 FilterRegistrationBean 配置的过滤器。有兴趣的朋友可以自己实验一下。\n\n## 三、拦截器的配置\n\n 　　上面我们已经介绍了过滤器的配置方法，接下来我们再来看看如何配置一个拦截器。我们使用拦截器来实现上面同样的功能，记录请求的执行时间。首先我们实现拦截器类：\n\n```java\npublic class LogCostInterceptor implements HandlerInterceptor {\n    long start = System.currentTimeMillis();\n    @Override\n    public boolean preHandle(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Object o) throws Exception {\n        start = System.currentTimeMillis();\n        return true;\n    }\n \n    @Override\n    public void postHandle(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Object o, ModelAndView modelAndView) throws Exception {\n        System.out.println(\"Interceptor cost=\"+(System.currentTimeMillis()-start));\n    }\n \n    @Override\n    public void afterCompletion(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Object o, Exception e) throws Exception {\n    }\n}\n```\n\n　　这里我们需要实现 HandlerInterceptor 这个接口，这个接口包括三个方法，preHandle 是请求执行前执行的，postHandler 是请求结束执行的，但只有 preHandle 方法返回 true 的时候才会执行，afterCompletion 是视图渲染完成后才执行，同样需要 preHandle 返回 true，该方法通常用于清理资源等工作。除了实现上面的接口外，我们还需对其进行配置：\n\n```java\n@Configuration\npublic class InterceptorConfig extends WebMvcConfigurerAdapter {\n \n    @Override\n    public void addInterceptors(InterceptorRegistry registry) {\n        registry.addInterceptor(new LogCostInterceptor()).addPathPatterns(\"/**\");\n        super.addInterceptors(registry);\n    }\n}\n```\n\n　　这里我们继承了 WebMVCConfigurerAdapter，看过前面的文章的朋友应该已经见过这个类了，在进行静态资源目录配置的时候我们用到过这个类。这里我们重写了 addInterceptors 这个方法，进行拦截器的配置，主要配置项就两个，一个是指定拦截器，第二个是指定拦截的 URL。现在我们再启动系统访问任意一个 URL：\n\n![](https://images2017.cnblogs.com/blog/820406/201801/820406-20180130003851859-2140257073.png)\n\n 　　可以看到，我们通过拦截器实现了同样的功能。不过这里还要说明一点的是，其实这个实现是有问题的，因为 preHandle 和 postHandle 是两个方法，所以我们这里不得不设置一个共享变量 start 来存储开始值，但是这样就会存在线程安全问题。当然，我们可以通过其他方法来解决，比如通过 ThreadLocal 就可以很好的解决这个问题，有兴趣的同学可以自己实现。不过通过这一点我们其实可以看到，虽然拦截器在很多场景下优于过滤器，但是在这种场景下，过滤器比拦截器实现起来更简单。\n","source":"_posts/Spring-Boot配置拦截器和过滤器.md","raw":"title: Spring Boot配置拦截器和过滤器\nauthor: Asia Cui\ntags:\n  - Spring Boot\ncategories:\n  - 配置\ndate: 2019-01-16 13:43:00\n---\n## 一、拦截器与过滤器\n\n　　在讲 Spring boot 之前，我们先了解一下过滤器和拦截器。这两者在功能方面很类似，但是在具体技术实现方面，差距还是比较大的。在分析两者的区别之前，我们先理解一下 AOP 的概念，AOP 不是一种具体的技术，而是一种编程思想。在面向对象编程的过程中，我们很容易通过继承、多态来解决纵向扩展。 但是对于横向的功能，比如，在所有的 service 方法中开启事务，或者统一记录日志等功能，面向对象的是无法解决的。所以 AOP——面向切面编程其实是面向对象编程思想的一个补充。而我们今天讲的过滤器和拦截器都属于面向切面编程的具体实现。而两者的主要区别包括以下几个方面：\n\n　　1、Filter 是依赖于 Servlet 容器，属于 Servlet 规范的一部分，而拦截器则是独立存在的，可以在任何情况下使用。\n\n　　2、Filter 的执行由 Servlet 容器回调完成，而拦截器通常通过动态代理的方式来执行。\n\n　　3、Filter 的生命周期由 Servlet 容器管理，而拦截器则可以通过 IoC 容器来管理，因此可以通过注入等方式来获取其他 Bean 的实例，因此使用会更方便。\n\n## 二、过滤器的配置\n\n　　现在我们通过过滤器来实现记录请求执行时间的功能，其实现如下：\n\n```java\npublic class LogCostFilter implements Filter {\n    @Override\n   public void init(FilterConfig filterConfig) throws ServletException {\n\n   }\n \n\t@Override\n\tpublic void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, \t\t\t\tFilterChain filterChain) throws IOException, ServletException {\n\t\n    \t\tlong start = System.currentTimeMillis();\n    \t\tfilterChain.doFilter(servletRequest,servletResponse);\n    \t\tSystem.out.println(\"Execute cost=\"+(System.currentTimeMillis()-start));\n\t}\n \n\t@Override\n\tpublic void destroy() {\n \n\t}\n}\n```\n\n　　这段代码的逻辑比较简单，就是在方法执行前先记录时间戳，然后通过过滤器链完成请求的执行，在返回结果之间计算执行的时间。这里需要主要，这个类必须继承 Filter 类，这个是 Servlet 的规范，这个跟以前的 Web 项目没区别。但是，有了过滤器类以后，以前的 web 项目可以在 web.xml 中进行配置，但是 spring boot 项目并没有 web.xml 这个文件，那怎么配置？在 Spring boot 中，我们需要 FilterRegistrationBean 来完成配置。其实现过程如下：\n\n```java\n@Configuration\npublic class FilterConfig {\n \n    @Bean\n    public FilterRegistrationBean registFilter() {\n        FilterRegistrationBean registration = new FilterRegistrationBean();\n        registration.setFilter(new LogCostFilter());\n        registration.addUrlPatterns(\"/*\");\n        registration.setName(\"LogCostFilter\");\n        registration.setOrder(1);\n        return registration;\n    }\n \n}\n```\n\n\n\n　　这样配置就完成了，需要配置的选项主要包括实例化 Filter 类，然后指定 url 的匹配模式，设置过滤器名称和执行顺序，这个过程和在 web.xml 中配置其实没什么区别，只是形式不同而已。现在我们可以启动服务器访问任意 URL：\n\n![](https://images2017.cnblogs.com/blog/820406/201801/820406-20180129231150312-465693715.png)\n\n　　大家可以看到上面的配置已经生效了。除了通过 FilterRegistrationBean 来配置以外，还有一种更直接的办法，直接通过注解就可以完成了：\n\n```java\n@WebFilter(urlPatterns = \"/*\", filterName = \"logFilter2\")\npublic class LogCostFilter2 implements Filter {\n    @Override\n    public void init(FilterConfig filterConfig) throws ServletException {\n \n    }\n \n    @Override\n    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {\n        long start = System.currentTimeMillis();\n        filterChain.doFilter(servletRequest, servletResponse);\n        System.out.println(\"LogFilter2 Execute cost=\" + (System.currentTimeMillis() - start));\n    }\n \n    @Override\n    public void destroy() {\n \n    }\n}\n```\n\n　　这里直接用 @WebFilter 就可以进行配置，同样，可以设置 url 匹配模式，过滤器名称等。这里需要注意一点的是 @WebFilter 这个注解是 Servlet3.0 的规范，并不是 Spring boot 提供的。除了这个注解以外，我们还需在配置类中加另外一个注解：@ServletComponetScan，指定扫描的包。\n\n```java\n@SpringBootApplication\n@MapperScan(\"com.pandy.blog.dao\")\n@ServletComponentScan(\"com.pandy.blog.filters\")\npublic class Application {\n    public static void main(String[] args) throws Exception {\n        SpringApplication.run(Application.class, args);\n    }\n}\n```\n\n　　现在，我们再来访问一下任意 URL：\n\n![](https://images2017.cnblogs.com/blog/820406/201801/820406-20180129232130046-1905239306.png)\n\n　　可以看到，我们配置的两个过滤器都生效了。细心的读者会发现，第二个 Filter 我们并没有指定执行的顺序，但是却在第一个 Filter 之前执行。这里需要解释一下，@WebFilter 这个注解并没有指定执行顺序的属性，其执行顺序依赖于 Filter 的名称，是根据 Filter 类名（注意不是配置的 filter 的名字）的字母顺序倒序排列，并且 @WebFilter 指定的过滤器优先级都高于 FilterRegistrationBean 配置的过滤器。有兴趣的朋友可以自己实验一下。\n\n## 三、拦截器的配置\n\n 　　上面我们已经介绍了过滤器的配置方法，接下来我们再来看看如何配置一个拦截器。我们使用拦截器来实现上面同样的功能，记录请求的执行时间。首先我们实现拦截器类：\n\n```java\npublic class LogCostInterceptor implements HandlerInterceptor {\n    long start = System.currentTimeMillis();\n    @Override\n    public boolean preHandle(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Object o) throws Exception {\n        start = System.currentTimeMillis();\n        return true;\n    }\n \n    @Override\n    public void postHandle(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Object o, ModelAndView modelAndView) throws Exception {\n        System.out.println(\"Interceptor cost=\"+(System.currentTimeMillis()-start));\n    }\n \n    @Override\n    public void afterCompletion(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Object o, Exception e) throws Exception {\n    }\n}\n```\n\n　　这里我们需要实现 HandlerInterceptor 这个接口，这个接口包括三个方法，preHandle 是请求执行前执行的，postHandler 是请求结束执行的，但只有 preHandle 方法返回 true 的时候才会执行，afterCompletion 是视图渲染完成后才执行，同样需要 preHandle 返回 true，该方法通常用于清理资源等工作。除了实现上面的接口外，我们还需对其进行配置：\n\n```java\n@Configuration\npublic class InterceptorConfig extends WebMvcConfigurerAdapter {\n \n    @Override\n    public void addInterceptors(InterceptorRegistry registry) {\n        registry.addInterceptor(new LogCostInterceptor()).addPathPatterns(\"/**\");\n        super.addInterceptors(registry);\n    }\n}\n```\n\n　　这里我们继承了 WebMVCConfigurerAdapter，看过前面的文章的朋友应该已经见过这个类了，在进行静态资源目录配置的时候我们用到过这个类。这里我们重写了 addInterceptors 这个方法，进行拦截器的配置，主要配置项就两个，一个是指定拦截器，第二个是指定拦截的 URL。现在我们再启动系统访问任意一个 URL：\n\n![](https://images2017.cnblogs.com/blog/820406/201801/820406-20180130003851859-2140257073.png)\n\n 　　可以看到，我们通过拦截器实现了同样的功能。不过这里还要说明一点的是，其实这个实现是有问题的，因为 preHandle 和 postHandle 是两个方法，所以我们这里不得不设置一个共享变量 start 来存储开始值，但是这样就会存在线程安全问题。当然，我们可以通过其他方法来解决，比如通过 ThreadLocal 就可以很好的解决这个问题，有兴趣的同学可以自己实现。不过通过这一点我们其实可以看到，虽然拦截器在很多场景下优于过滤器，但是在这种场景下，过滤器比拦截器实现起来更简单。\n","slug":"Spring-Boot配置拦截器和过滤器","published":1,"updated":"2019-01-16T05:49:31.824Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjs17mi06002opwgtu2t6dnf9","content":"<h2 id=\"一、拦截器与过滤器\"><a href=\"#一、拦截器与过滤器\" class=\"headerlink\" title=\"一、拦截器与过滤器\"></a>一、拦截器与过滤器</h2><p>　　在讲 Spring boot 之前，我们先了解一下过滤器和拦截器。这两者在功能方面很类似，但是在具体技术实现方面，差距还是比较大的。在分析两者的区别之前，我们先理解一下 AOP 的概念，AOP 不是一种具体的技术，而是一种编程思想。在面向对象编程的过程中，我们很容易通过继承、多态来解决纵向扩展。 但是对于横向的功能，比如，在所有的 service 方法中开启事务，或者统一记录日志等功能，面向对象的是无法解决的。所以 AOP——面向切面编程其实是面向对象编程思想的一个补充。而我们今天讲的过滤器和拦截器都属于面向切面编程的具体实现。而两者的主要区别包括以下几个方面：</p>\n<p>　　1、Filter 是依赖于 Servlet 容器，属于 Servlet 规范的一部分，而拦截器则是独立存在的，可以在任何情况下使用。</p>\n<p>　　2、Filter 的执行由 Servlet 容器回调完成，而拦截器通常通过动态代理的方式来执行。</p>\n<p>　　3、Filter 的生命周期由 Servlet 容器管理，而拦截器则可以通过 IoC 容器来管理，因此可以通过注入等方式来获取其他 Bean 的实例，因此使用会更方便。</p>\n<h2 id=\"二、过滤器的配置\"><a href=\"#二、过滤器的配置\" class=\"headerlink\" title=\"二、过滤器的配置\"></a>二、过滤器的配置</h2><p>　　现在我们通过过滤器来实现记录请求执行时间的功能，其实现如下：</p>\n<pre class=\"line-numbers language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">LogCostFilter</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Filter</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@Override</span>\n   <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">init</span><span class=\"token punctuation\">(</span>FilterConfig filterConfig<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> ServletException <span class=\"token punctuation\">{</span>\n\n   <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">doFilter</span><span class=\"token punctuation\">(</span>ServletRequest servletRequest<span class=\"token punctuation\">,</span> ServletResponse servletResponse<span class=\"token punctuation\">,</span>                 FilterChain filterChain<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> IOException<span class=\"token punctuation\">,</span> ServletException <span class=\"token punctuation\">{</span>\n\n            <span class=\"token keyword\">long</span> start <span class=\"token operator\">=</span> System<span class=\"token punctuation\">.</span><span class=\"token function\">currentTimeMillis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            filterChain<span class=\"token punctuation\">.</span><span class=\"token function\">doFilter</span><span class=\"token punctuation\">(</span>servletRequest<span class=\"token punctuation\">,</span>servletResponse<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            System<span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Execute cost=\"</span><span class=\"token operator\">+</span><span class=\"token punctuation\">(</span>System<span class=\"token punctuation\">.</span><span class=\"token function\">currentTimeMillis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-</span>start<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">destroy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>　　这段代码的逻辑比较简单，就是在方法执行前先记录时间戳，然后通过过滤器链完成请求的执行，在返回结果之间计算执行的时间。这里需要主要，这个类必须继承 Filter 类，这个是 Servlet 的规范，这个跟以前的 Web 项目没区别。但是，有了过滤器类以后，以前的 web 项目可以在 web.xml 中进行配置，但是 spring boot 项目并没有 web.xml 这个文件，那怎么配置？在 Spring boot 中，我们需要 FilterRegistrationBean 来完成配置。其实现过程如下：</p>\n<pre class=\"line-numbers language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FilterConfig</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> FilterRegistrationBean <span class=\"token function\">registFilter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        FilterRegistrationBean registration <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FilterRegistrationBean</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        registration<span class=\"token punctuation\">.</span><span class=\"token function\">setFilter</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">LogCostFilter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        registration<span class=\"token punctuation\">.</span><span class=\"token function\">addUrlPatterns</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/*\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        registration<span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"LogCostFilter\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        registration<span class=\"token punctuation\">.</span><span class=\"token function\">setOrder</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> registration<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>　　这样配置就完成了，需要配置的选项主要包括实例化 Filter 类，然后指定 url 的匹配模式，设置过滤器名称和执行顺序，这个过程和在 web.xml 中配置其实没什么区别，只是形式不同而已。现在我们可以启动服务器访问任意 URL：</p>\n<p><img src=\"https://images2017.cnblogs.com/blog/820406/201801/820406-20180129231150312-465693715.png\" alt=\"\"></p>\n<p>　　大家可以看到上面的配置已经生效了。除了通过 FilterRegistrationBean 来配置以外，还有一种更直接的办法，直接通过注解就可以完成了：</p>\n<pre class=\"line-numbers language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@WebFilter</span><span class=\"token punctuation\">(</span>urlPatterns <span class=\"token operator\">=</span> <span class=\"token string\">\"/*\"</span><span class=\"token punctuation\">,</span> filterName <span class=\"token operator\">=</span> <span class=\"token string\">\"logFilter2\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">LogCostFilter2</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Filter</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">init</span><span class=\"token punctuation\">(</span>FilterConfig filterConfig<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> ServletException <span class=\"token punctuation\">{</span>\n\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">doFilter</span><span class=\"token punctuation\">(</span>ServletRequest servletRequest<span class=\"token punctuation\">,</span> ServletResponse servletResponse<span class=\"token punctuation\">,</span> FilterChain filterChain<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> IOException<span class=\"token punctuation\">,</span> ServletException <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">long</span> start <span class=\"token operator\">=</span> System<span class=\"token punctuation\">.</span><span class=\"token function\">currentTimeMillis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        filterChain<span class=\"token punctuation\">.</span><span class=\"token function\">doFilter</span><span class=\"token punctuation\">(</span>servletRequest<span class=\"token punctuation\">,</span> servletResponse<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        System<span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"LogFilter2 Execute cost=\"</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>System<span class=\"token punctuation\">.</span><span class=\"token function\">currentTimeMillis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> start<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">destroy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>　　这里直接用 @WebFilter 就可以进行配置，同样，可以设置 url 匹配模式，过滤器名称等。这里需要注意一点的是 @WebFilter 这个注解是 Servlet3.0 的规范，并不是 Spring boot 提供的。除了这个注解以外，我们还需在配置类中加另外一个注解：@ServletComponetScan，指定扫描的包。</p>\n<pre class=\"line-numbers language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@SpringBootApplication</span>\n<span class=\"token annotation punctuation\">@MapperScan</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"com.pandy.blog.dao\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@ServletComponentScan</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"com.pandy.blog.filters\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Application</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span>String<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> Exception <span class=\"token punctuation\">{</span>\n        SpringApplication<span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span>Application<span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>　　现在，我们再来访问一下任意 URL：</p>\n<p><img src=\"https://images2017.cnblogs.com/blog/820406/201801/820406-20180129232130046-1905239306.png\" alt=\"\"></p>\n<p>　　可以看到，我们配置的两个过滤器都生效了。细心的读者会发现，第二个 Filter 我们并没有指定执行的顺序，但是却在第一个 Filter 之前执行。这里需要解释一下，@WebFilter 这个注解并没有指定执行顺序的属性，其执行顺序依赖于 Filter 的名称，是根据 Filter 类名（注意不是配置的 filter 的名字）的字母顺序倒序排列，并且 @WebFilter 指定的过滤器优先级都高于 FilterRegistrationBean 配置的过滤器。有兴趣的朋友可以自己实验一下。</p>\n<h2 id=\"三、拦截器的配置\"><a href=\"#三、拦截器的配置\" class=\"headerlink\" title=\"三、拦截器的配置\"></a>三、拦截器的配置</h2><p> 　　上面我们已经介绍了过滤器的配置方法，接下来我们再来看看如何配置一个拦截器。我们使用拦截器来实现上面同样的功能，记录请求的执行时间。首先我们实现拦截器类：</p>\n<pre class=\"line-numbers language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">LogCostInterceptor</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">HandlerInterceptor</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">long</span> start <span class=\"token operator\">=</span> System<span class=\"token punctuation\">.</span><span class=\"token function\">currentTimeMillis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">preHandle</span><span class=\"token punctuation\">(</span>HttpServletRequest httpServletRequest<span class=\"token punctuation\">,</span> HttpServletResponse httpServletResponse<span class=\"token punctuation\">,</span> Object o<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> Exception <span class=\"token punctuation\">{</span>\n        start <span class=\"token operator\">=</span> System<span class=\"token punctuation\">.</span><span class=\"token function\">currentTimeMillis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">postHandle</span><span class=\"token punctuation\">(</span>HttpServletRequest httpServletRequest<span class=\"token punctuation\">,</span> HttpServletResponse httpServletResponse<span class=\"token punctuation\">,</span> Object o<span class=\"token punctuation\">,</span> ModelAndView modelAndView<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> Exception <span class=\"token punctuation\">{</span>\n        System<span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Interceptor cost=\"</span><span class=\"token operator\">+</span><span class=\"token punctuation\">(</span>System<span class=\"token punctuation\">.</span><span class=\"token function\">currentTimeMillis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-</span>start<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">afterCompletion</span><span class=\"token punctuation\">(</span>HttpServletRequest httpServletRequest<span class=\"token punctuation\">,</span> HttpServletResponse httpServletResponse<span class=\"token punctuation\">,</span> Object o<span class=\"token punctuation\">,</span> Exception e<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> Exception <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>　　这里我们需要实现 HandlerInterceptor 这个接口，这个接口包括三个方法，preHandle 是请求执行前执行的，postHandler 是请求结束执行的，但只有 preHandle 方法返回 true 的时候才会执行，afterCompletion 是视图渲染完成后才执行，同样需要 preHandle 返回 true，该方法通常用于清理资源等工作。除了实现上面的接口外，我们还需对其进行配置：</p>\n<pre class=\"line-numbers language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">InterceptorConfig</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">WebMvcConfigurerAdapter</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">addInterceptors</span><span class=\"token punctuation\">(</span>InterceptorRegistry registry<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        registry<span class=\"token punctuation\">.</span><span class=\"token function\">addInterceptor</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">LogCostInterceptor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addPathPatterns</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/**\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">addInterceptors</span><span class=\"token punctuation\">(</span>registry<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>　　这里我们继承了 WebMVCConfigurerAdapter，看过前面的文章的朋友应该已经见过这个类了，在进行静态资源目录配置的时候我们用到过这个类。这里我们重写了 addInterceptors 这个方法，进行拦截器的配置，主要配置项就两个，一个是指定拦截器，第二个是指定拦截的 URL。现在我们再启动系统访问任意一个 URL：</p>\n<p><img src=\"https://images2017.cnblogs.com/blog/820406/201801/820406-20180130003851859-2140257073.png\" alt=\"\"></p>\n<p> 　　可以看到，我们通过拦截器实现了同样的功能。不过这里还要说明一点的是，其实这个实现是有问题的，因为 preHandle 和 postHandle 是两个方法，所以我们这里不得不设置一个共享变量 start 来存储开始值，但是这样就会存在线程安全问题。当然，我们可以通过其他方法来解决，比如通过 ThreadLocal 就可以很好的解决这个问题，有兴趣的同学可以自己实现。不过通过这一点我们其实可以看到，虽然拦截器在很多场景下优于过滤器，但是在这种场景下，过滤器比拦截器实现起来更简单。</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"一、拦截器与过滤器\"><a href=\"#一、拦截器与过滤器\" class=\"headerlink\" title=\"一、拦截器与过滤器\"></a>一、拦截器与过滤器</h2><p>　　在讲 Spring boot 之前，我们先了解一下过滤器和拦截器。这两者在功能方面很类似，但是在具体技术实现方面，差距还是比较大的。在分析两者的区别之前，我们先理解一下 AOP 的概念，AOP 不是一种具体的技术，而是一种编程思想。在面向对象编程的过程中，我们很容易通过继承、多态来解决纵向扩展。 但是对于横向的功能，比如，在所有的 service 方法中开启事务，或者统一记录日志等功能，面向对象的是无法解决的。所以 AOP——面向切面编程其实是面向对象编程思想的一个补充。而我们今天讲的过滤器和拦截器都属于面向切面编程的具体实现。而两者的主要区别包括以下几个方面：</p>\n<p>　　1、Filter 是依赖于 Servlet 容器，属于 Servlet 规范的一部分，而拦截器则是独立存在的，可以在任何情况下使用。</p>\n<p>　　2、Filter 的执行由 Servlet 容器回调完成，而拦截器通常通过动态代理的方式来执行。</p>\n<p>　　3、Filter 的生命周期由 Servlet 容器管理，而拦截器则可以通过 IoC 容器来管理，因此可以通过注入等方式来获取其他 Bean 的实例，因此使用会更方便。</p>\n<h2 id=\"二、过滤器的配置\"><a href=\"#二、过滤器的配置\" class=\"headerlink\" title=\"二、过滤器的配置\"></a>二、过滤器的配置</h2><p>　　现在我们通过过滤器来实现记录请求执行时间的功能，其实现如下：</p>\n<pre><code class=\"java\">public class LogCostFilter implements Filter {\n    @Override\n   public void init(FilterConfig filterConfig) throws ServletException {\n\n   }\n\n    @Override\n    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse,                 FilterChain filterChain) throws IOException, ServletException {\n\n            long start = System.currentTimeMillis();\n            filterChain.doFilter(servletRequest,servletResponse);\n            System.out.println(&quot;Execute cost=&quot;+(System.currentTimeMillis()-start));\n    }\n\n    @Override\n    public void destroy() {\n\n    }\n}\n</code></pre>\n<p>　　这段代码的逻辑比较简单，就是在方法执行前先记录时间戳，然后通过过滤器链完成请求的执行，在返回结果之间计算执行的时间。这里需要主要，这个类必须继承 Filter 类，这个是 Servlet 的规范，这个跟以前的 Web 项目没区别。但是，有了过滤器类以后，以前的 web 项目可以在 web.xml 中进行配置，但是 spring boot 项目并没有 web.xml 这个文件，那怎么配置？在 Spring boot 中，我们需要 FilterRegistrationBean 来完成配置。其实现过程如下：</p>\n<pre><code class=\"java\">@Configuration\npublic class FilterConfig {\n\n    @Bean\n    public FilterRegistrationBean registFilter() {\n        FilterRegistrationBean registration = new FilterRegistrationBean();\n        registration.setFilter(new LogCostFilter());\n        registration.addUrlPatterns(&quot;/*&quot;);\n        registration.setName(&quot;LogCostFilter&quot;);\n        registration.setOrder(1);\n        return registration;\n    }\n\n}\n</code></pre>\n<p>　　这样配置就完成了，需要配置的选项主要包括实例化 Filter 类，然后指定 url 的匹配模式，设置过滤器名称和执行顺序，这个过程和在 web.xml 中配置其实没什么区别，只是形式不同而已。现在我们可以启动服务器访问任意 URL：</p>\n<p><img src=\"https://images2017.cnblogs.com/blog/820406/201801/820406-20180129231150312-465693715.png\" alt=\"\"></p>\n<p>　　大家可以看到上面的配置已经生效了。除了通过 FilterRegistrationBean 来配置以外，还有一种更直接的办法，直接通过注解就可以完成了：</p>\n<pre><code class=\"java\">@WebFilter(urlPatterns = &quot;/*&quot;, filterName = &quot;logFilter2&quot;)\npublic class LogCostFilter2 implements Filter {\n    @Override\n    public void init(FilterConfig filterConfig) throws ServletException {\n\n    }\n\n    @Override\n    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {\n        long start = System.currentTimeMillis();\n        filterChain.doFilter(servletRequest, servletResponse);\n        System.out.println(&quot;LogFilter2 Execute cost=&quot; + (System.currentTimeMillis() - start));\n    }\n\n    @Override\n    public void destroy() {\n\n    }\n}\n</code></pre>\n<p>　　这里直接用 @WebFilter 就可以进行配置，同样，可以设置 url 匹配模式，过滤器名称等。这里需要注意一点的是 @WebFilter 这个注解是 Servlet3.0 的规范，并不是 Spring boot 提供的。除了这个注解以外，我们还需在配置类中加另外一个注解：@ServletComponetScan，指定扫描的包。</p>\n<pre><code class=\"java\">@SpringBootApplication\n@MapperScan(&quot;com.pandy.blog.dao&quot;)\n@ServletComponentScan(&quot;com.pandy.blog.filters&quot;)\npublic class Application {\n    public static void main(String[] args) throws Exception {\n        SpringApplication.run(Application.class, args);\n    }\n}\n</code></pre>\n<p>　　现在，我们再来访问一下任意 URL：</p>\n<p><img src=\"https://images2017.cnblogs.com/blog/820406/201801/820406-20180129232130046-1905239306.png\" alt=\"\"></p>\n<p>　　可以看到，我们配置的两个过滤器都生效了。细心的读者会发现，第二个 Filter 我们并没有指定执行的顺序，但是却在第一个 Filter 之前执行。这里需要解释一下，@WebFilter 这个注解并没有指定执行顺序的属性，其执行顺序依赖于 Filter 的名称，是根据 Filter 类名（注意不是配置的 filter 的名字）的字母顺序倒序排列，并且 @WebFilter 指定的过滤器优先级都高于 FilterRegistrationBean 配置的过滤器。有兴趣的朋友可以自己实验一下。</p>\n<h2 id=\"三、拦截器的配置\"><a href=\"#三、拦截器的配置\" class=\"headerlink\" title=\"三、拦截器的配置\"></a>三、拦截器的配置</h2><p> 　　上面我们已经介绍了过滤器的配置方法，接下来我们再来看看如何配置一个拦截器。我们使用拦截器来实现上面同样的功能，记录请求的执行时间。首先我们实现拦截器类：</p>\n<pre><code class=\"java\">public class LogCostInterceptor implements HandlerInterceptor {\n    long start = System.currentTimeMillis();\n    @Override\n    public boolean preHandle(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Object o) throws Exception {\n        start = System.currentTimeMillis();\n        return true;\n    }\n\n    @Override\n    public void postHandle(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Object o, ModelAndView modelAndView) throws Exception {\n        System.out.println(&quot;Interceptor cost=&quot;+(System.currentTimeMillis()-start));\n    }\n\n    @Override\n    public void afterCompletion(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Object o, Exception e) throws Exception {\n    }\n}\n</code></pre>\n<p>　　这里我们需要实现 HandlerInterceptor 这个接口，这个接口包括三个方法，preHandle 是请求执行前执行的，postHandler 是请求结束执行的，但只有 preHandle 方法返回 true 的时候才会执行，afterCompletion 是视图渲染完成后才执行，同样需要 preHandle 返回 true，该方法通常用于清理资源等工作。除了实现上面的接口外，我们还需对其进行配置：</p>\n<pre><code class=\"java\">@Configuration\npublic class InterceptorConfig extends WebMvcConfigurerAdapter {\n\n    @Override\n    public void addInterceptors(InterceptorRegistry registry) {\n        registry.addInterceptor(new LogCostInterceptor()).addPathPatterns(&quot;/**&quot;);\n        super.addInterceptors(registry);\n    }\n}\n</code></pre>\n<p>　　这里我们继承了 WebMVCConfigurerAdapter，看过前面的文章的朋友应该已经见过这个类了，在进行静态资源目录配置的时候我们用到过这个类。这里我们重写了 addInterceptors 这个方法，进行拦截器的配置，主要配置项就两个，一个是指定拦截器，第二个是指定拦截的 URL。现在我们再启动系统访问任意一个 URL：</p>\n<p><img src=\"https://images2017.cnblogs.com/blog/820406/201801/820406-20180130003851859-2140257073.png\" alt=\"\"></p>\n<p> 　　可以看到，我们通过拦截器实现了同样的功能。不过这里还要说明一点的是，其实这个实现是有问题的，因为 preHandle 和 postHandle 是两个方法，所以我们这里不得不设置一个共享变量 start 来存储开始值，但是这样就会存在线程安全问题。当然，我们可以通过其他方法来解决，比如通过 ThreadLocal 就可以很好的解决这个问题，有兴趣的同学可以自己实现。不过通过这一点我们其实可以看到，虽然拦截器在很多场景下优于过滤器，但是在这种场景下，过滤器比拦截器实现起来更简单。</p>\n"},{"title":"SpringBoot常用注解大全","author":"Asia Cui","date":"2019-01-21T01:48:00.000Z","_content":"### 一、注解 (annotations) 列表\n\n@SpringBootApplication：\n\n包含了 @ComponentScan、@Configuration 和 @EnableAutoConfiguration 注解。其中 @ComponentScan 让 spring Boot 扫描到 Configuration 类并把它加入到程序上下文。\n\n@Configuration 等同于 spring 的 XML 配置文件；使用 Java 代码可以检查类型安全。\n\n@EnableAutoConfiguration 自动配置。\n\n@ComponentScan 组件扫描，可自动发现和装配一些 Bean。\n\n@Component 可配合 CommandLineRunner 使用，在程序启动后执行一些基础任务。\n\n@RestController 注解是 @Controller 和 @ResponseBody 的合集, 表示这是个控制器 bean, 并且是将函数的返回值直 接填入 HTTP 响应体中, 是 REST 风格的控制器。\n\n@Autowired 自动导入。\n\n@PathVariable 获取参数。\n\n@JsonBackReference 解决嵌套外链问题。\n\n@RepositoryRestResourcepublic 配合 spring-boot-starter-data-rest 使用。\n\n### 二、注解 (annotations) 详解\n\n@SpringBootApplication：申明让 spring boot 自动给程序进行必要的配置，这个配置等同于：@Configuration ，@EnableAutoConfiguration 和 @ComponentScan 三个配置。\n\n```java\npackage com.example.myproject; \nimport org.springframework.boot.SpringApplication; \nimport org.springframework.boot.autoconfigure.SpringBootApplication;\n@SpringBootApplication // same as @Configuration @EnableAutoConfiguration @ComponentScan \npublic class Application { \n    public static void main(String[] args) { \n        SpringApplication.run(Application.class, args); \n    } \n}\n```\n\n@ResponseBody：表示该方法的返回结果直接写入 HTTP response body 中，一般在异步获取数据时使用，用于构建 RESTful 的 api。在使用 @RequestMapping 后，返回值通常解析为跳转路径，加上 @responsebody 后返回结果不会被解析为跳转路径，而是直接写入 HTTP response body 中。比如异步获取 json 数据，加上 @responsebody 后，会直接返回 json 数据。该注解一般会配合 @RequestMapping 一起使用。示例代码：\n\n```java\n@RequestMapping(“/test”) \n@ResponseBody \npublic String test(){\n    return”ok”; \n}\n```\n\n@Controller：用于定义控制器类，在 spring 项目中由控制器负责将用户发来的 URL 请求转发到对应的服务接口（service 层），一般这个注解在类中，通常方法需要配合注解 @RequestMapping。示例代码：\n\n```java\n@Controller \n@RequestMapping(“/demoInfo”) \npublicclass DemoController { \n@Autowired \nprivate DemoInfoService demoInfoService;\n\n@RequestMapping(\"/hello\")\npublic String hello(Map<String,Object> map){\n   System.out.println(\"DemoController.hello()\");\n   map.put(\"hello\",\"from TemplateController.helloHtml\");\n   //会使用hello.html或者hello.ftl模板进行渲染显示.\n   return\"/hello\";\n}\n}\n```\n\n@RestController：用于标注控制层组件 (如 struts 中的 action)，@ResponseBody 和 @Controller 的合集。示例代码：\n\n```java\npackage com.kfit.demo.web;\n\nimport org.springframework.web.bind.annotation.RequestMapping; \nimport org.springframework.web.bind.annotation.RestController;\n\n@RestController \n@RequestMapping(“/demoInfo2”) \npublicclass DemoController2 {\n\n@RequestMapping(\"/test\")\npublic String test(){\n   return\"ok\";\n}\n}\n```\n\n@RequestMapping：提供路由信息，负责 URL 到 Controller 中的具体函数的映射。\n\n@EnableAutoConfiguration：Spring Boot 自动配置（auto-configuration）：尝试根据你添加的 jar 依赖自动配置你的 Spring 应用。例如，如果你的 classpath 下存在 HSQLDB，并且你没有手动配置任何数据库连接 beans，那么我们将自动配置一个内存型（in-memory）数据库”。\n\n你可以将 @EnableAutoConfiguration 或者 @SpringBootApplication 注解添加到一个 @Configuration 类上来选择自动配置。如果发现应用了你不想要的特定自动配置类，你可以使用 @EnableAutoConfiguration 注解的排除属性来禁用它们。\n\n@ComponentScan：表示将该类自动发现扫描组件。个人理解相当于，如果扫描到有 @Component、@Controller、@Service 等这些注解的类，并注册为 Bean，可以自动收集所有的 Spring 组件，包括 @Configuration 类。我们经常使用 @ComponentScan 注解搜索 beans，并结合 @Autowired 注解导入。可以自动收集所有的 Spring 组件，包括 @Configuration 类。\n\n我们经常使用 @ComponentScan 注解搜索 beans，并结合 @Autowired 注解导入。如果没有配置的话，Spring Boot 会扫描启动类所在包下以及子包下的使用了 @Service,@Repository 等注解的类。\n\n@Configuration：相当于传统的 xml 配置文件，如果有些第三方库需要用到 xml 文件，建议仍然通过 @Configuration 类作为项目的配置主类——可以使用 @ImportResource 注解加载 xml 配置文件。\n\n@Import：用来导入其他配置类。\n\n@ImportResource：用来加载 xml 配置文件。\n\n@Autowired：自动导入依赖的 bean\n\n@Service：一般用于修饰 service 层的组件\n\n@Repository：使用 @Repository 注解可以确保 DAO 或者 repositories 提供异常转译，这个注解修饰的 DAO 或者 repositories 类会被 ComponetScan 发现并配置，同时也不需要为它们提供 XML 配置项。\n\n@Bean：用 @Bean 标注方法等价于 XML 中配置的 bean。\n\n@Value：注入 Spring boot application.properties 配置的属性的值。示例代码：\n\n```java\n@Value(value = “#{message}”) \nprivate String message;\n```\n\n@Inject：等价于默认的 @Autowired，只是没有 required 属性；\n\n@Component：泛指组件，当组件不好归类的时候，我们可以使用这个注解进行标注。\n\n@Bean: 相当于 XML 中的, 放在方法的上面，而不是类，意思是产生一个 bean, 并交给 spring 管理。\n\n@AutoWired：自动导入依赖的 bean。byType 方式。把配置好的 Bean 拿来用，完成属性、方法的组装，它可以对类成员变量、方法及构造函数进行标注，完成自动装配的工作。当加上（required=false）时，就算找不到 bean 也不报错。\n\n@Qualifier：当有多个同一类型的 Bean 时，可以用 @Qualifier(“name”) 来指定。与 @Autowired 配合使用。@Qualifier 限定描述符除了能根据名字进行注入，但能进行更细粒度的控制如何选择候选者，具体使用方式如下：\n\n```java\n@Autowired \n@Qualifier(value = “demoInfoService”) \nprivate DemoInfoService demoInfoService;\n```\n\n@Resource(name=”name”,type=”type”)：没有括号内内容的话，默认 byName。与 @Autowired 干类似的事。\n\n### 三、JPA 注解\n\n@Entity：@Table(name=”“)：表明这是一个实体类。一般用于 jpa 这两个注解一般一块使用，但是如果表名和实体类名相同的话，@Table 可以省略\n\n@MappedSuperClass: 用在确定是父类的 entity 上。父类的属性子类可以继承。\n\n@NoRepositoryBean: 一般用作父类的 repository，有这个注解，spring 不会去实例化该 repository。\n\n@Column：如果字段名与列名相同，则可以省略。\n\n@Id：表示该属性为主键。\n\n@GeneratedValue(strategy = GenerationType.SEQUENCE,generator = “repair_seq”)：表示主键生成策略是 sequence（可以为 Auto、IDENTITY、native 等，Auto 表示可在多个数据库间切换），指定 sequence 的名字是 repair_seq。\n\n@SequenceGeneretor(name = “repair_seq”, sequenceName = “seq_repair”, allocationSize = 1)：name 为 sequence 的名称，以便使用，sequenceName 为数据库的 sequence 名称，两个名称可以一致。\n\n@Transient：表示该属性并非一个到数据库表的字段的映射, ORM 框架将忽略该属性。如果一个属性并非数据库表的字段映射, 就务必将其标示为 @Transient, 否则, ORM 框架默认其注解为 @Basic。@Basic(fetch=FetchType.LAZY)：标记可以指定实体属性的加载方式\n\n@JsonIgnore：作用是 json 序列化时将 Java bean 中的一些属性忽略掉, 序列化和反序列化都受影响。\n\n@JoinColumn（name=”loginId”）: 一对一：本表中指向另一个表的外键。一对多：另一个表指向本表的外键。\n\n@OneToOne、@OneToMany、@ManyToOne：对应 hibernate 配置文件中的一对一，一对多，多对一。\n\n### 四、springMVC 相关注解\n\n@RequestMapping：@RequestMapping(“/path”)表示该控制器处理所有 “/path” 的 UR L 请求。RequestMapping 是一个用来处理请求地址映射的注解，可用于类或方法上。\n\n用于类上，表示类中的所有响应请求的方法都是以该地址作为父路径。\n\n**该注解有六个属性：**\n\n1.  params: 指定 request 中必须包含某些参数值是，才让该方法处理。\n\n2.  headers: 指定 request 中必须包含某些指定的 header 值，才能让该方法处理请求。\n\n3.  value: 指定请求的实际地址，指定的地址可以是 URI Template 模式\n\n4.  method: 指定请求的 method 类型， GET、POST、PUT、DELETE 等\n\n5.  consumes: 指定处理请求的提交内容类型（Content-Type），如 application/json,text/html;\n\n6.  produces: 指定返回的内容类型，仅当 request 请求头中的 (Accept) 类型中包含该指定类型才返回\n\n@RequestParam：用在方法的参数前面。\n\n```java\n@RequestParam \nString a =request.getParameter(“a”);\n```\n\n@PathVariable: 路径变量。如\n\n```java\n@RequestMapping(“user/get/mac/{macAddress}”) \npublic String getByMacAddress(@PathVariable String macAddress){ \n//do something; \n} \n```\n\n参数与大括号里的名字一样要相同。\n\n### 五、全局异常处理\n\n@ControllerAdvice：包含 @Component。可以被扫描到。统一处理异常。\n\n@ExceptionHandler（Exception.class）：用在方法上面表示遇到这个异常就执行以下方法。","source":"_posts/SpringBoot常用注解大全.md","raw":"title: SpringBoot常用注解大全\nauthor: Asia Cui\ntags:\n  - Spring Boot\ncategories:\n  - 常用注解\ndate: 2019-01-21 09:48:00\n---\n### 一、注解 (annotations) 列表\n\n@SpringBootApplication：\n\n包含了 @ComponentScan、@Configuration 和 @EnableAutoConfiguration 注解。其中 @ComponentScan 让 spring Boot 扫描到 Configuration 类并把它加入到程序上下文。\n\n@Configuration 等同于 spring 的 XML 配置文件；使用 Java 代码可以检查类型安全。\n\n@EnableAutoConfiguration 自动配置。\n\n@ComponentScan 组件扫描，可自动发现和装配一些 Bean。\n\n@Component 可配合 CommandLineRunner 使用，在程序启动后执行一些基础任务。\n\n@RestController 注解是 @Controller 和 @ResponseBody 的合集, 表示这是个控制器 bean, 并且是将函数的返回值直 接填入 HTTP 响应体中, 是 REST 风格的控制器。\n\n@Autowired 自动导入。\n\n@PathVariable 获取参数。\n\n@JsonBackReference 解决嵌套外链问题。\n\n@RepositoryRestResourcepublic 配合 spring-boot-starter-data-rest 使用。\n\n### 二、注解 (annotations) 详解\n\n@SpringBootApplication：申明让 spring boot 自动给程序进行必要的配置，这个配置等同于：@Configuration ，@EnableAutoConfiguration 和 @ComponentScan 三个配置。\n\n```java\npackage com.example.myproject; \nimport org.springframework.boot.SpringApplication; \nimport org.springframework.boot.autoconfigure.SpringBootApplication;\n@SpringBootApplication // same as @Configuration @EnableAutoConfiguration @ComponentScan \npublic class Application { \n    public static void main(String[] args) { \n        SpringApplication.run(Application.class, args); \n    } \n}\n```\n\n@ResponseBody：表示该方法的返回结果直接写入 HTTP response body 中，一般在异步获取数据时使用，用于构建 RESTful 的 api。在使用 @RequestMapping 后，返回值通常解析为跳转路径，加上 @responsebody 后返回结果不会被解析为跳转路径，而是直接写入 HTTP response body 中。比如异步获取 json 数据，加上 @responsebody 后，会直接返回 json 数据。该注解一般会配合 @RequestMapping 一起使用。示例代码：\n\n```java\n@RequestMapping(“/test”) \n@ResponseBody \npublic String test(){\n    return”ok”; \n}\n```\n\n@Controller：用于定义控制器类，在 spring 项目中由控制器负责将用户发来的 URL 请求转发到对应的服务接口（service 层），一般这个注解在类中，通常方法需要配合注解 @RequestMapping。示例代码：\n\n```java\n@Controller \n@RequestMapping(“/demoInfo”) \npublicclass DemoController { \n@Autowired \nprivate DemoInfoService demoInfoService;\n\n@RequestMapping(\"/hello\")\npublic String hello(Map<String,Object> map){\n   System.out.println(\"DemoController.hello()\");\n   map.put(\"hello\",\"from TemplateController.helloHtml\");\n   //会使用hello.html或者hello.ftl模板进行渲染显示.\n   return\"/hello\";\n}\n}\n```\n\n@RestController：用于标注控制层组件 (如 struts 中的 action)，@ResponseBody 和 @Controller 的合集。示例代码：\n\n```java\npackage com.kfit.demo.web;\n\nimport org.springframework.web.bind.annotation.RequestMapping; \nimport org.springframework.web.bind.annotation.RestController;\n\n@RestController \n@RequestMapping(“/demoInfo2”) \npublicclass DemoController2 {\n\n@RequestMapping(\"/test\")\npublic String test(){\n   return\"ok\";\n}\n}\n```\n\n@RequestMapping：提供路由信息，负责 URL 到 Controller 中的具体函数的映射。\n\n@EnableAutoConfiguration：Spring Boot 自动配置（auto-configuration）：尝试根据你添加的 jar 依赖自动配置你的 Spring 应用。例如，如果你的 classpath 下存在 HSQLDB，并且你没有手动配置任何数据库连接 beans，那么我们将自动配置一个内存型（in-memory）数据库”。\n\n你可以将 @EnableAutoConfiguration 或者 @SpringBootApplication 注解添加到一个 @Configuration 类上来选择自动配置。如果发现应用了你不想要的特定自动配置类，你可以使用 @EnableAutoConfiguration 注解的排除属性来禁用它们。\n\n@ComponentScan：表示将该类自动发现扫描组件。个人理解相当于，如果扫描到有 @Component、@Controller、@Service 等这些注解的类，并注册为 Bean，可以自动收集所有的 Spring 组件，包括 @Configuration 类。我们经常使用 @ComponentScan 注解搜索 beans，并结合 @Autowired 注解导入。可以自动收集所有的 Spring 组件，包括 @Configuration 类。\n\n我们经常使用 @ComponentScan 注解搜索 beans，并结合 @Autowired 注解导入。如果没有配置的话，Spring Boot 会扫描启动类所在包下以及子包下的使用了 @Service,@Repository 等注解的类。\n\n@Configuration：相当于传统的 xml 配置文件，如果有些第三方库需要用到 xml 文件，建议仍然通过 @Configuration 类作为项目的配置主类——可以使用 @ImportResource 注解加载 xml 配置文件。\n\n@Import：用来导入其他配置类。\n\n@ImportResource：用来加载 xml 配置文件。\n\n@Autowired：自动导入依赖的 bean\n\n@Service：一般用于修饰 service 层的组件\n\n@Repository：使用 @Repository 注解可以确保 DAO 或者 repositories 提供异常转译，这个注解修饰的 DAO 或者 repositories 类会被 ComponetScan 发现并配置，同时也不需要为它们提供 XML 配置项。\n\n@Bean：用 @Bean 标注方法等价于 XML 中配置的 bean。\n\n@Value：注入 Spring boot application.properties 配置的属性的值。示例代码：\n\n```java\n@Value(value = “#{message}”) \nprivate String message;\n```\n\n@Inject：等价于默认的 @Autowired，只是没有 required 属性；\n\n@Component：泛指组件，当组件不好归类的时候，我们可以使用这个注解进行标注。\n\n@Bean: 相当于 XML 中的, 放在方法的上面，而不是类，意思是产生一个 bean, 并交给 spring 管理。\n\n@AutoWired：自动导入依赖的 bean。byType 方式。把配置好的 Bean 拿来用，完成属性、方法的组装，它可以对类成员变量、方法及构造函数进行标注，完成自动装配的工作。当加上（required=false）时，就算找不到 bean 也不报错。\n\n@Qualifier：当有多个同一类型的 Bean 时，可以用 @Qualifier(“name”) 来指定。与 @Autowired 配合使用。@Qualifier 限定描述符除了能根据名字进行注入，但能进行更细粒度的控制如何选择候选者，具体使用方式如下：\n\n```java\n@Autowired \n@Qualifier(value = “demoInfoService”) \nprivate DemoInfoService demoInfoService;\n```\n\n@Resource(name=”name”,type=”type”)：没有括号内内容的话，默认 byName。与 @Autowired 干类似的事。\n\n### 三、JPA 注解\n\n@Entity：@Table(name=”“)：表明这是一个实体类。一般用于 jpa 这两个注解一般一块使用，但是如果表名和实体类名相同的话，@Table 可以省略\n\n@MappedSuperClass: 用在确定是父类的 entity 上。父类的属性子类可以继承。\n\n@NoRepositoryBean: 一般用作父类的 repository，有这个注解，spring 不会去实例化该 repository。\n\n@Column：如果字段名与列名相同，则可以省略。\n\n@Id：表示该属性为主键。\n\n@GeneratedValue(strategy = GenerationType.SEQUENCE,generator = “repair_seq”)：表示主键生成策略是 sequence（可以为 Auto、IDENTITY、native 等，Auto 表示可在多个数据库间切换），指定 sequence 的名字是 repair_seq。\n\n@SequenceGeneretor(name = “repair_seq”, sequenceName = “seq_repair”, allocationSize = 1)：name 为 sequence 的名称，以便使用，sequenceName 为数据库的 sequence 名称，两个名称可以一致。\n\n@Transient：表示该属性并非一个到数据库表的字段的映射, ORM 框架将忽略该属性。如果一个属性并非数据库表的字段映射, 就务必将其标示为 @Transient, 否则, ORM 框架默认其注解为 @Basic。@Basic(fetch=FetchType.LAZY)：标记可以指定实体属性的加载方式\n\n@JsonIgnore：作用是 json 序列化时将 Java bean 中的一些属性忽略掉, 序列化和反序列化都受影响。\n\n@JoinColumn（name=”loginId”）: 一对一：本表中指向另一个表的外键。一对多：另一个表指向本表的外键。\n\n@OneToOne、@OneToMany、@ManyToOne：对应 hibernate 配置文件中的一对一，一对多，多对一。\n\n### 四、springMVC 相关注解\n\n@RequestMapping：@RequestMapping(“/path”)表示该控制器处理所有 “/path” 的 UR L 请求。RequestMapping 是一个用来处理请求地址映射的注解，可用于类或方法上。\n\n用于类上，表示类中的所有响应请求的方法都是以该地址作为父路径。\n\n**该注解有六个属性：**\n\n1.  params: 指定 request 中必须包含某些参数值是，才让该方法处理。\n\n2.  headers: 指定 request 中必须包含某些指定的 header 值，才能让该方法处理请求。\n\n3.  value: 指定请求的实际地址，指定的地址可以是 URI Template 模式\n\n4.  method: 指定请求的 method 类型， GET、POST、PUT、DELETE 等\n\n5.  consumes: 指定处理请求的提交内容类型（Content-Type），如 application/json,text/html;\n\n6.  produces: 指定返回的内容类型，仅当 request 请求头中的 (Accept) 类型中包含该指定类型才返回\n\n@RequestParam：用在方法的参数前面。\n\n```java\n@RequestParam \nString a =request.getParameter(“a”);\n```\n\n@PathVariable: 路径变量。如\n\n```java\n@RequestMapping(“user/get/mac/{macAddress}”) \npublic String getByMacAddress(@PathVariable String macAddress){ \n//do something; \n} \n```\n\n参数与大括号里的名字一样要相同。\n\n### 五、全局异常处理\n\n@ControllerAdvice：包含 @Component。可以被扫描到。统一处理异常。\n\n@ExceptionHandler（Exception.class）：用在方法上面表示遇到这个异常就执行以下方法。","slug":"SpringBoot常用注解大全","published":1,"updated":"2019-01-21T01:49:31.112Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjs17mi09002spwgtetmc4l31","content":"<h3 id=\"一、注解-annotations-列表\"><a href=\"#一、注解-annotations-列表\" class=\"headerlink\" title=\"一、注解 (annotations) 列表\"></a>一、注解 (annotations) 列表</h3><p>@SpringBootApplication：</p>\n<p>包含了 @ComponentScan、@Configuration 和 @EnableAutoConfiguration 注解。其中 @ComponentScan 让 spring Boot 扫描到 Configuration 类并把它加入到程序上下文。</p>\n<p>@Configuration 等同于 spring 的 XML 配置文件；使用 Java 代码可以检查类型安全。</p>\n<p>@EnableAutoConfiguration 自动配置。</p>\n<p>@ComponentScan 组件扫描，可自动发现和装配一些 Bean。</p>\n<p>@Component 可配合 CommandLineRunner 使用，在程序启动后执行一些基础任务。</p>\n<p>@RestController 注解是 @Controller 和 @ResponseBody 的合集, 表示这是个控制器 bean, 并且是将函数的返回值直 接填入 HTTP 响应体中, 是 REST 风格的控制器。</p>\n<p>@Autowired 自动导入。</p>\n<p>@PathVariable 获取参数。</p>\n<p>@JsonBackReference 解决嵌套外链问题。</p>\n<p>@RepositoryRestResourcepublic 配合 spring-boot-starter-data-rest 使用。</p>\n<h3 id=\"二、注解-annotations-详解\"><a href=\"#二、注解-annotations-详解\" class=\"headerlink\" title=\"二、注解 (annotations) 详解\"></a>二、注解 (annotations) 详解</h3><p>@SpringBootApplication：申明让 spring boot 自动给程序进行必要的配置，这个配置等同于：@Configuration ，@EnableAutoConfiguration 和 @ComponentScan 三个配置。</p>\n<pre class=\"line-numbers language-java\"><code class=\"language-java\"><span class=\"token keyword\">package</span> com<span class=\"token punctuation\">.</span>example<span class=\"token punctuation\">.</span>myproject<span class=\"token punctuation\">;</span> \n<span class=\"token keyword\">import</span> org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>boot<span class=\"token punctuation\">.</span>SpringApplication<span class=\"token punctuation\">;</span> \n<span class=\"token keyword\">import</span> org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>boot<span class=\"token punctuation\">.</span>autoconfigure<span class=\"token punctuation\">.</span>SpringBootApplication<span class=\"token punctuation\">;</span>\n<span class=\"token annotation punctuation\">@SpringBootApplication</span> <span class=\"token comment\" spellcheck=\"true\">// same as @Configuration @EnableAutoConfiguration @ComponentScan </span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Application</span> <span class=\"token punctuation\">{</span> \n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span>String<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> \n        SpringApplication<span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span>Application<span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \n    <span class=\"token punctuation\">}</span> \n<span class=\"token punctuation\">}</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>@ResponseBody：表示该方法的返回结果直接写入 HTTP response body 中，一般在异步获取数据时使用，用于构建 RESTful 的 api。在使用 @RequestMapping 后，返回值通常解析为跳转路径，加上 @responsebody 后返回结果不会被解析为跳转路径，而是直接写入 HTTP response body 中。比如异步获取 json 数据，加上 @responsebody 后，会直接返回 json 数据。该注解一般会配合 @RequestMapping 一起使用。示例代码：</p>\n<pre class=\"line-numbers language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span>“<span class=\"token operator\">/</span>test”<span class=\"token punctuation\">)</span> \n<span class=\"token annotation punctuation\">@ResponseBody</span> \n<span class=\"token keyword\">public</span> String <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span>”ok”<span class=\"token punctuation\">;</span> \n<span class=\"token punctuation\">}</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>@Controller：用于定义控制器类，在 spring 项目中由控制器负责将用户发来的 URL 请求转发到对应的服务接口（service 层），一般这个注解在类中，通常方法需要配合注解 @RequestMapping。示例代码：</p>\n<pre class=\"line-numbers language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Controller</span> \n<span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span>“<span class=\"token operator\">/</span>demoInfo”<span class=\"token punctuation\">)</span> \npublicclass DemoController <span class=\"token punctuation\">{</span> \n<span class=\"token annotation punctuation\">@Autowired</span> \n<span class=\"token keyword\">private</span> DemoInfoService demoInfoService<span class=\"token punctuation\">;</span>\n\n<span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/hello\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> String <span class=\"token function\">hello</span><span class=\"token punctuation\">(</span>Map<span class=\"token operator\">&lt;</span>String<span class=\"token punctuation\">,</span>Object<span class=\"token operator\">></span> map<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n   System<span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"DemoController.hello()\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   map<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hello\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"from TemplateController.helloHtml\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token comment\" spellcheck=\"true\">//会使用hello.html或者hello.ftl模板进行渲染显示.</span>\n   <span class=\"token keyword\">return</span><span class=\"token string\">\"/hello\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>@RestController：用于标注控制层组件 (如 struts 中的 action)，@ResponseBody 和 @Controller 的合集。示例代码：</p>\n<pre class=\"line-numbers language-java\"><code class=\"language-java\"><span class=\"token keyword\">package</span> com<span class=\"token punctuation\">.</span>kfit<span class=\"token punctuation\">.</span>demo<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>bind<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span>RequestMapping<span class=\"token punctuation\">;</span> \n<span class=\"token keyword\">import</span> org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>bind<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span>RestController<span class=\"token punctuation\">;</span>\n\n<span class=\"token annotation punctuation\">@RestController</span> \n<span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span>“<span class=\"token operator\">/</span>demoInfo2”<span class=\"token punctuation\">)</span> \npublicclass DemoController2 <span class=\"token punctuation\">{</span>\n\n<span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/test\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> String <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n   <span class=\"token keyword\">return</span><span class=\"token string\">\"ok\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>@RequestMapping：提供路由信息，负责 URL 到 Controller 中的具体函数的映射。</p>\n<p>@EnableAutoConfiguration：Spring Boot 自动配置（auto-configuration）：尝试根据你添加的 jar 依赖自动配置你的 Spring 应用。例如，如果你的 classpath 下存在 HSQLDB，并且你没有手动配置任何数据库连接 beans，那么我们将自动配置一个内存型（in-memory）数据库”。</p>\n<p>你可以将 @EnableAutoConfiguration 或者 @SpringBootApplication 注解添加到一个 @Configuration 类上来选择自动配置。如果发现应用了你不想要的特定自动配置类，你可以使用 @EnableAutoConfiguration 注解的排除属性来禁用它们。</p>\n<p>@ComponentScan：表示将该类自动发现扫描组件。个人理解相当于，如果扫描到有 @Component、@Controller、@Service 等这些注解的类，并注册为 Bean，可以自动收集所有的 Spring 组件，包括 @Configuration 类。我们经常使用 @ComponentScan 注解搜索 beans，并结合 @Autowired 注解导入。可以自动收集所有的 Spring 组件，包括 @Configuration 类。</p>\n<p>我们经常使用 @ComponentScan 注解搜索 beans，并结合 @Autowired 注解导入。如果没有配置的话，Spring Boot 会扫描启动类所在包下以及子包下的使用了 @Service,@Repository 等注解的类。</p>\n<p>@Configuration：相当于传统的 xml 配置文件，如果有些第三方库需要用到 xml 文件，建议仍然通过 @Configuration 类作为项目的配置主类——可以使用 @ImportResource 注解加载 xml 配置文件。</p>\n<p>@Import：用来导入其他配置类。</p>\n<p>@ImportResource：用来加载 xml 配置文件。</p>\n<p>@Autowired：自动导入依赖的 bean</p>\n<p>@Service：一般用于修饰 service 层的组件</p>\n<p>@Repository：使用 @Repository 注解可以确保 DAO 或者 repositories 提供异常转译，这个注解修饰的 DAO 或者 repositories 类会被 ComponetScan 发现并配置，同时也不需要为它们提供 XML 配置项。</p>\n<p>@Bean：用 @Bean 标注方法等价于 XML 中配置的 bean。</p>\n<p>@Value：注入 Spring boot application.properties 配置的属性的值。示例代码：</p>\n<pre class=\"line-numbers language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Value</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> “#<span class=\"token punctuation\">{</span>message<span class=\"token punctuation\">}</span>”<span class=\"token punctuation\">)</span> \n<span class=\"token keyword\">private</span> String message<span class=\"token punctuation\">;</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>@Inject：等价于默认的 @Autowired，只是没有 required 属性；</p>\n<p>@Component：泛指组件，当组件不好归类的时候，我们可以使用这个注解进行标注。</p>\n<p>@Bean: 相当于 XML 中的, 放在方法的上面，而不是类，意思是产生一个 bean, 并交给 spring 管理。</p>\n<p>@AutoWired：自动导入依赖的 bean。byType 方式。把配置好的 Bean 拿来用，完成属性、方法的组装，它可以对类成员变量、方法及构造函数进行标注，完成自动装配的工作。当加上（required=false）时，就算找不到 bean 也不报错。</p>\n<p>@Qualifier：当有多个同一类型的 Bean 时，可以用 @Qualifier(“name”) 来指定。与 @Autowired 配合使用。@Qualifier 限定描述符除了能根据名字进行注入，但能进行更细粒度的控制如何选择候选者，具体使用方式如下：</p>\n<pre class=\"line-numbers language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Autowired</span> \n<span class=\"token annotation punctuation\">@Qualifier</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> “demoInfoService”<span class=\"token punctuation\">)</span> \n<span class=\"token keyword\">private</span> DemoInfoService demoInfoService<span class=\"token punctuation\">;</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<p>@Resource(name=”name”,type=”type”)：没有括号内内容的话，默认 byName。与 @Autowired 干类似的事。</p>\n<h3 id=\"三、JPA-注解\"><a href=\"#三、JPA-注解\" class=\"headerlink\" title=\"三、JPA 注解\"></a>三、JPA 注解</h3><p>@Entity：@Table(name=”“)：表明这是一个实体类。一般用于 jpa 这两个注解一般一块使用，但是如果表名和实体类名相同的话，@Table 可以省略</p>\n<p>@MappedSuperClass: 用在确定是父类的 entity 上。父类的属性子类可以继承。</p>\n<p>@NoRepositoryBean: 一般用作父类的 repository，有这个注解，spring 不会去实例化该 repository。</p>\n<p>@Column：如果字段名与列名相同，则可以省略。</p>\n<p>@Id：表示该属性为主键。</p>\n<p>@GeneratedValue(strategy = GenerationType.SEQUENCE,generator = “repair_seq”)：表示主键生成策略是 sequence（可以为 Auto、IDENTITY、native 等，Auto 表示可在多个数据库间切换），指定 sequence 的名字是 repair_seq。</p>\n<p>@SequenceGeneretor(name = “repair_seq”, sequenceName = “seq_repair”, allocationSize = 1)：name 为 sequence 的名称，以便使用，sequenceName 为数据库的 sequence 名称，两个名称可以一致。</p>\n<p>@Transient：表示该属性并非一个到数据库表的字段的映射, ORM 框架将忽略该属性。如果一个属性并非数据库表的字段映射, 就务必将其标示为 @Transient, 否则, ORM 框架默认其注解为 @Basic。@Basic(fetch=FetchType.LAZY)：标记可以指定实体属性的加载方式</p>\n<p>@JsonIgnore：作用是 json 序列化时将 Java bean 中的一些属性忽略掉, 序列化和反序列化都受影响。</p>\n<p>@JoinColumn（name=”loginId”）: 一对一：本表中指向另一个表的外键。一对多：另一个表指向本表的外键。</p>\n<p>@OneToOne、@OneToMany、@ManyToOne：对应 hibernate 配置文件中的一对一，一对多，多对一。</p>\n<h3 id=\"四、springMVC-相关注解\"><a href=\"#四、springMVC-相关注解\" class=\"headerlink\" title=\"四、springMVC 相关注解\"></a>四、springMVC 相关注解</h3><p>@RequestMapping：@RequestMapping(“/path”)表示该控制器处理所有 “/path” 的 UR L 请求。RequestMapping 是一个用来处理请求地址映射的注解，可用于类或方法上。</p>\n<p>用于类上，表示类中的所有响应请求的方法都是以该地址作为父路径。</p>\n<p><strong>该注解有六个属性：</strong></p>\n<ol>\n<li><p>params: 指定 request 中必须包含某些参数值是，才让该方法处理。</p>\n</li>\n<li><p>headers: 指定 request 中必须包含某些指定的 header 值，才能让该方法处理请求。</p>\n</li>\n<li><p>value: 指定请求的实际地址，指定的地址可以是 URI Template 模式</p>\n</li>\n<li><p>method: 指定请求的 method 类型， GET、POST、PUT、DELETE 等</p>\n</li>\n<li><p>consumes: 指定处理请求的提交内容类型（Content-Type），如 application/json,text/html;</p>\n</li>\n<li><p>produces: 指定返回的内容类型，仅当 request 请求头中的 (Accept) 类型中包含该指定类型才返回</p>\n</li>\n</ol>\n<p>@RequestParam：用在方法的参数前面。</p>\n<pre class=\"line-numbers language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@RequestParam</span> \nString a <span class=\"token operator\">=</span>request<span class=\"token punctuation\">.</span><span class=\"token function\">getParameter</span><span class=\"token punctuation\">(</span>“a”<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>@PathVariable: 路径变量。如</p>\n<pre class=\"line-numbers language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span>“user<span class=\"token operator\">/</span>get<span class=\"token operator\">/</span>mac<span class=\"token operator\">/</span><span class=\"token punctuation\">{</span>macAddress<span class=\"token punctuation\">}</span>”<span class=\"token punctuation\">)</span> \n<span class=\"token keyword\">public</span> String <span class=\"token function\">getByMacAddress</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@PathVariable</span> String macAddress<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span> \n<span class=\"token comment\" spellcheck=\"true\">//do something; </span>\n<span class=\"token punctuation\">}</span> \n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<p>参数与大括号里的名字一样要相同。</p>\n<h3 id=\"五、全局异常处理\"><a href=\"#五、全局异常处理\" class=\"headerlink\" title=\"五、全局异常处理\"></a>五、全局异常处理</h3><p>@ControllerAdvice：包含 @Component。可以被扫描到。统一处理异常。</p>\n<p>@ExceptionHandler（Exception.class）：用在方法上面表示遇到这个异常就执行以下方法。</p>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"一、注解-annotations-列表\"><a href=\"#一、注解-annotations-列表\" class=\"headerlink\" title=\"一、注解 (annotations) 列表\"></a>一、注解 (annotations) 列表</h3><p>@SpringBootApplication：</p>\n<p>包含了 @ComponentScan、@Configuration 和 @EnableAutoConfiguration 注解。其中 @ComponentScan 让 spring Boot 扫描到 Configuration 类并把它加入到程序上下文。</p>\n<p>@Configuration 等同于 spring 的 XML 配置文件；使用 Java 代码可以检查类型安全。</p>\n<p>@EnableAutoConfiguration 自动配置。</p>\n<p>@ComponentScan 组件扫描，可自动发现和装配一些 Bean。</p>\n<p>@Component 可配合 CommandLineRunner 使用，在程序启动后执行一些基础任务。</p>\n<p>@RestController 注解是 @Controller 和 @ResponseBody 的合集, 表示这是个控制器 bean, 并且是将函数的返回值直 接填入 HTTP 响应体中, 是 REST 风格的控制器。</p>\n<p>@Autowired 自动导入。</p>\n<p>@PathVariable 获取参数。</p>\n<p>@JsonBackReference 解决嵌套外链问题。</p>\n<p>@RepositoryRestResourcepublic 配合 spring-boot-starter-data-rest 使用。</p>\n<h3 id=\"二、注解-annotations-详解\"><a href=\"#二、注解-annotations-详解\" class=\"headerlink\" title=\"二、注解 (annotations) 详解\"></a>二、注解 (annotations) 详解</h3><p>@SpringBootApplication：申明让 spring boot 自动给程序进行必要的配置，这个配置等同于：@Configuration ，@EnableAutoConfiguration 和 @ComponentScan 三个配置。</p>\n<pre><code class=\"java\">package com.example.myproject; \nimport org.springframework.boot.SpringApplication; \nimport org.springframework.boot.autoconfigure.SpringBootApplication;\n@SpringBootApplication // same as @Configuration @EnableAutoConfiguration @ComponentScan \npublic class Application { \n    public static void main(String[] args) { \n        SpringApplication.run(Application.class, args); \n    } \n}\n</code></pre>\n<p>@ResponseBody：表示该方法的返回结果直接写入 HTTP response body 中，一般在异步获取数据时使用，用于构建 RESTful 的 api。在使用 @RequestMapping 后，返回值通常解析为跳转路径，加上 @responsebody 后返回结果不会被解析为跳转路径，而是直接写入 HTTP response body 中。比如异步获取 json 数据，加上 @responsebody 后，会直接返回 json 数据。该注解一般会配合 @RequestMapping 一起使用。示例代码：</p>\n<pre><code class=\"java\">@RequestMapping(“/test”) \n@ResponseBody \npublic String test(){\n    return”ok”; \n}\n</code></pre>\n<p>@Controller：用于定义控制器类，在 spring 项目中由控制器负责将用户发来的 URL 请求转发到对应的服务接口（service 层），一般这个注解在类中，通常方法需要配合注解 @RequestMapping。示例代码：</p>\n<pre><code class=\"java\">@Controller \n@RequestMapping(“/demoInfo”) \npublicclass DemoController { \n@Autowired \nprivate DemoInfoService demoInfoService;\n\n@RequestMapping(&quot;/hello&quot;)\npublic String hello(Map&lt;String,Object&gt; map){\n   System.out.println(&quot;DemoController.hello()&quot;);\n   map.put(&quot;hello&quot;,&quot;from TemplateController.helloHtml&quot;);\n   //会使用hello.html或者hello.ftl模板进行渲染显示.\n   return&quot;/hello&quot;;\n}\n}\n</code></pre>\n<p>@RestController：用于标注控制层组件 (如 struts 中的 action)，@ResponseBody 和 @Controller 的合集。示例代码：</p>\n<pre><code class=\"java\">package com.kfit.demo.web;\n\nimport org.springframework.web.bind.annotation.RequestMapping; \nimport org.springframework.web.bind.annotation.RestController;\n\n@RestController \n@RequestMapping(“/demoInfo2”) \npublicclass DemoController2 {\n\n@RequestMapping(&quot;/test&quot;)\npublic String test(){\n   return&quot;ok&quot;;\n}\n}\n</code></pre>\n<p>@RequestMapping：提供路由信息，负责 URL 到 Controller 中的具体函数的映射。</p>\n<p>@EnableAutoConfiguration：Spring Boot 自动配置（auto-configuration）：尝试根据你添加的 jar 依赖自动配置你的 Spring 应用。例如，如果你的 classpath 下存在 HSQLDB，并且你没有手动配置任何数据库连接 beans，那么我们将自动配置一个内存型（in-memory）数据库”。</p>\n<p>你可以将 @EnableAutoConfiguration 或者 @SpringBootApplication 注解添加到一个 @Configuration 类上来选择自动配置。如果发现应用了你不想要的特定自动配置类，你可以使用 @EnableAutoConfiguration 注解的排除属性来禁用它们。</p>\n<p>@ComponentScan：表示将该类自动发现扫描组件。个人理解相当于，如果扫描到有 @Component、@Controller、@Service 等这些注解的类，并注册为 Bean，可以自动收集所有的 Spring 组件，包括 @Configuration 类。我们经常使用 @ComponentScan 注解搜索 beans，并结合 @Autowired 注解导入。可以自动收集所有的 Spring 组件，包括 @Configuration 类。</p>\n<p>我们经常使用 @ComponentScan 注解搜索 beans，并结合 @Autowired 注解导入。如果没有配置的话，Spring Boot 会扫描启动类所在包下以及子包下的使用了 @Service,@Repository 等注解的类。</p>\n<p>@Configuration：相当于传统的 xml 配置文件，如果有些第三方库需要用到 xml 文件，建议仍然通过 @Configuration 类作为项目的配置主类——可以使用 @ImportResource 注解加载 xml 配置文件。</p>\n<p>@Import：用来导入其他配置类。</p>\n<p>@ImportResource：用来加载 xml 配置文件。</p>\n<p>@Autowired：自动导入依赖的 bean</p>\n<p>@Service：一般用于修饰 service 层的组件</p>\n<p>@Repository：使用 @Repository 注解可以确保 DAO 或者 repositories 提供异常转译，这个注解修饰的 DAO 或者 repositories 类会被 ComponetScan 发现并配置，同时也不需要为它们提供 XML 配置项。</p>\n<p>@Bean：用 @Bean 标注方法等价于 XML 中配置的 bean。</p>\n<p>@Value：注入 Spring boot application.properties 配置的属性的值。示例代码：</p>\n<pre><code class=\"java\">@Value(value = “#{message}”) \nprivate String message;\n</code></pre>\n<p>@Inject：等价于默认的 @Autowired，只是没有 required 属性；</p>\n<p>@Component：泛指组件，当组件不好归类的时候，我们可以使用这个注解进行标注。</p>\n<p>@Bean: 相当于 XML 中的, 放在方法的上面，而不是类，意思是产生一个 bean, 并交给 spring 管理。</p>\n<p>@AutoWired：自动导入依赖的 bean。byType 方式。把配置好的 Bean 拿来用，完成属性、方法的组装，它可以对类成员变量、方法及构造函数进行标注，完成自动装配的工作。当加上（required=false）时，就算找不到 bean 也不报错。</p>\n<p>@Qualifier：当有多个同一类型的 Bean 时，可以用 @Qualifier(“name”) 来指定。与 @Autowired 配合使用。@Qualifier 限定描述符除了能根据名字进行注入，但能进行更细粒度的控制如何选择候选者，具体使用方式如下：</p>\n<pre><code class=\"java\">@Autowired \n@Qualifier(value = “demoInfoService”) \nprivate DemoInfoService demoInfoService;\n</code></pre>\n<p>@Resource(name=”name”,type=”type”)：没有括号内内容的话，默认 byName。与 @Autowired 干类似的事。</p>\n<h3 id=\"三、JPA-注解\"><a href=\"#三、JPA-注解\" class=\"headerlink\" title=\"三、JPA 注解\"></a>三、JPA 注解</h3><p>@Entity：@Table(name=”“)：表明这是一个实体类。一般用于 jpa 这两个注解一般一块使用，但是如果表名和实体类名相同的话，@Table 可以省略</p>\n<p>@MappedSuperClass: 用在确定是父类的 entity 上。父类的属性子类可以继承。</p>\n<p>@NoRepositoryBean: 一般用作父类的 repository，有这个注解，spring 不会去实例化该 repository。</p>\n<p>@Column：如果字段名与列名相同，则可以省略。</p>\n<p>@Id：表示该属性为主键。</p>\n<p>@GeneratedValue(strategy = GenerationType.SEQUENCE,generator = “repair_seq”)：表示主键生成策略是 sequence（可以为 Auto、IDENTITY、native 等，Auto 表示可在多个数据库间切换），指定 sequence 的名字是 repair_seq。</p>\n<p>@SequenceGeneretor(name = “repair_seq”, sequenceName = “seq_repair”, allocationSize = 1)：name 为 sequence 的名称，以便使用，sequenceName 为数据库的 sequence 名称，两个名称可以一致。</p>\n<p>@Transient：表示该属性并非一个到数据库表的字段的映射, ORM 框架将忽略该属性。如果一个属性并非数据库表的字段映射, 就务必将其标示为 @Transient, 否则, ORM 框架默认其注解为 @Basic。@Basic(fetch=FetchType.LAZY)：标记可以指定实体属性的加载方式</p>\n<p>@JsonIgnore：作用是 json 序列化时将 Java bean 中的一些属性忽略掉, 序列化和反序列化都受影响。</p>\n<p>@JoinColumn（name=”loginId”）: 一对一：本表中指向另一个表的外键。一对多：另一个表指向本表的外键。</p>\n<p>@OneToOne、@OneToMany、@ManyToOne：对应 hibernate 配置文件中的一对一，一对多，多对一。</p>\n<h3 id=\"四、springMVC-相关注解\"><a href=\"#四、springMVC-相关注解\" class=\"headerlink\" title=\"四、springMVC 相关注解\"></a>四、springMVC 相关注解</h3><p>@RequestMapping：@RequestMapping(“/path”)表示该控制器处理所有 “/path” 的 UR L 请求。RequestMapping 是一个用来处理请求地址映射的注解，可用于类或方法上。</p>\n<p>用于类上，表示类中的所有响应请求的方法都是以该地址作为父路径。</p>\n<p><strong>该注解有六个属性：</strong></p>\n<ol>\n<li><p>params: 指定 request 中必须包含某些参数值是，才让该方法处理。</p>\n</li>\n<li><p>headers: 指定 request 中必须包含某些指定的 header 值，才能让该方法处理请求。</p>\n</li>\n<li><p>value: 指定请求的实际地址，指定的地址可以是 URI Template 模式</p>\n</li>\n<li><p>method: 指定请求的 method 类型， GET、POST、PUT、DELETE 等</p>\n</li>\n<li><p>consumes: 指定处理请求的提交内容类型（Content-Type），如 application/json,text/html;</p>\n</li>\n<li><p>produces: 指定返回的内容类型，仅当 request 请求头中的 (Accept) 类型中包含该指定类型才返回</p>\n</li>\n</ol>\n<p>@RequestParam：用在方法的参数前面。</p>\n<pre><code class=\"java\">@RequestParam \nString a =request.getParameter(“a”);\n</code></pre>\n<p>@PathVariable: 路径变量。如</p>\n<pre><code class=\"java\">@RequestMapping(“user/get/mac/{macAddress}”) \npublic String getByMacAddress(@PathVariable String macAddress){ \n//do something; \n} \n</code></pre>\n<p>参数与大括号里的名字一样要相同。</p>\n<h3 id=\"五、全局异常处理\"><a href=\"#五、全局异常处理\" class=\"headerlink\" title=\"五、全局异常处理\"></a>五、全局异常处理</h3><p>@ControllerAdvice：包含 @Component。可以被扫描到。统一处理异常。</p>\n<p>@ExceptionHandler（Exception.class）：用在方法上面表示遇到这个异常就执行以下方法。</p>\n"},{"title":"Swagger的集成和使用","author":"Asia Cui","date":"2019-01-24T03:39:00.000Z","_content":"##  手写文档存在的问题\n\n*   文档需要更新的时候，需要再次发送一份给前端，也就是文档更新交流不及时。\n*   接口返回结果不明确\n*   不能直接在线测试接口，通常需要使用工具，比如：`Postman`\n*   接口文档太多，不好管理\n\n##  使用 Swagger 解决问题\n\nSwagger 也就是为了解决这个问题，当然也不能说 Swagger 就一定是完美的，当然也有缺点，最明显的就是代码植入性比较强。\n\n###  Maven\n\n增加 Swagger2 所需依赖，`pom.xml` 配置如下：\n\n```xml\n<!-- Swagger2 Begin -->\n<dependency>\n    <groupId>io.springfox</groupId>\n    <artifactId>springfox-swagger2</artifactId>\n    <version>2.8.0</version>\n</dependency>\n<dependency>\n    <groupId>io.springfox</groupId>\n    <artifactId>springfox-swagger-ui</artifactId>\n    <version>2.8.0</version>\n</dependency>\n<!-- Swagger2 End -->\n\n```\n\n###  配置 Swagger2\n\n注意：`RequestHandlerSelectors.basePackage(\"com.funtl.itoken.service.admin.controller\")` 为 Controller 包路径，不然生成的文档扫描不到接口\n\n创建一个名为 `Swagger2Config` 的 Java 配置类，代码如下：\n\n```java\npackage com.funtl.itoken.service.admin.config;\n\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport springfox.documentation.builders.ApiInfoBuilder;\nimport springfox.documentation.builders.PathSelectors;\nimport springfox.documentation.builders.RequestHandlerSelectors;\nimport springfox.documentation.service.ApiInfo;\nimport springfox.documentation.spi.DocumentationType;\nimport springfox.documentation.spring.web.plugins.Docket;\n\n@Configuration\npublic class Swagger2Config {\n    @Bean\n    public Docket createRestApi() {\n        return new Docket(DocumentationType.SWAGGER_2)\n                .apiInfo(apiInfo())\n                .select()\n                .apis(RequestHandlerSelectors.basePackage(\"com.funtl.itoken.service.admin.controller\"))\n                .paths(PathSelectors.any())\n                .build();\n    }\n\n    private ApiInfo apiInfo() {\n        return new ApiInfoBuilder()\n                .title(\"iToken API 文档\")\n                .description(\"iToken API 网关接口，http://www.baidu.com\")\n                .termsOfServiceUrl(\"http://www.baidu.com\")\n                .version(\"1.0.0\")\n                .build();\n    }\n}\n\n```\n### 启用 Swagger2\n\nApplication 中加上注解 `@EnableSwagger2` 表示开启 Swagger\n\n```java\npackage com.funtl.itoken.service.admin;\n\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\nimport org.springframework.cloud.netflix.eureka.EnableEurekaClient;\nimport springfox.documentation.swagger2.annotations.EnableSwagger2;\nimport tk.mybatis.spring.annotation.MapperScan;\n\n@SpringBootApplication(scanBasePackages = \"com.funtl.itoken\")\n@EnableEurekaClient\n@EnableSwagger2\n@MapperScan(basePackages = {\"com.funtl.itoken.common.mapper\", \"com.funtl.itoken.service.admin.mapper\"})\npublic class ServiceAdminApplication {\n    public static void main(String[] args) {\n        SpringApplication.run(ServiceAdminApplication.class, args);\n    }\n}\n\n```\n\n### 使用 Swagger2\n\n在 Controller 中增加 Swagger2 相关注解，代码如下：\n\n```java\n/**\n * 分页查询\n *\n * @param pageNum\n * @param pageSize\n * @param tbSysUserJson\n * @return\n */\n@ApiOperation(value = \"管理员分页查询\")\n@ApiImplicitParams({\n        @ApiImplicitParam(name = \"pageNum\", value = \"页码\", required = true, dataType = \"int\", paramType = \"path\"),\n        @ApiImplicitParam(name = \"pageSize\", value = \"笔数\", required = true, dataType = \"int\", paramType = \"path\"),\n        @ApiImplicitParam(name = \"tbSysUserJson\", value = \"管理员对象 JSON 字符串\", required = false, dataTypeClass = String.class, paramType = \"json\")\n})\n@RequestMapping(value = \"page/{pageNum}/{pageSize}\", method = RequestMethod.GET)\npublic BaseResult page(\n        @PathVariable(required = true) int pageNum,\n        @PathVariable(required = true) int pageSize,\n        @RequestParam(required = false) String tbSysUserJson\n) throws Exception {\n\n    TbSysUser bSysUser = null;\n    if (bSysUserJson != null) {\n        bSysUser = MapperUtils.json2pojo(bSysUserJson, TbSysUser.class);\n    }\n    PageInfo pageInf = adminService.page(pageNum, pageSize, bSysUser);\n\n    // 分页后的结果集\n    List<TbSysUser> list = pageInf.getList();\n\n    // 封装 Cursor 对象\n    BaseResult.Cursor cursor = new BaseResult.Cursor();\n    cursor.setTotal(new Long(pageInf.getTotal()).intValue());\n    cursor.setOffset(pageInf.getPageNum());\n    cursor.setLimit(pageInf.getPageSize());\n\n    return BaseResult.ok(list, cursor);\n}\n\n```\n###  Swagger 注解说明\n\nSwagger 通过注解表明该接口会生成文档，包括接口名、请求方法、参数、返回信息的等等。\n\n*   `@Api`：修饰整个类，描述 Controller 的作用\n*   `@ApiOperation`：描述一个类的一个方法，或者说一个接口\n*   `@ApiParam`：单个参数描述\n*   `@ApiModel`：用对象来接收参数\n*   `@ApiProperty`：用对象接收参数时，描述对象的一个字段\n*   `@ApiResponse`：HTTP 响应其中 1 个描述\n*   `@ApiResponses`：HTTP 响应整体描述\n*   `@ApiIgnore`：使用该注解忽略这个 API\n*   `@ApiError`：发生错误返回的信息\n*   `@ApiImplicitParam`：一个请求参数\n*   `@ApiImplicitParams`：多个请求参数\n\n###  访问 Swagger2\n\n访问地址：http://ip:port/{contentpath}/swagger-ui.html\n\n注意：\n\n- 如果项目配置了contentpath需要加上contentpath\n- 如果有权限控制拦截此请求，也会访问失败\n\n\n## 注解的使用\n\n- @ApiIgnore \n\n  例如想隐藏接口接收参数`Moedl`在swagger文档中不显示，需要在`Model`参数前添加`@ApiIgnore `属性，接口如下：\n\n  ```java\n  @ApiOperation(value = \"测试接口\")\n  @GetMapping(\"test\")\n  @ResponseBody\n  public Object test(String name, User user, @ApiIgnore Model model) {\n     return null;\n  }\n  ```\n\n- @ApiOperation\n\n  接口http请求的描述\n\n  ```java\n  @ApiOperation(value = \"获取图书信息\", notes = \"获取图书信息\", response = Book.class, responseContainer = \"Item\", produces = \"application/json\")\n  ```\n\n- @ApiResponses\n\n  用于方法，描述操作的可能响应。\n\n- @ApiImplicitParams\n\n  用于方法，参数，字段说明，表示对参数的添加元数据（说明或是否必填等）\n\n  ```java\n  @ApiImplicitParams\n  @ApiImplicitParams({\n          @ApiImplicitParam(name = \"name\", value = \"姓名\", required = true, dataType = \"String\", paramType = \"query\"),\n          @ApiImplicitParam(name = \"age\", value = \"年龄\", required = true, dataType = \"String\", paramType = \"query\")\n  })\n  ```\n作用在方法上，表示单独的请求参数 \n参数： \n1. name ：参数名。 \n\n2. value ： 参数的具体意义，作用。 \n\n3. required ： 参数是否必填。 \n\n4. dataType ：参数的数据类型。 \n\n5. paramType ：查询参数类型，这里有几种形式：\n\n   | 类型   | 作用                                     |\n   | ------ | ---------------------------------------- |\n   | path   | 以地址的形式提交数据(@PathVariable)      |\n   | query  | 直接跟参数完成自动映射赋值(url使用&连接) |\n   | body   | 以流的形式提交 仅支持POST                |\n   | header | 参数在request headers 里边提交           |\n   | form   | 以form表单的形式提交 仅支持POST          |\n\n   **踩坑**：当我发POST请求的时候，当时接受的整个参数，不论我用body还是query，后台都会报Body Missing错误。这个参数和SpringMvc中的@RequestBody冲突，索性我就去掉了paramType，对接口测试并没有影响。\n\n\n## GET请求 \n\n如果参数比较多的况下，Controller接收GET请求参数时，后台代码为了方便会把所有的参数封装到一个实体类中，此时显示实体类的所有参数到swagger中，需要使用`@ModelAttribute`注解。接口注解使用如下：\n```java\n  @ApiOperation(value = \"测试接口\")\n  @GetMapping(\"test\")\n  @ResponseBody\n  public Object test( @ModelAttribute User user) {\n     return null;\n  }\n```\n实体类注解如下：\n\n```java\n@ApiModel(value = \"用户实体类\")\n public class User  {\n     \n    @ApiModelProperty(value = \"姓名\",required = true)\n    private String name;\n    \n    @ApiModelProperty(value = \"年龄\")\n    private String age;\n  }\n  \n```","source":"_posts/Swagger的集成和使用.md","raw":"title: Swagger的集成和使用\nauthor: Asia Cui\ntags:\n  - Spring Boot\ncategories:\n  - Swagger\ndate: 2019-01-24 11:39:00\n---\n##  手写文档存在的问题\n\n*   文档需要更新的时候，需要再次发送一份给前端，也就是文档更新交流不及时。\n*   接口返回结果不明确\n*   不能直接在线测试接口，通常需要使用工具，比如：`Postman`\n*   接口文档太多，不好管理\n\n##  使用 Swagger 解决问题\n\nSwagger 也就是为了解决这个问题，当然也不能说 Swagger 就一定是完美的，当然也有缺点，最明显的就是代码植入性比较强。\n\n###  Maven\n\n增加 Swagger2 所需依赖，`pom.xml` 配置如下：\n\n```xml\n<!-- Swagger2 Begin -->\n<dependency>\n    <groupId>io.springfox</groupId>\n    <artifactId>springfox-swagger2</artifactId>\n    <version>2.8.0</version>\n</dependency>\n<dependency>\n    <groupId>io.springfox</groupId>\n    <artifactId>springfox-swagger-ui</artifactId>\n    <version>2.8.0</version>\n</dependency>\n<!-- Swagger2 End -->\n\n```\n\n###  配置 Swagger2\n\n注意：`RequestHandlerSelectors.basePackage(\"com.funtl.itoken.service.admin.controller\")` 为 Controller 包路径，不然生成的文档扫描不到接口\n\n创建一个名为 `Swagger2Config` 的 Java 配置类，代码如下：\n\n```java\npackage com.funtl.itoken.service.admin.config;\n\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport springfox.documentation.builders.ApiInfoBuilder;\nimport springfox.documentation.builders.PathSelectors;\nimport springfox.documentation.builders.RequestHandlerSelectors;\nimport springfox.documentation.service.ApiInfo;\nimport springfox.documentation.spi.DocumentationType;\nimport springfox.documentation.spring.web.plugins.Docket;\n\n@Configuration\npublic class Swagger2Config {\n    @Bean\n    public Docket createRestApi() {\n        return new Docket(DocumentationType.SWAGGER_2)\n                .apiInfo(apiInfo())\n                .select()\n                .apis(RequestHandlerSelectors.basePackage(\"com.funtl.itoken.service.admin.controller\"))\n                .paths(PathSelectors.any())\n                .build();\n    }\n\n    private ApiInfo apiInfo() {\n        return new ApiInfoBuilder()\n                .title(\"iToken API 文档\")\n                .description(\"iToken API 网关接口，http://www.baidu.com\")\n                .termsOfServiceUrl(\"http://www.baidu.com\")\n                .version(\"1.0.0\")\n                .build();\n    }\n}\n\n```\n### 启用 Swagger2\n\nApplication 中加上注解 `@EnableSwagger2` 表示开启 Swagger\n\n```java\npackage com.funtl.itoken.service.admin;\n\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\nimport org.springframework.cloud.netflix.eureka.EnableEurekaClient;\nimport springfox.documentation.swagger2.annotations.EnableSwagger2;\nimport tk.mybatis.spring.annotation.MapperScan;\n\n@SpringBootApplication(scanBasePackages = \"com.funtl.itoken\")\n@EnableEurekaClient\n@EnableSwagger2\n@MapperScan(basePackages = {\"com.funtl.itoken.common.mapper\", \"com.funtl.itoken.service.admin.mapper\"})\npublic class ServiceAdminApplication {\n    public static void main(String[] args) {\n        SpringApplication.run(ServiceAdminApplication.class, args);\n    }\n}\n\n```\n\n### 使用 Swagger2\n\n在 Controller 中增加 Swagger2 相关注解，代码如下：\n\n```java\n/**\n * 分页查询\n *\n * @param pageNum\n * @param pageSize\n * @param tbSysUserJson\n * @return\n */\n@ApiOperation(value = \"管理员分页查询\")\n@ApiImplicitParams({\n        @ApiImplicitParam(name = \"pageNum\", value = \"页码\", required = true, dataType = \"int\", paramType = \"path\"),\n        @ApiImplicitParam(name = \"pageSize\", value = \"笔数\", required = true, dataType = \"int\", paramType = \"path\"),\n        @ApiImplicitParam(name = \"tbSysUserJson\", value = \"管理员对象 JSON 字符串\", required = false, dataTypeClass = String.class, paramType = \"json\")\n})\n@RequestMapping(value = \"page/{pageNum}/{pageSize}\", method = RequestMethod.GET)\npublic BaseResult page(\n        @PathVariable(required = true) int pageNum,\n        @PathVariable(required = true) int pageSize,\n        @RequestParam(required = false) String tbSysUserJson\n) throws Exception {\n\n    TbSysUser bSysUser = null;\n    if (bSysUserJson != null) {\n        bSysUser = MapperUtils.json2pojo(bSysUserJson, TbSysUser.class);\n    }\n    PageInfo pageInf = adminService.page(pageNum, pageSize, bSysUser);\n\n    // 分页后的结果集\n    List<TbSysUser> list = pageInf.getList();\n\n    // 封装 Cursor 对象\n    BaseResult.Cursor cursor = new BaseResult.Cursor();\n    cursor.setTotal(new Long(pageInf.getTotal()).intValue());\n    cursor.setOffset(pageInf.getPageNum());\n    cursor.setLimit(pageInf.getPageSize());\n\n    return BaseResult.ok(list, cursor);\n}\n\n```\n###  Swagger 注解说明\n\nSwagger 通过注解表明该接口会生成文档，包括接口名、请求方法、参数、返回信息的等等。\n\n*   `@Api`：修饰整个类，描述 Controller 的作用\n*   `@ApiOperation`：描述一个类的一个方法，或者说一个接口\n*   `@ApiParam`：单个参数描述\n*   `@ApiModel`：用对象来接收参数\n*   `@ApiProperty`：用对象接收参数时，描述对象的一个字段\n*   `@ApiResponse`：HTTP 响应其中 1 个描述\n*   `@ApiResponses`：HTTP 响应整体描述\n*   `@ApiIgnore`：使用该注解忽略这个 API\n*   `@ApiError`：发生错误返回的信息\n*   `@ApiImplicitParam`：一个请求参数\n*   `@ApiImplicitParams`：多个请求参数\n\n###  访问 Swagger2\n\n访问地址：http://ip:port/{contentpath}/swagger-ui.html\n\n注意：\n\n- 如果项目配置了contentpath需要加上contentpath\n- 如果有权限控制拦截此请求，也会访问失败\n\n\n## 注解的使用\n\n- @ApiIgnore \n\n  例如想隐藏接口接收参数`Moedl`在swagger文档中不显示，需要在`Model`参数前添加`@ApiIgnore `属性，接口如下：\n\n  ```java\n  @ApiOperation(value = \"测试接口\")\n  @GetMapping(\"test\")\n  @ResponseBody\n  public Object test(String name, User user, @ApiIgnore Model model) {\n     return null;\n  }\n  ```\n\n- @ApiOperation\n\n  接口http请求的描述\n\n  ```java\n  @ApiOperation(value = \"获取图书信息\", notes = \"获取图书信息\", response = Book.class, responseContainer = \"Item\", produces = \"application/json\")\n  ```\n\n- @ApiResponses\n\n  用于方法，描述操作的可能响应。\n\n- @ApiImplicitParams\n\n  用于方法，参数，字段说明，表示对参数的添加元数据（说明或是否必填等）\n\n  ```java\n  @ApiImplicitParams\n  @ApiImplicitParams({\n          @ApiImplicitParam(name = \"name\", value = \"姓名\", required = true, dataType = \"String\", paramType = \"query\"),\n          @ApiImplicitParam(name = \"age\", value = \"年龄\", required = true, dataType = \"String\", paramType = \"query\")\n  })\n  ```\n作用在方法上，表示单独的请求参数 \n参数： \n1. name ：参数名。 \n\n2. value ： 参数的具体意义，作用。 \n\n3. required ： 参数是否必填。 \n\n4. dataType ：参数的数据类型。 \n\n5. paramType ：查询参数类型，这里有几种形式：\n\n   | 类型   | 作用                                     |\n   | ------ | ---------------------------------------- |\n   | path   | 以地址的形式提交数据(@PathVariable)      |\n   | query  | 直接跟参数完成自动映射赋值(url使用&连接) |\n   | body   | 以流的形式提交 仅支持POST                |\n   | header | 参数在request headers 里边提交           |\n   | form   | 以form表单的形式提交 仅支持POST          |\n\n   **踩坑**：当我发POST请求的时候，当时接受的整个参数，不论我用body还是query，后台都会报Body Missing错误。这个参数和SpringMvc中的@RequestBody冲突，索性我就去掉了paramType，对接口测试并没有影响。\n\n\n## GET请求 \n\n如果参数比较多的况下，Controller接收GET请求参数时，后台代码为了方便会把所有的参数封装到一个实体类中，此时显示实体类的所有参数到swagger中，需要使用`@ModelAttribute`注解。接口注解使用如下：\n```java\n  @ApiOperation(value = \"测试接口\")\n  @GetMapping(\"test\")\n  @ResponseBody\n  public Object test( @ModelAttribute User user) {\n     return null;\n  }\n```\n实体类注解如下：\n\n```java\n@ApiModel(value = \"用户实体类\")\n public class User  {\n     \n    @ApiModelProperty(value = \"姓名\",required = true)\n    private String name;\n    \n    @ApiModelProperty(value = \"年龄\")\n    private String age;\n  }\n  \n```","slug":"Swagger的集成和使用","published":1,"updated":"2019-01-24T03:42:29.808Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjs17mi0c002vpwgtsrv5u09v","content":"<h2 id=\"手写文档存在的问题\"><a href=\"#手写文档存在的问题\" class=\"headerlink\" title=\"手写文档存在的问题\"></a>手写文档存在的问题</h2><ul>\n<li>文档需要更新的时候，需要再次发送一份给前端，也就是文档更新交流不及时。</li>\n<li>接口返回结果不明确</li>\n<li>不能直接在线测试接口，通常需要使用工具，比如：<code>Postman</code></li>\n<li>接口文档太多，不好管理</li>\n</ul>\n<h2 id=\"使用-Swagger-解决问题\"><a href=\"#使用-Swagger-解决问题\" class=\"headerlink\" title=\"使用 Swagger 解决问题\"></a>使用 Swagger 解决问题</h2><p>Swagger 也就是为了解决这个问题，当然也不能说 Swagger 就一定是完美的，当然也有缺点，最明显的就是代码植入性比较强。</p>\n<h3 id=\"Maven\"><a href=\"#Maven\" class=\"headerlink\" title=\"Maven\"></a>Maven</h3><p>增加 Swagger2 所需依赖，<code>pom.xml</code> 配置如下：</p>\n<pre class=\"line-numbers language-xml\"><code class=\"language-xml\"><span class=\"token comment\" spellcheck=\"true\">&lt;!-- Swagger2 Begin --></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>io.springfox<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>springfox-swagger2<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>2.8.0<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>io.springfox<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>springfox-swagger-ui<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>2.8.0<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span>\n<span class=\"token comment\" spellcheck=\"true\">&lt;!-- Swagger2 End --></span>\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"配置-Swagger2\"><a href=\"#配置-Swagger2\" class=\"headerlink\" title=\"配置 Swagger2\"></a>配置 Swagger2</h3><p>注意：<code>RequestHandlerSelectors.basePackage(&quot;com.funtl.itoken.service.admin.controller&quot;)</code> 为 Controller 包路径，不然生成的文档扫描不到接口</p>\n<p>创建一个名为 <code>Swagger2Config</code> 的 Java 配置类，代码如下：</p>\n<pre class=\"line-numbers language-java\"><code class=\"language-java\"><span class=\"token keyword\">package</span> com<span class=\"token punctuation\">.</span>funtl<span class=\"token punctuation\">.</span>itoken<span class=\"token punctuation\">.</span>service<span class=\"token punctuation\">.</span>admin<span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span>Bean<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span>Configuration<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> springfox<span class=\"token punctuation\">.</span>documentation<span class=\"token punctuation\">.</span>builders<span class=\"token punctuation\">.</span>ApiInfoBuilder<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> springfox<span class=\"token punctuation\">.</span>documentation<span class=\"token punctuation\">.</span>builders<span class=\"token punctuation\">.</span>PathSelectors<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> springfox<span class=\"token punctuation\">.</span>documentation<span class=\"token punctuation\">.</span>builders<span class=\"token punctuation\">.</span>RequestHandlerSelectors<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> springfox<span class=\"token punctuation\">.</span>documentation<span class=\"token punctuation\">.</span>service<span class=\"token punctuation\">.</span>ApiInfo<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> springfox<span class=\"token punctuation\">.</span>documentation<span class=\"token punctuation\">.</span>spi<span class=\"token punctuation\">.</span>DocumentationType<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> springfox<span class=\"token punctuation\">.</span>documentation<span class=\"token punctuation\">.</span>spring<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>plugins<span class=\"token punctuation\">.</span>Docket<span class=\"token punctuation\">;</span>\n\n<span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Swagger2Config</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> Docket <span class=\"token function\">createRestApi</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Docket</span><span class=\"token punctuation\">(</span>DocumentationType<span class=\"token punctuation\">.</span>SWAGGER_2<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">apiInfo</span><span class=\"token punctuation\">(</span><span class=\"token function\">apiInfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">apis</span><span class=\"token punctuation\">(</span>RequestHandlerSelectors<span class=\"token punctuation\">.</span><span class=\"token function\">basePackage</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"com.funtl.itoken.service.admin.controller\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">paths</span><span class=\"token punctuation\">(</span>PathSelectors<span class=\"token punctuation\">.</span><span class=\"token function\">any</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> ApiInfo <span class=\"token function\">apiInfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ApiInfoBuilder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">title</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"iToken API 文档\"</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">description</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"iToken API 网关接口，http://www.baidu.com\"</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">termsOfServiceUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"http://www.baidu.com\"</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">version</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"1.0.0\"</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"启用-Swagger2\"><a href=\"#启用-Swagger2\" class=\"headerlink\" title=\"启用 Swagger2\"></a>启用 Swagger2</h3><p>Application 中加上注解 <code>@EnableSwagger2</code> 表示开启 Swagger</p>\n<pre class=\"line-numbers language-java\"><code class=\"language-java\"><span class=\"token keyword\">package</span> com<span class=\"token punctuation\">.</span>funtl<span class=\"token punctuation\">.</span>itoken<span class=\"token punctuation\">.</span>service<span class=\"token punctuation\">.</span>admin<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>boot<span class=\"token punctuation\">.</span>SpringApplication<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>boot<span class=\"token punctuation\">.</span>autoconfigure<span class=\"token punctuation\">.</span>SpringBootApplication<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>cloud<span class=\"token punctuation\">.</span>netflix<span class=\"token punctuation\">.</span>eureka<span class=\"token punctuation\">.</span>EnableEurekaClient<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> springfox<span class=\"token punctuation\">.</span>documentation<span class=\"token punctuation\">.</span>swagger2<span class=\"token punctuation\">.</span>annotations<span class=\"token punctuation\">.</span>EnableSwagger2<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> tk<span class=\"token punctuation\">.</span>mybatis<span class=\"token punctuation\">.</span>spring<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span>MapperScan<span class=\"token punctuation\">;</span>\n\n<span class=\"token annotation punctuation\">@SpringBootApplication</span><span class=\"token punctuation\">(</span>scanBasePackages <span class=\"token operator\">=</span> <span class=\"token string\">\"com.funtl.itoken\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@EnableEurekaClient</span>\n<span class=\"token annotation punctuation\">@EnableSwagger2</span>\n<span class=\"token annotation punctuation\">@MapperScan</span><span class=\"token punctuation\">(</span>basePackages <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"com.funtl.itoken.common.mapper\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"com.funtl.itoken.service.admin.mapper\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ServiceAdminApplication</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span>String<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        SpringApplication<span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span>ServiceAdminApplication<span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"使用-Swagger2\"><a href=\"#使用-Swagger2\" class=\"headerlink\" title=\"使用 Swagger2\"></a>使用 Swagger2</h3><p>在 Controller 中增加 Swagger2 相关注解，代码如下：</p>\n<pre class=\"line-numbers language-java\"><code class=\"language-java\"><span class=\"token comment\" spellcheck=\"true\">/**\n * 分页查询\n *\n * @param pageNum\n * @param pageSize\n * @param tbSysUserJson\n * @return\n */</span>\n<span class=\"token annotation punctuation\">@ApiOperation</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"管理员分页查询\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@ApiImplicitParams</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        <span class=\"token annotation punctuation\">@ApiImplicitParam</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"pageNum\"</span><span class=\"token punctuation\">,</span> value <span class=\"token operator\">=</span> <span class=\"token string\">\"页码\"</span><span class=\"token punctuation\">,</span> required <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> dataType <span class=\"token operator\">=</span> <span class=\"token string\">\"int\"</span><span class=\"token punctuation\">,</span> paramType <span class=\"token operator\">=</span> <span class=\"token string\">\"path\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token annotation punctuation\">@ApiImplicitParam</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"pageSize\"</span><span class=\"token punctuation\">,</span> value <span class=\"token operator\">=</span> <span class=\"token string\">\"笔数\"</span><span class=\"token punctuation\">,</span> required <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> dataType <span class=\"token operator\">=</span> <span class=\"token string\">\"int\"</span><span class=\"token punctuation\">,</span> paramType <span class=\"token operator\">=</span> <span class=\"token string\">\"path\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token annotation punctuation\">@ApiImplicitParam</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"tbSysUserJson\"</span><span class=\"token punctuation\">,</span> value <span class=\"token operator\">=</span> <span class=\"token string\">\"管理员对象 JSON 字符串\"</span><span class=\"token punctuation\">,</span> required <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> dataTypeClass <span class=\"token operator\">=</span> String<span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> paramType <span class=\"token operator\">=</span> <span class=\"token string\">\"json\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"page/{pageNum}/{pageSize}\"</span><span class=\"token punctuation\">,</span> method <span class=\"token operator\">=</span> RequestMethod<span class=\"token punctuation\">.</span>GET<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> BaseResult <span class=\"token function\">page</span><span class=\"token punctuation\">(</span>\n        <span class=\"token annotation punctuation\">@PathVariable</span><span class=\"token punctuation\">(</span>required <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">int</span> pageNum<span class=\"token punctuation\">,</span>\n        <span class=\"token annotation punctuation\">@PathVariable</span><span class=\"token punctuation\">(</span>required <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">int</span> pageSize<span class=\"token punctuation\">,</span>\n        <span class=\"token annotation punctuation\">@RequestParam</span><span class=\"token punctuation\">(</span>required <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span> String tbSysUserJson\n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> Exception <span class=\"token punctuation\">{</span>\n\n    TbSysUser bSysUser <span class=\"token operator\">=</span> null<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>bSysUserJson <span class=\"token operator\">!=</span> null<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        bSysUser <span class=\"token operator\">=</span> MapperUtils<span class=\"token punctuation\">.</span><span class=\"token function\">json2pojo</span><span class=\"token punctuation\">(</span>bSysUserJson<span class=\"token punctuation\">,</span> TbSysUser<span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    PageInfo pageInf <span class=\"token operator\">=</span> adminService<span class=\"token punctuation\">.</span><span class=\"token function\">page</span><span class=\"token punctuation\">(</span>pageNum<span class=\"token punctuation\">,</span> pageSize<span class=\"token punctuation\">,</span> bSysUser<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">// 分页后的结果集</span>\n    List<span class=\"token operator\">&lt;</span>TbSysUser<span class=\"token operator\">></span> list <span class=\"token operator\">=</span> pageInf<span class=\"token punctuation\">.</span><span class=\"token function\">getList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">// 封装 Cursor 对象</span>\n    BaseResult<span class=\"token punctuation\">.</span>Cursor cursor <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BaseResult<span class=\"token punctuation\">.</span>Cursor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    cursor<span class=\"token punctuation\">.</span><span class=\"token function\">setTotal</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Long</span><span class=\"token punctuation\">(</span>pageInf<span class=\"token punctuation\">.</span><span class=\"token function\">getTotal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">intValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    cursor<span class=\"token punctuation\">.</span><span class=\"token function\">setOffset</span><span class=\"token punctuation\">(</span>pageInf<span class=\"token punctuation\">.</span><span class=\"token function\">getPageNum</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    cursor<span class=\"token punctuation\">.</span><span class=\"token function\">setLimit</span><span class=\"token punctuation\">(</span>pageInf<span class=\"token punctuation\">.</span><span class=\"token function\">getPageSize</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> BaseResult<span class=\"token punctuation\">.</span><span class=\"token function\">ok</span><span class=\"token punctuation\">(</span>list<span class=\"token punctuation\">,</span> cursor<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"Swagger-注解说明\"><a href=\"#Swagger-注解说明\" class=\"headerlink\" title=\"Swagger 注解说明\"></a>Swagger 注解说明</h3><p>Swagger 通过注解表明该接口会生成文档，包括接口名、请求方法、参数、返回信息的等等。</p>\n<ul>\n<li><code>@Api</code>：修饰整个类，描述 Controller 的作用</li>\n<li><code>@ApiOperation</code>：描述一个类的一个方法，或者说一个接口</li>\n<li><code>@ApiParam</code>：单个参数描述</li>\n<li><code>@ApiModel</code>：用对象来接收参数</li>\n<li><code>@ApiProperty</code>：用对象接收参数时，描述对象的一个字段</li>\n<li><code>@ApiResponse</code>：HTTP 响应其中 1 个描述</li>\n<li><code>@ApiResponses</code>：HTTP 响应整体描述</li>\n<li><code>@ApiIgnore</code>：使用该注解忽略这个 API</li>\n<li><code>@ApiError</code>：发生错误返回的信息</li>\n<li><code>@ApiImplicitParam</code>：一个请求参数</li>\n<li><code>@ApiImplicitParams</code>：多个请求参数</li>\n</ul>\n<h3 id=\"访问-Swagger2\"><a href=\"#访问-Swagger2\" class=\"headerlink\" title=\"访问 Swagger2\"></a>访问 Swagger2</h3><p>访问地址：<a href=\"http://ip:port/{contentpath}/swagger-ui.html\" target=\"_blank\" rel=\"noopener\">http://ip:port/{contentpath}/swagger-ui.html</a></p>\n<p>注意：</p>\n<ul>\n<li>如果项目配置了contentpath需要加上contentpath</li>\n<li>如果有权限控制拦截此请求，也会访问失败</li>\n</ul>\n<h2 id=\"注解的使用\"><a href=\"#注解的使用\" class=\"headerlink\" title=\"注解的使用\"></a>注解的使用</h2><ul>\n<li><p>@ApiIgnore </p>\n<p>例如想隐藏接口接收参数<code>Moedl</code>在swagger文档中不显示，需要在<code>Model</code>参数前添加<code>@ApiIgnore</code>属性，接口如下：</p>\n<pre class=\"line-numbers language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@ApiOperation</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"测试接口\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"test\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@ResponseBody</span>\n<span class=\"token keyword\">public</span> Object <span class=\"token function\">test</span><span class=\"token punctuation\">(</span>String name<span class=\"token punctuation\">,</span> User user<span class=\"token punctuation\">,</span> <span class=\"token annotation punctuation\">@ApiIgnore</span> Model model<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n   <span class=\"token keyword\">return</span> null<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n</li>\n<li><p>@ApiOperation</p>\n<p>接口http请求的描述</p>\n<pre class=\"line-numbers language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@ApiOperation</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"获取图书信息\"</span><span class=\"token punctuation\">,</span> notes <span class=\"token operator\">=</span> <span class=\"token string\">\"获取图书信息\"</span><span class=\"token punctuation\">,</span> response <span class=\"token operator\">=</span> Book<span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> responseContainer <span class=\"token operator\">=</span> <span class=\"token string\">\"Item\"</span><span class=\"token punctuation\">,</span> produces <span class=\"token operator\">=</span> <span class=\"token string\">\"application/json\"</span><span class=\"token punctuation\">)</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n</li>\n<li><p>@ApiResponses</p>\n<p>用于方法，描述操作的可能响应。</p>\n</li>\n<li><p>@ApiImplicitParams</p>\n<p>用于方法，参数，字段说明，表示对参数的添加元数据（说明或是否必填等）</p>\n<pre class=\"line-numbers language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@ApiImplicitParams</span>\n<span class=\"token annotation punctuation\">@ApiImplicitParams</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        <span class=\"token annotation punctuation\">@ApiImplicitParam</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"name\"</span><span class=\"token punctuation\">,</span> value <span class=\"token operator\">=</span> <span class=\"token string\">\"姓名\"</span><span class=\"token punctuation\">,</span> required <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> dataType <span class=\"token operator\">=</span> <span class=\"token string\">\"String\"</span><span class=\"token punctuation\">,</span> paramType <span class=\"token operator\">=</span> <span class=\"token string\">\"query\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token annotation punctuation\">@ApiImplicitParam</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"age\"</span><span class=\"token punctuation\">,</span> value <span class=\"token operator\">=</span> <span class=\"token string\">\"年龄\"</span><span class=\"token punctuation\">,</span> required <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> dataType <span class=\"token operator\">=</span> <span class=\"token string\">\"String\"</span><span class=\"token punctuation\">,</span> paramType <span class=\"token operator\">=</span> <span class=\"token string\">\"query\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>作用在方法上，表示单独的请求参数<br>参数： </p>\n</li>\n</ul>\n<ol>\n<li><p>name ：参数名。 </p>\n</li>\n<li><p>value ： 参数的具体意义，作用。 </p>\n</li>\n<li><p>required ： 参数是否必填。 </p>\n</li>\n<li><p>dataType ：参数的数据类型。 </p>\n</li>\n<li><p>paramType ：查询参数类型，这里有几种形式：</p>\n<p>| 类型   | 作用                                     |<br>| —— | —————————————- |<br>| path   | 以地址的形式提交数据(@PathVariable)      |<br>| query  | 直接跟参数完成自动映射赋值(url使用&amp;连接) |<br>| body   | 以流的形式提交 仅支持POST                |<br>| header | 参数在request headers 里边提交           |<br>| form   | 以form表单的形式提交 仅支持POST          |</p>\n<p><strong>踩坑</strong>：当我发POST请求的时候，当时接受的整个参数，不论我用body还是query，后台都会报Body Missing错误。这个参数和SpringMvc中的@RequestBody冲突，索性我就去掉了paramType，对接口测试并没有影响。</p>\n</li>\n</ol>\n<h2 id=\"GET请求\"><a href=\"#GET请求\" class=\"headerlink\" title=\"GET请求\"></a>GET请求</h2><p>如果参数比较多的况下，Controller接收GET请求参数时，后台代码为了方便会把所有的参数封装到一个实体类中，此时显示实体类的所有参数到swagger中，需要使用<code>@ModelAttribute</code>注解。接口注解使用如下：</p>\n<pre class=\"line-numbers language-java\"><code class=\"language-java\">  <span class=\"token annotation punctuation\">@ApiOperation</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"测试接口\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"test\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token annotation punctuation\">@ResponseBody</span>\n  <span class=\"token keyword\">public</span> Object <span class=\"token function\">test</span><span class=\"token punctuation\">(</span> <span class=\"token annotation punctuation\">@ModelAttribute</span> User user<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n     <span class=\"token keyword\">return</span> null<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>实体类注解如下：</p>\n<pre class=\"line-numbers language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@ApiModel</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"用户实体类\"</span><span class=\"token punctuation\">)</span>\n <span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">User</span>  <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@ApiModelProperty</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"姓名\"</span><span class=\"token punctuation\">,</span>required <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> String name<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@ApiModelProperty</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"年龄\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> String age<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"手写文档存在的问题\"><a href=\"#手写文档存在的问题\" class=\"headerlink\" title=\"手写文档存在的问题\"></a>手写文档存在的问题</h2><ul>\n<li>文档需要更新的时候，需要再次发送一份给前端，也就是文档更新交流不及时。</li>\n<li>接口返回结果不明确</li>\n<li>不能直接在线测试接口，通常需要使用工具，比如：<code>Postman</code></li>\n<li>接口文档太多，不好管理</li>\n</ul>\n<h2 id=\"使用-Swagger-解决问题\"><a href=\"#使用-Swagger-解决问题\" class=\"headerlink\" title=\"使用 Swagger 解决问题\"></a>使用 Swagger 解决问题</h2><p>Swagger 也就是为了解决这个问题，当然也不能说 Swagger 就一定是完美的，当然也有缺点，最明显的就是代码植入性比较强。</p>\n<h3 id=\"Maven\"><a href=\"#Maven\" class=\"headerlink\" title=\"Maven\"></a>Maven</h3><p>增加 Swagger2 所需依赖，<code>pom.xml</code> 配置如下：</p>\n<pre><code class=\"xml\">&lt;!-- Swagger2 Begin --&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;io.springfox&lt;/groupId&gt;\n    &lt;artifactId&gt;springfox-swagger2&lt;/artifactId&gt;\n    &lt;version&gt;2.8.0&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;io.springfox&lt;/groupId&gt;\n    &lt;artifactId&gt;springfox-swagger-ui&lt;/artifactId&gt;\n    &lt;version&gt;2.8.0&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;!-- Swagger2 End --&gt;\n\n</code></pre>\n<h3 id=\"配置-Swagger2\"><a href=\"#配置-Swagger2\" class=\"headerlink\" title=\"配置 Swagger2\"></a>配置 Swagger2</h3><p>注意：<code>RequestHandlerSelectors.basePackage(&quot;com.funtl.itoken.service.admin.controller&quot;)</code> 为 Controller 包路径，不然生成的文档扫描不到接口</p>\n<p>创建一个名为 <code>Swagger2Config</code> 的 Java 配置类，代码如下：</p>\n<pre><code class=\"java\">package com.funtl.itoken.service.admin.config;\n\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport springfox.documentation.builders.ApiInfoBuilder;\nimport springfox.documentation.builders.PathSelectors;\nimport springfox.documentation.builders.RequestHandlerSelectors;\nimport springfox.documentation.service.ApiInfo;\nimport springfox.documentation.spi.DocumentationType;\nimport springfox.documentation.spring.web.plugins.Docket;\n\n@Configuration\npublic class Swagger2Config {\n    @Bean\n    public Docket createRestApi() {\n        return new Docket(DocumentationType.SWAGGER_2)\n                .apiInfo(apiInfo())\n                .select()\n                .apis(RequestHandlerSelectors.basePackage(&quot;com.funtl.itoken.service.admin.controller&quot;))\n                .paths(PathSelectors.any())\n                .build();\n    }\n\n    private ApiInfo apiInfo() {\n        return new ApiInfoBuilder()\n                .title(&quot;iToken API 文档&quot;)\n                .description(&quot;iToken API 网关接口，http://www.baidu.com&quot;)\n                .termsOfServiceUrl(&quot;http://www.baidu.com&quot;)\n                .version(&quot;1.0.0&quot;)\n                .build();\n    }\n}\n\n</code></pre>\n<h3 id=\"启用-Swagger2\"><a href=\"#启用-Swagger2\" class=\"headerlink\" title=\"启用 Swagger2\"></a>启用 Swagger2</h3><p>Application 中加上注解 <code>@EnableSwagger2</code> 表示开启 Swagger</p>\n<pre><code class=\"java\">package com.funtl.itoken.service.admin;\n\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\nimport org.springframework.cloud.netflix.eureka.EnableEurekaClient;\nimport springfox.documentation.swagger2.annotations.EnableSwagger2;\nimport tk.mybatis.spring.annotation.MapperScan;\n\n@SpringBootApplication(scanBasePackages = &quot;com.funtl.itoken&quot;)\n@EnableEurekaClient\n@EnableSwagger2\n@MapperScan(basePackages = {&quot;com.funtl.itoken.common.mapper&quot;, &quot;com.funtl.itoken.service.admin.mapper&quot;})\npublic class ServiceAdminApplication {\n    public static void main(String[] args) {\n        SpringApplication.run(ServiceAdminApplication.class, args);\n    }\n}\n\n</code></pre>\n<h3 id=\"使用-Swagger2\"><a href=\"#使用-Swagger2\" class=\"headerlink\" title=\"使用 Swagger2\"></a>使用 Swagger2</h3><p>在 Controller 中增加 Swagger2 相关注解，代码如下：</p>\n<pre><code class=\"java\">/**\n * 分页查询\n *\n * @param pageNum\n * @param pageSize\n * @param tbSysUserJson\n * @return\n */\n@ApiOperation(value = &quot;管理员分页查询&quot;)\n@ApiImplicitParams({\n        @ApiImplicitParam(name = &quot;pageNum&quot;, value = &quot;页码&quot;, required = true, dataType = &quot;int&quot;, paramType = &quot;path&quot;),\n        @ApiImplicitParam(name = &quot;pageSize&quot;, value = &quot;笔数&quot;, required = true, dataType = &quot;int&quot;, paramType = &quot;path&quot;),\n        @ApiImplicitParam(name = &quot;tbSysUserJson&quot;, value = &quot;管理员对象 JSON 字符串&quot;, required = false, dataTypeClass = String.class, paramType = &quot;json&quot;)\n})\n@RequestMapping(value = &quot;page/{pageNum}/{pageSize}&quot;, method = RequestMethod.GET)\npublic BaseResult page(\n        @PathVariable(required = true) int pageNum,\n        @PathVariable(required = true) int pageSize,\n        @RequestParam(required = false) String tbSysUserJson\n) throws Exception {\n\n    TbSysUser bSysUser = null;\n    if (bSysUserJson != null) {\n        bSysUser = MapperUtils.json2pojo(bSysUserJson, TbSysUser.class);\n    }\n    PageInfo pageInf = adminService.page(pageNum, pageSize, bSysUser);\n\n    // 分页后的结果集\n    List&lt;TbSysUser&gt; list = pageInf.getList();\n\n    // 封装 Cursor 对象\n    BaseResult.Cursor cursor = new BaseResult.Cursor();\n    cursor.setTotal(new Long(pageInf.getTotal()).intValue());\n    cursor.setOffset(pageInf.getPageNum());\n    cursor.setLimit(pageInf.getPageSize());\n\n    return BaseResult.ok(list, cursor);\n}\n\n</code></pre>\n<h3 id=\"Swagger-注解说明\"><a href=\"#Swagger-注解说明\" class=\"headerlink\" title=\"Swagger 注解说明\"></a>Swagger 注解说明</h3><p>Swagger 通过注解表明该接口会生成文档，包括接口名、请求方法、参数、返回信息的等等。</p>\n<ul>\n<li><code>@Api</code>：修饰整个类，描述 Controller 的作用</li>\n<li><code>@ApiOperation</code>：描述一个类的一个方法，或者说一个接口</li>\n<li><code>@ApiParam</code>：单个参数描述</li>\n<li><code>@ApiModel</code>：用对象来接收参数</li>\n<li><code>@ApiProperty</code>：用对象接收参数时，描述对象的一个字段</li>\n<li><code>@ApiResponse</code>：HTTP 响应其中 1 个描述</li>\n<li><code>@ApiResponses</code>：HTTP 响应整体描述</li>\n<li><code>@ApiIgnore</code>：使用该注解忽略这个 API</li>\n<li><code>@ApiError</code>：发生错误返回的信息</li>\n<li><code>@ApiImplicitParam</code>：一个请求参数</li>\n<li><code>@ApiImplicitParams</code>：多个请求参数</li>\n</ul>\n<h3 id=\"访问-Swagger2\"><a href=\"#访问-Swagger2\" class=\"headerlink\" title=\"访问 Swagger2\"></a>访问 Swagger2</h3><p>访问地址：<a href=\"http://ip:port/{contentpath}/swagger-ui.html\" target=\"_blank\" rel=\"noopener\">http://ip:port/{contentpath}/swagger-ui.html</a></p>\n<p>注意：</p>\n<ul>\n<li>如果项目配置了contentpath需要加上contentpath</li>\n<li>如果有权限控制拦截此请求，也会访问失败</li>\n</ul>\n<h2 id=\"注解的使用\"><a href=\"#注解的使用\" class=\"headerlink\" title=\"注解的使用\"></a>注解的使用</h2><ul>\n<li><p>@ApiIgnore </p>\n<p>例如想隐藏接口接收参数<code>Moedl</code>在swagger文档中不显示，需要在<code>Model</code>参数前添加<code>@ApiIgnore</code>属性，接口如下：</p>\n<pre><code class=\"java\">@ApiOperation(value = &quot;测试接口&quot;)\n@GetMapping(&quot;test&quot;)\n@ResponseBody\npublic Object test(String name, User user, @ApiIgnore Model model) {\n   return null;\n}\n</code></pre>\n</li>\n<li><p>@ApiOperation</p>\n<p>接口http请求的描述</p>\n<pre><code class=\"java\">@ApiOperation(value = &quot;获取图书信息&quot;, notes = &quot;获取图书信息&quot;, response = Book.class, responseContainer = &quot;Item&quot;, produces = &quot;application/json&quot;)\n</code></pre>\n</li>\n<li><p>@ApiResponses</p>\n<p>用于方法，描述操作的可能响应。</p>\n</li>\n<li><p>@ApiImplicitParams</p>\n<p>用于方法，参数，字段说明，表示对参数的添加元数据（说明或是否必填等）</p>\n<pre><code class=\"java\">@ApiImplicitParams\n@ApiImplicitParams({\n        @ApiImplicitParam(name = &quot;name&quot;, value = &quot;姓名&quot;, required = true, dataType = &quot;String&quot;, paramType = &quot;query&quot;),\n        @ApiImplicitParam(name = &quot;age&quot;, value = &quot;年龄&quot;, required = true, dataType = &quot;String&quot;, paramType = &quot;query&quot;)\n})\n</code></pre>\n<p>作用在方法上，表示单独的请求参数<br>参数： </p>\n</li>\n</ul>\n<ol>\n<li><p>name ：参数名。 </p>\n</li>\n<li><p>value ： 参数的具体意义，作用。 </p>\n</li>\n<li><p>required ： 参数是否必填。 </p>\n</li>\n<li><p>dataType ：参数的数据类型。 </p>\n</li>\n<li><p>paramType ：查询参数类型，这里有几种形式：</p>\n<p>| 类型   | 作用                                     |<br>| —— | —————————————- |<br>| path   | 以地址的形式提交数据(@PathVariable)      |<br>| query  | 直接跟参数完成自动映射赋值(url使用&amp;连接) |<br>| body   | 以流的形式提交 仅支持POST                |<br>| header | 参数在request headers 里边提交           |<br>| form   | 以form表单的形式提交 仅支持POST          |</p>\n<p><strong>踩坑</strong>：当我发POST请求的时候，当时接受的整个参数，不论我用body还是query，后台都会报Body Missing错误。这个参数和SpringMvc中的@RequestBody冲突，索性我就去掉了paramType，对接口测试并没有影响。</p>\n</li>\n</ol>\n<h2 id=\"GET请求\"><a href=\"#GET请求\" class=\"headerlink\" title=\"GET请求\"></a>GET请求</h2><p>如果参数比较多的况下，Controller接收GET请求参数时，后台代码为了方便会把所有的参数封装到一个实体类中，此时显示实体类的所有参数到swagger中，需要使用<code>@ModelAttribute</code>注解。接口注解使用如下：</p>\n<pre><code class=\"java\">  @ApiOperation(value = &quot;测试接口&quot;)\n  @GetMapping(&quot;test&quot;)\n  @ResponseBody\n  public Object test( @ModelAttribute User user) {\n     return null;\n  }\n</code></pre>\n<p>实体类注解如下：</p>\n<pre><code class=\"java\">@ApiModel(value = &quot;用户实体类&quot;)\n public class User  {\n\n    @ApiModelProperty(value = &quot;姓名&quot;,required = true)\n    private String name;\n\n    @ApiModelProperty(value = &quot;年龄&quot;)\n    private String age;\n  }\n\n</code></pre>\n"},{"title":"事务管理入门","author":"Asia Cui","date":"2019-01-22T01:50:00.000Z","_content":"\n> 说起事务，大家应该多多少少用过，尤其是在一个 service 方法中调用多次 dao 操作，我们一定要用到事务 ( `@Transational注解`)，那么这个事务的默认隔离级别和传播机制是什么呢?\n\n先来讲讲 `脏读` `不可重复读` 和 `幻读`。\n\n1.  脏读: 我们在并发编程中是很熟悉的，通俗的讲就是你读得数据已经被修改了，已经过时失去意义了。\n\n2.  不可重复读： 同一个事务里面多次读取同一行数据，却返回不同的结果。\n\n3.  幻读：同样一笔查询在整个事务过程中多次执行后，查询所得的结果集不一样。\n\n### 事务四大特性 ACID\n\n##### 1\\. 原子性 `(Atomicity)`\n\n> 要求事务所包含的全部操作是一个不可分割的整体，如果有一步发生异常，则全部不提交。\n\n##### 2\\. 一致性 `（Consistency）`\n\n> A 给 B 转钱，A 减和 B 增这两个操作必须保持一致。\n\n##### 3\\. 隔离性 `（Isolation）`\n\n> 事务会将一部分数据与其他事务隔离，防止脏读等。\n\n##### 4\\. 持久性 `（Durability）`\n\n> 事务的结果被写到持久化存储器中。\n\n### 事务四大隔离级别\n\n> 隔离级别越高，则性能相对越低，反之亦然。\n> \n> ##### 1\\. Read Uncommitted\n> \n> 最低的隔离级别，跟你直译的意思一样：可以读取其它事务未完成的结果。(脏读)\n\n很明显， `脏读` `不可重复读` 和 `幻读`这三个问题它都有。\n\n##### 2\\. Read Committed\n\n> 大部分数据库采用的**默认隔离级别**，比上一个隔离级别多了限定：在该事务完成后，才能读取该事务的数据更新后的结果。\n\n它可以避免脏读，但是也有不可重复读取和幻读的问题。\n\n##### 3\\. Repeatable Read\n\n> 可以保证在整个事务的过程中，对同一笔数据的读取结果是相同的，不管其他事务是否同时在对同一笔数据进行更新，也不管其他事务对同一笔数 据的更新提交与否。\n\nRepeatable Read 隔离级别避免了脏读和不可重复读取的问题，但无法避免幻读。\n\n##### 4\\. Serializable\n\n> 最为严格的隔离级别，所有的事务操作都必须依次顺序执行，可以避免其他隔离级别遇到的所有问题，是最为安全的隔离级别， 但同时也是性能最差的隔离级别。\n\n通常情况下，我们会使用其他隔离级别加上相应的并发锁的机制来控制对数据的访问，这样既保证 了系统性能不会损失太大，也能够一定程度上保证数据的一致性。\n\n### Spring 事务传播机制\n\n![](https://mmbiz.qpic.cn/mmbiz_png/eQPyBffYbufj62v2Y8YlK6PduUGQVluDic4XXpbR4OMSmHSC4ciapicuGohqr5jCt9RcQ7ib5PRbn5LFialQ9MDlHgg/640?wx_fmt=png)\n\n### 从 JDBC 的事务说起\n\n> 我们都知道，JDBC 给我们提供了事务。\n\n<pre style=\"box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 8px 0px 6px;background-color: rgb(32, 32, 29);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size: 10px;line-height: 12px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;\">\n\n1.  `try{`\n\n2.  `con.setAutoCommit(false);//开启事务`\n\n3.  `......`\n\n4.  `con.commit();//try的最后提交事务`\n\n5.  `} catch（） {`\n\n6.  `con.rollback();//回滚事务`\n\n7.  `}`\n\n</pre>\n\n获取事务隔离级别\n\n<pre style=\"box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 8px 0px 6px;background-color: rgb(32, 32, 29);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size: 10px;line-height: 12px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;\">\n\n1.  `Connection.getTransactionIsolation()`\n\n</pre>\n\n设置事务隔离级别\n\n<pre style=\"box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 8px 0px 6px;background-color: rgb(32, 32, 29);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size: 10px;line-height: 12px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;\">\n\n1.  `con.setTransactionIsolation(Connection.TRANSACTION_REPEATABLE_READ);`\n\n</pre>\n\n### Spring 事务机制\n\n> Spring 并不会直接管理事务，而是提供了事务管理器，将事务管理的职责委托给 JPA JDBC JTA DataSourceTransaction JMSTransactionManager 等框架提供的事务来实现。\n\n那么，Spring 提供的事务管理器是什么呢?\n\n是 `PlatformTransactionManager.java`接口:\n\n##### PlatformTransactionManager.java\n\n> Spring 提供的事务管理器。不同的事务遵循该事务管理器的 API，便能很轻松的交给 Spring 管理。\n\n<pre style=\"box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 8px 0px 6px;background-color: rgb(32, 32, 29);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size: 10px;line-height: 12px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;\">\n\n1.  `public interface PlatformTransactionManager {`\n\n2.  `// 通过Transation定义 获取Transation`\n\n3.  `TransactionStatus getTransaction(@Nullable TransactionDefinition var1) throws TransactionException;`\n\n4.  `// 提交事务`\n\n5.  `void commit(TransactionStatus var1) throws TransactionException;`\n\n6.  `// 回滚事务`\n\n7.  `void rollback(TransactionStatus var1) throws TransactionException;`\n\n8.  `}`\n\n</pre>\n\n可以看到它里面引用到了 `TransactionDefinition`和 `TransactionStatus`.\n\n##### TransactionDefinition.java\n\n> 它里面包含了事务的定义。\n\n<pre style=\"box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 8px 0px 6px;background-color: rgb(32, 32, 29);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size: 10px;line-height: 12px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;\">\n\n1.  `public interface TransactionDefinition {`\n\n2.  `// 传播机制`\n\n3.  `int PROPAGATION_REQUIRED = 0;`\n\n4.  `int PROPAGATION_SUPPORTS = 1;`\n\n5.  `int PROPAGATION_MANDATORY = 2;`\n\n6.  `int PROPAGATION_REQUIRES_NEW = 3;`\n\n7.  `int PROPAGATION_NOT_SUPPORTED = 4;`\n\n8.  `int PROPAGATION_NEVER = 5;`\n\n9.  `int PROPAGATION_NESTED = 6;`\n\n10.  `// 隔离级别`\n\n11.  `int ISOLATION_DEFAULT = -1;`\n\n12.  `int ISOLATION_READ_UNCOMMITTED = 1;`\n\n13.  `int ISOLATION_READ_COMMITTED = 2;`\n\n14.  `int ISOLATION_REPEATABLE_READ = 4;`\n\n15.  `int ISOLATION_SERIALIZABLE = 8;`\n\n16.  `int TIMEOUT_DEFAULT = -1;`\n\n18.  `int getPropagationBehavior();`\n\n19.  `// 获取隔离级别`\n\n20.  `int getIsolationLevel();`\n\n22.  `int getTimeout();`\n\n24.  `boolean isReadOnly();`\n\n26.  `@Nullable`\n\n27.  `String getName();`\n\n28.  `}`\n\n</pre>\n\n##### TransactionStatus.java\n\n> 事务的状态。\n\n<pre style=\"box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 8px 0px 6px;background-color: rgb(32, 32, 29);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size: 10px;line-height: 12px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;\">\n\n1.  `public interface TransactionStatus extends SavepointManager, Flushable {`\n\n2.  `boolean isNewTransaction();`\n\n4.  `boolean hasSavepoint();`\n\n6.  `void setRollbackOnly();`\n\n8.  `boolean isRollbackOnly();`\n\n10.  `void flush();`\n\n12.  `boolean isCompleted();`\n\n13.  `}`\n\n</pre>\n\n#### Spring 默认事务使用\n\n##### 1\\. 代码方式使用\n\n<pre style=\"box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 8px 0px 6px;background-color: rgb(32, 32, 29);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size: 10px;line-height: 12px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;\">\n\n1.  `@Autowired`\n\n2.  `private PlatformTransactionManager transactionManager;`\n\n3.  `public void testTX(){`\n\n4.  `DefaultTransactionDefinition definition = new DefaultTransactionDefinition();`\n\n5.  `TransactionStatus status = transactionManager.getTransaction(definition);`\n\n6.  `try {`\n\n7.  `// 业务逻辑`\n\n8.  `// ...`\n\n10.  `// 提交事务`\n\n11.  `transactionManager.commit(status);`\n\n12.  `}catch (Exception e){`\n\n13.  `// 发生异常，事务回滚`\n\n14.  `transactionManager.rollback(status);`\n\n15.  `}`\n\n16.  `}`\n\n</pre>\n\n##### 2\\. 注解方式使用\n\n<pre style=\"box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 8px 0px 6px;background-color: rgb(32, 32, 29);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size: 10px;line-height: 12px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;\">\n\n1.  `@Transactional`\n\n2.  `void testTX2(){`\n\n3.  `// 业务逻辑 ...`\n\n4.  `}`\n\n</pre>\n\n这不是玄学，它的底层是依靠 AOP 动态代理实现，其实重新渲染出的代码和第一个使用方式类似，不过大大减少了开发复杂度。\n\n##### 扩展：@Transactional 注解\n\n<pre style=\"box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 8px 0px 6px;background-color: rgb(32, 32, 29);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size: 10px;line-height: 12px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;\">\n\n1.  `@Target({ElementType.METHOD, ElementType.TYPE})`\n\n2.  `@Retention(RetentionPolicy.RUNTIME)`\n\n3.  `@Inherited`\n\n4.  `@Documented`\n\n5.  `public @interface Transactional {`\n\n7.  `//指定使用的事务管理器`\n\n8.  `@AliasFor(\"transactionManager\")`\n\n9.  `String value() default \"\";`\n\n11.  `@AliasFor(\"value\")`\n\n12.  `String transactionManager() default \"\";`\n\n13.  `// 可选的事务传播行为设置`\n\n14.  `Propagation propagation() default Propagation.REQUIRED;`\n\n15.  `// 可选的事务隔离级别设置`\n\n16.  `Isolation isolation() default Isolation.DEFAULT;`\n\n17.  `// 事务超时时间设置`\n\n18.  `int timeout() default -1;`\n\n19.  `// 读写或只读事务，默认读写`\n\n20.  `boolean readOnly() default false;`\n\n21.  `// 导致事务回滚的异常类数组` \n\n22.  `Class<? extends Throwable>[] rollbackFor() default {};`\n\n23.  `// 导致事务回滚的异常类名字数组`\n\n24.  `String[] rollbackForClassName() default {};`\n\n25.  `// 不会导致事务回滚的异常类数组`\n\n26.  `Class<? extends Throwable>[] noRollbackFor() default {};`\n\n27.  `// 不会导致事务回滚的异常类名字数组`\n\n28.  `String[] noRollbackForClassName() default {};`\n\n29.  `}`\n\n</pre>\n\n### Spring 事务实践\n\n> 非入门选手下面的 demo 可能会引起你的不适 (浪费时间)。 假设我要完成一个功能，当删除用户的时候，将与该用户有关的所有数据行都删除。\n\n<pre style=\"box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 8px 0px 6px;background-color: rgb(32, 32, 29);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size: 10px;line-height: 12px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;\">\n\n1.  `public void delUser(Integer userId) {`\n\n2.  `// 删除和用户相关的信息`\n\n3.  `otherRepository.deleteByUserId(userId);` \n\n4.  `// 删除用户`\n\n5.  `userRepository.deleteById(userId);`\n\n6.  `}`\n\n</pre>\n\n这样的写法一般来讲，会成功的完成任务。但是如果这样一段代码：\n\n<pre style=\"box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 8px 0px 6px;background-color: rgb(32, 32, 29);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size: 10px;line-height: 12px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;\">\n\n1.  `public void delUser(Integer userId) {`\n\n2.  `// 删除和用户相关的信息`\n\n3.  `otherRepository.deleteByUserId();`\n\n4.  `if (true) {`\n\n5.  `throw new RuntimeException(\"xxx\");`\n\n6.  `}`\n\n7.  `// 删除用户`\n\n8.  `userRepository.deleteById(userId);`\n\n9.  `}`\n\n</pre>\n\n结果会是： `deleteByUserId()`执行成功， `deleteById()`执行失败，不满足数据的一致性。\n\n所以我们需要事务来限制：要么全部执行，要么全部不执行 (方法中有异常就自动回滚)。那怎么实现呢，只需要在方法上加一个注解： `@Transactional`\n\n<pre style=\"box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 8px 0px 6px;background-color: rgb(32, 32, 29);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size: 10px;line-height: 12px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;\">\n\n1.  `@Transactional`\n\n2.  `public void delUser(Integer userId) {`\n\n3.  `// 删除和用户相关的信息`\n\n4.  `otherRepository.deleteByUserId();`\n\n5.  `if (true) {`\n\n6.  `throw new RuntimeException(\"xxx\");`\n\n7.  `}`\n\n8.  `// 删除用户`\n\n9.  `userRepository.deleteById(userId);`\n\n10.  `}`\n\n</pre>\n\n### Spring 加载第三方事务管理\n\n> 比如我有个需求 (接着上次的强票系统 II)，要求信息不能丢失，要用到 RabbitMQ 的事务管理，那怎么去加载到 Spring 的事务管理器中呢？\n\n<pre style=\"box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 8px 0px 6px;background-color: rgb(32, 32, 29);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size: 10px;line-height: 12px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;\">\n\n1.  `@Bean`\n\n2.  `public ConnectionFactory connectionFactory() {`\n\n3.  `CachingConnectionFactory connectionFactory = new CachingConnectionFactory();`\n\n4.  `return connectionFactory;`\n\n5.  `}`\n\n7.  `@Bean`\n\n8.  `public RabbitTransactionManager rabbitTransactionManager(ConnectionFactory connectionFactory) {`\n\n9.  `return new RabbitTransactionManager(connectionFactory);`\n\n10.  `}`\n\n</pre>\n\n我们只需要这样做便可以使的使用 `@Transactional注解`来实现对 RabbitMQ 的事务管理, 其它框架也类似。\n","source":"_posts/事务管理入门.md","raw":"title: 事务管理入门\nauthor: Asia Cui\ntags:\n  - Spring Boot\ncategories:\n  - 事务\ndate: 2019-01-22 09:50:00\n---\n\n> 说起事务，大家应该多多少少用过，尤其是在一个 service 方法中调用多次 dao 操作，我们一定要用到事务 ( `@Transational注解`)，那么这个事务的默认隔离级别和传播机制是什么呢?\n\n先来讲讲 `脏读` `不可重复读` 和 `幻读`。\n\n1.  脏读: 我们在并发编程中是很熟悉的，通俗的讲就是你读得数据已经被修改了，已经过时失去意义了。\n\n2.  不可重复读： 同一个事务里面多次读取同一行数据，却返回不同的结果。\n\n3.  幻读：同样一笔查询在整个事务过程中多次执行后，查询所得的结果集不一样。\n\n### 事务四大特性 ACID\n\n##### 1\\. 原子性 `(Atomicity)`\n\n> 要求事务所包含的全部操作是一个不可分割的整体，如果有一步发生异常，则全部不提交。\n\n##### 2\\. 一致性 `（Consistency）`\n\n> A 给 B 转钱，A 减和 B 增这两个操作必须保持一致。\n\n##### 3\\. 隔离性 `（Isolation）`\n\n> 事务会将一部分数据与其他事务隔离，防止脏读等。\n\n##### 4\\. 持久性 `（Durability）`\n\n> 事务的结果被写到持久化存储器中。\n\n### 事务四大隔离级别\n\n> 隔离级别越高，则性能相对越低，反之亦然。\n> \n> ##### 1\\. Read Uncommitted\n> \n> 最低的隔离级别，跟你直译的意思一样：可以读取其它事务未完成的结果。(脏读)\n\n很明显， `脏读` `不可重复读` 和 `幻读`这三个问题它都有。\n\n##### 2\\. Read Committed\n\n> 大部分数据库采用的**默认隔离级别**，比上一个隔离级别多了限定：在该事务完成后，才能读取该事务的数据更新后的结果。\n\n它可以避免脏读，但是也有不可重复读取和幻读的问题。\n\n##### 3\\. Repeatable Read\n\n> 可以保证在整个事务的过程中，对同一笔数据的读取结果是相同的，不管其他事务是否同时在对同一笔数据进行更新，也不管其他事务对同一笔数 据的更新提交与否。\n\nRepeatable Read 隔离级别避免了脏读和不可重复读取的问题，但无法避免幻读。\n\n##### 4\\. Serializable\n\n> 最为严格的隔离级别，所有的事务操作都必须依次顺序执行，可以避免其他隔离级别遇到的所有问题，是最为安全的隔离级别， 但同时也是性能最差的隔离级别。\n\n通常情况下，我们会使用其他隔离级别加上相应的并发锁的机制来控制对数据的访问，这样既保证 了系统性能不会损失太大，也能够一定程度上保证数据的一致性。\n\n### Spring 事务传播机制\n\n![](https://mmbiz.qpic.cn/mmbiz_png/eQPyBffYbufj62v2Y8YlK6PduUGQVluDic4XXpbR4OMSmHSC4ciapicuGohqr5jCt9RcQ7ib5PRbn5LFialQ9MDlHgg/640?wx_fmt=png)\n\n### 从 JDBC 的事务说起\n\n> 我们都知道，JDBC 给我们提供了事务。\n\n<pre style=\"box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 8px 0px 6px;background-color: rgb(32, 32, 29);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size: 10px;line-height: 12px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;\">\n\n1.  `try{`\n\n2.  `con.setAutoCommit(false);//开启事务`\n\n3.  `......`\n\n4.  `con.commit();//try的最后提交事务`\n\n5.  `} catch（） {`\n\n6.  `con.rollback();//回滚事务`\n\n7.  `}`\n\n</pre>\n\n获取事务隔离级别\n\n<pre style=\"box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 8px 0px 6px;background-color: rgb(32, 32, 29);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size: 10px;line-height: 12px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;\">\n\n1.  `Connection.getTransactionIsolation()`\n\n</pre>\n\n设置事务隔离级别\n\n<pre style=\"box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 8px 0px 6px;background-color: rgb(32, 32, 29);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size: 10px;line-height: 12px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;\">\n\n1.  `con.setTransactionIsolation(Connection.TRANSACTION_REPEATABLE_READ);`\n\n</pre>\n\n### Spring 事务机制\n\n> Spring 并不会直接管理事务，而是提供了事务管理器，将事务管理的职责委托给 JPA JDBC JTA DataSourceTransaction JMSTransactionManager 等框架提供的事务来实现。\n\n那么，Spring 提供的事务管理器是什么呢?\n\n是 `PlatformTransactionManager.java`接口:\n\n##### PlatformTransactionManager.java\n\n> Spring 提供的事务管理器。不同的事务遵循该事务管理器的 API，便能很轻松的交给 Spring 管理。\n\n<pre style=\"box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 8px 0px 6px;background-color: rgb(32, 32, 29);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size: 10px;line-height: 12px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;\">\n\n1.  `public interface PlatformTransactionManager {`\n\n2.  `// 通过Transation定义 获取Transation`\n\n3.  `TransactionStatus getTransaction(@Nullable TransactionDefinition var1) throws TransactionException;`\n\n4.  `// 提交事务`\n\n5.  `void commit(TransactionStatus var1) throws TransactionException;`\n\n6.  `// 回滚事务`\n\n7.  `void rollback(TransactionStatus var1) throws TransactionException;`\n\n8.  `}`\n\n</pre>\n\n可以看到它里面引用到了 `TransactionDefinition`和 `TransactionStatus`.\n\n##### TransactionDefinition.java\n\n> 它里面包含了事务的定义。\n\n<pre style=\"box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 8px 0px 6px;background-color: rgb(32, 32, 29);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size: 10px;line-height: 12px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;\">\n\n1.  `public interface TransactionDefinition {`\n\n2.  `// 传播机制`\n\n3.  `int PROPAGATION_REQUIRED = 0;`\n\n4.  `int PROPAGATION_SUPPORTS = 1;`\n\n5.  `int PROPAGATION_MANDATORY = 2;`\n\n6.  `int PROPAGATION_REQUIRES_NEW = 3;`\n\n7.  `int PROPAGATION_NOT_SUPPORTED = 4;`\n\n8.  `int PROPAGATION_NEVER = 5;`\n\n9.  `int PROPAGATION_NESTED = 6;`\n\n10.  `// 隔离级别`\n\n11.  `int ISOLATION_DEFAULT = -1;`\n\n12.  `int ISOLATION_READ_UNCOMMITTED = 1;`\n\n13.  `int ISOLATION_READ_COMMITTED = 2;`\n\n14.  `int ISOLATION_REPEATABLE_READ = 4;`\n\n15.  `int ISOLATION_SERIALIZABLE = 8;`\n\n16.  `int TIMEOUT_DEFAULT = -1;`\n\n18.  `int getPropagationBehavior();`\n\n19.  `// 获取隔离级别`\n\n20.  `int getIsolationLevel();`\n\n22.  `int getTimeout();`\n\n24.  `boolean isReadOnly();`\n\n26.  `@Nullable`\n\n27.  `String getName();`\n\n28.  `}`\n\n</pre>\n\n##### TransactionStatus.java\n\n> 事务的状态。\n\n<pre style=\"box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 8px 0px 6px;background-color: rgb(32, 32, 29);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size: 10px;line-height: 12px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;\">\n\n1.  `public interface TransactionStatus extends SavepointManager, Flushable {`\n\n2.  `boolean isNewTransaction();`\n\n4.  `boolean hasSavepoint();`\n\n6.  `void setRollbackOnly();`\n\n8.  `boolean isRollbackOnly();`\n\n10.  `void flush();`\n\n12.  `boolean isCompleted();`\n\n13.  `}`\n\n</pre>\n\n#### Spring 默认事务使用\n\n##### 1\\. 代码方式使用\n\n<pre style=\"box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 8px 0px 6px;background-color: rgb(32, 32, 29);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size: 10px;line-height: 12px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;\">\n\n1.  `@Autowired`\n\n2.  `private PlatformTransactionManager transactionManager;`\n\n3.  `public void testTX(){`\n\n4.  `DefaultTransactionDefinition definition = new DefaultTransactionDefinition();`\n\n5.  `TransactionStatus status = transactionManager.getTransaction(definition);`\n\n6.  `try {`\n\n7.  `// 业务逻辑`\n\n8.  `// ...`\n\n10.  `// 提交事务`\n\n11.  `transactionManager.commit(status);`\n\n12.  `}catch (Exception e){`\n\n13.  `// 发生异常，事务回滚`\n\n14.  `transactionManager.rollback(status);`\n\n15.  `}`\n\n16.  `}`\n\n</pre>\n\n##### 2\\. 注解方式使用\n\n<pre style=\"box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 8px 0px 6px;background-color: rgb(32, 32, 29);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size: 10px;line-height: 12px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;\">\n\n1.  `@Transactional`\n\n2.  `void testTX2(){`\n\n3.  `// 业务逻辑 ...`\n\n4.  `}`\n\n</pre>\n\n这不是玄学，它的底层是依靠 AOP 动态代理实现，其实重新渲染出的代码和第一个使用方式类似，不过大大减少了开发复杂度。\n\n##### 扩展：@Transactional 注解\n\n<pre style=\"box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 8px 0px 6px;background-color: rgb(32, 32, 29);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size: 10px;line-height: 12px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;\">\n\n1.  `@Target({ElementType.METHOD, ElementType.TYPE})`\n\n2.  `@Retention(RetentionPolicy.RUNTIME)`\n\n3.  `@Inherited`\n\n4.  `@Documented`\n\n5.  `public @interface Transactional {`\n\n7.  `//指定使用的事务管理器`\n\n8.  `@AliasFor(\"transactionManager\")`\n\n9.  `String value() default \"\";`\n\n11.  `@AliasFor(\"value\")`\n\n12.  `String transactionManager() default \"\";`\n\n13.  `// 可选的事务传播行为设置`\n\n14.  `Propagation propagation() default Propagation.REQUIRED;`\n\n15.  `// 可选的事务隔离级别设置`\n\n16.  `Isolation isolation() default Isolation.DEFAULT;`\n\n17.  `// 事务超时时间设置`\n\n18.  `int timeout() default -1;`\n\n19.  `// 读写或只读事务，默认读写`\n\n20.  `boolean readOnly() default false;`\n\n21.  `// 导致事务回滚的异常类数组` \n\n22.  `Class<? extends Throwable>[] rollbackFor() default {};`\n\n23.  `// 导致事务回滚的异常类名字数组`\n\n24.  `String[] rollbackForClassName() default {};`\n\n25.  `// 不会导致事务回滚的异常类数组`\n\n26.  `Class<? extends Throwable>[] noRollbackFor() default {};`\n\n27.  `// 不会导致事务回滚的异常类名字数组`\n\n28.  `String[] noRollbackForClassName() default {};`\n\n29.  `}`\n\n</pre>\n\n### Spring 事务实践\n\n> 非入门选手下面的 demo 可能会引起你的不适 (浪费时间)。 假设我要完成一个功能，当删除用户的时候，将与该用户有关的所有数据行都删除。\n\n<pre style=\"box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 8px 0px 6px;background-color: rgb(32, 32, 29);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size: 10px;line-height: 12px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;\">\n\n1.  `public void delUser(Integer userId) {`\n\n2.  `// 删除和用户相关的信息`\n\n3.  `otherRepository.deleteByUserId(userId);` \n\n4.  `// 删除用户`\n\n5.  `userRepository.deleteById(userId);`\n\n6.  `}`\n\n</pre>\n\n这样的写法一般来讲，会成功的完成任务。但是如果这样一段代码：\n\n<pre style=\"box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 8px 0px 6px;background-color: rgb(32, 32, 29);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size: 10px;line-height: 12px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;\">\n\n1.  `public void delUser(Integer userId) {`\n\n2.  `// 删除和用户相关的信息`\n\n3.  `otherRepository.deleteByUserId();`\n\n4.  `if (true) {`\n\n5.  `throw new RuntimeException(\"xxx\");`\n\n6.  `}`\n\n7.  `// 删除用户`\n\n8.  `userRepository.deleteById(userId);`\n\n9.  `}`\n\n</pre>\n\n结果会是： `deleteByUserId()`执行成功， `deleteById()`执行失败，不满足数据的一致性。\n\n所以我们需要事务来限制：要么全部执行，要么全部不执行 (方法中有异常就自动回滚)。那怎么实现呢，只需要在方法上加一个注解： `@Transactional`\n\n<pre style=\"box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 8px 0px 6px;background-color: rgb(32, 32, 29);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size: 10px;line-height: 12px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;\">\n\n1.  `@Transactional`\n\n2.  `public void delUser(Integer userId) {`\n\n3.  `// 删除和用户相关的信息`\n\n4.  `otherRepository.deleteByUserId();`\n\n5.  `if (true) {`\n\n6.  `throw new RuntimeException(\"xxx\");`\n\n7.  `}`\n\n8.  `// 删除用户`\n\n9.  `userRepository.deleteById(userId);`\n\n10.  `}`\n\n</pre>\n\n### Spring 加载第三方事务管理\n\n> 比如我有个需求 (接着上次的强票系统 II)，要求信息不能丢失，要用到 RabbitMQ 的事务管理，那怎么去加载到 Spring 的事务管理器中呢？\n\n<pre style=\"box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 8px 0px 6px;background-color: rgb(32, 32, 29);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size: 10px;line-height: 12px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;\">\n\n1.  `@Bean`\n\n2.  `public ConnectionFactory connectionFactory() {`\n\n3.  `CachingConnectionFactory connectionFactory = new CachingConnectionFactory();`\n\n4.  `return connectionFactory;`\n\n5.  `}`\n\n7.  `@Bean`\n\n8.  `public RabbitTransactionManager rabbitTransactionManager(ConnectionFactory connectionFactory) {`\n\n9.  `return new RabbitTransactionManager(connectionFactory);`\n\n10.  `}`\n\n</pre>\n\n我们只需要这样做便可以使的使用 `@Transactional注解`来实现对 RabbitMQ 的事务管理, 其它框架也类似。\n","slug":"事务管理入门","published":1,"updated":"2019-01-22T01:52:48.362Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjs17mi0f002ypwgtdz65rhps","content":"<blockquote>\n<p>说起事务，大家应该多多少少用过，尤其是在一个 service 方法中调用多次 dao 操作，我们一定要用到事务 ( <code>@Transational注解</code>)，那么这个事务的默认隔离级别和传播机制是什么呢?</p>\n</blockquote>\n<p>先来讲讲 <code>脏读</code> <code>不可重复读</code> 和 <code>幻读</code>。</p>\n<ol>\n<li><p>脏读: 我们在并发编程中是很熟悉的，通俗的讲就是你读得数据已经被修改了，已经过时失去意义了。</p>\n</li>\n<li><p>不可重复读： 同一个事务里面多次读取同一行数据，却返回不同的结果。</p>\n</li>\n<li><p>幻读：同样一笔查询在整个事务过程中多次执行后，查询所得的结果集不一样。</p>\n</li>\n</ol>\n<h3 id=\"事务四大特性-ACID\"><a href=\"#事务四大特性-ACID\" class=\"headerlink\" title=\"事务四大特性 ACID\"></a>事务四大特性 ACID</h3><h5 id=\"1-原子性-Atomicity\"><a href=\"#1-原子性-Atomicity\" class=\"headerlink\" title=\"1. 原子性 (Atomicity)\"></a>1. 原子性 <code>(Atomicity)</code></h5><blockquote>\n<p>要求事务所包含的全部操作是一个不可分割的整体，如果有一步发生异常，则全部不提交。</p>\n</blockquote>\n<h5 id=\"2-一致性-（Consistency）\"><a href=\"#2-一致性-（Consistency）\" class=\"headerlink\" title=\"2. 一致性 （Consistency）\"></a>2. 一致性 <code>（Consistency）</code></h5><blockquote>\n<p>A 给 B 转钱，A 减和 B 增这两个操作必须保持一致。</p>\n</blockquote>\n<h5 id=\"3-隔离性-（Isolation）\"><a href=\"#3-隔离性-（Isolation）\" class=\"headerlink\" title=\"3. 隔离性 （Isolation）\"></a>3. 隔离性 <code>（Isolation）</code></h5><blockquote>\n<p>事务会将一部分数据与其他事务隔离，防止脏读等。</p>\n</blockquote>\n<h5 id=\"4-持久性-（Durability）\"><a href=\"#4-持久性-（Durability）\" class=\"headerlink\" title=\"4. 持久性 （Durability）\"></a>4. 持久性 <code>（Durability）</code></h5><blockquote>\n<p>事务的结果被写到持久化存储器中。</p>\n</blockquote>\n<h3 id=\"事务四大隔离级别\"><a href=\"#事务四大隔离级别\" class=\"headerlink\" title=\"事务四大隔离级别\"></a>事务四大隔离级别</h3><blockquote>\n<p>隔离级别越高，则性能相对越低，反之亦然。</p>\n<h5 id=\"1-Read-Uncommitted\"><a href=\"#1-Read-Uncommitted\" class=\"headerlink\" title=\"1. Read Uncommitted\"></a>1. Read Uncommitted</h5><p>最低的隔离级别，跟你直译的意思一样：可以读取其它事务未完成的结果。(脏读)</p>\n</blockquote>\n<p>很明显， <code>脏读</code> <code>不可重复读</code> 和 <code>幻读</code>这三个问题它都有。</p>\n<h5 id=\"2-Read-Committed\"><a href=\"#2-Read-Committed\" class=\"headerlink\" title=\"2. Read Committed\"></a>2. Read Committed</h5><blockquote>\n<p>大部分数据库采用的<strong>默认隔离级别</strong>，比上一个隔离级别多了限定：在该事务完成后，才能读取该事务的数据更新后的结果。</p>\n</blockquote>\n<p>它可以避免脏读，但是也有不可重复读取和幻读的问题。</p>\n<h5 id=\"3-Repeatable-Read\"><a href=\"#3-Repeatable-Read\" class=\"headerlink\" title=\"3. Repeatable Read\"></a>3. Repeatable Read</h5><blockquote>\n<p>可以保证在整个事务的过程中，对同一笔数据的读取结果是相同的，不管其他事务是否同时在对同一笔数据进行更新，也不管其他事务对同一笔数 据的更新提交与否。</p>\n</blockquote>\n<p>Repeatable Read 隔离级别避免了脏读和不可重复读取的问题，但无法避免幻读。</p>\n<h5 id=\"4-Serializable\"><a href=\"#4-Serializable\" class=\"headerlink\" title=\"4. Serializable\"></a>4. Serializable</h5><blockquote>\n<p>最为严格的隔离级别，所有的事务操作都必须依次顺序执行，可以避免其他隔离级别遇到的所有问题，是最为安全的隔离级别， 但同时也是性能最差的隔离级别。</p>\n</blockquote>\n<p>通常情况下，我们会使用其他隔离级别加上相应的并发锁的机制来控制对数据的访问，这样既保证 了系统性能不会损失太大，也能够一定程度上保证数据的一致性。</p>\n<h3 id=\"Spring-事务传播机制\"><a href=\"#Spring-事务传播机制\" class=\"headerlink\" title=\"Spring 事务传播机制\"></a>Spring 事务传播机制</h3><p><img src=\"https://mmbiz.qpic.cn/mmbiz_png/eQPyBffYbufj62v2Y8YlK6PduUGQVluDic4XXpbR4OMSmHSC4ciapicuGohqr5jCt9RcQ7ib5PRbn5LFialQ9MDlHgg/640?wx_fmt=png\" alt=\"\"></p>\n<h3 id=\"从-JDBC-的事务说起\"><a href=\"#从-JDBC-的事务说起\" class=\"headerlink\" title=\"从 JDBC 的事务说起\"></a>从 JDBC 的事务说起</h3><blockquote>\n<p>我们都知道，JDBC 给我们提供了事务。</p>\n</blockquote>\n<pre style=\"box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 8px 0px 6px;background-color: rgb(32, 32, 29);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size: 10px;line-height: 12px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;\">\n\n1.  `try{`\n\n2.  `con.setAutoCommit(false);//开启事务`\n\n3.  `......`\n\n4.  `con.commit();//try的最后提交事务`\n\n5.  `} catch（） {`\n\n6.  `con.rollback();//回滚事务`\n\n7.  `}`\n\n</pre>\n\n<p>获取事务隔离级别</p>\n<pre style=\"box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 8px 0px 6px;background-color: rgb(32, 32, 29);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size: 10px;line-height: 12px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;\">\n\n1.  `Connection.getTransactionIsolation()`\n\n</pre>\n\n<p>设置事务隔离级别</p>\n<pre style=\"box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 8px 0px 6px;background-color: rgb(32, 32, 29);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size: 10px;line-height: 12px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;\">\n\n1.  `con.setTransactionIsolation(Connection.TRANSACTION_REPEATABLE_READ);`\n\n</pre>\n\n<h3 id=\"Spring-事务机制\"><a href=\"#Spring-事务机制\" class=\"headerlink\" title=\"Spring 事务机制\"></a>Spring 事务机制</h3><blockquote>\n<p>Spring 并不会直接管理事务，而是提供了事务管理器，将事务管理的职责委托给 JPA JDBC JTA DataSourceTransaction JMSTransactionManager 等框架提供的事务来实现。</p>\n</blockquote>\n<p>那么，Spring 提供的事务管理器是什么呢?</p>\n<p>是 <code>PlatformTransactionManager.java</code>接口:</p>\n<h5 id=\"PlatformTransactionManager-java\"><a href=\"#PlatformTransactionManager-java\" class=\"headerlink\" title=\"PlatformTransactionManager.java\"></a>PlatformTransactionManager.java</h5><blockquote>\n<p>Spring 提供的事务管理器。不同的事务遵循该事务管理器的 API，便能很轻松的交给 Spring 管理。</p>\n</blockquote>\n<pre style=\"box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 8px 0px 6px;background-color: rgb(32, 32, 29);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size: 10px;line-height: 12px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;\">\n\n1.  `public interface PlatformTransactionManager {`\n\n2.  `// 通过Transation定义 获取Transation`\n\n3.  `TransactionStatus getTransaction(@Nullable TransactionDefinition var1) throws TransactionException;`\n\n4.  `// 提交事务`\n\n5.  `void commit(TransactionStatus var1) throws TransactionException;`\n\n6.  `// 回滚事务`\n\n7.  `void rollback(TransactionStatus var1) throws TransactionException;`\n\n8.  `}`\n\n</pre>\n\n<p>可以看到它里面引用到了 <code>TransactionDefinition</code>和 <code>TransactionStatus</code>.</p>\n<h5 id=\"TransactionDefinition-java\"><a href=\"#TransactionDefinition-java\" class=\"headerlink\" title=\"TransactionDefinition.java\"></a>TransactionDefinition.java</h5><blockquote>\n<p>它里面包含了事务的定义。</p>\n</blockquote>\n<pre style=\"box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 8px 0px 6px;background-color: rgb(32, 32, 29);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size: 10px;line-height: 12px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;\">\n\n1.  `public interface TransactionDefinition {`\n\n2.  `// 传播机制`\n\n3.  `int PROPAGATION_REQUIRED = 0;`\n\n4.  `int PROPAGATION_SUPPORTS = 1;`\n\n5.  `int PROPAGATION_MANDATORY = 2;`\n\n6.  `int PROPAGATION_REQUIRES_NEW = 3;`\n\n7.  `int PROPAGATION_NOT_SUPPORTED = 4;`\n\n8.  `int PROPAGATION_NEVER = 5;`\n\n9.  `int PROPAGATION_NESTED = 6;`\n\n10.  `// 隔离级别`\n\n11.  `int ISOLATION_DEFAULT = -1;`\n\n12.  `int ISOLATION_READ_UNCOMMITTED = 1;`\n\n13.  `int ISOLATION_READ_COMMITTED = 2;`\n\n14.  `int ISOLATION_REPEATABLE_READ = 4;`\n\n15.  `int ISOLATION_SERIALIZABLE = 8;`\n\n16.  `int TIMEOUT_DEFAULT = -1;`\n\n18.  `int getPropagationBehavior();`\n\n19.  `// 获取隔离级别`\n\n20.  `int getIsolationLevel();`\n\n22.  `int getTimeout();`\n\n24.  `boolean isReadOnly();`\n\n26.  `@Nullable`\n\n27.  `String getName();`\n\n28.  `}`\n\n</pre>\n\n<h5 id=\"TransactionStatus-java\"><a href=\"#TransactionStatus-java\" class=\"headerlink\" title=\"TransactionStatus.java\"></a>TransactionStatus.java</h5><blockquote>\n<p>事务的状态。</p>\n</blockquote>\n<pre style=\"box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 8px 0px 6px;background-color: rgb(32, 32, 29);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size: 10px;line-height: 12px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;\">\n\n1.  `public interface TransactionStatus extends SavepointManager, Flushable {`\n\n2.  `boolean isNewTransaction();`\n\n4.  `boolean hasSavepoint();`\n\n6.  `void setRollbackOnly();`\n\n8.  `boolean isRollbackOnly();`\n\n10.  `void flush();`\n\n12.  `boolean isCompleted();`\n\n13.  `}`\n\n</pre>\n\n<h4 id=\"Spring-默认事务使用\"><a href=\"#Spring-默认事务使用\" class=\"headerlink\" title=\"Spring 默认事务使用\"></a>Spring 默认事务使用</h4><h5 id=\"1-代码方式使用\"><a href=\"#1-代码方式使用\" class=\"headerlink\" title=\"1. 代码方式使用\"></a>1. 代码方式使用</h5><pre style=\"box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 8px 0px 6px;background-color: rgb(32, 32, 29);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size: 10px;line-height: 12px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;\">\n\n1.  `@Autowired`\n\n2.  `private PlatformTransactionManager transactionManager;`\n\n3.  `public void testTX(){`\n\n4.  `DefaultTransactionDefinition definition = new DefaultTransactionDefinition();`\n\n5.  `TransactionStatus status = transactionManager.getTransaction(definition);`\n\n6.  `try {`\n\n7.  `// 业务逻辑`\n\n8.  `// ...`\n\n10.  `// 提交事务`\n\n11.  `transactionManager.commit(status);`\n\n12.  `}catch (Exception e){`\n\n13.  `// 发生异常，事务回滚`\n\n14.  `transactionManager.rollback(status);`\n\n15.  `}`\n\n16.  `}`\n\n</pre>\n\n<h5 id=\"2-注解方式使用\"><a href=\"#2-注解方式使用\" class=\"headerlink\" title=\"2. 注解方式使用\"></a>2. 注解方式使用</h5><pre style=\"box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 8px 0px 6px;background-color: rgb(32, 32, 29);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size: 10px;line-height: 12px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;\">\n\n1.  `@Transactional`\n\n2.  `void testTX2(){`\n\n3.  `// 业务逻辑 ...`\n\n4.  `}`\n\n</pre>\n\n<p>这不是玄学，它的底层是依靠 AOP 动态代理实现，其实重新渲染出的代码和第一个使用方式类似，不过大大减少了开发复杂度。</p>\n<h5 id=\"扩展：-Transactional-注解\"><a href=\"#扩展：-Transactional-注解\" class=\"headerlink\" title=\"扩展：@Transactional 注解\"></a>扩展：@Transactional 注解</h5><pre style=\"box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 8px 0px 6px;background-color: rgb(32, 32, 29);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size: 10px;line-height: 12px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;\">\n\n1.  `@Target({ElementType.METHOD, ElementType.TYPE})`\n\n2.  `@Retention(RetentionPolicy.RUNTIME)`\n\n3.  `@Inherited`\n\n4.  `@Documented`\n\n5.  `public @interface Transactional {`\n\n7.  `//指定使用的事务管理器`\n\n8.  `@AliasFor(\"transactionManager\")`\n\n9.  `String value() default \"\";`\n\n11.  `@AliasFor(\"value\")`\n\n12.  `String transactionManager() default \"\";`\n\n13.  `// 可选的事务传播行为设置`\n\n14.  `Propagation propagation() default Propagation.REQUIRED;`\n\n15.  `// 可选的事务隔离级别设置`\n\n16.  `Isolation isolation() default Isolation.DEFAULT;`\n\n17.  `// 事务超时时间设置`\n\n18.  `int timeout() default -1;`\n\n19.  `// 读写或只读事务，默认读写`\n\n20.  `boolean readOnly() default false;`\n\n21.  `// 导致事务回滚的异常类数组` \n\n22.  `Class<? extends Throwable>[] rollbackFor() default {};`\n\n23.  `// 导致事务回滚的异常类名字数组`\n\n24.  `String[] rollbackForClassName() default {};`\n\n25.  `// 不会导致事务回滚的异常类数组`\n\n26.  `Class<? extends Throwable>[] noRollbackFor() default {};`\n\n27.  `// 不会导致事务回滚的异常类名字数组`\n\n28.  `String[] noRollbackForClassName() default {};`\n\n29.  `}`\n\n</pre>\n\n<h3 id=\"Spring-事务实践\"><a href=\"#Spring-事务实践\" class=\"headerlink\" title=\"Spring 事务实践\"></a>Spring 事务实践</h3><blockquote>\n<p>非入门选手下面的 demo 可能会引起你的不适 (浪费时间)。 假设我要完成一个功能，当删除用户的时候，将与该用户有关的所有数据行都删除。</p>\n</blockquote>\n<pre style=\"box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 8px 0px 6px;background-color: rgb(32, 32, 29);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size: 10px;line-height: 12px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;\">\n\n1.  `public void delUser(Integer userId) {`\n\n2.  `// 删除和用户相关的信息`\n\n3.  `otherRepository.deleteByUserId(userId);` \n\n4.  `// 删除用户`\n\n5.  `userRepository.deleteById(userId);`\n\n6.  `}`\n\n</pre>\n\n<p>这样的写法一般来讲，会成功的完成任务。但是如果这样一段代码：</p>\n<pre style=\"box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 8px 0px 6px;background-color: rgb(32, 32, 29);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size: 10px;line-height: 12px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;\">\n\n1.  `public void delUser(Integer userId) {`\n\n2.  `// 删除和用户相关的信息`\n\n3.  `otherRepository.deleteByUserId();`\n\n4.  `if (true) {`\n\n5.  `throw new RuntimeException(\"xxx\");`\n\n6.  `}`\n\n7.  `// 删除用户`\n\n8.  `userRepository.deleteById(userId);`\n\n9.  `}`\n\n</pre>\n\n<p>结果会是： <code>deleteByUserId()</code>执行成功， <code>deleteById()</code>执行失败，不满足数据的一致性。</p>\n<p>所以我们需要事务来限制：要么全部执行，要么全部不执行 (方法中有异常就自动回滚)。那怎么实现呢，只需要在方法上加一个注解： <code>@Transactional</code></p>\n<pre style=\"box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 8px 0px 6px;background-color: rgb(32, 32, 29);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size: 10px;line-height: 12px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;\">\n\n1.  `@Transactional`\n\n2.  `public void delUser(Integer userId) {`\n\n3.  `// 删除和用户相关的信息`\n\n4.  `otherRepository.deleteByUserId();`\n\n5.  `if (true) {`\n\n6.  `throw new RuntimeException(\"xxx\");`\n\n7.  `}`\n\n8.  `// 删除用户`\n\n9.  `userRepository.deleteById(userId);`\n\n10.  `}`\n\n</pre>\n\n<h3 id=\"Spring-加载第三方事务管理\"><a href=\"#Spring-加载第三方事务管理\" class=\"headerlink\" title=\"Spring 加载第三方事务管理\"></a>Spring 加载第三方事务管理</h3><blockquote>\n<p>比如我有个需求 (接着上次的强票系统 II)，要求信息不能丢失，要用到 RabbitMQ 的事务管理，那怎么去加载到 Spring 的事务管理器中呢？</p>\n</blockquote>\n<pre style=\"box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 8px 0px 6px;background-color: rgb(32, 32, 29);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size: 10px;line-height: 12px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;\">\n\n1.  `@Bean`\n\n2.  `public ConnectionFactory connectionFactory() {`\n\n3.  `CachingConnectionFactory connectionFactory = new CachingConnectionFactory();`\n\n4.  `return connectionFactory;`\n\n5.  `}`\n\n7.  `@Bean`\n\n8.  `public RabbitTransactionManager rabbitTransactionManager(ConnectionFactory connectionFactory) {`\n\n9.  `return new RabbitTransactionManager(connectionFactory);`\n\n10.  `}`\n\n</pre>\n\n<p>我们只需要这样做便可以使的使用 <code>@Transactional注解</code>来实现对 RabbitMQ 的事务管理, 其它框架也类似。</p>\n","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p>说起事务，大家应该多多少少用过，尤其是在一个 service 方法中调用多次 dao 操作，我们一定要用到事务 ( <code>@Transational注解</code>)，那么这个事务的默认隔离级别和传播机制是什么呢?</p>\n</blockquote>\n<p>先来讲讲 <code>脏读</code> <code>不可重复读</code> 和 <code>幻读</code>。</p>\n<ol>\n<li><p>脏读: 我们在并发编程中是很熟悉的，通俗的讲就是你读得数据已经被修改了，已经过时失去意义了。</p>\n</li>\n<li><p>不可重复读： 同一个事务里面多次读取同一行数据，却返回不同的结果。</p>\n</li>\n<li><p>幻读：同样一笔查询在整个事务过程中多次执行后，查询所得的结果集不一样。</p>\n</li>\n</ol>\n<h3 id=\"事务四大特性-ACID\"><a href=\"#事务四大特性-ACID\" class=\"headerlink\" title=\"事务四大特性 ACID\"></a>事务四大特性 ACID</h3><h5 id=\"1-原子性-Atomicity\"><a href=\"#1-原子性-Atomicity\" class=\"headerlink\" title=\"1. 原子性 (Atomicity)\"></a>1. 原子性 <code>(Atomicity)</code></h5><blockquote>\n<p>要求事务所包含的全部操作是一个不可分割的整体，如果有一步发生异常，则全部不提交。</p>\n</blockquote>\n<h5 id=\"2-一致性-（Consistency）\"><a href=\"#2-一致性-（Consistency）\" class=\"headerlink\" title=\"2. 一致性 （Consistency）\"></a>2. 一致性 <code>（Consistency）</code></h5><blockquote>\n<p>A 给 B 转钱，A 减和 B 增这两个操作必须保持一致。</p>\n</blockquote>\n<h5 id=\"3-隔离性-（Isolation）\"><a href=\"#3-隔离性-（Isolation）\" class=\"headerlink\" title=\"3. 隔离性 （Isolation）\"></a>3. 隔离性 <code>（Isolation）</code></h5><blockquote>\n<p>事务会将一部分数据与其他事务隔离，防止脏读等。</p>\n</blockquote>\n<h5 id=\"4-持久性-（Durability）\"><a href=\"#4-持久性-（Durability）\" class=\"headerlink\" title=\"4. 持久性 （Durability）\"></a>4. 持久性 <code>（Durability）</code></h5><blockquote>\n<p>事务的结果被写到持久化存储器中。</p>\n</blockquote>\n<h3 id=\"事务四大隔离级别\"><a href=\"#事务四大隔离级别\" class=\"headerlink\" title=\"事务四大隔离级别\"></a>事务四大隔离级别</h3><blockquote>\n<p>隔离级别越高，则性能相对越低，反之亦然。</p>\n<h5 id=\"1-Read-Uncommitted\"><a href=\"#1-Read-Uncommitted\" class=\"headerlink\" title=\"1. Read Uncommitted\"></a>1. Read Uncommitted</h5><p>最低的隔离级别，跟你直译的意思一样：可以读取其它事务未完成的结果。(脏读)</p>\n</blockquote>\n<p>很明显， <code>脏读</code> <code>不可重复读</code> 和 <code>幻读</code>这三个问题它都有。</p>\n<h5 id=\"2-Read-Committed\"><a href=\"#2-Read-Committed\" class=\"headerlink\" title=\"2. Read Committed\"></a>2. Read Committed</h5><blockquote>\n<p>大部分数据库采用的<strong>默认隔离级别</strong>，比上一个隔离级别多了限定：在该事务完成后，才能读取该事务的数据更新后的结果。</p>\n</blockquote>\n<p>它可以避免脏读，但是也有不可重复读取和幻读的问题。</p>\n<h5 id=\"3-Repeatable-Read\"><a href=\"#3-Repeatable-Read\" class=\"headerlink\" title=\"3. Repeatable Read\"></a>3. Repeatable Read</h5><blockquote>\n<p>可以保证在整个事务的过程中，对同一笔数据的读取结果是相同的，不管其他事务是否同时在对同一笔数据进行更新，也不管其他事务对同一笔数 据的更新提交与否。</p>\n</blockquote>\n<p>Repeatable Read 隔离级别避免了脏读和不可重复读取的问题，但无法避免幻读。</p>\n<h5 id=\"4-Serializable\"><a href=\"#4-Serializable\" class=\"headerlink\" title=\"4. Serializable\"></a>4. Serializable</h5><blockquote>\n<p>最为严格的隔离级别，所有的事务操作都必须依次顺序执行，可以避免其他隔离级别遇到的所有问题，是最为安全的隔离级别， 但同时也是性能最差的隔离级别。</p>\n</blockquote>\n<p>通常情况下，我们会使用其他隔离级别加上相应的并发锁的机制来控制对数据的访问，这样既保证 了系统性能不会损失太大，也能够一定程度上保证数据的一致性。</p>\n<h3 id=\"Spring-事务传播机制\"><a href=\"#Spring-事务传播机制\" class=\"headerlink\" title=\"Spring 事务传播机制\"></a>Spring 事务传播机制</h3><p><img src=\"https://mmbiz.qpic.cn/mmbiz_png/eQPyBffYbufj62v2Y8YlK6PduUGQVluDic4XXpbR4OMSmHSC4ciapicuGohqr5jCt9RcQ7ib5PRbn5LFialQ9MDlHgg/640?wx_fmt=png\" alt=\"\"></p>\n<h3 id=\"从-JDBC-的事务说起\"><a href=\"#从-JDBC-的事务说起\" class=\"headerlink\" title=\"从 JDBC 的事务说起\"></a>从 JDBC 的事务说起</h3><blockquote>\n<p>我们都知道，JDBC 给我们提供了事务。</p>\n</blockquote>\n<pre style=\"box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 8px 0px 6px;background-color: rgb(32, 32, 29);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size: 10px;line-height: 12px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;\">\n\n1.  `try{`\n\n2.  `con.setAutoCommit(false);//开启事务`\n\n3.  `......`\n\n4.  `con.commit();//try的最后提交事务`\n\n5.  `} catch（） {`\n\n6.  `con.rollback();//回滚事务`\n\n7.  `}`\n\n</pre>\n\n<p>获取事务隔离级别</p>\n<pre style=\"box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 8px 0px 6px;background-color: rgb(32, 32, 29);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size: 10px;line-height: 12px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;\">\n\n1.  `Connection.getTransactionIsolation()`\n\n</pre>\n\n<p>设置事务隔离级别</p>\n<pre style=\"box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 8px 0px 6px;background-color: rgb(32, 32, 29);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size: 10px;line-height: 12px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;\">\n\n1.  `con.setTransactionIsolation(Connection.TRANSACTION_REPEATABLE_READ);`\n\n</pre>\n\n<h3 id=\"Spring-事务机制\"><a href=\"#Spring-事务机制\" class=\"headerlink\" title=\"Spring 事务机制\"></a>Spring 事务机制</h3><blockquote>\n<p>Spring 并不会直接管理事务，而是提供了事务管理器，将事务管理的职责委托给 JPA JDBC JTA DataSourceTransaction JMSTransactionManager 等框架提供的事务来实现。</p>\n</blockquote>\n<p>那么，Spring 提供的事务管理器是什么呢?</p>\n<p>是 <code>PlatformTransactionManager.java</code>接口:</p>\n<h5 id=\"PlatformTransactionManager-java\"><a href=\"#PlatformTransactionManager-java\" class=\"headerlink\" title=\"PlatformTransactionManager.java\"></a>PlatformTransactionManager.java</h5><blockquote>\n<p>Spring 提供的事务管理器。不同的事务遵循该事务管理器的 API，便能很轻松的交给 Spring 管理。</p>\n</blockquote>\n<pre style=\"box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 8px 0px 6px;background-color: rgb(32, 32, 29);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size: 10px;line-height: 12px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;\">\n\n1.  `public interface PlatformTransactionManager {`\n\n2.  `// 通过Transation定义 获取Transation`\n\n3.  `TransactionStatus getTransaction(@Nullable TransactionDefinition var1) throws TransactionException;`\n\n4.  `// 提交事务`\n\n5.  `void commit(TransactionStatus var1) throws TransactionException;`\n\n6.  `// 回滚事务`\n\n7.  `void rollback(TransactionStatus var1) throws TransactionException;`\n\n8.  `}`\n\n</pre>\n\n<p>可以看到它里面引用到了 <code>TransactionDefinition</code>和 <code>TransactionStatus</code>.</p>\n<h5 id=\"TransactionDefinition-java\"><a href=\"#TransactionDefinition-java\" class=\"headerlink\" title=\"TransactionDefinition.java\"></a>TransactionDefinition.java</h5><blockquote>\n<p>它里面包含了事务的定义。</p>\n</blockquote>\n<pre style=\"box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 8px 0px 6px;background-color: rgb(32, 32, 29);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size: 10px;line-height: 12px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;\">\n\n1.  `public interface TransactionDefinition {`\n\n2.  `// 传播机制`\n\n3.  `int PROPAGATION_REQUIRED = 0;`\n\n4.  `int PROPAGATION_SUPPORTS = 1;`\n\n5.  `int PROPAGATION_MANDATORY = 2;`\n\n6.  `int PROPAGATION_REQUIRES_NEW = 3;`\n\n7.  `int PROPAGATION_NOT_SUPPORTED = 4;`\n\n8.  `int PROPAGATION_NEVER = 5;`\n\n9.  `int PROPAGATION_NESTED = 6;`\n\n10.  `// 隔离级别`\n\n11.  `int ISOLATION_DEFAULT = -1;`\n\n12.  `int ISOLATION_READ_UNCOMMITTED = 1;`\n\n13.  `int ISOLATION_READ_COMMITTED = 2;`\n\n14.  `int ISOLATION_REPEATABLE_READ = 4;`\n\n15.  `int ISOLATION_SERIALIZABLE = 8;`\n\n16.  `int TIMEOUT_DEFAULT = -1;`\n\n18.  `int getPropagationBehavior();`\n\n19.  `// 获取隔离级别`\n\n20.  `int getIsolationLevel();`\n\n22.  `int getTimeout();`\n\n24.  `boolean isReadOnly();`\n\n26.  `@Nullable`\n\n27.  `String getName();`\n\n28.  `}`\n\n</pre>\n\n<h5 id=\"TransactionStatus-java\"><a href=\"#TransactionStatus-java\" class=\"headerlink\" title=\"TransactionStatus.java\"></a>TransactionStatus.java</h5><blockquote>\n<p>事务的状态。</p>\n</blockquote>\n<pre style=\"box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 8px 0px 6px;background-color: rgb(32, 32, 29);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size: 10px;line-height: 12px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;\">\n\n1.  `public interface TransactionStatus extends SavepointManager, Flushable {`\n\n2.  `boolean isNewTransaction();`\n\n4.  `boolean hasSavepoint();`\n\n6.  `void setRollbackOnly();`\n\n8.  `boolean isRollbackOnly();`\n\n10.  `void flush();`\n\n12.  `boolean isCompleted();`\n\n13.  `}`\n\n</pre>\n\n<h4 id=\"Spring-默认事务使用\"><a href=\"#Spring-默认事务使用\" class=\"headerlink\" title=\"Spring 默认事务使用\"></a>Spring 默认事务使用</h4><h5 id=\"1-代码方式使用\"><a href=\"#1-代码方式使用\" class=\"headerlink\" title=\"1. 代码方式使用\"></a>1. 代码方式使用</h5><pre style=\"box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 8px 0px 6px;background-color: rgb(32, 32, 29);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size: 10px;line-height: 12px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;\">\n\n1.  `@Autowired`\n\n2.  `private PlatformTransactionManager transactionManager;`\n\n3.  `public void testTX(){`\n\n4.  `DefaultTransactionDefinition definition = new DefaultTransactionDefinition();`\n\n5.  `TransactionStatus status = transactionManager.getTransaction(definition);`\n\n6.  `try {`\n\n7.  `// 业务逻辑`\n\n8.  `// ...`\n\n10.  `// 提交事务`\n\n11.  `transactionManager.commit(status);`\n\n12.  `}catch (Exception e){`\n\n13.  `// 发生异常，事务回滚`\n\n14.  `transactionManager.rollback(status);`\n\n15.  `}`\n\n16.  `}`\n\n</pre>\n\n<h5 id=\"2-注解方式使用\"><a href=\"#2-注解方式使用\" class=\"headerlink\" title=\"2. 注解方式使用\"></a>2. 注解方式使用</h5><pre style=\"box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 8px 0px 6px;background-color: rgb(32, 32, 29);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size: 10px;line-height: 12px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;\">\n\n1.  `@Transactional`\n\n2.  `void testTX2(){`\n\n3.  `// 业务逻辑 ...`\n\n4.  `}`\n\n</pre>\n\n<p>这不是玄学，它的底层是依靠 AOP 动态代理实现，其实重新渲染出的代码和第一个使用方式类似，不过大大减少了开发复杂度。</p>\n<h5 id=\"扩展：-Transactional-注解\"><a href=\"#扩展：-Transactional-注解\" class=\"headerlink\" title=\"扩展：@Transactional 注解\"></a>扩展：@Transactional 注解</h5><pre style=\"box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 8px 0px 6px;background-color: rgb(32, 32, 29);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size: 10px;line-height: 12px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;\">\n\n1.  `@Target({ElementType.METHOD, ElementType.TYPE})`\n\n2.  `@Retention(RetentionPolicy.RUNTIME)`\n\n3.  `@Inherited`\n\n4.  `@Documented`\n\n5.  `public @interface Transactional {`\n\n7.  `//指定使用的事务管理器`\n\n8.  `@AliasFor(\"transactionManager\")`\n\n9.  `String value() default \"\";`\n\n11.  `@AliasFor(\"value\")`\n\n12.  `String transactionManager() default \"\";`\n\n13.  `// 可选的事务传播行为设置`\n\n14.  `Propagation propagation() default Propagation.REQUIRED;`\n\n15.  `// 可选的事务隔离级别设置`\n\n16.  `Isolation isolation() default Isolation.DEFAULT;`\n\n17.  `// 事务超时时间设置`\n\n18.  `int timeout() default -1;`\n\n19.  `// 读写或只读事务，默认读写`\n\n20.  `boolean readOnly() default false;`\n\n21.  `// 导致事务回滚的异常类数组` \n\n22.  `Class<? extends Throwable>[] rollbackFor() default {};`\n\n23.  `// 导致事务回滚的异常类名字数组`\n\n24.  `String[] rollbackForClassName() default {};`\n\n25.  `// 不会导致事务回滚的异常类数组`\n\n26.  `Class<? extends Throwable>[] noRollbackFor() default {};`\n\n27.  `// 不会导致事务回滚的异常类名字数组`\n\n28.  `String[] noRollbackForClassName() default {};`\n\n29.  `}`\n\n</pre>\n\n<h3 id=\"Spring-事务实践\"><a href=\"#Spring-事务实践\" class=\"headerlink\" title=\"Spring 事务实践\"></a>Spring 事务实践</h3><blockquote>\n<p>非入门选手下面的 demo 可能会引起你的不适 (浪费时间)。 假设我要完成一个功能，当删除用户的时候，将与该用户有关的所有数据行都删除。</p>\n</blockquote>\n<pre style=\"box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 8px 0px 6px;background-color: rgb(32, 32, 29);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size: 10px;line-height: 12px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;\">\n\n1.  `public void delUser(Integer userId) {`\n\n2.  `// 删除和用户相关的信息`\n\n3.  `otherRepository.deleteByUserId(userId);` \n\n4.  `// 删除用户`\n\n5.  `userRepository.deleteById(userId);`\n\n6.  `}`\n\n</pre>\n\n<p>这样的写法一般来讲，会成功的完成任务。但是如果这样一段代码：</p>\n<pre style=\"box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 8px 0px 6px;background-color: rgb(32, 32, 29);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size: 10px;line-height: 12px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;\">\n\n1.  `public void delUser(Integer userId) {`\n\n2.  `// 删除和用户相关的信息`\n\n3.  `otherRepository.deleteByUserId();`\n\n4.  `if (true) {`\n\n5.  `throw new RuntimeException(\"xxx\");`\n\n6.  `}`\n\n7.  `// 删除用户`\n\n8.  `userRepository.deleteById(userId);`\n\n9.  `}`\n\n</pre>\n\n<p>结果会是： <code>deleteByUserId()</code>执行成功， <code>deleteById()</code>执行失败，不满足数据的一致性。</p>\n<p>所以我们需要事务来限制：要么全部执行，要么全部不执行 (方法中有异常就自动回滚)。那怎么实现呢，只需要在方法上加一个注解： <code>@Transactional</code></p>\n<pre style=\"box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 8px 0px 6px;background-color: rgb(32, 32, 29);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size: 10px;line-height: 12px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;\">\n\n1.  `@Transactional`\n\n2.  `public void delUser(Integer userId) {`\n\n3.  `// 删除和用户相关的信息`\n\n4.  `otherRepository.deleteByUserId();`\n\n5.  `if (true) {`\n\n6.  `throw new RuntimeException(\"xxx\");`\n\n7.  `}`\n\n8.  `// 删除用户`\n\n9.  `userRepository.deleteById(userId);`\n\n10.  `}`\n\n</pre>\n\n<h3 id=\"Spring-加载第三方事务管理\"><a href=\"#Spring-加载第三方事务管理\" class=\"headerlink\" title=\"Spring 加载第三方事务管理\"></a>Spring 加载第三方事务管理</h3><blockquote>\n<p>比如我有个需求 (接着上次的强票系统 II)，要求信息不能丢失，要用到 RabbitMQ 的事务管理，那怎么去加载到 Spring 的事务管理器中呢？</p>\n</blockquote>\n<pre style=\"box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 8px 0px 6px;background-color: rgb(32, 32, 29);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size: 10px;line-height: 12px;font-family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;\">\n\n1.  `@Bean`\n\n2.  `public ConnectionFactory connectionFactory() {`\n\n3.  `CachingConnectionFactory connectionFactory = new CachingConnectionFactory();`\n\n4.  `return connectionFactory;`\n\n5.  `}`\n\n7.  `@Bean`\n\n8.  `public RabbitTransactionManager rabbitTransactionManager(ConnectionFactory connectionFactory) {`\n\n9.  `return new RabbitTransactionManager(connectionFactory);`\n\n10.  `}`\n\n</pre>\n\n<p>我们只需要这样做便可以使的使用 <code>@Transactional注解</code>来实现对 RabbitMQ 的事务管理, 其它框架也类似。</p>\n"},{"title":"分布式锁的场景与实现","author":"Asia Cui","date":"2019-01-08T08:34:00.000Z","_content":"## 使用场景\n\n首先，我们看这样一个场景：客户下单的时候，我们调用库存中心进行减库存，那我们一般的操作都是：\n\n```sql\nupdate store set num = $num where id = $id\n\n```\n\n这种通过设置库存的修改方式，我们知道在并发量高的时候会存在数据库的丢失更新，比如 a, b 当前两个事务，查询出来的库存都是 5，a 买了 3 个单子要把库存设置为 2，而 b 买了 1 个单子要把库存设置为 4，那这个时候就会出现 a 会覆盖 b 的更新，所以我们更多的都是会加个条件：\n\n```sql\nupdate store set num = $num where id = $id and num = $query_num\n\n```\n\n即乐观锁的方式来处理，当然也可以通过版本号来处理乐观锁，都是一样的，但是这是更新一个表，如果我们牵扯到多个表呢，我们希望和这个单子关联的所有的表同一时间只能被一个线程来处理更新，多个线程按照不同的顺序去更新同一个单子关联的不同数据，出现死锁的概率比较大。对于非敏感的数据，我们也没有必要去都加乐观锁处理，我们的服务都是多机器部署的，要保证多进程多线程同时只能有一个进程的一个线程去处理，这个时候我们就需要用到分布式锁。分布式锁的实现方式有很多，我们今天分别通过数据库，Zookeeper, Redis 以及 Tair 的实现逻辑。\n\n##  数据库实现\n\n### 加 xx 锁\n\n更新一个单子关联的所有的数据，先查询出这个单子，并加上排他锁，在进行一系列的更新操作\n\n```sql\nbegin transaction；\nselect ...for update；\ndoSomething()；\ncommit();\n\n```\n\n这种处理主要依靠排他锁来阻塞其他线程，不过这个需要注意几点：\n\n1.  查询的数据一定要在数据库里存在，如果不存在的话，数据库会加 gap 锁，而 gap 锁之间是兼容的，这种如果两个线程都加了 gap 锁，另一个再更新的话会出现死锁。不过一般能更新的数据都是存在的\n2.  后续的处理流程需要尽可能的时间短，即在更新的时候提前准备好数据，保证事务处理的时间足够的短，流程足够的短，因为开启事务是一直占着连接的，如果流程比较长会消耗过多的数据库连接的\n\n###  唯一键\n\n通过在一张表里创建唯一键来获取锁，比如执行 saveStore 这个方法\n\n```sql\ninsert table lock_store ('method_name') values($method_name)\n\n```\n\n其中 `method_name` 是个唯一键，通过这种方式也可以做到，解锁的时候直接删除改行记录就行。不过这种方式，锁就不会是阻塞式的，因为插入数据是立马可以得到返回结果的。\n\n那针对以上数据库实现的两种分布式锁，存在什么样的优缺点呢？\n\n### 优点\n\n简单，方便，快速实现\n\n###  缺点\n\n*   基于数据库，开销比较大，性能可能会存在影响\n*   基于数据库的当前读来实现，数据库会在底层做优化，可能用到索引，可能不用到索引，这个依赖于查询计划的分析\n\n##  Zookeeper 实现\n\n### 获取锁\n\n1.  先有一个锁跟节点，lockRootNode，这可以是一个永久的节点\n2.  客户端获取锁，先在 lockRootNode 下创建一个顺序的瞬时节点，保证客户端断开连接，节点也自动删除\n3.  调用 lockRootNode 父节点的 getChildren() 方法，获取所有的节点，并从小到大排序，如果创建的最小的节点是当前节点，则返回 true, 获取锁成功，否则，关注比自己序号小的节点的释放动作 (exist watch)，这样可以保证每一个客户端只需要关注一个节点，不需要关注所有的节点，避免羊群效应。\n4.  如果有节点释放操作，重复步骤 3\n\n### 释放锁\n\n只需要删除步骤 2 中创建的节点即可\n\n使用 Zookeeper 的分布式锁存在什么样的优缺点呢？\n\n### 优点\n\n*   客户端如果出现宕机故障的话，锁可以马上释放\n*   可以实现阻塞式锁，通过 watcher 监听，实现起来也比较简单\n*   集群模式，稳定性比较高\n\n###  缺点\n\n*   一旦网络有任何的抖动，Zookeeper 就会认为客户端已经宕机，就会断掉连接，其他客户端就可以获取到锁。当然 Zookeeper 有重试机制，这个就比较依赖于其重试机制的策略了\n*   性能上不如缓存\n\n##  Redis 实现\n\n我们先举个例子，比如现在我要更新产品的信息，产品的唯一键就是 productId\n\n###  简单实现 1\n\n```java\npublic boolean lock(String key, V v, int expireTime){\n        int retry = 0;\n        //获取锁失败最多尝试10次\n        while (retry < failRetryTimes){\n            //获取锁\n            Boolean result = redis.setNx(key, v, expireTime);\n            if (result){\n                return true;\n            }\n\n            try {\n                //获取锁失败间隔一段时间重试\n                TimeUnit.MILLISECONDS.sleep(sleepInterval);\n            } catch (InterruptedException e) {\n                Thread.currentThread().interrupt();\n                return false;\n            }\n\n        }\n\n        return false;\n    }\n    public boolean unlock(String key){\n        return redis.delete(key);\n    }\n    public static void main(String[] args) {\n        Integer productId = 324324;\n        RedisLock<Integer> redisLock = new RedisLock<Integer>();\n        redisLock.lock(productId+\"\", productId, 1000);\n    }\n}\n```\n\n这是一个简单的实现，存在的问题：\n\n1.  可能会导致当前线程的锁误被其他线程释放，比如 a 线程获取到了锁正在执行，但是由于内部流程处理超时或者 gc 导致锁过期，这个时候 b 线程获取到了锁，a 和 b 线程处理的是同一个 productId，b 还在处理的过程中，这个时候 a 处理完了，a 去释放锁，可能就会导致 a 把 b 获取的锁释放了。\n2.  不能实现可重入\n3.  客户端如果第一次已经设置成功，但是由于超时返回失败，此后客户端尝试会一直失败\n\n针对以上问题我们改进下：\n\n1.  v 传 requestId，然后我们在释放锁的时候判断一下，如果是当前 requestId，那就可以释放，否则不允许释放\n2.  加入 count 的锁计数，在获取锁的时候查询一次，如果是当前线程已经持有的锁，那锁技术加 1，直接返回 true\n\n###  简单实现 2\n\n```java\nprivate static volatile int count = 0;\npublic boolean lock(String key, V v, int expireTime){\n    int retry = 0;\n    //获取锁失败最多尝试10次\n    while (retry < failRetryTimes){\n        //1.先获取锁,如果是当前线程已经持有，则直接返回\n        //2.防止后面设置锁超时，其实是设置成功，而网络超时导致客户端返回失败，所以获取锁之前需要查询一下\n        V value = redis.get(key);\n        //如果当前锁存在，并且属于当前线程持有，则锁计数+1，直接返回\n        if (null != value && value.equals(v)){\n            count ++;\n            return true;\n        }\n\n        //如果锁已经被持有了，那需要等待锁的释放\n        if (value == null || count <= 0){\n            //获取锁\n            Boolean result = redis.setNx(key, v, expireTime);\n            if (result){\n                count = 1;\n                return true;\n            }\n        }\n\n        try {\n            //获取锁失败间隔一段时间重试\n            TimeUnit.MILLISECONDS.sleep(sleepInterval);\n        } catch (InterruptedException e) {\n            Thread.currentThread().interrupt();\n            return false;\n        }\n\n    }\n\n    return false;\n}\npublic boolean unlock(String key, String requestId){\n    String value = redis.get(key);\n    if (Strings.isNullOrEmpty(value)){\n        count = 0;\n        return true;\n    }\n    //判断当前锁的持有者是否是当前线程，如果是的话释放锁，不是的话返回false\n    if (value.equals(requestId)){\n        if (count > 1){\n            count -- ;\n            return true;\n        }\n\n        boolean delete = redis.delete(key);\n        if (delete){\n            count = 0;\n        }\n        return delete;\n    }\n\n    return false;\n}\npublic static void main(String[] args) {\n    Integer productId = 324324;\n    RedisLock<String> redisLock = new RedisLock<String>();\n    String requestId = UUID.randomUUID().toString();\n    redisLock.lock(productId+\"\", requestId, 1000);\n}\n\n```\n\n这种实现基本解决了误释放和可重入的问题，这里说明几点：\n\n1.  引入 count 实现重入的话，看业务需要，并且在释放锁的时候，其实也可以直接就把锁删除了，一次释放搞定，不需要在通过 count 数量释放多次，看业务需要吧\n2.  关于要考虑设置锁超时，所以需要在设置锁的时候查询一次，可能会有性能的考量，看具体业务吧\n3.  目前获取锁失败的等待时间是在代码里面设置的，可以提出来，修改下等待的逻辑即可\n\n### [#](#错误实现) 错误实现\n\n获取到锁之后要检查下锁的过期时间，如果锁过期了要重新设置下时间, 大致代码如下：\n\n```java\npublic boolean tryLock2(String key, int expireTime){\n    long expires = System.currentTimeMillis() + expireTime;\n\n    // 获取锁\n    Boolean result = redis.setNx(key, expires, expireTime);\n    if (result){\n        return true;\n    }\n\n    V value = redis.get(key);\n    if (value != null && (Long)value < System.currentTimeMillis()){\n        // 锁已经过期\n        String oldValue = redis.getSet(key, expireTime);\n        if (oldValue != null && oldValue.equals(value)){\n            return true;\n        }\n    }\n\n    return false;\n}\n\n```\n\n这种实现存在的问题，过度依赖当前服务器的时间了，如果在大量的并发请求下，都判断出了锁过期，而这个时候再去设置锁的时候，最终是会只有一个线程，但是可能会导致不同服务器根据自身不同的时间覆盖掉最终获取锁的那个线程设置的时间。\n\n##  Tair 实现\n\n通过 Tair 来实现分布式锁和 Redis 的实现核心差不多，不过 Tair 有个很方便的 api，感觉是实现分布式锁的最佳配置，就是 Put api 调用的时候需要传入一个 version，就和数据库的乐观锁一样，修改数据之后，版本会自动累加，如果传入的版本和当前数据版本不一致，就不允许修改。","source":"_posts/分布式锁的场景与实现.md","raw":"title: 分布式锁的场景与实现\nauthor: Asia Cui\ntags:\n  - 道\ncategories:\n  - 分布式\ndate: 2019-01-08 16:34:00\n---\n## 使用场景\n\n首先，我们看这样一个场景：客户下单的时候，我们调用库存中心进行减库存，那我们一般的操作都是：\n\n```sql\nupdate store set num = $num where id = $id\n\n```\n\n这种通过设置库存的修改方式，我们知道在并发量高的时候会存在数据库的丢失更新，比如 a, b 当前两个事务，查询出来的库存都是 5，a 买了 3 个单子要把库存设置为 2，而 b 买了 1 个单子要把库存设置为 4，那这个时候就会出现 a 会覆盖 b 的更新，所以我们更多的都是会加个条件：\n\n```sql\nupdate store set num = $num where id = $id and num = $query_num\n\n```\n\n即乐观锁的方式来处理，当然也可以通过版本号来处理乐观锁，都是一样的，但是这是更新一个表，如果我们牵扯到多个表呢，我们希望和这个单子关联的所有的表同一时间只能被一个线程来处理更新，多个线程按照不同的顺序去更新同一个单子关联的不同数据，出现死锁的概率比较大。对于非敏感的数据，我们也没有必要去都加乐观锁处理，我们的服务都是多机器部署的，要保证多进程多线程同时只能有一个进程的一个线程去处理，这个时候我们就需要用到分布式锁。分布式锁的实现方式有很多，我们今天分别通过数据库，Zookeeper, Redis 以及 Tair 的实现逻辑。\n\n##  数据库实现\n\n### 加 xx 锁\n\n更新一个单子关联的所有的数据，先查询出这个单子，并加上排他锁，在进行一系列的更新操作\n\n```sql\nbegin transaction；\nselect ...for update；\ndoSomething()；\ncommit();\n\n```\n\n这种处理主要依靠排他锁来阻塞其他线程，不过这个需要注意几点：\n\n1.  查询的数据一定要在数据库里存在，如果不存在的话，数据库会加 gap 锁，而 gap 锁之间是兼容的，这种如果两个线程都加了 gap 锁，另一个再更新的话会出现死锁。不过一般能更新的数据都是存在的\n2.  后续的处理流程需要尽可能的时间短，即在更新的时候提前准备好数据，保证事务处理的时间足够的短，流程足够的短，因为开启事务是一直占着连接的，如果流程比较长会消耗过多的数据库连接的\n\n###  唯一键\n\n通过在一张表里创建唯一键来获取锁，比如执行 saveStore 这个方法\n\n```sql\ninsert table lock_store ('method_name') values($method_name)\n\n```\n\n其中 `method_name` 是个唯一键，通过这种方式也可以做到，解锁的时候直接删除改行记录就行。不过这种方式，锁就不会是阻塞式的，因为插入数据是立马可以得到返回结果的。\n\n那针对以上数据库实现的两种分布式锁，存在什么样的优缺点呢？\n\n### 优点\n\n简单，方便，快速实现\n\n###  缺点\n\n*   基于数据库，开销比较大，性能可能会存在影响\n*   基于数据库的当前读来实现，数据库会在底层做优化，可能用到索引，可能不用到索引，这个依赖于查询计划的分析\n\n##  Zookeeper 实现\n\n### 获取锁\n\n1.  先有一个锁跟节点，lockRootNode，这可以是一个永久的节点\n2.  客户端获取锁，先在 lockRootNode 下创建一个顺序的瞬时节点，保证客户端断开连接，节点也自动删除\n3.  调用 lockRootNode 父节点的 getChildren() 方法，获取所有的节点，并从小到大排序，如果创建的最小的节点是当前节点，则返回 true, 获取锁成功，否则，关注比自己序号小的节点的释放动作 (exist watch)，这样可以保证每一个客户端只需要关注一个节点，不需要关注所有的节点，避免羊群效应。\n4.  如果有节点释放操作，重复步骤 3\n\n### 释放锁\n\n只需要删除步骤 2 中创建的节点即可\n\n使用 Zookeeper 的分布式锁存在什么样的优缺点呢？\n\n### 优点\n\n*   客户端如果出现宕机故障的话，锁可以马上释放\n*   可以实现阻塞式锁，通过 watcher 监听，实现起来也比较简单\n*   集群模式，稳定性比较高\n\n###  缺点\n\n*   一旦网络有任何的抖动，Zookeeper 就会认为客户端已经宕机，就会断掉连接，其他客户端就可以获取到锁。当然 Zookeeper 有重试机制，这个就比较依赖于其重试机制的策略了\n*   性能上不如缓存\n\n##  Redis 实现\n\n我们先举个例子，比如现在我要更新产品的信息，产品的唯一键就是 productId\n\n###  简单实现 1\n\n```java\npublic boolean lock(String key, V v, int expireTime){\n        int retry = 0;\n        //获取锁失败最多尝试10次\n        while (retry < failRetryTimes){\n            //获取锁\n            Boolean result = redis.setNx(key, v, expireTime);\n            if (result){\n                return true;\n            }\n\n            try {\n                //获取锁失败间隔一段时间重试\n                TimeUnit.MILLISECONDS.sleep(sleepInterval);\n            } catch (InterruptedException e) {\n                Thread.currentThread().interrupt();\n                return false;\n            }\n\n        }\n\n        return false;\n    }\n    public boolean unlock(String key){\n        return redis.delete(key);\n    }\n    public static void main(String[] args) {\n        Integer productId = 324324;\n        RedisLock<Integer> redisLock = new RedisLock<Integer>();\n        redisLock.lock(productId+\"\", productId, 1000);\n    }\n}\n```\n\n这是一个简单的实现，存在的问题：\n\n1.  可能会导致当前线程的锁误被其他线程释放，比如 a 线程获取到了锁正在执行，但是由于内部流程处理超时或者 gc 导致锁过期，这个时候 b 线程获取到了锁，a 和 b 线程处理的是同一个 productId，b 还在处理的过程中，这个时候 a 处理完了，a 去释放锁，可能就会导致 a 把 b 获取的锁释放了。\n2.  不能实现可重入\n3.  客户端如果第一次已经设置成功，但是由于超时返回失败，此后客户端尝试会一直失败\n\n针对以上问题我们改进下：\n\n1.  v 传 requestId，然后我们在释放锁的时候判断一下，如果是当前 requestId，那就可以释放，否则不允许释放\n2.  加入 count 的锁计数，在获取锁的时候查询一次，如果是当前线程已经持有的锁，那锁技术加 1，直接返回 true\n\n###  简单实现 2\n\n```java\nprivate static volatile int count = 0;\npublic boolean lock(String key, V v, int expireTime){\n    int retry = 0;\n    //获取锁失败最多尝试10次\n    while (retry < failRetryTimes){\n        //1.先获取锁,如果是当前线程已经持有，则直接返回\n        //2.防止后面设置锁超时，其实是设置成功，而网络超时导致客户端返回失败，所以获取锁之前需要查询一下\n        V value = redis.get(key);\n        //如果当前锁存在，并且属于当前线程持有，则锁计数+1，直接返回\n        if (null != value && value.equals(v)){\n            count ++;\n            return true;\n        }\n\n        //如果锁已经被持有了，那需要等待锁的释放\n        if (value == null || count <= 0){\n            //获取锁\n            Boolean result = redis.setNx(key, v, expireTime);\n            if (result){\n                count = 1;\n                return true;\n            }\n        }\n\n        try {\n            //获取锁失败间隔一段时间重试\n            TimeUnit.MILLISECONDS.sleep(sleepInterval);\n        } catch (InterruptedException e) {\n            Thread.currentThread().interrupt();\n            return false;\n        }\n\n    }\n\n    return false;\n}\npublic boolean unlock(String key, String requestId){\n    String value = redis.get(key);\n    if (Strings.isNullOrEmpty(value)){\n        count = 0;\n        return true;\n    }\n    //判断当前锁的持有者是否是当前线程，如果是的话释放锁，不是的话返回false\n    if (value.equals(requestId)){\n        if (count > 1){\n            count -- ;\n            return true;\n        }\n\n        boolean delete = redis.delete(key);\n        if (delete){\n            count = 0;\n        }\n        return delete;\n    }\n\n    return false;\n}\npublic static void main(String[] args) {\n    Integer productId = 324324;\n    RedisLock<String> redisLock = new RedisLock<String>();\n    String requestId = UUID.randomUUID().toString();\n    redisLock.lock(productId+\"\", requestId, 1000);\n}\n\n```\n\n这种实现基本解决了误释放和可重入的问题，这里说明几点：\n\n1.  引入 count 实现重入的话，看业务需要，并且在释放锁的时候，其实也可以直接就把锁删除了，一次释放搞定，不需要在通过 count 数量释放多次，看业务需要吧\n2.  关于要考虑设置锁超时，所以需要在设置锁的时候查询一次，可能会有性能的考量，看具体业务吧\n3.  目前获取锁失败的等待时间是在代码里面设置的，可以提出来，修改下等待的逻辑即可\n\n### [#](#错误实现) 错误实现\n\n获取到锁之后要检查下锁的过期时间，如果锁过期了要重新设置下时间, 大致代码如下：\n\n```java\npublic boolean tryLock2(String key, int expireTime){\n    long expires = System.currentTimeMillis() + expireTime;\n\n    // 获取锁\n    Boolean result = redis.setNx(key, expires, expireTime);\n    if (result){\n        return true;\n    }\n\n    V value = redis.get(key);\n    if (value != null && (Long)value < System.currentTimeMillis()){\n        // 锁已经过期\n        String oldValue = redis.getSet(key, expireTime);\n        if (oldValue != null && oldValue.equals(value)){\n            return true;\n        }\n    }\n\n    return false;\n}\n\n```\n\n这种实现存在的问题，过度依赖当前服务器的时间了，如果在大量的并发请求下，都判断出了锁过期，而这个时候再去设置锁的时候，最终是会只有一个线程，但是可能会导致不同服务器根据自身不同的时间覆盖掉最终获取锁的那个线程设置的时间。\n\n##  Tair 实现\n\n通过 Tair 来实现分布式锁和 Redis 的实现核心差不多，不过 Tair 有个很方便的 api，感觉是实现分布式锁的最佳配置，就是 Put api 调用的时候需要传入一个 version，就和数据库的乐观锁一样，修改数据之后，版本会自动累加，如果传入的版本和当前数据版本不一致，就不允许修改。","slug":"分布式锁的场景与实现","published":1,"updated":"2019-01-08T08:35:21.537Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjs17mi0h0031pwgtxyrkof3w","content":"<h2 id=\"使用场景\"><a href=\"#使用场景\" class=\"headerlink\" title=\"使用场景\"></a>使用场景</h2><p>首先，我们看这样一个场景：客户下单的时候，我们调用库存中心进行减库存，那我们一般的操作都是：</p>\n<pre class=\"line-numbers language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">update</span> store <span class=\"token keyword\">set</span> num <span class=\"token operator\">=</span> $num <span class=\"token keyword\">where</span> id <span class=\"token operator\">=</span> $id\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>这种通过设置库存的修改方式，我们知道在并发量高的时候会存在数据库的丢失更新，比如 a, b 当前两个事务，查询出来的库存都是 5，a 买了 3 个单子要把库存设置为 2，而 b 买了 1 个单子要把库存设置为 4，那这个时候就会出现 a 会覆盖 b 的更新，所以我们更多的都是会加个条件：</p>\n<pre class=\"line-numbers language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">update</span> store <span class=\"token keyword\">set</span> num <span class=\"token operator\">=</span> $num <span class=\"token keyword\">where</span> id <span class=\"token operator\">=</span> $id <span class=\"token operator\">and</span> num <span class=\"token operator\">=</span> $query_num\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>即乐观锁的方式来处理，当然也可以通过版本号来处理乐观锁，都是一样的，但是这是更新一个表，如果我们牵扯到多个表呢，我们希望和这个单子关联的所有的表同一时间只能被一个线程来处理更新，多个线程按照不同的顺序去更新同一个单子关联的不同数据，出现死锁的概率比较大。对于非敏感的数据，我们也没有必要去都加乐观锁处理，我们的服务都是多机器部署的，要保证多进程多线程同时只能有一个进程的一个线程去处理，这个时候我们就需要用到分布式锁。分布式锁的实现方式有很多，我们今天分别通过数据库，Zookeeper, Redis 以及 Tair 的实现逻辑。</p>\n<h2 id=\"数据库实现\"><a href=\"#数据库实现\" class=\"headerlink\" title=\"数据库实现\"></a>数据库实现</h2><h3 id=\"加-xx-锁\"><a href=\"#加-xx-锁\" class=\"headerlink\" title=\"加 xx 锁\"></a>加 xx 锁</h3><p>更新一个单子关联的所有的数据，先查询出这个单子，并加上排他锁，在进行一系列的更新操作</p>\n<pre class=\"line-numbers language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">begin</span> <span class=\"token keyword\">transaction</span>；\n<span class=\"token keyword\">select</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">for</span> <span class=\"token keyword\">update</span>；\ndoSomething<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>；\n<span class=\"token keyword\">commit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>这种处理主要依靠排他锁来阻塞其他线程，不过这个需要注意几点：</p>\n<ol>\n<li>查询的数据一定要在数据库里存在，如果不存在的话，数据库会加 gap 锁，而 gap 锁之间是兼容的，这种如果两个线程都加了 gap 锁，另一个再更新的话会出现死锁。不过一般能更新的数据都是存在的</li>\n<li>后续的处理流程需要尽可能的时间短，即在更新的时候提前准备好数据，保证事务处理的时间足够的短，流程足够的短，因为开启事务是一直占着连接的，如果流程比较长会消耗过多的数据库连接的</li>\n</ol>\n<h3 id=\"唯一键\"><a href=\"#唯一键\" class=\"headerlink\" title=\"唯一键\"></a>唯一键</h3><p>通过在一张表里创建唯一键来获取锁，比如执行 saveStore 这个方法</p>\n<pre class=\"line-numbers language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">insert</span> <span class=\"token keyword\">table</span> lock_store <span class=\"token punctuation\">(</span><span class=\"token string\">'method_name'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">values</span><span class=\"token punctuation\">(</span>$method_name<span class=\"token punctuation\">)</span>\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>其中 <code>method_name</code> 是个唯一键，通过这种方式也可以做到，解锁的时候直接删除改行记录就行。不过这种方式，锁就不会是阻塞式的，因为插入数据是立马可以得到返回结果的。</p>\n<p>那针对以上数据库实现的两种分布式锁，存在什么样的优缺点呢？</p>\n<h3 id=\"优点\"><a href=\"#优点\" class=\"headerlink\" title=\"优点\"></a>优点</h3><p>简单，方便，快速实现</p>\n<h3 id=\"缺点\"><a href=\"#缺点\" class=\"headerlink\" title=\"缺点\"></a>缺点</h3><ul>\n<li>基于数据库，开销比较大，性能可能会存在影响</li>\n<li>基于数据库的当前读来实现，数据库会在底层做优化，可能用到索引，可能不用到索引，这个依赖于查询计划的分析</li>\n</ul>\n<h2 id=\"Zookeeper-实现\"><a href=\"#Zookeeper-实现\" class=\"headerlink\" title=\"Zookeeper 实现\"></a>Zookeeper 实现</h2><h3 id=\"获取锁\"><a href=\"#获取锁\" class=\"headerlink\" title=\"获取锁\"></a>获取锁</h3><ol>\n<li>先有一个锁跟节点，lockRootNode，这可以是一个永久的节点</li>\n<li>客户端获取锁，先在 lockRootNode 下创建一个顺序的瞬时节点，保证客户端断开连接，节点也自动删除</li>\n<li>调用 lockRootNode 父节点的 getChildren() 方法，获取所有的节点，并从小到大排序，如果创建的最小的节点是当前节点，则返回 true, 获取锁成功，否则，关注比自己序号小的节点的释放动作 (exist watch)，这样可以保证每一个客户端只需要关注一个节点，不需要关注所有的节点，避免羊群效应。</li>\n<li>如果有节点释放操作，重复步骤 3</li>\n</ol>\n<h3 id=\"释放锁\"><a href=\"#释放锁\" class=\"headerlink\" title=\"释放锁\"></a>释放锁</h3><p>只需要删除步骤 2 中创建的节点即可</p>\n<p>使用 Zookeeper 的分布式锁存在什么样的优缺点呢？</p>\n<h3 id=\"优点-1\"><a href=\"#优点-1\" class=\"headerlink\" title=\"优点\"></a>优点</h3><ul>\n<li>客户端如果出现宕机故障的话，锁可以马上释放</li>\n<li>可以实现阻塞式锁，通过 watcher 监听，实现起来也比较简单</li>\n<li>集群模式，稳定性比较高</li>\n</ul>\n<h3 id=\"缺点-1\"><a href=\"#缺点-1\" class=\"headerlink\" title=\"缺点\"></a>缺点</h3><ul>\n<li>一旦网络有任何的抖动，Zookeeper 就会认为客户端已经宕机，就会断掉连接，其他客户端就可以获取到锁。当然 Zookeeper 有重试机制，这个就比较依赖于其重试机制的策略了</li>\n<li>性能上不如缓存</li>\n</ul>\n<h2 id=\"Redis-实现\"><a href=\"#Redis-实现\" class=\"headerlink\" title=\"Redis 实现\"></a>Redis 实现</h2><p>我们先举个例子，比如现在我要更新产品的信息，产品的唯一键就是 productId</p>\n<h3 id=\"简单实现-1\"><a href=\"#简单实现-1\" class=\"headerlink\" title=\"简单实现 1\"></a>简单实现 1</h3><pre class=\"line-numbers language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">lock</span><span class=\"token punctuation\">(</span>String key<span class=\"token punctuation\">,</span> V v<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> expireTime<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">int</span> retry <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\" spellcheck=\"true\">//获取锁失败最多尝试10次</span>\n        <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>retry <span class=\"token operator\">&lt;</span> failRetryTimes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n            <span class=\"token comment\" spellcheck=\"true\">//获取锁</span>\n            Boolean result <span class=\"token operator\">=</span> redis<span class=\"token punctuation\">.</span><span class=\"token function\">setNx</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> v<span class=\"token punctuation\">,</span> expireTime<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n\n            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token comment\" spellcheck=\"true\">//获取锁失败间隔一段时间重试</span>\n                TimeUnit<span class=\"token punctuation\">.</span>MILLISECONDS<span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span>sleepInterval<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">InterruptedException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                Thread<span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">interrupt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">unlock</span><span class=\"token punctuation\">(</span>String key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> redis<span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span>String<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        Integer productId <span class=\"token operator\">=</span> <span class=\"token number\">324324</span><span class=\"token punctuation\">;</span>\n        RedisLock<span class=\"token operator\">&lt;</span>Integer<span class=\"token operator\">></span> redisLock <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RedisLock</span><span class=\"token operator\">&lt;</span>Integer<span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        redisLock<span class=\"token punctuation\">.</span><span class=\"token function\">lock</span><span class=\"token punctuation\">(</span>productId<span class=\"token operator\">+</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> productId<span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>这是一个简单的实现，存在的问题：</p>\n<ol>\n<li>可能会导致当前线程的锁误被其他线程释放，比如 a 线程获取到了锁正在执行，但是由于内部流程处理超时或者 gc 导致锁过期，这个时候 b 线程获取到了锁，a 和 b 线程处理的是同一个 productId，b 还在处理的过程中，这个时候 a 处理完了，a 去释放锁，可能就会导致 a 把 b 获取的锁释放了。</li>\n<li>不能实现可重入</li>\n<li>客户端如果第一次已经设置成功，但是由于超时返回失败，此后客户端尝试会一直失败</li>\n</ol>\n<p>针对以上问题我们改进下：</p>\n<ol>\n<li>v 传 requestId，然后我们在释放锁的时候判断一下，如果是当前 requestId，那就可以释放，否则不允许释放</li>\n<li>加入 count 的锁计数，在获取锁的时候查询一次，如果是当前线程已经持有的锁，那锁技术加 1，直接返回 true</li>\n</ol>\n<h3 id=\"简单实现-2\"><a href=\"#简单实现-2\" class=\"headerlink\" title=\"简单实现 2\"></a>简单实现 2</h3><pre class=\"line-numbers language-java\"><code class=\"language-java\"><span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">volatile</span> <span class=\"token keyword\">int</span> count <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">lock</span><span class=\"token punctuation\">(</span>String key<span class=\"token punctuation\">,</span> V v<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> expireTime<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">int</span> retry <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\" spellcheck=\"true\">//获取锁失败最多尝试10次</span>\n    <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>retry <span class=\"token operator\">&lt;</span> failRetryTimes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token comment\" spellcheck=\"true\">//1.先获取锁,如果是当前线程已经持有，则直接返回</span>\n        <span class=\"token comment\" spellcheck=\"true\">//2.防止后面设置锁超时，其实是设置成功，而网络超时导致客户端返回失败，所以获取锁之前需要查询一下</span>\n        V value <span class=\"token operator\">=</span> redis<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\" spellcheck=\"true\">//如果当前锁存在，并且属于当前线程持有，则锁计数+1，直接返回</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>null <span class=\"token operator\">!=</span> value <span class=\"token operator\">&amp;&amp;</span> value<span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>v<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n            count <span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\" spellcheck=\"true\">//如果锁已经被持有了，那需要等待锁的释放</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>value <span class=\"token operator\">==</span> null <span class=\"token operator\">||</span> count <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n            <span class=\"token comment\" spellcheck=\"true\">//获取锁</span>\n            Boolean result <span class=\"token operator\">=</span> redis<span class=\"token punctuation\">.</span><span class=\"token function\">setNx</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> v<span class=\"token punctuation\">,</span> expireTime<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n                count <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\" spellcheck=\"true\">//获取锁失败间隔一段时间重试</span>\n            TimeUnit<span class=\"token punctuation\">.</span>MILLISECONDS<span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span>sleepInterval<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">InterruptedException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            Thread<span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">interrupt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">unlock</span><span class=\"token punctuation\">(</span>String key<span class=\"token punctuation\">,</span> String requestId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    String value <span class=\"token operator\">=</span> redis<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>Strings<span class=\"token punctuation\">.</span><span class=\"token function\">isNullOrEmpty</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        count <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token comment\" spellcheck=\"true\">//判断当前锁的持有者是否是当前线程，如果是的话释放锁，不是的话返回false</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>requestId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>count <span class=\"token operator\">></span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n            count <span class=\"token operator\">--</span> <span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">boolean</span> delete <span class=\"token operator\">=</span> redis<span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>delete<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n            count <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span> delete<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span>String<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    Integer productId <span class=\"token operator\">=</span> <span class=\"token number\">324324</span><span class=\"token punctuation\">;</span>\n    RedisLock<span class=\"token operator\">&lt;</span>String<span class=\"token operator\">></span> redisLock <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RedisLock</span><span class=\"token operator\">&lt;</span>String<span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    String requestId <span class=\"token operator\">=</span> UUID<span class=\"token punctuation\">.</span><span class=\"token function\">randomUUID</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    redisLock<span class=\"token punctuation\">.</span><span class=\"token function\">lock</span><span class=\"token punctuation\">(</span>productId<span class=\"token operator\">+</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> requestId<span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>这种实现基本解决了误释放和可重入的问题，这里说明几点：</p>\n<ol>\n<li>引入 count 实现重入的话，看业务需要，并且在释放锁的时候，其实也可以直接就把锁删除了，一次释放搞定，不需要在通过 count 数量释放多次，看业务需要吧</li>\n<li>关于要考虑设置锁超时，所以需要在设置锁的时候查询一次，可能会有性能的考量，看具体业务吧</li>\n<li>目前获取锁失败的等待时间是在代码里面设置的，可以提出来，修改下等待的逻辑即可</li>\n</ol>\n<h3 id=\"错误实现\"><a href=\"#错误实现\" class=\"headerlink\" title=\"# 错误实现\"></a><a href=\"#错误实现\">#</a> 错误实现</h3><p>获取到锁之后要检查下锁的过期时间，如果锁过期了要重新设置下时间, 大致代码如下：</p>\n<pre class=\"line-numbers language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">tryLock2</span><span class=\"token punctuation\">(</span>String key<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> expireTime<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">long</span> expires <span class=\"token operator\">=</span> System<span class=\"token punctuation\">.</span><span class=\"token function\">currentTimeMillis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> expireTime<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">// 获取锁</span>\n    Boolean result <span class=\"token operator\">=</span> redis<span class=\"token punctuation\">.</span><span class=\"token function\">setNx</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> expires<span class=\"token punctuation\">,</span> expireTime<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    V value <span class=\"token operator\">=</span> redis<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>value <span class=\"token operator\">!=</span> null <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>Long<span class=\"token punctuation\">)</span>value <span class=\"token operator\">&lt;</span> System<span class=\"token punctuation\">.</span><span class=\"token function\">currentTimeMillis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token comment\" spellcheck=\"true\">// 锁已经过期</span>\n        String oldValue <span class=\"token operator\">=</span> redis<span class=\"token punctuation\">.</span><span class=\"token function\">getSet</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> expireTime<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>oldValue <span class=\"token operator\">!=</span> null <span class=\"token operator\">&amp;&amp;</span> oldValue<span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>这种实现存在的问题，过度依赖当前服务器的时间了，如果在大量的并发请求下，都判断出了锁过期，而这个时候再去设置锁的时候，最终是会只有一个线程，但是可能会导致不同服务器根据自身不同的时间覆盖掉最终获取锁的那个线程设置的时间。</p>\n<h2 id=\"Tair-实现\"><a href=\"#Tair-实现\" class=\"headerlink\" title=\"Tair 实现\"></a>Tair 实现</h2><p>通过 Tair 来实现分布式锁和 Redis 的实现核心差不多，不过 Tair 有个很方便的 api，感觉是实现分布式锁的最佳配置，就是 Put api 调用的时候需要传入一个 version，就和数据库的乐观锁一样，修改数据之后，版本会自动累加，如果传入的版本和当前数据版本不一致，就不允许修改。</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"使用场景\"><a href=\"#使用场景\" class=\"headerlink\" title=\"使用场景\"></a>使用场景</h2><p>首先，我们看这样一个场景：客户下单的时候，我们调用库存中心进行减库存，那我们一般的操作都是：</p>\n<pre><code class=\"sql\">update store set num = $num where id = $id\n\n</code></pre>\n<p>这种通过设置库存的修改方式，我们知道在并发量高的时候会存在数据库的丢失更新，比如 a, b 当前两个事务，查询出来的库存都是 5，a 买了 3 个单子要把库存设置为 2，而 b 买了 1 个单子要把库存设置为 4，那这个时候就会出现 a 会覆盖 b 的更新，所以我们更多的都是会加个条件：</p>\n<pre><code class=\"sql\">update store set num = $num where id = $id and num = $query_num\n\n</code></pre>\n<p>即乐观锁的方式来处理，当然也可以通过版本号来处理乐观锁，都是一样的，但是这是更新一个表，如果我们牵扯到多个表呢，我们希望和这个单子关联的所有的表同一时间只能被一个线程来处理更新，多个线程按照不同的顺序去更新同一个单子关联的不同数据，出现死锁的概率比较大。对于非敏感的数据，我们也没有必要去都加乐观锁处理，我们的服务都是多机器部署的，要保证多进程多线程同时只能有一个进程的一个线程去处理，这个时候我们就需要用到分布式锁。分布式锁的实现方式有很多，我们今天分别通过数据库，Zookeeper, Redis 以及 Tair 的实现逻辑。</p>\n<h2 id=\"数据库实现\"><a href=\"#数据库实现\" class=\"headerlink\" title=\"数据库实现\"></a>数据库实现</h2><h3 id=\"加-xx-锁\"><a href=\"#加-xx-锁\" class=\"headerlink\" title=\"加 xx 锁\"></a>加 xx 锁</h3><p>更新一个单子关联的所有的数据，先查询出这个单子，并加上排他锁，在进行一系列的更新操作</p>\n<pre><code class=\"sql\">begin transaction；\nselect ...for update；\ndoSomething()；\ncommit();\n\n</code></pre>\n<p>这种处理主要依靠排他锁来阻塞其他线程，不过这个需要注意几点：</p>\n<ol>\n<li>查询的数据一定要在数据库里存在，如果不存在的话，数据库会加 gap 锁，而 gap 锁之间是兼容的，这种如果两个线程都加了 gap 锁，另一个再更新的话会出现死锁。不过一般能更新的数据都是存在的</li>\n<li>后续的处理流程需要尽可能的时间短，即在更新的时候提前准备好数据，保证事务处理的时间足够的短，流程足够的短，因为开启事务是一直占着连接的，如果流程比较长会消耗过多的数据库连接的</li>\n</ol>\n<h3 id=\"唯一键\"><a href=\"#唯一键\" class=\"headerlink\" title=\"唯一键\"></a>唯一键</h3><p>通过在一张表里创建唯一键来获取锁，比如执行 saveStore 这个方法</p>\n<pre><code class=\"sql\">insert table lock_store (&#39;method_name&#39;) values($method_name)\n\n</code></pre>\n<p>其中 <code>method_name</code> 是个唯一键，通过这种方式也可以做到，解锁的时候直接删除改行记录就行。不过这种方式，锁就不会是阻塞式的，因为插入数据是立马可以得到返回结果的。</p>\n<p>那针对以上数据库实现的两种分布式锁，存在什么样的优缺点呢？</p>\n<h3 id=\"优点\"><a href=\"#优点\" class=\"headerlink\" title=\"优点\"></a>优点</h3><p>简单，方便，快速实现</p>\n<h3 id=\"缺点\"><a href=\"#缺点\" class=\"headerlink\" title=\"缺点\"></a>缺点</h3><ul>\n<li>基于数据库，开销比较大，性能可能会存在影响</li>\n<li>基于数据库的当前读来实现，数据库会在底层做优化，可能用到索引，可能不用到索引，这个依赖于查询计划的分析</li>\n</ul>\n<h2 id=\"Zookeeper-实现\"><a href=\"#Zookeeper-实现\" class=\"headerlink\" title=\"Zookeeper 实现\"></a>Zookeeper 实现</h2><h3 id=\"获取锁\"><a href=\"#获取锁\" class=\"headerlink\" title=\"获取锁\"></a>获取锁</h3><ol>\n<li>先有一个锁跟节点，lockRootNode，这可以是一个永久的节点</li>\n<li>客户端获取锁，先在 lockRootNode 下创建一个顺序的瞬时节点，保证客户端断开连接，节点也自动删除</li>\n<li>调用 lockRootNode 父节点的 getChildren() 方法，获取所有的节点，并从小到大排序，如果创建的最小的节点是当前节点，则返回 true, 获取锁成功，否则，关注比自己序号小的节点的释放动作 (exist watch)，这样可以保证每一个客户端只需要关注一个节点，不需要关注所有的节点，避免羊群效应。</li>\n<li>如果有节点释放操作，重复步骤 3</li>\n</ol>\n<h3 id=\"释放锁\"><a href=\"#释放锁\" class=\"headerlink\" title=\"释放锁\"></a>释放锁</h3><p>只需要删除步骤 2 中创建的节点即可</p>\n<p>使用 Zookeeper 的分布式锁存在什么样的优缺点呢？</p>\n<h3 id=\"优点-1\"><a href=\"#优点-1\" class=\"headerlink\" title=\"优点\"></a>优点</h3><ul>\n<li>客户端如果出现宕机故障的话，锁可以马上释放</li>\n<li>可以实现阻塞式锁，通过 watcher 监听，实现起来也比较简单</li>\n<li>集群模式，稳定性比较高</li>\n</ul>\n<h3 id=\"缺点-1\"><a href=\"#缺点-1\" class=\"headerlink\" title=\"缺点\"></a>缺点</h3><ul>\n<li>一旦网络有任何的抖动，Zookeeper 就会认为客户端已经宕机，就会断掉连接，其他客户端就可以获取到锁。当然 Zookeeper 有重试机制，这个就比较依赖于其重试机制的策略了</li>\n<li>性能上不如缓存</li>\n</ul>\n<h2 id=\"Redis-实现\"><a href=\"#Redis-实现\" class=\"headerlink\" title=\"Redis 实现\"></a>Redis 实现</h2><p>我们先举个例子，比如现在我要更新产品的信息，产品的唯一键就是 productId</p>\n<h3 id=\"简单实现-1\"><a href=\"#简单实现-1\" class=\"headerlink\" title=\"简单实现 1\"></a>简单实现 1</h3><pre><code class=\"java\">public boolean lock(String key, V v, int expireTime){\n        int retry = 0;\n        //获取锁失败最多尝试10次\n        while (retry &lt; failRetryTimes){\n            //获取锁\n            Boolean result = redis.setNx(key, v, expireTime);\n            if (result){\n                return true;\n            }\n\n            try {\n                //获取锁失败间隔一段时间重试\n                TimeUnit.MILLISECONDS.sleep(sleepInterval);\n            } catch (InterruptedException e) {\n                Thread.currentThread().interrupt();\n                return false;\n            }\n\n        }\n\n        return false;\n    }\n    public boolean unlock(String key){\n        return redis.delete(key);\n    }\n    public static void main(String[] args) {\n        Integer productId = 324324;\n        RedisLock&lt;Integer&gt; redisLock = new RedisLock&lt;Integer&gt;();\n        redisLock.lock(productId+&quot;&quot;, productId, 1000);\n    }\n}\n</code></pre>\n<p>这是一个简单的实现，存在的问题：</p>\n<ol>\n<li>可能会导致当前线程的锁误被其他线程释放，比如 a 线程获取到了锁正在执行，但是由于内部流程处理超时或者 gc 导致锁过期，这个时候 b 线程获取到了锁，a 和 b 线程处理的是同一个 productId，b 还在处理的过程中，这个时候 a 处理完了，a 去释放锁，可能就会导致 a 把 b 获取的锁释放了。</li>\n<li>不能实现可重入</li>\n<li>客户端如果第一次已经设置成功，但是由于超时返回失败，此后客户端尝试会一直失败</li>\n</ol>\n<p>针对以上问题我们改进下：</p>\n<ol>\n<li>v 传 requestId，然后我们在释放锁的时候判断一下，如果是当前 requestId，那就可以释放，否则不允许释放</li>\n<li>加入 count 的锁计数，在获取锁的时候查询一次，如果是当前线程已经持有的锁，那锁技术加 1，直接返回 true</li>\n</ol>\n<h3 id=\"简单实现-2\"><a href=\"#简单实现-2\" class=\"headerlink\" title=\"简单实现 2\"></a>简单实现 2</h3><pre><code class=\"java\">private static volatile int count = 0;\npublic boolean lock(String key, V v, int expireTime){\n    int retry = 0;\n    //获取锁失败最多尝试10次\n    while (retry &lt; failRetryTimes){\n        //1.先获取锁,如果是当前线程已经持有，则直接返回\n        //2.防止后面设置锁超时，其实是设置成功，而网络超时导致客户端返回失败，所以获取锁之前需要查询一下\n        V value = redis.get(key);\n        //如果当前锁存在，并且属于当前线程持有，则锁计数+1，直接返回\n        if (null != value &amp;&amp; value.equals(v)){\n            count ++;\n            return true;\n        }\n\n        //如果锁已经被持有了，那需要等待锁的释放\n        if (value == null || count &lt;= 0){\n            //获取锁\n            Boolean result = redis.setNx(key, v, expireTime);\n            if (result){\n                count = 1;\n                return true;\n            }\n        }\n\n        try {\n            //获取锁失败间隔一段时间重试\n            TimeUnit.MILLISECONDS.sleep(sleepInterval);\n        } catch (InterruptedException e) {\n            Thread.currentThread().interrupt();\n            return false;\n        }\n\n    }\n\n    return false;\n}\npublic boolean unlock(String key, String requestId){\n    String value = redis.get(key);\n    if (Strings.isNullOrEmpty(value)){\n        count = 0;\n        return true;\n    }\n    //判断当前锁的持有者是否是当前线程，如果是的话释放锁，不是的话返回false\n    if (value.equals(requestId)){\n        if (count &gt; 1){\n            count -- ;\n            return true;\n        }\n\n        boolean delete = redis.delete(key);\n        if (delete){\n            count = 0;\n        }\n        return delete;\n    }\n\n    return false;\n}\npublic static void main(String[] args) {\n    Integer productId = 324324;\n    RedisLock&lt;String&gt; redisLock = new RedisLock&lt;String&gt;();\n    String requestId = UUID.randomUUID().toString();\n    redisLock.lock(productId+&quot;&quot;, requestId, 1000);\n}\n\n</code></pre>\n<p>这种实现基本解决了误释放和可重入的问题，这里说明几点：</p>\n<ol>\n<li>引入 count 实现重入的话，看业务需要，并且在释放锁的时候，其实也可以直接就把锁删除了，一次释放搞定，不需要在通过 count 数量释放多次，看业务需要吧</li>\n<li>关于要考虑设置锁超时，所以需要在设置锁的时候查询一次，可能会有性能的考量，看具体业务吧</li>\n<li>目前获取锁失败的等待时间是在代码里面设置的，可以提出来，修改下等待的逻辑即可</li>\n</ol>\n<h3 id=\"错误实现\"><a href=\"#错误实现\" class=\"headerlink\" title=\"# 错误实现\"></a><a href=\"#错误实现\">#</a> 错误实现</h3><p>获取到锁之后要检查下锁的过期时间，如果锁过期了要重新设置下时间, 大致代码如下：</p>\n<pre><code class=\"java\">public boolean tryLock2(String key, int expireTime){\n    long expires = System.currentTimeMillis() + expireTime;\n\n    // 获取锁\n    Boolean result = redis.setNx(key, expires, expireTime);\n    if (result){\n        return true;\n    }\n\n    V value = redis.get(key);\n    if (value != null &amp;&amp; (Long)value &lt; System.currentTimeMillis()){\n        // 锁已经过期\n        String oldValue = redis.getSet(key, expireTime);\n        if (oldValue != null &amp;&amp; oldValue.equals(value)){\n            return true;\n        }\n    }\n\n    return false;\n}\n\n</code></pre>\n<p>这种实现存在的问题，过度依赖当前服务器的时间了，如果在大量的并发请求下，都判断出了锁过期，而这个时候再去设置锁的时候，最终是会只有一个线程，但是可能会导致不同服务器根据自身不同的时间覆盖掉最终获取锁的那个线程设置的时间。</p>\n<h2 id=\"Tair-实现\"><a href=\"#Tair-实现\" class=\"headerlink\" title=\"Tair 实现\"></a>Tair 实现</h2><p>通过 Tair 来实现分布式锁和 Redis 的实现核心差不多，不过 Tair 有个很方便的 api，感觉是实现分布式锁的最佳配置，就是 Put api 调用的时候需要传入一个 version，就和数据库的乐观锁一样，修改数据之后，版本会自动累加，如果传入的版本和当前数据版本不一致，就不允许修改。</p>\n"},{"title":"设计一个良好的Rest API","author":"Asia Cui","date":"2019-01-18T01:30:00.000Z","_content":"## 版本号\n\n在 RESTful API 中，API 接口应该尽量兼容之前的版本。但是，在实际业务开发场景中，可能随着业务需求的不断迭代，现有的 API 接口无法支持旧版本的适配，此时如果强制升级服务端的 API 接口将导致客户端旧有功能出现故障。实际上，Web 端是部署在服务器，因此它可以很容易为了适配服务端的新的 API 接口进行版本升级，然而像 Android 端、IOS 端、PC 端等其他客户端是运行在用户的机器上，因此当前产品很难做到适配新的服务端的 API 接口，从而出现功能故障，这种情况下，用户必须升级产品到最新的版本才能正常使用。\n\n为了解决这个版本不兼容问题，在设计 RESTful API 的一种实用的做法是使用版本号。一般情况下，我们会在 url 中保留版本号，并同时兼容多个版本。\n\n```java\n【GET】  /v1/users/{user_id}  // 版本 v1 的查询用户列表的 API 接口\n【GET】  /v2/users/{user_id}  // 版本 v2 的查询用户列表的 API 接口\n\n```\n\n现在，我们可以不改变版本 v1 的查询用户列表的 API 接口的情况下，新增版本 v2 的查询用户列表的 API 接口以满足新的业务需求，此时，客户端的产品的新功能将请求新的服务端的 API 接口地址。虽然服务端会同时兼容多个版本，但是同时维护太多版本对于服务端而言是个不小的负担，因为服务端要维护多套代码。这种情况下，常见的做法不是维护所有的兼容版本，而是只维护最新的几个兼容版本，例如维护最新的三个兼容版本。在一段时间后，当绝大多数用户升级到较新的版本后，废弃一些使用量较少的服务端的老版本 API 接口版本，并要求使用产品的非常旧的版本的用户强制升级。\n\n注意的是，“不改变版本 v1 的查询用户列表的 API 接口” 主要指的是对于客户端的调用者而言它看起来是没有改变。而实际上，如果业务变化太大，服务端的开发人员需要对旧版本的 API 接口使用适配器模式将请求适配到新的 API 接口上。\n\n### 资源路径\n\nRESTful API 的设计以资源为核心，每一个 URI 代表一种资源。因此，URI 不能包含动词，只能是名词。注意的是，形容词也是可以使用的，但是尽量少用。一般来说，不论资源是单个还是多个，API 的名词要以复数进行命名。此外，命名名词的时候，要使用小写、数字及下划线来区分多个单词。这样的设计是为了与 json 对象及属性的命名方案保持一致。例如，一个查询系统标签的接口可以进行如下设计。\n\n```java\n【GET】  /v1/tags/{tag_id} \n\n```\n\n同时，资源的路径应该从根到子依次如下\n\n```java\n/{resources}/{resource_id}/{sub_resources}/{sub_resource_id}/{sub_resource_property}\n\n```\n\n我们来看一个 “添加用户的角色” 的设计，其中 “用户” 是主资源，“角色” 是子资源。\n\n```java\n【POST】  /v1/users/{user_id}/roles/{role_id} // 添加用户的角色\n\n```\n\n有的时候，当一个资源变化难以使用标准的 RESTful API 来命名，可以考虑使用一些特殊的 actions 命名。\n\n```java\n/{resources}/{resource_id}/actions/{action}\n\n```\n\n举个例子，“密码修改” 这个接口的命名很难完全使用名词来构建路径，此时可以引入 action 命名。\n\n```basic\n【PUT】  /v1/users/{user_id}/password/actions/modify // 密码修改\n\n```\n\n### 请求方式\n\n可以通过 GET、 POST、 PUT、 PATCH、 DELETE 等方式对服务端的资源进行操作。其中：\n\n*   GET：用于查询资源\n*   POST：用于创建资源\n*   PUT：用于更新服务端的资源的全部信息\n*   PATCH：用于更新服务端的资源的部分信息\n*   DELETE：用于删除服务端的资源。\n\n这里，使用 “用户” 的案例进行回顾通过 GET、 POST、 PUT、 PATCH、 DELETE 等方式对服务端的资源进行操作。\n\n```java\n【GET】          /users                # 查询用户信息列表\n【GET】          /users/1001           # 查看某个用户信息\n【POST】         /users                # 新建用户信息\n【PUT】          /users/1001           # 更新用户信息(全部字段)\n【PATCH】        /users/1001           # 更新用户信息(部分字段)\n【DELETE】       /users/1001           # 删除用户信息\n\n```\n\n### 查询参数\n\nRESTful API 接口应该提供参数，过滤返回结果。其中，offset 指定返回记录的开始位置。一般情况下，它会结合 limit 来做分页的查询，这里 limit 指定返回记录的数量。\n\n```java\n【GET】  /{version}/{resources}/{resource_id}?offset=0&limit=20\n\n```\n\n同时，orderby 可以用来排序，但仅支持单个字符的排序，如果存在多个字段排序，需要业务中扩展其他参数进行支持。\n\n```java\n【GET】  /{version}/{resources}/{resource_id}?orderby={field} [asc|desc]\n\n```\n\n为了更好地选择是否支持查询总数，我们可以使用 count 字段，count 表示返回数据是否包含总条数，它的默认值为 false。\n\n```java\n【GET】  /{version}/{resources}/{resource_id}?count=[true|false]\n\n```\n\n上面介绍的 offset、 limit、 orderby 是一些公共参数。此外，业务场景中还存在许多个性化的参数。我们来看一个例子。\n\n```java\n【GET】  /v1/categorys/{category_id}/apps/{app_id}?enable=[1|0]&os_type={field}&device_ids={field,field,…}\n\n```\n\n注意的是，不要过度设计，只返回用户需要的查询参数。此外，需要考虑是否对查询参数创建数据库索引以提高查询性能。\n\n### 状态码\n\n使用适合的状态码很重要，而不应该全部都返回状态码 200，或者随便乱使用。这里，列举在实际开发过程中常用的一些状态码，以供参考。\n\n| 状态码 | 描述 |\n| --- | --- |\n| 200 | 请求成功 |\n| 201 | 创建成功 |\n| 400 | 错误的请求 |\n| 401 | 未验证 |\n| 403 | 被拒绝 |\n| 404 | 无法找到 |\n| 409 | 资源冲突 |\n| 500 | 服务器内部错误 |\n\n### 异常响应\n\n当 RESTful API 接口出现非 2xx 的 HTTP 错误码响应时，采用全局的异常结构响应信息。\n\n```json\nHTTP/1.1 400 Bad Request\nContent-Type: application/json\n{\n    \"code\": \"INVALID_ARGUMENT\",\n    \"message\": \"{error message}\",\n    \"cause\": \"{cause message}\",\n    \"request_id\": \"01234567-89ab-cdef-0123-456789abcdef\",\n    \"host_id\": \"{server identity}\",\n    \"server_time\": \"2014-01-01T12:00:00Z\"\n}\n\n```\n\n### 请求参数\n\n在设计服务端的 RESTful API 的时候，我们还需要对请求参数进行限制说明。例如一个支持批量查询的接口，我们要考虑最大支持查询的数量。\n\n```java\n【GET】     /v1/users/batch?user_ids=1001,1002      // 批量查询用户信息\n参数说明\n- user_ids: 用户ID串，最多允许 20 个。\n\n```\n\n此外，在设计新增或修改接口时，我们还需要在文档中明确告诉调用者哪些参数是必填项，哪些是选填项，以及它们的边界值的限制。\n\n```json\n【POST】     /v1/users                             // 创建用户信息\n请求内容\n{\n    \"username\": \"lusifer\",                 // 必填, 用户名称, max 10\n    \"realname\": \"鲁斯菲尔\",               // 必填, 用户名称, max 10\n    \"password\": \"123456\",              // 必填, 用户密码, max 32\n    \"email\": \"topsale@vip.qq.com\",     // 选填, 电子邮箱, max 32\n    \"weixin\": \"Lusifer\",            // 选填，微信账号, max 32\n    \"sex\": 1                           // 必填, 用户性别[1-男 2-女 99-未知]\n}\n\n```\n\n### 响应参数\n\n针对不同操作，服务端向用户返回的结果应该符合以下规范。\n\n```java\n【GET】     /{version}/{resources}/{resource_id}      // 返回单个资源对象\n【GET】     /{version}/{resources}                    // 返回资源对象的列表\n【POST】    /{version}/{resources}                    // 返回新生成的资源对象\n【PUT】     /{version}/{resources}/{resource_id}      // 返回完整的资源对象\n【PATCH】   /{version}/{resources}/{resource_id}      // 返回完整的资源对象\n【DELETE】  /{version}/{resources}/{resource_id}      // 状态码 200，返回完整的资源对象。\n                                                      // 状态码 204，返回一个空文档\n\n```\n\n如果是单条数据，则返回一个对象的 JSON 字符串。\n\n```json\nHTTP/1.1 200 OK\n{\n    \"id\" : \"01234567-89ab-cdef-0123-456789abcdef\",\n    \"name\" : \"example\",\n    \"created_time\": 1496676420000,\n    \"updated_time\": 1496676420000,\n    ...\n}\n\n```\n\n如果是列表数据，则返回一个封装的结构体。\n\n```json\nHTTP/1.1 200 OK\n{\n    \"count\":100,\n    \"items\":[\n        {\n            \"id\" : \"01234567-89ab-cdef-0123-456789abcdef\",\n            \"name\" : \"example\",\n            \"created_time\": 1496676420000,\n            \"updated_time\": 1496676420000,\n            ...\n        },\n        ...\n    ]\n}\n\n```\n\n### 一个完整的案例\n\n最后，我们使用一个完整的案例将前面介绍的知识整合起来。这里，使用 “获取用户列表” 的案例。\n\n```json\n【GET】     /v1/users?[&keyword=xxx][&enable=1][&offset=0][&limit=20] 获取用户列表\n功能说明：获取用户列表\n请求方式：GET\n参数说明\n- keyword: 模糊查找的关键字。[选填]\n- enable: 启用状态[1-启用 2-禁用]。[选填]\n- offset: 获取位置偏移，从 0 开始。[选填]\n- limit: 每次获取返回的条数，缺省为 20 条，最大不超过 100。 [选填]\n响应内容\nHTTP/1.1 200 OK\n{\n    \"count\":100,\n    \"items\":[\n        {\n            \"id\" : \"01234567-89ab-cdef-0123-456789abcdef\",\n            \"name\" : \"example\",\n            \"created_time\": 1496676420000,\n            \"updated_time\": 1496676420000,\n            ...\n        },\n        ...\n    ]\n}\n失败响应\nHTTP/1.1 403 UC/AUTH_DENIED\nContent-Type: application/json\n{\n    \"code\": \"INVALID_ARGUMENT\",\n    \"message\": \"{error message}\",\n    \"cause\": \"{cause message}\",\n    \"request_id\": \"01234567-89ab-cdef-0123-456789abcdef\",\n    \"host_id\": \"{server identity}\",\n    \"server_time\": \"2014-01-01T12:00:00Z\"\n}\n错误代码\n- 403 UC/AUTH_DENIED    授权受限\n\n```","source":"_posts/设计一个良好的-API.md","raw":"title: 设计一个良好的Rest API\nauthor: Asia Cui\ntags:\n  - RESTful\ncategories:\n  - 设计一个良好的 API\ndate: 2019-01-18 09:30:00\n---\n## 版本号\n\n在 RESTful API 中，API 接口应该尽量兼容之前的版本。但是，在实际业务开发场景中，可能随着业务需求的不断迭代，现有的 API 接口无法支持旧版本的适配，此时如果强制升级服务端的 API 接口将导致客户端旧有功能出现故障。实际上，Web 端是部署在服务器，因此它可以很容易为了适配服务端的新的 API 接口进行版本升级，然而像 Android 端、IOS 端、PC 端等其他客户端是运行在用户的机器上，因此当前产品很难做到适配新的服务端的 API 接口，从而出现功能故障，这种情况下，用户必须升级产品到最新的版本才能正常使用。\n\n为了解决这个版本不兼容问题，在设计 RESTful API 的一种实用的做法是使用版本号。一般情况下，我们会在 url 中保留版本号，并同时兼容多个版本。\n\n```java\n【GET】  /v1/users/{user_id}  // 版本 v1 的查询用户列表的 API 接口\n【GET】  /v2/users/{user_id}  // 版本 v2 的查询用户列表的 API 接口\n\n```\n\n现在，我们可以不改变版本 v1 的查询用户列表的 API 接口的情况下，新增版本 v2 的查询用户列表的 API 接口以满足新的业务需求，此时，客户端的产品的新功能将请求新的服务端的 API 接口地址。虽然服务端会同时兼容多个版本，但是同时维护太多版本对于服务端而言是个不小的负担，因为服务端要维护多套代码。这种情况下，常见的做法不是维护所有的兼容版本，而是只维护最新的几个兼容版本，例如维护最新的三个兼容版本。在一段时间后，当绝大多数用户升级到较新的版本后，废弃一些使用量较少的服务端的老版本 API 接口版本，并要求使用产品的非常旧的版本的用户强制升级。\n\n注意的是，“不改变版本 v1 的查询用户列表的 API 接口” 主要指的是对于客户端的调用者而言它看起来是没有改变。而实际上，如果业务变化太大，服务端的开发人员需要对旧版本的 API 接口使用适配器模式将请求适配到新的 API 接口上。\n\n### 资源路径\n\nRESTful API 的设计以资源为核心，每一个 URI 代表一种资源。因此，URI 不能包含动词，只能是名词。注意的是，形容词也是可以使用的，但是尽量少用。一般来说，不论资源是单个还是多个，API 的名词要以复数进行命名。此外，命名名词的时候，要使用小写、数字及下划线来区分多个单词。这样的设计是为了与 json 对象及属性的命名方案保持一致。例如，一个查询系统标签的接口可以进行如下设计。\n\n```java\n【GET】  /v1/tags/{tag_id} \n\n```\n\n同时，资源的路径应该从根到子依次如下\n\n```java\n/{resources}/{resource_id}/{sub_resources}/{sub_resource_id}/{sub_resource_property}\n\n```\n\n我们来看一个 “添加用户的角色” 的设计，其中 “用户” 是主资源，“角色” 是子资源。\n\n```java\n【POST】  /v1/users/{user_id}/roles/{role_id} // 添加用户的角色\n\n```\n\n有的时候，当一个资源变化难以使用标准的 RESTful API 来命名，可以考虑使用一些特殊的 actions 命名。\n\n```java\n/{resources}/{resource_id}/actions/{action}\n\n```\n\n举个例子，“密码修改” 这个接口的命名很难完全使用名词来构建路径，此时可以引入 action 命名。\n\n```basic\n【PUT】  /v1/users/{user_id}/password/actions/modify // 密码修改\n\n```\n\n### 请求方式\n\n可以通过 GET、 POST、 PUT、 PATCH、 DELETE 等方式对服务端的资源进行操作。其中：\n\n*   GET：用于查询资源\n*   POST：用于创建资源\n*   PUT：用于更新服务端的资源的全部信息\n*   PATCH：用于更新服务端的资源的部分信息\n*   DELETE：用于删除服务端的资源。\n\n这里，使用 “用户” 的案例进行回顾通过 GET、 POST、 PUT、 PATCH、 DELETE 等方式对服务端的资源进行操作。\n\n```java\n【GET】          /users                # 查询用户信息列表\n【GET】          /users/1001           # 查看某个用户信息\n【POST】         /users                # 新建用户信息\n【PUT】          /users/1001           # 更新用户信息(全部字段)\n【PATCH】        /users/1001           # 更新用户信息(部分字段)\n【DELETE】       /users/1001           # 删除用户信息\n\n```\n\n### 查询参数\n\nRESTful API 接口应该提供参数，过滤返回结果。其中，offset 指定返回记录的开始位置。一般情况下，它会结合 limit 来做分页的查询，这里 limit 指定返回记录的数量。\n\n```java\n【GET】  /{version}/{resources}/{resource_id}?offset=0&limit=20\n\n```\n\n同时，orderby 可以用来排序，但仅支持单个字符的排序，如果存在多个字段排序，需要业务中扩展其他参数进行支持。\n\n```java\n【GET】  /{version}/{resources}/{resource_id}?orderby={field} [asc|desc]\n\n```\n\n为了更好地选择是否支持查询总数，我们可以使用 count 字段，count 表示返回数据是否包含总条数，它的默认值为 false。\n\n```java\n【GET】  /{version}/{resources}/{resource_id}?count=[true|false]\n\n```\n\n上面介绍的 offset、 limit、 orderby 是一些公共参数。此外，业务场景中还存在许多个性化的参数。我们来看一个例子。\n\n```java\n【GET】  /v1/categorys/{category_id}/apps/{app_id}?enable=[1|0]&os_type={field}&device_ids={field,field,…}\n\n```\n\n注意的是，不要过度设计，只返回用户需要的查询参数。此外，需要考虑是否对查询参数创建数据库索引以提高查询性能。\n\n### 状态码\n\n使用适合的状态码很重要，而不应该全部都返回状态码 200，或者随便乱使用。这里，列举在实际开发过程中常用的一些状态码，以供参考。\n\n| 状态码 | 描述 |\n| --- | --- |\n| 200 | 请求成功 |\n| 201 | 创建成功 |\n| 400 | 错误的请求 |\n| 401 | 未验证 |\n| 403 | 被拒绝 |\n| 404 | 无法找到 |\n| 409 | 资源冲突 |\n| 500 | 服务器内部错误 |\n\n### 异常响应\n\n当 RESTful API 接口出现非 2xx 的 HTTP 错误码响应时，采用全局的异常结构响应信息。\n\n```json\nHTTP/1.1 400 Bad Request\nContent-Type: application/json\n{\n    \"code\": \"INVALID_ARGUMENT\",\n    \"message\": \"{error message}\",\n    \"cause\": \"{cause message}\",\n    \"request_id\": \"01234567-89ab-cdef-0123-456789abcdef\",\n    \"host_id\": \"{server identity}\",\n    \"server_time\": \"2014-01-01T12:00:00Z\"\n}\n\n```\n\n### 请求参数\n\n在设计服务端的 RESTful API 的时候，我们还需要对请求参数进行限制说明。例如一个支持批量查询的接口，我们要考虑最大支持查询的数量。\n\n```java\n【GET】     /v1/users/batch?user_ids=1001,1002      // 批量查询用户信息\n参数说明\n- user_ids: 用户ID串，最多允许 20 个。\n\n```\n\n此外，在设计新增或修改接口时，我们还需要在文档中明确告诉调用者哪些参数是必填项，哪些是选填项，以及它们的边界值的限制。\n\n```json\n【POST】     /v1/users                             // 创建用户信息\n请求内容\n{\n    \"username\": \"lusifer\",                 // 必填, 用户名称, max 10\n    \"realname\": \"鲁斯菲尔\",               // 必填, 用户名称, max 10\n    \"password\": \"123456\",              // 必填, 用户密码, max 32\n    \"email\": \"topsale@vip.qq.com\",     // 选填, 电子邮箱, max 32\n    \"weixin\": \"Lusifer\",            // 选填，微信账号, max 32\n    \"sex\": 1                           // 必填, 用户性别[1-男 2-女 99-未知]\n}\n\n```\n\n### 响应参数\n\n针对不同操作，服务端向用户返回的结果应该符合以下规范。\n\n```java\n【GET】     /{version}/{resources}/{resource_id}      // 返回单个资源对象\n【GET】     /{version}/{resources}                    // 返回资源对象的列表\n【POST】    /{version}/{resources}                    // 返回新生成的资源对象\n【PUT】     /{version}/{resources}/{resource_id}      // 返回完整的资源对象\n【PATCH】   /{version}/{resources}/{resource_id}      // 返回完整的资源对象\n【DELETE】  /{version}/{resources}/{resource_id}      // 状态码 200，返回完整的资源对象。\n                                                      // 状态码 204，返回一个空文档\n\n```\n\n如果是单条数据，则返回一个对象的 JSON 字符串。\n\n```json\nHTTP/1.1 200 OK\n{\n    \"id\" : \"01234567-89ab-cdef-0123-456789abcdef\",\n    \"name\" : \"example\",\n    \"created_time\": 1496676420000,\n    \"updated_time\": 1496676420000,\n    ...\n}\n\n```\n\n如果是列表数据，则返回一个封装的结构体。\n\n```json\nHTTP/1.1 200 OK\n{\n    \"count\":100,\n    \"items\":[\n        {\n            \"id\" : \"01234567-89ab-cdef-0123-456789abcdef\",\n            \"name\" : \"example\",\n            \"created_time\": 1496676420000,\n            \"updated_time\": 1496676420000,\n            ...\n        },\n        ...\n    ]\n}\n\n```\n\n### 一个完整的案例\n\n最后，我们使用一个完整的案例将前面介绍的知识整合起来。这里，使用 “获取用户列表” 的案例。\n\n```json\n【GET】     /v1/users?[&keyword=xxx][&enable=1][&offset=0][&limit=20] 获取用户列表\n功能说明：获取用户列表\n请求方式：GET\n参数说明\n- keyword: 模糊查找的关键字。[选填]\n- enable: 启用状态[1-启用 2-禁用]。[选填]\n- offset: 获取位置偏移，从 0 开始。[选填]\n- limit: 每次获取返回的条数，缺省为 20 条，最大不超过 100。 [选填]\n响应内容\nHTTP/1.1 200 OK\n{\n    \"count\":100,\n    \"items\":[\n        {\n            \"id\" : \"01234567-89ab-cdef-0123-456789abcdef\",\n            \"name\" : \"example\",\n            \"created_time\": 1496676420000,\n            \"updated_time\": 1496676420000,\n            ...\n        },\n        ...\n    ]\n}\n失败响应\nHTTP/1.1 403 UC/AUTH_DENIED\nContent-Type: application/json\n{\n    \"code\": \"INVALID_ARGUMENT\",\n    \"message\": \"{error message}\",\n    \"cause\": \"{cause message}\",\n    \"request_id\": \"01234567-89ab-cdef-0123-456789abcdef\",\n    \"host_id\": \"{server identity}\",\n    \"server_time\": \"2014-01-01T12:00:00Z\"\n}\n错误代码\n- 403 UC/AUTH_DENIED    授权受限\n\n```","slug":"设计一个良好的-API","published":1,"updated":"2019-01-24T10:09:39.807Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjs17mi0j0033pwgt7qnl8kz4","content":"<h2 id=\"版本号\"><a href=\"#版本号\" class=\"headerlink\" title=\"版本号\"></a>版本号</h2><p>在 RESTful API 中，API 接口应该尽量兼容之前的版本。但是，在实际业务开发场景中，可能随着业务需求的不断迭代，现有的 API 接口无法支持旧版本的适配，此时如果强制升级服务端的 API 接口将导致客户端旧有功能出现故障。实际上，Web 端是部署在服务器，因此它可以很容易为了适配服务端的新的 API 接口进行版本升级，然而像 Android 端、IOS 端、PC 端等其他客户端是运行在用户的机器上，因此当前产品很难做到适配新的服务端的 API 接口，从而出现功能故障，这种情况下，用户必须升级产品到最新的版本才能正常使用。</p>\n<p>为了解决这个版本不兼容问题，在设计 RESTful API 的一种实用的做法是使用版本号。一般情况下，我们会在 url 中保留版本号，并同时兼容多个版本。</p>\n<pre class=\"line-numbers language-java\"><code class=\"language-java\">【GET】  <span class=\"token operator\">/</span>v1<span class=\"token operator\">/</span>users<span class=\"token operator\">/</span><span class=\"token punctuation\">{</span>user_id<span class=\"token punctuation\">}</span>  <span class=\"token comment\" spellcheck=\"true\">// 版本 v1 的查询用户列表的 API 接口</span>\n【GET】  <span class=\"token operator\">/</span>v2<span class=\"token operator\">/</span>users<span class=\"token operator\">/</span><span class=\"token punctuation\">{</span>user_id<span class=\"token punctuation\">}</span>  <span class=\"token comment\" spellcheck=\"true\">// 版本 v2 的查询用户列表的 API 接口</span>\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<p>现在，我们可以不改变版本 v1 的查询用户列表的 API 接口的情况下，新增版本 v2 的查询用户列表的 API 接口以满足新的业务需求，此时，客户端的产品的新功能将请求新的服务端的 API 接口地址。虽然服务端会同时兼容多个版本，但是同时维护太多版本对于服务端而言是个不小的负担，因为服务端要维护多套代码。这种情况下，常见的做法不是维护所有的兼容版本，而是只维护最新的几个兼容版本，例如维护最新的三个兼容版本。在一段时间后，当绝大多数用户升级到较新的版本后，废弃一些使用量较少的服务端的老版本 API 接口版本，并要求使用产品的非常旧的版本的用户强制升级。</p>\n<p>注意的是，“不改变版本 v1 的查询用户列表的 API 接口” 主要指的是对于客户端的调用者而言它看起来是没有改变。而实际上，如果业务变化太大，服务端的开发人员需要对旧版本的 API 接口使用适配器模式将请求适配到新的 API 接口上。</p>\n<h3 id=\"资源路径\"><a href=\"#资源路径\" class=\"headerlink\" title=\"资源路径\"></a>资源路径</h3><p>RESTful API 的设计以资源为核心，每一个 URI 代表一种资源。因此，URI 不能包含动词，只能是名词。注意的是，形容词也是可以使用的，但是尽量少用。一般来说，不论资源是单个还是多个，API 的名词要以复数进行命名。此外，命名名词的时候，要使用小写、数字及下划线来区分多个单词。这样的设计是为了与 json 对象及属性的命名方案保持一致。例如，一个查询系统标签的接口可以进行如下设计。</p>\n<pre class=\"line-numbers language-java\"><code class=\"language-java\">【GET】  <span class=\"token operator\">/</span>v1<span class=\"token operator\">/</span>tags<span class=\"token operator\">/</span><span class=\"token punctuation\">{</span>tag_id<span class=\"token punctuation\">}</span> \n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>同时，资源的路径应该从根到子依次如下</p>\n<pre class=\"line-numbers language-java\"><code class=\"language-java\"><span class=\"token operator\">/</span><span class=\"token punctuation\">{</span>resources<span class=\"token punctuation\">}</span><span class=\"token operator\">/</span><span class=\"token punctuation\">{</span>resource_id<span class=\"token punctuation\">}</span><span class=\"token operator\">/</span><span class=\"token punctuation\">{</span>sub_resources<span class=\"token punctuation\">}</span><span class=\"token operator\">/</span><span class=\"token punctuation\">{</span>sub_resource_id<span class=\"token punctuation\">}</span><span class=\"token operator\">/</span><span class=\"token punctuation\">{</span>sub_resource_property<span class=\"token punctuation\">}</span>\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>我们来看一个 “添加用户的角色” 的设计，其中 “用户” 是主资源，“角色” 是子资源。</p>\n<pre class=\"line-numbers language-java\"><code class=\"language-java\">【POST】  <span class=\"token operator\">/</span>v1<span class=\"token operator\">/</span>users<span class=\"token operator\">/</span><span class=\"token punctuation\">{</span>user_id<span class=\"token punctuation\">}</span><span class=\"token operator\">/</span>roles<span class=\"token operator\">/</span><span class=\"token punctuation\">{</span>role_id<span class=\"token punctuation\">}</span> <span class=\"token comment\" spellcheck=\"true\">// 添加用户的角色</span>\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>有的时候，当一个资源变化难以使用标准的 RESTful API 来命名，可以考虑使用一些特殊的 actions 命名。</p>\n<pre class=\"line-numbers language-java\"><code class=\"language-java\"><span class=\"token operator\">/</span><span class=\"token punctuation\">{</span>resources<span class=\"token punctuation\">}</span><span class=\"token operator\">/</span><span class=\"token punctuation\">{</span>resource_id<span class=\"token punctuation\">}</span><span class=\"token operator\">/</span>actions<span class=\"token operator\">/</span><span class=\"token punctuation\">{</span>action<span class=\"token punctuation\">}</span>\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>举个例子，“密码修改” 这个接口的命名很难完全使用名词来构建路径，此时可以引入 action 命名。</p>\n<pre class=\"line-numbers language-basic\"><code class=\"language-basic\">【<span class=\"token keyword\">PUT</span>】  <span class=\"token operator\">/</span>v1<span class=\"token operator\">/</span>users<span class=\"token operator\">/</span>{user_id}<span class=\"token operator\">/</span>password<span class=\"token operator\">/</span>actions<span class=\"token operator\">/</span>modify <span class=\"token operator\">/</span><span class=\"token operator\">/</span> 密码修改\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h3 id=\"请求方式\"><a href=\"#请求方式\" class=\"headerlink\" title=\"请求方式\"></a>请求方式</h3><p>可以通过 GET、 POST、 PUT、 PATCH、 DELETE 等方式对服务端的资源进行操作。其中：</p>\n<ul>\n<li>GET：用于查询资源</li>\n<li>POST：用于创建资源</li>\n<li>PUT：用于更新服务端的资源的全部信息</li>\n<li>PATCH：用于更新服务端的资源的部分信息</li>\n<li>DELETE：用于删除服务端的资源。</li>\n</ul>\n<p>这里，使用 “用户” 的案例进行回顾通过 GET、 POST、 PUT、 PATCH、 DELETE 等方式对服务端的资源进行操作。</p>\n<pre class=\"line-numbers language-java\"><code class=\"language-java\">【GET】          <span class=\"token operator\">/</span>users                # 查询用户信息列表\n【GET】          <span class=\"token operator\">/</span>users<span class=\"token operator\">/</span><span class=\"token number\">1001</span>           # 查看某个用户信息\n【POST】         <span class=\"token operator\">/</span>users                # 新建用户信息\n【PUT】          <span class=\"token operator\">/</span>users<span class=\"token operator\">/</span><span class=\"token number\">1001</span>           # 更新用户信息<span class=\"token punctuation\">(</span>全部字段<span class=\"token punctuation\">)</span>\n【PATCH】        <span class=\"token operator\">/</span>users<span class=\"token operator\">/</span><span class=\"token number\">1001</span>           # 更新用户信息<span class=\"token punctuation\">(</span>部分字段<span class=\"token punctuation\">)</span>\n【DELETE】       <span class=\"token operator\">/</span>users<span class=\"token operator\">/</span><span class=\"token number\">1001</span>           # 删除用户信息\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"查询参数\"><a href=\"#查询参数\" class=\"headerlink\" title=\"查询参数\"></a>查询参数</h3><p>RESTful API 接口应该提供参数，过滤返回结果。其中，offset 指定返回记录的开始位置。一般情况下，它会结合 limit 来做分页的查询，这里 limit 指定返回记录的数量。</p>\n<pre class=\"line-numbers language-java\"><code class=\"language-java\">【GET】  <span class=\"token operator\">/</span><span class=\"token punctuation\">{</span>version<span class=\"token punctuation\">}</span><span class=\"token operator\">/</span><span class=\"token punctuation\">{</span>resources<span class=\"token punctuation\">}</span><span class=\"token operator\">/</span><span class=\"token punctuation\">{</span>resource_id<span class=\"token punctuation\">}</span><span class=\"token operator\">?</span>offset<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token operator\">&amp;</span>limit<span class=\"token operator\">=</span><span class=\"token number\">20</span>\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>同时，orderby 可以用来排序，但仅支持单个字符的排序，如果存在多个字段排序，需要业务中扩展其他参数进行支持。</p>\n<pre class=\"line-numbers language-java\"><code class=\"language-java\">【GET】  <span class=\"token operator\">/</span><span class=\"token punctuation\">{</span>version<span class=\"token punctuation\">}</span><span class=\"token operator\">/</span><span class=\"token punctuation\">{</span>resources<span class=\"token punctuation\">}</span><span class=\"token operator\">/</span><span class=\"token punctuation\">{</span>resource_id<span class=\"token punctuation\">}</span><span class=\"token operator\">?</span>orderby<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>field<span class=\"token punctuation\">}</span> <span class=\"token punctuation\">[</span>asc<span class=\"token operator\">|</span>desc<span class=\"token punctuation\">]</span>\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>为了更好地选择是否支持查询总数，我们可以使用 count 字段，count 表示返回数据是否包含总条数，它的默认值为 false。</p>\n<pre class=\"line-numbers language-java\"><code class=\"language-java\">【GET】  <span class=\"token operator\">/</span><span class=\"token punctuation\">{</span>version<span class=\"token punctuation\">}</span><span class=\"token operator\">/</span><span class=\"token punctuation\">{</span>resources<span class=\"token punctuation\">}</span><span class=\"token operator\">/</span><span class=\"token punctuation\">{</span>resource_id<span class=\"token punctuation\">}</span><span class=\"token operator\">?</span>count<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token boolean\">true</span><span class=\"token operator\">|</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">]</span>\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>上面介绍的 offset、 limit、 orderby 是一些公共参数。此外，业务场景中还存在许多个性化的参数。我们来看一个例子。</p>\n<pre class=\"line-numbers language-java\"><code class=\"language-java\">【GET】  <span class=\"token operator\">/</span>v1<span class=\"token operator\">/</span>categorys<span class=\"token operator\">/</span><span class=\"token punctuation\">{</span>category_id<span class=\"token punctuation\">}</span><span class=\"token operator\">/</span>apps<span class=\"token operator\">/</span><span class=\"token punctuation\">{</span>app_id<span class=\"token punctuation\">}</span><span class=\"token operator\">?</span>enable<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token operator\">|</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token operator\">&amp;</span>os_type<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>field<span class=\"token punctuation\">}</span><span class=\"token operator\">&amp;</span>device_ids<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>field<span class=\"token punctuation\">,</span>field<span class=\"token punctuation\">,</span>…<span class=\"token punctuation\">}</span>\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>注意的是，不要过度设计，只返回用户需要的查询参数。此外，需要考虑是否对查询参数创建数据库索引以提高查询性能。</p>\n<h3 id=\"状态码\"><a href=\"#状态码\" class=\"headerlink\" title=\"状态码\"></a>状态码</h3><p>使用适合的状态码很重要，而不应该全部都返回状态码 200，或者随便乱使用。这里，列举在实际开发过程中常用的一些状态码，以供参考。</p>\n<table>\n<thead>\n<tr>\n<th>状态码</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>200</td>\n<td>请求成功</td>\n</tr>\n<tr>\n<td>201</td>\n<td>创建成功</td>\n</tr>\n<tr>\n<td>400</td>\n<td>错误的请求</td>\n</tr>\n<tr>\n<td>401</td>\n<td>未验证</td>\n</tr>\n<tr>\n<td>403</td>\n<td>被拒绝</td>\n</tr>\n<tr>\n<td>404</td>\n<td>无法找到</td>\n</tr>\n<tr>\n<td>409</td>\n<td>资源冲突</td>\n</tr>\n<tr>\n<td>500</td>\n<td>服务器内部错误</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"异常响应\"><a href=\"#异常响应\" class=\"headerlink\" title=\"异常响应\"></a>异常响应</h3><p>当 RESTful API 接口出现非 2xx 的 HTTP 错误码响应时，采用全局的异常结构响应信息。</p>\n<pre class=\"line-numbers language-json\"><code class=\"language-json\">HTTP/<span class=\"token number\">1.1</span> <span class=\"token number\">400</span> Bad Request\nContent-Type<span class=\"token operator\">:</span> application/json\n<span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"code\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"INVALID_ARGUMENT\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"message\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"{error message}\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"cause\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"{cause message}\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"request_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"01234567-89ab-cdef-0123-456789abcdef\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"host_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"{server identity}\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"server_time\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2014-01-01T12:00:00Z\"</span>\n<span class=\"token punctuation\">}</span>\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"请求参数\"><a href=\"#请求参数\" class=\"headerlink\" title=\"请求参数\"></a>请求参数</h3><p>在设计服务端的 RESTful API 的时候，我们还需要对请求参数进行限制说明。例如一个支持批量查询的接口，我们要考虑最大支持查询的数量。</p>\n<pre class=\"line-numbers language-java\"><code class=\"language-java\">【GET】     <span class=\"token operator\">/</span>v1<span class=\"token operator\">/</span>users<span class=\"token operator\">/</span>batch<span class=\"token operator\">?</span>user_ids<span class=\"token operator\">=</span><span class=\"token number\">1001</span><span class=\"token punctuation\">,</span><span class=\"token number\">1002</span>      <span class=\"token comment\" spellcheck=\"true\">// 批量查询用户信息</span>\n参数说明\n<span class=\"token operator\">-</span> user_ids<span class=\"token operator\">:</span> 用户ID串，最多允许 <span class=\"token number\">20</span> 个。\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<p>此外，在设计新增或修改接口时，我们还需要在文档中明确告诉调用者哪些参数是必填项，哪些是选填项，以及它们的边界值的限制。</p>\n<pre class=\"line-numbers language-json\"><code class=\"language-json\">【POST】     /v1/users                             // 创建用户信息\n请求内容\n<span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"username\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"lusifer\"</span><span class=\"token punctuation\">,</span>                 // 必填<span class=\"token punctuation\">,</span> 用户名称<span class=\"token punctuation\">,</span> max <span class=\"token number\">10</span>\n    <span class=\"token property\">\"realname\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"鲁斯菲尔\"</span><span class=\"token punctuation\">,</span>               // 必填<span class=\"token punctuation\">,</span> 用户名称<span class=\"token punctuation\">,</span> max <span class=\"token number\">10</span>\n    <span class=\"token property\">\"password\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"123456\"</span><span class=\"token punctuation\">,</span>              // 必填<span class=\"token punctuation\">,</span> 用户密码<span class=\"token punctuation\">,</span> max <span class=\"token number\">32</span>\n    <span class=\"token property\">\"email\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"topsale@vip.qq.com\"</span><span class=\"token punctuation\">,</span>     // 选填<span class=\"token punctuation\">,</span> 电子邮箱<span class=\"token punctuation\">,</span> max <span class=\"token number\">32</span>\n    <span class=\"token property\">\"weixin\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Lusifer\"</span><span class=\"token punctuation\">,</span>            // 选填，微信账号<span class=\"token punctuation\">,</span> max <span class=\"token number\">32</span>\n    <span class=\"token property\">\"sex\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span>                           // 必填<span class=\"token punctuation\">,</span> 用户性别<span class=\"token punctuation\">[</span><span class=\"token number\">1</span>-男 <span class=\"token number\">2</span>-女 <span class=\"token number\">99</span>-未知<span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span>\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"响应参数\"><a href=\"#响应参数\" class=\"headerlink\" title=\"响应参数\"></a>响应参数</h3><p>针对不同操作，服务端向用户返回的结果应该符合以下规范。</p>\n<pre class=\"line-numbers language-java\"><code class=\"language-java\">【GET】     <span class=\"token operator\">/</span><span class=\"token punctuation\">{</span>version<span class=\"token punctuation\">}</span><span class=\"token operator\">/</span><span class=\"token punctuation\">{</span>resources<span class=\"token punctuation\">}</span><span class=\"token operator\">/</span><span class=\"token punctuation\">{</span>resource_id<span class=\"token punctuation\">}</span>      <span class=\"token comment\" spellcheck=\"true\">// 返回单个资源对象</span>\n【GET】     <span class=\"token operator\">/</span><span class=\"token punctuation\">{</span>version<span class=\"token punctuation\">}</span><span class=\"token operator\">/</span><span class=\"token punctuation\">{</span>resources<span class=\"token punctuation\">}</span>                    <span class=\"token comment\" spellcheck=\"true\">// 返回资源对象的列表</span>\n【POST】    <span class=\"token operator\">/</span><span class=\"token punctuation\">{</span>version<span class=\"token punctuation\">}</span><span class=\"token operator\">/</span><span class=\"token punctuation\">{</span>resources<span class=\"token punctuation\">}</span>                    <span class=\"token comment\" spellcheck=\"true\">// 返回新生成的资源对象</span>\n【PUT】     <span class=\"token operator\">/</span><span class=\"token punctuation\">{</span>version<span class=\"token punctuation\">}</span><span class=\"token operator\">/</span><span class=\"token punctuation\">{</span>resources<span class=\"token punctuation\">}</span><span class=\"token operator\">/</span><span class=\"token punctuation\">{</span>resource_id<span class=\"token punctuation\">}</span>      <span class=\"token comment\" spellcheck=\"true\">// 返回完整的资源对象</span>\n【PATCH】   <span class=\"token operator\">/</span><span class=\"token punctuation\">{</span>version<span class=\"token punctuation\">}</span><span class=\"token operator\">/</span><span class=\"token punctuation\">{</span>resources<span class=\"token punctuation\">}</span><span class=\"token operator\">/</span><span class=\"token punctuation\">{</span>resource_id<span class=\"token punctuation\">}</span>      <span class=\"token comment\" spellcheck=\"true\">// 返回完整的资源对象</span>\n【DELETE】  <span class=\"token operator\">/</span><span class=\"token punctuation\">{</span>version<span class=\"token punctuation\">}</span><span class=\"token operator\">/</span><span class=\"token punctuation\">{</span>resources<span class=\"token punctuation\">}</span><span class=\"token operator\">/</span><span class=\"token punctuation\">{</span>resource_id<span class=\"token punctuation\">}</span>      <span class=\"token comment\" spellcheck=\"true\">// 状态码 200，返回完整的资源对象。</span>\n                                                      <span class=\"token comment\" spellcheck=\"true\">// 状态码 204，返回一个空文档</span>\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>如果是单条数据，则返回一个对象的 JSON 字符串。</p>\n<pre class=\"line-numbers language-json\"><code class=\"language-json\">HTTP/<span class=\"token number\">1.1</span> <span class=\"token number\">200</span> OK\n<span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"id\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"01234567-89ab-cdef-0123-456789abcdef\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"name\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"example\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"created_time\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1496676420000</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"updated_time\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1496676420000</span><span class=\"token punctuation\">,</span>\n    ...\n<span class=\"token punctuation\">}</span>\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>如果是列表数据，则返回一个封装的结构体。</p>\n<pre class=\"line-numbers language-json\"><code class=\"language-json\">HTTP/<span class=\"token number\">1.1</span> <span class=\"token number\">200</span> OK\n<span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"count\"</span><span class=\"token operator\">:</span><span class=\"token number\">100</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"items\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"id\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"01234567-89ab-cdef-0123-456789abcdef\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"name\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"example\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"created_time\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1496676420000</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"updated_time\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1496676420000</span><span class=\"token punctuation\">,</span>\n            ...\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        ...\n    <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span>\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"一个完整的案例\"><a href=\"#一个完整的案例\" class=\"headerlink\" title=\"一个完整的案例\"></a>一个完整的案例</h3><p>最后，我们使用一个完整的案例将前面介绍的知识整合起来。这里，使用 “获取用户列表” 的案例。</p>\n<pre class=\"line-numbers language-json\"><code class=\"language-json\">【GET】     /v1/users?<span class=\"token punctuation\">[</span>&amp;keyword=xxx<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>&amp;enable=<span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>&amp;offset=<span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>&amp;limit=<span class=\"token number\">20</span><span class=\"token punctuation\">]</span> 获取用户列表\n功能说明：获取用户列表\n请求方式：GET\n参数说明\n- keyword<span class=\"token operator\">:</span> 模糊查找的关键字。<span class=\"token punctuation\">[</span>选填<span class=\"token punctuation\">]</span>\n- enable<span class=\"token operator\">:</span> 启用状态<span class=\"token punctuation\">[</span><span class=\"token number\">1</span>-启用 <span class=\"token number\">2</span>-禁用<span class=\"token punctuation\">]</span>。<span class=\"token punctuation\">[</span>选填<span class=\"token punctuation\">]</span>\n- offset<span class=\"token operator\">:</span> 获取位置偏移，从 <span class=\"token number\">0</span> 开始。<span class=\"token punctuation\">[</span>选填<span class=\"token punctuation\">]</span>\n- limit<span class=\"token operator\">:</span> 每次获取返回的条数，缺省为 <span class=\"token number\">20</span> 条，最大不超过 <span class=\"token number\">100</span>。 <span class=\"token punctuation\">[</span>选填<span class=\"token punctuation\">]</span>\n响应内容\nHTTP/<span class=\"token number\">1.1</span> <span class=\"token number\">200</span> OK\n<span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"count\"</span><span class=\"token operator\">:</span><span class=\"token number\">100</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"items\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"id\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"01234567-89ab-cdef-0123-456789abcdef\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"name\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"example\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"created_time\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1496676420000</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"updated_time\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1496676420000</span><span class=\"token punctuation\">,</span>\n            ...\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        ...\n    <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span>\n失败响应\nHTTP/<span class=\"token number\">1.1</span> <span class=\"token number\">403</span> UC/AUTH_DENIED\nContent-Type<span class=\"token operator\">:</span> application/json\n<span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"code\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"INVALID_ARGUMENT\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"message\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"{error message}\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"cause\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"{cause message}\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"request_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"01234567-89ab-cdef-0123-456789abcdef\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"host_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"{server identity}\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"server_time\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2014-01-01T12:00:00Z\"</span>\n<span class=\"token punctuation\">}</span>\n错误代码\n- <span class=\"token number\">403</span> UC/AUTH_DENIED    授权受限\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"版本号\"><a href=\"#版本号\" class=\"headerlink\" title=\"版本号\"></a>版本号</h2><p>在 RESTful API 中，API 接口应该尽量兼容之前的版本。但是，在实际业务开发场景中，可能随着业务需求的不断迭代，现有的 API 接口无法支持旧版本的适配，此时如果强制升级服务端的 API 接口将导致客户端旧有功能出现故障。实际上，Web 端是部署在服务器，因此它可以很容易为了适配服务端的新的 API 接口进行版本升级，然而像 Android 端、IOS 端、PC 端等其他客户端是运行在用户的机器上，因此当前产品很难做到适配新的服务端的 API 接口，从而出现功能故障，这种情况下，用户必须升级产品到最新的版本才能正常使用。</p>\n<p>为了解决这个版本不兼容问题，在设计 RESTful API 的一种实用的做法是使用版本号。一般情况下，我们会在 url 中保留版本号，并同时兼容多个版本。</p>\n<pre><code class=\"java\">【GET】  /v1/users/{user_id}  // 版本 v1 的查询用户列表的 API 接口\n【GET】  /v2/users/{user_id}  // 版本 v2 的查询用户列表的 API 接口\n\n</code></pre>\n<p>现在，我们可以不改变版本 v1 的查询用户列表的 API 接口的情况下，新增版本 v2 的查询用户列表的 API 接口以满足新的业务需求，此时，客户端的产品的新功能将请求新的服务端的 API 接口地址。虽然服务端会同时兼容多个版本，但是同时维护太多版本对于服务端而言是个不小的负担，因为服务端要维护多套代码。这种情况下，常见的做法不是维护所有的兼容版本，而是只维护最新的几个兼容版本，例如维护最新的三个兼容版本。在一段时间后，当绝大多数用户升级到较新的版本后，废弃一些使用量较少的服务端的老版本 API 接口版本，并要求使用产品的非常旧的版本的用户强制升级。</p>\n<p>注意的是，“不改变版本 v1 的查询用户列表的 API 接口” 主要指的是对于客户端的调用者而言它看起来是没有改变。而实际上，如果业务变化太大，服务端的开发人员需要对旧版本的 API 接口使用适配器模式将请求适配到新的 API 接口上。</p>\n<h3 id=\"资源路径\"><a href=\"#资源路径\" class=\"headerlink\" title=\"资源路径\"></a>资源路径</h3><p>RESTful API 的设计以资源为核心，每一个 URI 代表一种资源。因此，URI 不能包含动词，只能是名词。注意的是，形容词也是可以使用的，但是尽量少用。一般来说，不论资源是单个还是多个，API 的名词要以复数进行命名。此外，命名名词的时候，要使用小写、数字及下划线来区分多个单词。这样的设计是为了与 json 对象及属性的命名方案保持一致。例如，一个查询系统标签的接口可以进行如下设计。</p>\n<pre><code class=\"java\">【GET】  /v1/tags/{tag_id} \n\n</code></pre>\n<p>同时，资源的路径应该从根到子依次如下</p>\n<pre><code class=\"java\">/{resources}/{resource_id}/{sub_resources}/{sub_resource_id}/{sub_resource_property}\n\n</code></pre>\n<p>我们来看一个 “添加用户的角色” 的设计，其中 “用户” 是主资源，“角色” 是子资源。</p>\n<pre><code class=\"java\">【POST】  /v1/users/{user_id}/roles/{role_id} // 添加用户的角色\n\n</code></pre>\n<p>有的时候，当一个资源变化难以使用标准的 RESTful API 来命名，可以考虑使用一些特殊的 actions 命名。</p>\n<pre><code class=\"java\">/{resources}/{resource_id}/actions/{action}\n\n</code></pre>\n<p>举个例子，“密码修改” 这个接口的命名很难完全使用名词来构建路径，此时可以引入 action 命名。</p>\n<pre><code class=\"basic\">【PUT】  /v1/users/{user_id}/password/actions/modify // 密码修改\n\n</code></pre>\n<h3 id=\"请求方式\"><a href=\"#请求方式\" class=\"headerlink\" title=\"请求方式\"></a>请求方式</h3><p>可以通过 GET、 POST、 PUT、 PATCH、 DELETE 等方式对服务端的资源进行操作。其中：</p>\n<ul>\n<li>GET：用于查询资源</li>\n<li>POST：用于创建资源</li>\n<li>PUT：用于更新服务端的资源的全部信息</li>\n<li>PATCH：用于更新服务端的资源的部分信息</li>\n<li>DELETE：用于删除服务端的资源。</li>\n</ul>\n<p>这里，使用 “用户” 的案例进行回顾通过 GET、 POST、 PUT、 PATCH、 DELETE 等方式对服务端的资源进行操作。</p>\n<pre><code class=\"java\">【GET】          /users                # 查询用户信息列表\n【GET】          /users/1001           # 查看某个用户信息\n【POST】         /users                # 新建用户信息\n【PUT】          /users/1001           # 更新用户信息(全部字段)\n【PATCH】        /users/1001           # 更新用户信息(部分字段)\n【DELETE】       /users/1001           # 删除用户信息\n\n</code></pre>\n<h3 id=\"查询参数\"><a href=\"#查询参数\" class=\"headerlink\" title=\"查询参数\"></a>查询参数</h3><p>RESTful API 接口应该提供参数，过滤返回结果。其中，offset 指定返回记录的开始位置。一般情况下，它会结合 limit 来做分页的查询，这里 limit 指定返回记录的数量。</p>\n<pre><code class=\"java\">【GET】  /{version}/{resources}/{resource_id}?offset=0&amp;limit=20\n\n</code></pre>\n<p>同时，orderby 可以用来排序，但仅支持单个字符的排序，如果存在多个字段排序，需要业务中扩展其他参数进行支持。</p>\n<pre><code class=\"java\">【GET】  /{version}/{resources}/{resource_id}?orderby={field} [asc|desc]\n\n</code></pre>\n<p>为了更好地选择是否支持查询总数，我们可以使用 count 字段，count 表示返回数据是否包含总条数，它的默认值为 false。</p>\n<pre><code class=\"java\">【GET】  /{version}/{resources}/{resource_id}?count=[true|false]\n\n</code></pre>\n<p>上面介绍的 offset、 limit、 orderby 是一些公共参数。此外，业务场景中还存在许多个性化的参数。我们来看一个例子。</p>\n<pre><code class=\"java\">【GET】  /v1/categorys/{category_id}/apps/{app_id}?enable=[1|0]&amp;os_type={field}&amp;device_ids={field,field,…}\n\n</code></pre>\n<p>注意的是，不要过度设计，只返回用户需要的查询参数。此外，需要考虑是否对查询参数创建数据库索引以提高查询性能。</p>\n<h3 id=\"状态码\"><a href=\"#状态码\" class=\"headerlink\" title=\"状态码\"></a>状态码</h3><p>使用适合的状态码很重要，而不应该全部都返回状态码 200，或者随便乱使用。这里，列举在实际开发过程中常用的一些状态码，以供参考。</p>\n<table>\n<thead>\n<tr>\n<th>状态码</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>200</td>\n<td>请求成功</td>\n</tr>\n<tr>\n<td>201</td>\n<td>创建成功</td>\n</tr>\n<tr>\n<td>400</td>\n<td>错误的请求</td>\n</tr>\n<tr>\n<td>401</td>\n<td>未验证</td>\n</tr>\n<tr>\n<td>403</td>\n<td>被拒绝</td>\n</tr>\n<tr>\n<td>404</td>\n<td>无法找到</td>\n</tr>\n<tr>\n<td>409</td>\n<td>资源冲突</td>\n</tr>\n<tr>\n<td>500</td>\n<td>服务器内部错误</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"异常响应\"><a href=\"#异常响应\" class=\"headerlink\" title=\"异常响应\"></a>异常响应</h3><p>当 RESTful API 接口出现非 2xx 的 HTTP 错误码响应时，采用全局的异常结构响应信息。</p>\n<pre><code class=\"json\">HTTP/1.1 400 Bad Request\nContent-Type: application/json\n{\n    &quot;code&quot;: &quot;INVALID_ARGUMENT&quot;,\n    &quot;message&quot;: &quot;{error message}&quot;,\n    &quot;cause&quot;: &quot;{cause message}&quot;,\n    &quot;request_id&quot;: &quot;01234567-89ab-cdef-0123-456789abcdef&quot;,\n    &quot;host_id&quot;: &quot;{server identity}&quot;,\n    &quot;server_time&quot;: &quot;2014-01-01T12:00:00Z&quot;\n}\n\n</code></pre>\n<h3 id=\"请求参数\"><a href=\"#请求参数\" class=\"headerlink\" title=\"请求参数\"></a>请求参数</h3><p>在设计服务端的 RESTful API 的时候，我们还需要对请求参数进行限制说明。例如一个支持批量查询的接口，我们要考虑最大支持查询的数量。</p>\n<pre><code class=\"java\">【GET】     /v1/users/batch?user_ids=1001,1002      // 批量查询用户信息\n参数说明\n- user_ids: 用户ID串，最多允许 20 个。\n\n</code></pre>\n<p>此外，在设计新增或修改接口时，我们还需要在文档中明确告诉调用者哪些参数是必填项，哪些是选填项，以及它们的边界值的限制。</p>\n<pre><code class=\"json\">【POST】     /v1/users                             // 创建用户信息\n请求内容\n{\n    &quot;username&quot;: &quot;lusifer&quot;,                 // 必填, 用户名称, max 10\n    &quot;realname&quot;: &quot;鲁斯菲尔&quot;,               // 必填, 用户名称, max 10\n    &quot;password&quot;: &quot;123456&quot;,              // 必填, 用户密码, max 32\n    &quot;email&quot;: &quot;topsale@vip.qq.com&quot;,     // 选填, 电子邮箱, max 32\n    &quot;weixin&quot;: &quot;Lusifer&quot;,            // 选填，微信账号, max 32\n    &quot;sex&quot;: 1                           // 必填, 用户性别[1-男 2-女 99-未知]\n}\n\n</code></pre>\n<h3 id=\"响应参数\"><a href=\"#响应参数\" class=\"headerlink\" title=\"响应参数\"></a>响应参数</h3><p>针对不同操作，服务端向用户返回的结果应该符合以下规范。</p>\n<pre><code class=\"java\">【GET】     /{version}/{resources}/{resource_id}      // 返回单个资源对象\n【GET】     /{version}/{resources}                    // 返回资源对象的列表\n【POST】    /{version}/{resources}                    // 返回新生成的资源对象\n【PUT】     /{version}/{resources}/{resource_id}      // 返回完整的资源对象\n【PATCH】   /{version}/{resources}/{resource_id}      // 返回完整的资源对象\n【DELETE】  /{version}/{resources}/{resource_id}      // 状态码 200，返回完整的资源对象。\n                                                      // 状态码 204，返回一个空文档\n\n</code></pre>\n<p>如果是单条数据，则返回一个对象的 JSON 字符串。</p>\n<pre><code class=\"json\">HTTP/1.1 200 OK\n{\n    &quot;id&quot; : &quot;01234567-89ab-cdef-0123-456789abcdef&quot;,\n    &quot;name&quot; : &quot;example&quot;,\n    &quot;created_time&quot;: 1496676420000,\n    &quot;updated_time&quot;: 1496676420000,\n    ...\n}\n\n</code></pre>\n<p>如果是列表数据，则返回一个封装的结构体。</p>\n<pre><code class=\"json\">HTTP/1.1 200 OK\n{\n    &quot;count&quot;:100,\n    &quot;items&quot;:[\n        {\n            &quot;id&quot; : &quot;01234567-89ab-cdef-0123-456789abcdef&quot;,\n            &quot;name&quot; : &quot;example&quot;,\n            &quot;created_time&quot;: 1496676420000,\n            &quot;updated_time&quot;: 1496676420000,\n            ...\n        },\n        ...\n    ]\n}\n\n</code></pre>\n<h3 id=\"一个完整的案例\"><a href=\"#一个完整的案例\" class=\"headerlink\" title=\"一个完整的案例\"></a>一个完整的案例</h3><p>最后，我们使用一个完整的案例将前面介绍的知识整合起来。这里，使用 “获取用户列表” 的案例。</p>\n<pre><code class=\"json\">【GET】     /v1/users?[&amp;keyword=xxx][&amp;enable=1][&amp;offset=0][&amp;limit=20] 获取用户列表\n功能说明：获取用户列表\n请求方式：GET\n参数说明\n- keyword: 模糊查找的关键字。[选填]\n- enable: 启用状态[1-启用 2-禁用]。[选填]\n- offset: 获取位置偏移，从 0 开始。[选填]\n- limit: 每次获取返回的条数，缺省为 20 条，最大不超过 100。 [选填]\n响应内容\nHTTP/1.1 200 OK\n{\n    &quot;count&quot;:100,\n    &quot;items&quot;:[\n        {\n            &quot;id&quot; : &quot;01234567-89ab-cdef-0123-456789abcdef&quot;,\n            &quot;name&quot; : &quot;example&quot;,\n            &quot;created_time&quot;: 1496676420000,\n            &quot;updated_time&quot;: 1496676420000,\n            ...\n        },\n        ...\n    ]\n}\n失败响应\nHTTP/1.1 403 UC/AUTH_DENIED\nContent-Type: application/json\n{\n    &quot;code&quot;: &quot;INVALID_ARGUMENT&quot;,\n    &quot;message&quot;: &quot;{error message}&quot;,\n    &quot;cause&quot;: &quot;{cause message}&quot;,\n    &quot;request_id&quot;: &quot;01234567-89ab-cdef-0123-456789abcdef&quot;,\n    &quot;host_id&quot;: &quot;{server identity}&quot;,\n    &quot;server_time&quot;: &quot;2014-01-01T12:00:00Z&quot;\n}\n错误代码\n- 403 UC/AUTH_DENIED    授权受限\n\n</code></pre>\n"},{"title":"日期时间工具类","author":"Asia Cui","date":"2018-12-31T04:15:00.000Z","_content":"```js\n/**\n * 日期时间工具类\n * @type {{dateFormat}}\n */\nvar DateTime = function () {\n    var patterns = {\n        PATTERN_ERA: 'G', // Era 标志符 Era strings. For example: \"AD\" and \"BC\"\n        PATTERN_YEAR: 'y', // 年\n        PATTERN_MONTH: 'M', // 月份\n        PATTERN_DAY_OF_MONTH: 'd', // 月份的天数\n        PATTERN_HOUR_OF_DAY1: 'k', // 一天中的小时数（1-24）\n        PATTERN_HOUR_OF_DAY0: 'H', // 24 小时制，一天中的小时数（0-23）\n        PATTERN_MINUTE: 'm', // 小时中的分钟数\n        PATTERN_SECOND: 's', // 秒\n        PATTERN_MILLISECOND: 'S', // 毫秒\n        PATTERN_DAY_OF_WEEK: 'E', // 一周中对应的星期，如星期一，周一\n        PATTERN_DAY_OF_YEAR: 'D', // 一年中的第几天\n        PATTERN_DAY_OF_WEEK_IN_MONTH: 'F', // 一月中的第几个星期(会把这个月总共过的天数除以7,不够准确，推荐用W)\n        PATTERN_WEEK_OF_YEAR: 'w', // 一年中的第几个星期\n        PATTERN_WEEK_OF_MONTH: 'W', // 一月中的第几星期(会根据实际情况来算)\n        PATTERN_AM_PM: 'a', // 上下午标识\n        PATTERN_HOUR1: 'h', // 12 小时制 ，am/pm 中的小时数（1-12）\n        PATTERN_HOUR0: 'K', // 和 h 类型\n        PATTERN_ZONE_NAME: 'z', // 时区名\n        PATTERN_ZONE_VALUE: 'Z', // 时区值\n        PATTERN_WEEK_YEAR: 'Y', // 和 y 类型\n        PATTERN_ISO_DAY_OF_WEEK: 'u',\n        PATTERN_ISO_ZONE: 'X'\n    };\n\n    var week = {\n        'ch': {\n            \"0\": \"\\u65e5\",\n            \"1\": \"\\u4e00\",\n            \"2\": \"\\u4e8c\",\n            \"3\": \"\\u4e09\",\n            \"4\": \"\\u56db\",\n            \"5\": \"\\u4e94\",\n            \"6\": \"\\u516d\"\n        },\n        'en': {\n            \"0\": \"Sunday\",\n            \"1\": \"Monday\",\n            \"2\": \"Tuesday\",\n            \"3\": \"Wednesday\",\n            \"4\": \"Thursday\",\n            \"5\": \"Friday\",\n            \"6\": \"Saturday\"\n        }\n    };\n\n    /**\n     * 获取当前时间\n     * @returns {string}\n     */\n    var handlerGetCurrentTime = function () {\n        var today = new Date();\n        var year = today.getFullYear();\n        var month = today.getMonth() + 1;\n        var day = today.getDate();\n        var hours = today.getHours();\n        var minutes = today.getMinutes();\n        var seconds = today.getSeconds();\n        var timeString = year + \"-\" + month + \"-\" + day + \" \" + hours + \":\" + minutes + \":\" + seconds;\n        return timeString;\n    };\n\n    /**\n     * 比较时间大小\n     * time1 > time2 return 1\n     * time1 < time2 return -1\n     * time1 == time2 return 0\n     * @param time1\n     * @param time2\n     * @returns {number}\n     */\n    var handlerCompareTime = function (time1, time2) {\n        if (Date.parse(time1.replace(/-/g, \"/\")) > Date.parse(time2.replace(/-/g, \"/\"))) {\n            return 1;\n        } else if (Date.parse(time1.replace(/-/g, \"/\")) < Date.parse(time2.replace(/-/g, \"/\"))) {\n            return -1;\n        } else if (Date.parse(time1.replace(/-/g, \"/\")) == Date.parse(time2.replace(/-/g, \"/\"))) {\n            return 0;\n        }\n    };\n\n    /**\n     * 是否闰年\n     * @param year\n     * @returns {boolean}\n     */\n    var handlerIsLeapYear = function (year) {\n        return ((year % 4 === 0 && year % 100 !== 0) || year % 400 === 0);\n    };\n\n    /**\n     * 获取某个月的天数，从 0 开始\n     * @param year\n     * @param month\n     * @returns {*}\n     */\n    var handlerGetDaysOfMonth = function (year, month) {\n        return [31, (this.isLeapYear(year) ? 29 : 28), 31, 30, 31, 30, 31, 31, 30, 31, 30, 31][month];\n    };\n\n    /**\n     * 获取某个月的天数，从 0 开始\n     * @param year\n     * @param month\n     * @returns {number}\n     */\n    var handlerGetDaysOfMonth2 = function (year, month) {\n        // 将天置为 0，会获取其上个月的最后一天\n        month = parseInt(month) + 1;\n        var date = new Date(year, month, 0);\n        return date.getDate();\n    };\n\n    /**\n     * 距离现在几天的日期：负数表示今天之前的日期，0 表示今天，整数表示未来的日期\n     * 如 -1 表示昨天的日期，0 表示今天，2 表示后天\n     * @param days\n     * @returns {string}\n     */\n    var handlerFromToday = function (days) {\n        var today = new Date();\n        today.setDate(today.getDate() + days);\n        var date = today.getFullYear() + \"-\" + (today.getMonth() + 1) + \"-\" + today.getDate();\n        return date;\n    };\n\n    /**\n     * 格式化日期时间\n     * @param dateTime 需要格式化的日期时间\n     * @param pattern 格式化的模式，如 yyyy-MM-dd hh(HH):mm:ss.S a k K E D F w W z Z\n     * @returns {*}\n     */\n    var handlerFormat = function (dateTime, pattern) {\n        var date = new Date(dateTime);\n        if (pattern == null || pattern.length == 0) {\n            return date.toLocaleString();\n        }\n        return pattern.replace(/([a-z])\\1*/ig, function (matchStr, group1) {\n            var replacement = \"\";\n            switch (group1) {\n                case patterns.PATTERN_ERA: //G\n                    break;\n                case patterns.PATTERN_WEEK_YEAR: //Y\n                case patterns.PATTERN_YEAR: //y\n                    replacement = date.getFullYear();\n                    break;\n                case patterns.PATTERN_MONTH: //M\n                    var month = date.getMonth() + 1;\n                    replacement = (month < 10 && matchStr.length >= 2) ? \"0\" + month : month;\n                    break;\n                case patterns.PATTERN_DAY_OF_MONTH: //d\n                    var days = date.getDate();\n                    replacement = (days < 10 && matchStr.length >= 2) ? \"0\" + days : days;\n                    break;\n                case patterns.PATTERN_HOUR_OF_DAY1: //k(1~24)\n                    var hours24 = date.getHours();\n                    replacement = hours24;\n                    break;\n                case patterns.PATTERN_HOUR_OF_DAY0: //H(0~23)\n                    var hours24 = date.getHours();\n                    replacement = (hours24 < 10 && matchStr.length >= 2) ? \"0\" + hours24 : hours24;\n                    break;\n                case patterns.PATTERN_MINUTE: //m\n                    var minutes = date.getMinutes();\n                    replacement = (minutes < 10 && matchStr.length >= 2) ? \"0\" + minutes : minutes;\n                    break;\n                case patterns.PATTERN_SECOND: //s\n                    var seconds = date.getSeconds();\n                    replacement = (seconds < 10 && matchStr.length >= 2) ? \"0\" + seconds : seconds;\n                    break;\n                case patterns.PATTERN_MILLISECOND: //S\n                    var milliSeconds = date.getMilliseconds();\n                    replacement = milliSeconds;\n                    break;\n                case patterns.PATTERN_DAY_OF_WEEK: //E\n                    var day = date.getDay();\n                    replacement = week['ch'][day];\n                    break;\n                case patterns.PATTERN_DAY_OF_YEAR: //D\n                    replacement = dayOfTheYear(date);\n                    break;\n                case patterns.PATTERN_DAY_OF_WEEK_IN_MONTH: //F\n                    var days = date.getDate();\n                    replacement = Math.floor(days / 7);\n                    break;\n                case patterns.PATTERN_WEEK_OF_YEAR: //w\n                    var days = dayOfTheYear(date);\n                    replacement = Math.ceil(days / 7);\n                    break;\n                case patterns.PATTERN_WEEK_OF_MONTH: //W\n                    var days = date.getDate();\n                    replacement = Math.ceil(days / 7);\n                    break;\n                case patterns.PATTERN_AM_PM: //a\n                    var hours24 = date.getHours();\n                    replacement = hours24 < 12 ? \"\\u4e0a\\u5348\" : \"\\u4e0b\\u5348\";\n                    break;\n                case patterns.PATTERN_HOUR1: //h(1~12)\n                    var hours12 = date.getHours() % 12 || 12; //0转为12\n                    replacement = (hours12 < 10 && matchStr.length >= 2) ? \"0\" + hours12 : hours12;\n                    break;\n                case patterns.PATTERN_HOUR0: //K(0~11)\n                    var hours12 = date.getHours() % 12;\n                    replacement = hours12;\n                    break;\n                case patterns.PATTERN_ZONE_NAME: //z\n                    replacement = handlerGetZoneNameValue(date)['name'];\n                    break;\n                case patterns.PATTERN_ZONE_VALUE: //Z\n                    replacement = handlerGetZoneNameValue(date)['value'];\n                    break;\n                case patterns.PATTERN_ISO_DAY_OF_WEEK: //u\n                    break;\n                case patterns.PATTERN_ISO_ZONE: //X\n                    break;\n                default:\n                    break;\n            }\n            return replacement;\n        });\n    };\n\n    /**\n     * 计算一个日期是当年的第几天\n     * @param date\n     * @returns {number}\n     */\n    var handlerDayOfTheYear = function (date) {\n        var obj = new Date(date);\n        var year = obj.getFullYear();\n        var month = obj.getMonth(); //从0开始\n        var days = obj.getDate();\n        var daysArr = [31, (this.isLeapYear(year) ? 29 : 28), 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];\n        for (var i = 0; i < month; i++) {\n            days += daysArr[i];\n        }\n        return days;\n    };\n\n    /**\n     * 获得时区名和值\n     * @param dateObj\n     * @returns {{name: string, value: string}}\n     */\n    var handlerGetZoneNameValue = function (dateObj) {\n        var date = new Date(dateObj);\n        date = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));\n        var arr = date.toString().match(/([A-Z]+)([-+]\\d+:?\\d+)/);\n        var obj = {\n            'name': arr[1],\n            'value': arr[2]\n        };\n        return obj;\n    };\n\n    return {\n        getCurrentTime: function () {\n            return handlerGetCurrentTime();\n        },\n\n        compareTime: function (time1, time2) {\n            return handlerCompareTime(time1, time2);\n        },\n\n        isLeapYear: function (year) {\n            return handlerIsLeapYear(year);\n        },\n\n        getDaysOfMonth: function (year, month) {\n            return handlerGetDaysOfMonth(year, month);\n        },\n\n        getDaysOfMonth2: function (year, month) {\n            return handlerGetDaysOfMonth2(year, month);\n        },\n\n        fromToday: function (days) {\n            return handlerFromToday(days);\n        },\n\n        format: function (dateTime, pattern) {\n            return handlerFormat(dateTime, pattern);\n        },\n\n        dayOfTheYear: function (date) {\n            return handlerDayOfTheYear(date);\n        },\n\n        getZoneNameValue: function (dateObj) {\n            return handlerGetZoneNameValue(dateObj);\n        }\n    }\n}();\n\n```","source":"_posts/期工具类.md","raw":"title: 日期时间工具类\nauthor: Asia Cui\ntags:\n  - Js工具类\ncategories:\n  - 日期时间工具类\ndate: 2018-12-31 12:15:00\n---\n```js\n/**\n * 日期时间工具类\n * @type {{dateFormat}}\n */\nvar DateTime = function () {\n    var patterns = {\n        PATTERN_ERA: 'G', // Era 标志符 Era strings. For example: \"AD\" and \"BC\"\n        PATTERN_YEAR: 'y', // 年\n        PATTERN_MONTH: 'M', // 月份\n        PATTERN_DAY_OF_MONTH: 'd', // 月份的天数\n        PATTERN_HOUR_OF_DAY1: 'k', // 一天中的小时数（1-24）\n        PATTERN_HOUR_OF_DAY0: 'H', // 24 小时制，一天中的小时数（0-23）\n        PATTERN_MINUTE: 'm', // 小时中的分钟数\n        PATTERN_SECOND: 's', // 秒\n        PATTERN_MILLISECOND: 'S', // 毫秒\n        PATTERN_DAY_OF_WEEK: 'E', // 一周中对应的星期，如星期一，周一\n        PATTERN_DAY_OF_YEAR: 'D', // 一年中的第几天\n        PATTERN_DAY_OF_WEEK_IN_MONTH: 'F', // 一月中的第几个星期(会把这个月总共过的天数除以7,不够准确，推荐用W)\n        PATTERN_WEEK_OF_YEAR: 'w', // 一年中的第几个星期\n        PATTERN_WEEK_OF_MONTH: 'W', // 一月中的第几星期(会根据实际情况来算)\n        PATTERN_AM_PM: 'a', // 上下午标识\n        PATTERN_HOUR1: 'h', // 12 小时制 ，am/pm 中的小时数（1-12）\n        PATTERN_HOUR0: 'K', // 和 h 类型\n        PATTERN_ZONE_NAME: 'z', // 时区名\n        PATTERN_ZONE_VALUE: 'Z', // 时区值\n        PATTERN_WEEK_YEAR: 'Y', // 和 y 类型\n        PATTERN_ISO_DAY_OF_WEEK: 'u',\n        PATTERN_ISO_ZONE: 'X'\n    };\n\n    var week = {\n        'ch': {\n            \"0\": \"\\u65e5\",\n            \"1\": \"\\u4e00\",\n            \"2\": \"\\u4e8c\",\n            \"3\": \"\\u4e09\",\n            \"4\": \"\\u56db\",\n            \"5\": \"\\u4e94\",\n            \"6\": \"\\u516d\"\n        },\n        'en': {\n            \"0\": \"Sunday\",\n            \"1\": \"Monday\",\n            \"2\": \"Tuesday\",\n            \"3\": \"Wednesday\",\n            \"4\": \"Thursday\",\n            \"5\": \"Friday\",\n            \"6\": \"Saturday\"\n        }\n    };\n\n    /**\n     * 获取当前时间\n     * @returns {string}\n     */\n    var handlerGetCurrentTime = function () {\n        var today = new Date();\n        var year = today.getFullYear();\n        var month = today.getMonth() + 1;\n        var day = today.getDate();\n        var hours = today.getHours();\n        var minutes = today.getMinutes();\n        var seconds = today.getSeconds();\n        var timeString = year + \"-\" + month + \"-\" + day + \" \" + hours + \":\" + minutes + \":\" + seconds;\n        return timeString;\n    };\n\n    /**\n     * 比较时间大小\n     * time1 > time2 return 1\n     * time1 < time2 return -1\n     * time1 == time2 return 0\n     * @param time1\n     * @param time2\n     * @returns {number}\n     */\n    var handlerCompareTime = function (time1, time2) {\n        if (Date.parse(time1.replace(/-/g, \"/\")) > Date.parse(time2.replace(/-/g, \"/\"))) {\n            return 1;\n        } else if (Date.parse(time1.replace(/-/g, \"/\")) < Date.parse(time2.replace(/-/g, \"/\"))) {\n            return -1;\n        } else if (Date.parse(time1.replace(/-/g, \"/\")) == Date.parse(time2.replace(/-/g, \"/\"))) {\n            return 0;\n        }\n    };\n\n    /**\n     * 是否闰年\n     * @param year\n     * @returns {boolean}\n     */\n    var handlerIsLeapYear = function (year) {\n        return ((year % 4 === 0 && year % 100 !== 0) || year % 400 === 0);\n    };\n\n    /**\n     * 获取某个月的天数，从 0 开始\n     * @param year\n     * @param month\n     * @returns {*}\n     */\n    var handlerGetDaysOfMonth = function (year, month) {\n        return [31, (this.isLeapYear(year) ? 29 : 28), 31, 30, 31, 30, 31, 31, 30, 31, 30, 31][month];\n    };\n\n    /**\n     * 获取某个月的天数，从 0 开始\n     * @param year\n     * @param month\n     * @returns {number}\n     */\n    var handlerGetDaysOfMonth2 = function (year, month) {\n        // 将天置为 0，会获取其上个月的最后一天\n        month = parseInt(month) + 1;\n        var date = new Date(year, month, 0);\n        return date.getDate();\n    };\n\n    /**\n     * 距离现在几天的日期：负数表示今天之前的日期，0 表示今天，整数表示未来的日期\n     * 如 -1 表示昨天的日期，0 表示今天，2 表示后天\n     * @param days\n     * @returns {string}\n     */\n    var handlerFromToday = function (days) {\n        var today = new Date();\n        today.setDate(today.getDate() + days);\n        var date = today.getFullYear() + \"-\" + (today.getMonth() + 1) + \"-\" + today.getDate();\n        return date;\n    };\n\n    /**\n     * 格式化日期时间\n     * @param dateTime 需要格式化的日期时间\n     * @param pattern 格式化的模式，如 yyyy-MM-dd hh(HH):mm:ss.S a k K E D F w W z Z\n     * @returns {*}\n     */\n    var handlerFormat = function (dateTime, pattern) {\n        var date = new Date(dateTime);\n        if (pattern == null || pattern.length == 0) {\n            return date.toLocaleString();\n        }\n        return pattern.replace(/([a-z])\\1*/ig, function (matchStr, group1) {\n            var replacement = \"\";\n            switch (group1) {\n                case patterns.PATTERN_ERA: //G\n                    break;\n                case patterns.PATTERN_WEEK_YEAR: //Y\n                case patterns.PATTERN_YEAR: //y\n                    replacement = date.getFullYear();\n                    break;\n                case patterns.PATTERN_MONTH: //M\n                    var month = date.getMonth() + 1;\n                    replacement = (month < 10 && matchStr.length >= 2) ? \"0\" + month : month;\n                    break;\n                case patterns.PATTERN_DAY_OF_MONTH: //d\n                    var days = date.getDate();\n                    replacement = (days < 10 && matchStr.length >= 2) ? \"0\" + days : days;\n                    break;\n                case patterns.PATTERN_HOUR_OF_DAY1: //k(1~24)\n                    var hours24 = date.getHours();\n                    replacement = hours24;\n                    break;\n                case patterns.PATTERN_HOUR_OF_DAY0: //H(0~23)\n                    var hours24 = date.getHours();\n                    replacement = (hours24 < 10 && matchStr.length >= 2) ? \"0\" + hours24 : hours24;\n                    break;\n                case patterns.PATTERN_MINUTE: //m\n                    var minutes = date.getMinutes();\n                    replacement = (minutes < 10 && matchStr.length >= 2) ? \"0\" + minutes : minutes;\n                    break;\n                case patterns.PATTERN_SECOND: //s\n                    var seconds = date.getSeconds();\n                    replacement = (seconds < 10 && matchStr.length >= 2) ? \"0\" + seconds : seconds;\n                    break;\n                case patterns.PATTERN_MILLISECOND: //S\n                    var milliSeconds = date.getMilliseconds();\n                    replacement = milliSeconds;\n                    break;\n                case patterns.PATTERN_DAY_OF_WEEK: //E\n                    var day = date.getDay();\n                    replacement = week['ch'][day];\n                    break;\n                case patterns.PATTERN_DAY_OF_YEAR: //D\n                    replacement = dayOfTheYear(date);\n                    break;\n                case patterns.PATTERN_DAY_OF_WEEK_IN_MONTH: //F\n                    var days = date.getDate();\n                    replacement = Math.floor(days / 7);\n                    break;\n                case patterns.PATTERN_WEEK_OF_YEAR: //w\n                    var days = dayOfTheYear(date);\n                    replacement = Math.ceil(days / 7);\n                    break;\n                case patterns.PATTERN_WEEK_OF_MONTH: //W\n                    var days = date.getDate();\n                    replacement = Math.ceil(days / 7);\n                    break;\n                case patterns.PATTERN_AM_PM: //a\n                    var hours24 = date.getHours();\n                    replacement = hours24 < 12 ? \"\\u4e0a\\u5348\" : \"\\u4e0b\\u5348\";\n                    break;\n                case patterns.PATTERN_HOUR1: //h(1~12)\n                    var hours12 = date.getHours() % 12 || 12; //0转为12\n                    replacement = (hours12 < 10 && matchStr.length >= 2) ? \"0\" + hours12 : hours12;\n                    break;\n                case patterns.PATTERN_HOUR0: //K(0~11)\n                    var hours12 = date.getHours() % 12;\n                    replacement = hours12;\n                    break;\n                case patterns.PATTERN_ZONE_NAME: //z\n                    replacement = handlerGetZoneNameValue(date)['name'];\n                    break;\n                case patterns.PATTERN_ZONE_VALUE: //Z\n                    replacement = handlerGetZoneNameValue(date)['value'];\n                    break;\n                case patterns.PATTERN_ISO_DAY_OF_WEEK: //u\n                    break;\n                case patterns.PATTERN_ISO_ZONE: //X\n                    break;\n                default:\n                    break;\n            }\n            return replacement;\n        });\n    };\n\n    /**\n     * 计算一个日期是当年的第几天\n     * @param date\n     * @returns {number}\n     */\n    var handlerDayOfTheYear = function (date) {\n        var obj = new Date(date);\n        var year = obj.getFullYear();\n        var month = obj.getMonth(); //从0开始\n        var days = obj.getDate();\n        var daysArr = [31, (this.isLeapYear(year) ? 29 : 28), 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];\n        for (var i = 0; i < month; i++) {\n            days += daysArr[i];\n        }\n        return days;\n    };\n\n    /**\n     * 获得时区名和值\n     * @param dateObj\n     * @returns {{name: string, value: string}}\n     */\n    var handlerGetZoneNameValue = function (dateObj) {\n        var date = new Date(dateObj);\n        date = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));\n        var arr = date.toString().match(/([A-Z]+)([-+]\\d+:?\\d+)/);\n        var obj = {\n            'name': arr[1],\n            'value': arr[2]\n        };\n        return obj;\n    };\n\n    return {\n        getCurrentTime: function () {\n            return handlerGetCurrentTime();\n        },\n\n        compareTime: function (time1, time2) {\n            return handlerCompareTime(time1, time2);\n        },\n\n        isLeapYear: function (year) {\n            return handlerIsLeapYear(year);\n        },\n\n        getDaysOfMonth: function (year, month) {\n            return handlerGetDaysOfMonth(year, month);\n        },\n\n        getDaysOfMonth2: function (year, month) {\n            return handlerGetDaysOfMonth2(year, month);\n        },\n\n        fromToday: function (days) {\n            return handlerFromToday(days);\n        },\n\n        format: function (dateTime, pattern) {\n            return handlerFormat(dateTime, pattern);\n        },\n\n        dayOfTheYear: function (date) {\n            return handlerDayOfTheYear(date);\n        },\n\n        getZoneNameValue: function (dateObj) {\n            return handlerGetZoneNameValue(dateObj);\n        }\n    }\n}();\n\n```","slug":"期工具类","published":1,"updated":"2019-01-02T09:56:51.183Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjs17mi0m0037pwgty65mfe6l","content":"<pre class=\"line-numbers language-js\"><code class=\"language-js\"><span class=\"token comment\" spellcheck=\"true\">/**\n * 日期时间工具类\n * @type {{dateFormat}}\n */</span>\n<span class=\"token keyword\">var</span> DateTime <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> patterns <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n        PATTERN_ERA<span class=\"token punctuation\">:</span> <span class=\"token string\">'G'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\" spellcheck=\"true\">// Era 标志符 Era strings. For example: \"AD\" and \"BC\"</span>\n        PATTERN_YEAR<span class=\"token punctuation\">:</span> <span class=\"token string\">'y'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\" spellcheck=\"true\">// 年</span>\n        PATTERN_MONTH<span class=\"token punctuation\">:</span> <span class=\"token string\">'M'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\" spellcheck=\"true\">// 月份</span>\n        PATTERN_DAY_OF_MONTH<span class=\"token punctuation\">:</span> <span class=\"token string\">'d'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\" spellcheck=\"true\">// 月份的天数</span>\n        PATTERN_HOUR_OF_DAY1<span class=\"token punctuation\">:</span> <span class=\"token string\">'k'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\" spellcheck=\"true\">// 一天中的小时数（1-24）</span>\n        PATTERN_HOUR_OF_DAY0<span class=\"token punctuation\">:</span> <span class=\"token string\">'H'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\" spellcheck=\"true\">// 24 小时制，一天中的小时数（0-23）</span>\n        PATTERN_MINUTE<span class=\"token punctuation\">:</span> <span class=\"token string\">'m'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\" spellcheck=\"true\">// 小时中的分钟数</span>\n        PATTERN_SECOND<span class=\"token punctuation\">:</span> <span class=\"token string\">'s'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\" spellcheck=\"true\">// 秒</span>\n        PATTERN_MILLISECOND<span class=\"token punctuation\">:</span> <span class=\"token string\">'S'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\" spellcheck=\"true\">// 毫秒</span>\n        PATTERN_DAY_OF_WEEK<span class=\"token punctuation\">:</span> <span class=\"token string\">'E'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\" spellcheck=\"true\">// 一周中对应的星期，如星期一，周一</span>\n        PATTERN_DAY_OF_YEAR<span class=\"token punctuation\">:</span> <span class=\"token string\">'D'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\" spellcheck=\"true\">// 一年中的第几天</span>\n        PATTERN_DAY_OF_WEEK_IN_MONTH<span class=\"token punctuation\">:</span> <span class=\"token string\">'F'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\" spellcheck=\"true\">// 一月中的第几个星期(会把这个月总共过的天数除以7,不够准确，推荐用W)</span>\n        PATTERN_WEEK_OF_YEAR<span class=\"token punctuation\">:</span> <span class=\"token string\">'w'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\" spellcheck=\"true\">// 一年中的第几个星期</span>\n        PATTERN_WEEK_OF_MONTH<span class=\"token punctuation\">:</span> <span class=\"token string\">'W'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\" spellcheck=\"true\">// 一月中的第几星期(会根据实际情况来算)</span>\n        PATTERN_AM_PM<span class=\"token punctuation\">:</span> <span class=\"token string\">'a'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\" spellcheck=\"true\">// 上下午标识</span>\n        PATTERN_HOUR1<span class=\"token punctuation\">:</span> <span class=\"token string\">'h'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\" spellcheck=\"true\">// 12 小时制 ，am/pm 中的小时数（1-12）</span>\n        PATTERN_HOUR0<span class=\"token punctuation\">:</span> <span class=\"token string\">'K'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\" spellcheck=\"true\">// 和 h 类型</span>\n        PATTERN_ZONE_NAME<span class=\"token punctuation\">:</span> <span class=\"token string\">'z'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\" spellcheck=\"true\">// 时区名</span>\n        PATTERN_ZONE_VALUE<span class=\"token punctuation\">:</span> <span class=\"token string\">'Z'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\" spellcheck=\"true\">// 时区值</span>\n        PATTERN_WEEK_YEAR<span class=\"token punctuation\">:</span> <span class=\"token string\">'Y'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\" spellcheck=\"true\">// 和 y 类型</span>\n        PATTERN_ISO_DAY_OF_WEEK<span class=\"token punctuation\">:</span> <span class=\"token string\">'u'</span><span class=\"token punctuation\">,</span>\n        PATTERN_ISO_ZONE<span class=\"token punctuation\">:</span> <span class=\"token string\">'X'</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">var</span> week <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">'ch'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token string\">\"0\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\\u65e5\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"1\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\\u4e00\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"2\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\\u4e8c\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"3\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\\u4e09\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"4\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\\u56db\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"5\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\\u4e94\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"6\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\\u516d\"</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'en'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token string\">\"0\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Sunday\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"1\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Monday\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"2\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Tuesday\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"3\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Wednesday\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"4\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Thursday\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"5\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Friday\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"6\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Saturday\"</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">/**\n     * 获取当前时间\n     * @returns {string}\n     */</span>\n    <span class=\"token keyword\">var</span> handlerGetCurrentTime <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">var</span> today <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">var</span> year <span class=\"token operator\">=</span> today<span class=\"token punctuation\">.</span><span class=\"token function\">getFullYear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">var</span> month <span class=\"token operator\">=</span> today<span class=\"token punctuation\">.</span><span class=\"token function\">getMonth</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">var</span> day <span class=\"token operator\">=</span> today<span class=\"token punctuation\">.</span><span class=\"token function\">getDate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">var</span> hours <span class=\"token operator\">=</span> today<span class=\"token punctuation\">.</span><span class=\"token function\">getHours</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">var</span> minutes <span class=\"token operator\">=</span> today<span class=\"token punctuation\">.</span><span class=\"token function\">getMinutes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">var</span> seconds <span class=\"token operator\">=</span> today<span class=\"token punctuation\">.</span><span class=\"token function\">getSeconds</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">var</span> timeString <span class=\"token operator\">=</span> year <span class=\"token operator\">+</span> <span class=\"token string\">\"-\"</span> <span class=\"token operator\">+</span> month <span class=\"token operator\">+</span> <span class=\"token string\">\"-\"</span> <span class=\"token operator\">+</span> day <span class=\"token operator\">+</span> <span class=\"token string\">\" \"</span> <span class=\"token operator\">+</span> hours <span class=\"token operator\">+</span> <span class=\"token string\">\":\"</span> <span class=\"token operator\">+</span> minutes <span class=\"token operator\">+</span> <span class=\"token string\">\":\"</span> <span class=\"token operator\">+</span> seconds<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> timeString<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">/**\n     * 比较时间大小\n     * time1 > time2 return 1\n     * time1 &lt; time2 return -1\n     * time1 == time2 return 0\n     * @param time1\n     * @param time2\n     * @returns {number}\n     */</span>\n    <span class=\"token keyword\">var</span> handlerCompareTime <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span>time1<span class=\"token punctuation\">,</span> time2<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>Date<span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>time1<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\">/-/g</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> Date<span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>time2<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\">/-/g</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>Date<span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>time1<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\">/-/g</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> Date<span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>time2<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\">/-/g</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>Date<span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>time1<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\">/-/g</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> Date<span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>time2<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\">/-/g</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">/**\n     * 是否闰年\n     * @param year\n     * @returns {boolean}\n     */</span>\n    <span class=\"token keyword\">var</span> handlerIsLeapYear <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span>year<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>year <span class=\"token operator\">%</span> <span class=\"token number\">4</span> <span class=\"token operator\">===</span> <span class=\"token number\">0</span> <span class=\"token operator\">&amp;&amp;</span> year <span class=\"token operator\">%</span> <span class=\"token number\">100</span> <span class=\"token operator\">!==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> year <span class=\"token operator\">%</span> <span class=\"token number\">400</span> <span class=\"token operator\">===</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">/**\n     * 获取某个月的天数，从 0 开始\n     * @param year\n     * @param month\n     * @returns {*}\n     */</span>\n    <span class=\"token keyword\">var</span> handlerGetDaysOfMonth <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span>year<span class=\"token punctuation\">,</span> month<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span><span class=\"token number\">31</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">isLeapYear</span><span class=\"token punctuation\">(</span>year<span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token number\">29</span> <span class=\"token punctuation\">:</span> <span class=\"token number\">28</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">31</span><span class=\"token punctuation\">,</span> <span class=\"token number\">30</span><span class=\"token punctuation\">,</span> <span class=\"token number\">31</span><span class=\"token punctuation\">,</span> <span class=\"token number\">30</span><span class=\"token punctuation\">,</span> <span class=\"token number\">31</span><span class=\"token punctuation\">,</span> <span class=\"token number\">31</span><span class=\"token punctuation\">,</span> <span class=\"token number\">30</span><span class=\"token punctuation\">,</span> <span class=\"token number\">31</span><span class=\"token punctuation\">,</span> <span class=\"token number\">30</span><span class=\"token punctuation\">,</span> <span class=\"token number\">31</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>month<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">/**\n     * 获取某个月的天数，从 0 开始\n     * @param year\n     * @param month\n     * @returns {number}\n     */</span>\n    <span class=\"token keyword\">var</span> handlerGetDaysOfMonth2 <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span>year<span class=\"token punctuation\">,</span> month<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\" spellcheck=\"true\">// 将天置为 0，会获取其上个月的最后一天</span>\n        month <span class=\"token operator\">=</span> <span class=\"token function\">parseInt</span><span class=\"token punctuation\">(</span>month<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">var</span> date <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>year<span class=\"token punctuation\">,</span> month<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> date<span class=\"token punctuation\">.</span><span class=\"token function\">getDate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">/**\n     * 距离现在几天的日期：负数表示今天之前的日期，0 表示今天，整数表示未来的日期\n     * 如 -1 表示昨天的日期，0 表示今天，2 表示后天\n     * @param days\n     * @returns {string}\n     */</span>\n    <span class=\"token keyword\">var</span> handlerFromToday <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span>days<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">var</span> today <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        today<span class=\"token punctuation\">.</span><span class=\"token function\">setDate</span><span class=\"token punctuation\">(</span>today<span class=\"token punctuation\">.</span><span class=\"token function\">getDate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> days<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">var</span> date <span class=\"token operator\">=</span> today<span class=\"token punctuation\">.</span><span class=\"token function\">getFullYear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"-\"</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>today<span class=\"token punctuation\">.</span><span class=\"token function\">getMonth</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"-\"</span> <span class=\"token operator\">+</span> today<span class=\"token punctuation\">.</span><span class=\"token function\">getDate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> date<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">/**\n     * 格式化日期时间\n     * @param dateTime 需要格式化的日期时间\n     * @param pattern 格式化的模式，如 yyyy-MM-dd hh(HH):mm:ss.S a k K E D F w W z Z\n     * @returns {*}\n     */</span>\n    <span class=\"token keyword\">var</span> handlerFormat <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span>dateTime<span class=\"token punctuation\">,</span> pattern<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">var</span> date <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>dateTime<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>pattern <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">||</span> pattern<span class=\"token punctuation\">.</span>length <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> date<span class=\"token punctuation\">.</span><span class=\"token function\">toLocaleString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span> pattern<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\">/([a-z])\\1*/ig</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span>matchStr<span class=\"token punctuation\">,</span> group1<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">var</span> replacement <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>group1<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">case</span> patterns<span class=\"token punctuation\">.</span>PATTERN_ERA<span class=\"token punctuation\">:</span> <span class=\"token comment\" spellcheck=\"true\">//G</span>\n                    <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">case</span> patterns<span class=\"token punctuation\">.</span>PATTERN_WEEK_YEAR<span class=\"token punctuation\">:</span> <span class=\"token comment\" spellcheck=\"true\">//Y</span>\n                <span class=\"token keyword\">case</span> patterns<span class=\"token punctuation\">.</span>PATTERN_YEAR<span class=\"token punctuation\">:</span> <span class=\"token comment\" spellcheck=\"true\">//y</span>\n                    replacement <span class=\"token operator\">=</span> date<span class=\"token punctuation\">.</span><span class=\"token function\">getFullYear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">case</span> patterns<span class=\"token punctuation\">.</span>PATTERN_MONTH<span class=\"token punctuation\">:</span> <span class=\"token comment\" spellcheck=\"true\">//M</span>\n                    <span class=\"token keyword\">var</span> month <span class=\"token operator\">=</span> date<span class=\"token punctuation\">.</span><span class=\"token function\">getMonth</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n                    replacement <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>month <span class=\"token operator\">&lt;</span> <span class=\"token number\">10</span> <span class=\"token operator\">&amp;&amp;</span> matchStr<span class=\"token punctuation\">.</span>length <span class=\"token operator\">>=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token string\">\"0\"</span> <span class=\"token operator\">+</span> month <span class=\"token punctuation\">:</span> month<span class=\"token punctuation\">;</span>\n                    <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">case</span> patterns<span class=\"token punctuation\">.</span>PATTERN_DAY_OF_MONTH<span class=\"token punctuation\">:</span> <span class=\"token comment\" spellcheck=\"true\">//d</span>\n                    <span class=\"token keyword\">var</span> days <span class=\"token operator\">=</span> date<span class=\"token punctuation\">.</span><span class=\"token function\">getDate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    replacement <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>days <span class=\"token operator\">&lt;</span> <span class=\"token number\">10</span> <span class=\"token operator\">&amp;&amp;</span> matchStr<span class=\"token punctuation\">.</span>length <span class=\"token operator\">>=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token string\">\"0\"</span> <span class=\"token operator\">+</span> days <span class=\"token punctuation\">:</span> days<span class=\"token punctuation\">;</span>\n                    <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">case</span> patterns<span class=\"token punctuation\">.</span>PATTERN_HOUR_OF_DAY1<span class=\"token punctuation\">:</span> <span class=\"token comment\" spellcheck=\"true\">//k(1~24)</span>\n                    <span class=\"token keyword\">var</span> hours24 <span class=\"token operator\">=</span> date<span class=\"token punctuation\">.</span><span class=\"token function\">getHours</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    replacement <span class=\"token operator\">=</span> hours24<span class=\"token punctuation\">;</span>\n                    <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">case</span> patterns<span class=\"token punctuation\">.</span>PATTERN_HOUR_OF_DAY0<span class=\"token punctuation\">:</span> <span class=\"token comment\" spellcheck=\"true\">//H(0~23)</span>\n                    <span class=\"token keyword\">var</span> hours24 <span class=\"token operator\">=</span> date<span class=\"token punctuation\">.</span><span class=\"token function\">getHours</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    replacement <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>hours24 <span class=\"token operator\">&lt;</span> <span class=\"token number\">10</span> <span class=\"token operator\">&amp;&amp;</span> matchStr<span class=\"token punctuation\">.</span>length <span class=\"token operator\">>=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token string\">\"0\"</span> <span class=\"token operator\">+</span> hours24 <span class=\"token punctuation\">:</span> hours24<span class=\"token punctuation\">;</span>\n                    <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">case</span> patterns<span class=\"token punctuation\">.</span>PATTERN_MINUTE<span class=\"token punctuation\">:</span> <span class=\"token comment\" spellcheck=\"true\">//m</span>\n                    <span class=\"token keyword\">var</span> minutes <span class=\"token operator\">=</span> date<span class=\"token punctuation\">.</span><span class=\"token function\">getMinutes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    replacement <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>minutes <span class=\"token operator\">&lt;</span> <span class=\"token number\">10</span> <span class=\"token operator\">&amp;&amp;</span> matchStr<span class=\"token punctuation\">.</span>length <span class=\"token operator\">>=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token string\">\"0\"</span> <span class=\"token operator\">+</span> minutes <span class=\"token punctuation\">:</span> minutes<span class=\"token punctuation\">;</span>\n                    <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">case</span> patterns<span class=\"token punctuation\">.</span>PATTERN_SECOND<span class=\"token punctuation\">:</span> <span class=\"token comment\" spellcheck=\"true\">//s</span>\n                    <span class=\"token keyword\">var</span> seconds <span class=\"token operator\">=</span> date<span class=\"token punctuation\">.</span><span class=\"token function\">getSeconds</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    replacement <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>seconds <span class=\"token operator\">&lt;</span> <span class=\"token number\">10</span> <span class=\"token operator\">&amp;&amp;</span> matchStr<span class=\"token punctuation\">.</span>length <span class=\"token operator\">>=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token string\">\"0\"</span> <span class=\"token operator\">+</span> seconds <span class=\"token punctuation\">:</span> seconds<span class=\"token punctuation\">;</span>\n                    <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">case</span> patterns<span class=\"token punctuation\">.</span>PATTERN_MILLISECOND<span class=\"token punctuation\">:</span> <span class=\"token comment\" spellcheck=\"true\">//S</span>\n                    <span class=\"token keyword\">var</span> milliSeconds <span class=\"token operator\">=</span> date<span class=\"token punctuation\">.</span><span class=\"token function\">getMilliseconds</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    replacement <span class=\"token operator\">=</span> milliSeconds<span class=\"token punctuation\">;</span>\n                    <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">case</span> patterns<span class=\"token punctuation\">.</span>PATTERN_DAY_OF_WEEK<span class=\"token punctuation\">:</span> <span class=\"token comment\" spellcheck=\"true\">//E</span>\n                    <span class=\"token keyword\">var</span> day <span class=\"token operator\">=</span> date<span class=\"token punctuation\">.</span><span class=\"token function\">getDay</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    replacement <span class=\"token operator\">=</span> week<span class=\"token punctuation\">[</span><span class=\"token string\">'ch'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>day<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">case</span> patterns<span class=\"token punctuation\">.</span>PATTERN_DAY_OF_YEAR<span class=\"token punctuation\">:</span> <span class=\"token comment\" spellcheck=\"true\">//D</span>\n                    replacement <span class=\"token operator\">=</span> <span class=\"token function\">dayOfTheYear</span><span class=\"token punctuation\">(</span>date<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">case</span> patterns<span class=\"token punctuation\">.</span>PATTERN_DAY_OF_WEEK_IN_MONTH<span class=\"token punctuation\">:</span> <span class=\"token comment\" spellcheck=\"true\">//F</span>\n                    <span class=\"token keyword\">var</span> days <span class=\"token operator\">=</span> date<span class=\"token punctuation\">.</span><span class=\"token function\">getDate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    replacement <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span>days <span class=\"token operator\">/</span> <span class=\"token number\">7</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">case</span> patterns<span class=\"token punctuation\">.</span>PATTERN_WEEK_OF_YEAR<span class=\"token punctuation\">:</span> <span class=\"token comment\" spellcheck=\"true\">//w</span>\n                    <span class=\"token keyword\">var</span> days <span class=\"token operator\">=</span> <span class=\"token function\">dayOfTheYear</span><span class=\"token punctuation\">(</span>date<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    replacement <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">ceil</span><span class=\"token punctuation\">(</span>days <span class=\"token operator\">/</span> <span class=\"token number\">7</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">case</span> patterns<span class=\"token punctuation\">.</span>PATTERN_WEEK_OF_MONTH<span class=\"token punctuation\">:</span> <span class=\"token comment\" spellcheck=\"true\">//W</span>\n                    <span class=\"token keyword\">var</span> days <span class=\"token operator\">=</span> date<span class=\"token punctuation\">.</span><span class=\"token function\">getDate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    replacement <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">ceil</span><span class=\"token punctuation\">(</span>days <span class=\"token operator\">/</span> <span class=\"token number\">7</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">case</span> patterns<span class=\"token punctuation\">.</span>PATTERN_AM_PM<span class=\"token punctuation\">:</span> <span class=\"token comment\" spellcheck=\"true\">//a</span>\n                    <span class=\"token keyword\">var</span> hours24 <span class=\"token operator\">=</span> date<span class=\"token punctuation\">.</span><span class=\"token function\">getHours</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    replacement <span class=\"token operator\">=</span> hours24 <span class=\"token operator\">&lt;</span> <span class=\"token number\">12</span> <span class=\"token operator\">?</span> <span class=\"token string\">\"\\u4e0a\\u5348\"</span> <span class=\"token punctuation\">:</span> <span class=\"token string\">\"\\u4e0b\\u5348\"</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">case</span> patterns<span class=\"token punctuation\">.</span>PATTERN_HOUR1<span class=\"token punctuation\">:</span> <span class=\"token comment\" spellcheck=\"true\">//h(1~12)</span>\n                    <span class=\"token keyword\">var</span> hours12 <span class=\"token operator\">=</span> date<span class=\"token punctuation\">.</span><span class=\"token function\">getHours</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">%</span> <span class=\"token number\">12</span> <span class=\"token operator\">||</span> <span class=\"token number\">12</span><span class=\"token punctuation\">;</span> <span class=\"token comment\" spellcheck=\"true\">//0转为12</span>\n                    replacement <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>hours12 <span class=\"token operator\">&lt;</span> <span class=\"token number\">10</span> <span class=\"token operator\">&amp;&amp;</span> matchStr<span class=\"token punctuation\">.</span>length <span class=\"token operator\">>=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token string\">\"0\"</span> <span class=\"token operator\">+</span> hours12 <span class=\"token punctuation\">:</span> hours12<span class=\"token punctuation\">;</span>\n                    <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">case</span> patterns<span class=\"token punctuation\">.</span>PATTERN_HOUR0<span class=\"token punctuation\">:</span> <span class=\"token comment\" spellcheck=\"true\">//K(0~11)</span>\n                    <span class=\"token keyword\">var</span> hours12 <span class=\"token operator\">=</span> date<span class=\"token punctuation\">.</span><span class=\"token function\">getHours</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">%</span> <span class=\"token number\">12</span><span class=\"token punctuation\">;</span>\n                    replacement <span class=\"token operator\">=</span> hours12<span class=\"token punctuation\">;</span>\n                    <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">case</span> patterns<span class=\"token punctuation\">.</span>PATTERN_ZONE_NAME<span class=\"token punctuation\">:</span> <span class=\"token comment\" spellcheck=\"true\">//z</span>\n                    replacement <span class=\"token operator\">=</span> <span class=\"token function\">handlerGetZoneNameValue</span><span class=\"token punctuation\">(</span>date<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">case</span> patterns<span class=\"token punctuation\">.</span>PATTERN_ZONE_VALUE<span class=\"token punctuation\">:</span> <span class=\"token comment\" spellcheck=\"true\">//Z</span>\n                    replacement <span class=\"token operator\">=</span> <span class=\"token function\">handlerGetZoneNameValue</span><span class=\"token punctuation\">(</span>date<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token string\">'value'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">case</span> patterns<span class=\"token punctuation\">.</span>PATTERN_ISO_DAY_OF_WEEK<span class=\"token punctuation\">:</span> <span class=\"token comment\" spellcheck=\"true\">//u</span>\n                    <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">case</span> patterns<span class=\"token punctuation\">.</span>PATTERN_ISO_ZONE<span class=\"token punctuation\">:</span> <span class=\"token comment\" spellcheck=\"true\">//X</span>\n                    <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">default</span><span class=\"token punctuation\">:</span>\n                    <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token keyword\">return</span> replacement<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">/**\n     * 计算一个日期是当年的第几天\n     * @param date\n     * @returns {number}\n     */</span>\n    <span class=\"token keyword\">var</span> handlerDayOfTheYear <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span>date<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">var</span> obj <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>date<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">var</span> year <span class=\"token operator\">=</span> obj<span class=\"token punctuation\">.</span><span class=\"token function\">getFullYear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">var</span> month <span class=\"token operator\">=</span> obj<span class=\"token punctuation\">.</span><span class=\"token function\">getMonth</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\" spellcheck=\"true\">//从0开始</span>\n        <span class=\"token keyword\">var</span> days <span class=\"token operator\">=</span> obj<span class=\"token punctuation\">.</span><span class=\"token function\">getDate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">var</span> daysArr <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">31</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">isLeapYear</span><span class=\"token punctuation\">(</span>year<span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token number\">29</span> <span class=\"token punctuation\">:</span> <span class=\"token number\">28</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">31</span><span class=\"token punctuation\">,</span> <span class=\"token number\">30</span><span class=\"token punctuation\">,</span> <span class=\"token number\">31</span><span class=\"token punctuation\">,</span> <span class=\"token number\">30</span><span class=\"token punctuation\">,</span> <span class=\"token number\">31</span><span class=\"token punctuation\">,</span> <span class=\"token number\">31</span><span class=\"token punctuation\">,</span> <span class=\"token number\">30</span><span class=\"token punctuation\">,</span> <span class=\"token number\">31</span><span class=\"token punctuation\">,</span> <span class=\"token number\">30</span><span class=\"token punctuation\">,</span> <span class=\"token number\">31</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> month<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            days <span class=\"token operator\">+</span><span class=\"token operator\">=</span> daysArr<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span> days<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">/**\n     * 获得时区名和值\n     * @param dateObj\n     * @returns {{name: string, value: string}}\n     */</span>\n    <span class=\"token keyword\">var</span> handlerGetZoneNameValue <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span>dateObj<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">var</span> date <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>dateObj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        date <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>Date<span class=\"token punctuation\">.</span><span class=\"token function\">UTC</span><span class=\"token punctuation\">(</span>date<span class=\"token punctuation\">.</span><span class=\"token function\">getFullYear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> date<span class=\"token punctuation\">.</span><span class=\"token function\">getMonth</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> date<span class=\"token punctuation\">.</span><span class=\"token function\">getDate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">var</span> arr <span class=\"token operator\">=</span> date<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span><span class=\"token regex\">/([A-Z]+)([-+]\\d+:?\\d+)/</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">var</span> obj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token string\">'name'</span><span class=\"token punctuation\">:</span> arr<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">'value'</span><span class=\"token punctuation\">:</span> arr<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> obj<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n        getCurrentTime<span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token function\">handlerGetCurrentTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n        compareTime<span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span>time1<span class=\"token punctuation\">,</span> time2<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token function\">handlerCompareTime</span><span class=\"token punctuation\">(</span>time1<span class=\"token punctuation\">,</span> time2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n        isLeapYear<span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span>year<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token function\">handlerIsLeapYear</span><span class=\"token punctuation\">(</span>year<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n        getDaysOfMonth<span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span>year<span class=\"token punctuation\">,</span> month<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token function\">handlerGetDaysOfMonth</span><span class=\"token punctuation\">(</span>year<span class=\"token punctuation\">,</span> month<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n        getDaysOfMonth2<span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span>year<span class=\"token punctuation\">,</span> month<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token function\">handlerGetDaysOfMonth2</span><span class=\"token punctuation\">(</span>year<span class=\"token punctuation\">,</span> month<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n        fromToday<span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span>days<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token function\">handlerFromToday</span><span class=\"token punctuation\">(</span>days<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n        format<span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span>dateTime<span class=\"token punctuation\">,</span> pattern<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token function\">handlerFormat</span><span class=\"token punctuation\">(</span>dateTime<span class=\"token punctuation\">,</span> pattern<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n        dayOfTheYear<span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span>date<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token function\">handlerDayOfTheYear</span><span class=\"token punctuation\">(</span>date<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n        getZoneNameValue<span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span>dateObj<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token function\">handlerGetZoneNameValue</span><span class=\"token punctuation\">(</span>dateObj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n","site":{"data":{}},"excerpt":"","more":"<pre><code class=\"js\">/**\n * 日期时间工具类\n * @type {{dateFormat}}\n */\nvar DateTime = function () {\n    var patterns = {\n        PATTERN_ERA: &#39;G&#39;, // Era 标志符 Era strings. For example: &quot;AD&quot; and &quot;BC&quot;\n        PATTERN_YEAR: &#39;y&#39;, // 年\n        PATTERN_MONTH: &#39;M&#39;, // 月份\n        PATTERN_DAY_OF_MONTH: &#39;d&#39;, // 月份的天数\n        PATTERN_HOUR_OF_DAY1: &#39;k&#39;, // 一天中的小时数（1-24）\n        PATTERN_HOUR_OF_DAY0: &#39;H&#39;, // 24 小时制，一天中的小时数（0-23）\n        PATTERN_MINUTE: &#39;m&#39;, // 小时中的分钟数\n        PATTERN_SECOND: &#39;s&#39;, // 秒\n        PATTERN_MILLISECOND: &#39;S&#39;, // 毫秒\n        PATTERN_DAY_OF_WEEK: &#39;E&#39;, // 一周中对应的星期，如星期一，周一\n        PATTERN_DAY_OF_YEAR: &#39;D&#39;, // 一年中的第几天\n        PATTERN_DAY_OF_WEEK_IN_MONTH: &#39;F&#39;, // 一月中的第几个星期(会把这个月总共过的天数除以7,不够准确，推荐用W)\n        PATTERN_WEEK_OF_YEAR: &#39;w&#39;, // 一年中的第几个星期\n        PATTERN_WEEK_OF_MONTH: &#39;W&#39;, // 一月中的第几星期(会根据实际情况来算)\n        PATTERN_AM_PM: &#39;a&#39;, // 上下午标识\n        PATTERN_HOUR1: &#39;h&#39;, // 12 小时制 ，am/pm 中的小时数（1-12）\n        PATTERN_HOUR0: &#39;K&#39;, // 和 h 类型\n        PATTERN_ZONE_NAME: &#39;z&#39;, // 时区名\n        PATTERN_ZONE_VALUE: &#39;Z&#39;, // 时区值\n        PATTERN_WEEK_YEAR: &#39;Y&#39;, // 和 y 类型\n        PATTERN_ISO_DAY_OF_WEEK: &#39;u&#39;,\n        PATTERN_ISO_ZONE: &#39;X&#39;\n    };\n\n    var week = {\n        &#39;ch&#39;: {\n            &quot;0&quot;: &quot;\\u65e5&quot;,\n            &quot;1&quot;: &quot;\\u4e00&quot;,\n            &quot;2&quot;: &quot;\\u4e8c&quot;,\n            &quot;3&quot;: &quot;\\u4e09&quot;,\n            &quot;4&quot;: &quot;\\u56db&quot;,\n            &quot;5&quot;: &quot;\\u4e94&quot;,\n            &quot;6&quot;: &quot;\\u516d&quot;\n        },\n        &#39;en&#39;: {\n            &quot;0&quot;: &quot;Sunday&quot;,\n            &quot;1&quot;: &quot;Monday&quot;,\n            &quot;2&quot;: &quot;Tuesday&quot;,\n            &quot;3&quot;: &quot;Wednesday&quot;,\n            &quot;4&quot;: &quot;Thursday&quot;,\n            &quot;5&quot;: &quot;Friday&quot;,\n            &quot;6&quot;: &quot;Saturday&quot;\n        }\n    };\n\n    /**\n     * 获取当前时间\n     * @returns {string}\n     */\n    var handlerGetCurrentTime = function () {\n        var today = new Date();\n        var year = today.getFullYear();\n        var month = today.getMonth() + 1;\n        var day = today.getDate();\n        var hours = today.getHours();\n        var minutes = today.getMinutes();\n        var seconds = today.getSeconds();\n        var timeString = year + &quot;-&quot; + month + &quot;-&quot; + day + &quot; &quot; + hours + &quot;:&quot; + minutes + &quot;:&quot; + seconds;\n        return timeString;\n    };\n\n    /**\n     * 比较时间大小\n     * time1 &gt; time2 return 1\n     * time1 &lt; time2 return -1\n     * time1 == time2 return 0\n     * @param time1\n     * @param time2\n     * @returns {number}\n     */\n    var handlerCompareTime = function (time1, time2) {\n        if (Date.parse(time1.replace(/-/g, &quot;/&quot;)) &gt; Date.parse(time2.replace(/-/g, &quot;/&quot;))) {\n            return 1;\n        } else if (Date.parse(time1.replace(/-/g, &quot;/&quot;)) &lt; Date.parse(time2.replace(/-/g, &quot;/&quot;))) {\n            return -1;\n        } else if (Date.parse(time1.replace(/-/g, &quot;/&quot;)) == Date.parse(time2.replace(/-/g, &quot;/&quot;))) {\n            return 0;\n        }\n    };\n\n    /**\n     * 是否闰年\n     * @param year\n     * @returns {boolean}\n     */\n    var handlerIsLeapYear = function (year) {\n        return ((year % 4 === 0 &amp;&amp; year % 100 !== 0) || year % 400 === 0);\n    };\n\n    /**\n     * 获取某个月的天数，从 0 开始\n     * @param year\n     * @param month\n     * @returns {*}\n     */\n    var handlerGetDaysOfMonth = function (year, month) {\n        return [31, (this.isLeapYear(year) ? 29 : 28), 31, 30, 31, 30, 31, 31, 30, 31, 30, 31][month];\n    };\n\n    /**\n     * 获取某个月的天数，从 0 开始\n     * @param year\n     * @param month\n     * @returns {number}\n     */\n    var handlerGetDaysOfMonth2 = function (year, month) {\n        // 将天置为 0，会获取其上个月的最后一天\n        month = parseInt(month) + 1;\n        var date = new Date(year, month, 0);\n        return date.getDate();\n    };\n\n    /**\n     * 距离现在几天的日期：负数表示今天之前的日期，0 表示今天，整数表示未来的日期\n     * 如 -1 表示昨天的日期，0 表示今天，2 表示后天\n     * @param days\n     * @returns {string}\n     */\n    var handlerFromToday = function (days) {\n        var today = new Date();\n        today.setDate(today.getDate() + days);\n        var date = today.getFullYear() + &quot;-&quot; + (today.getMonth() + 1) + &quot;-&quot; + today.getDate();\n        return date;\n    };\n\n    /**\n     * 格式化日期时间\n     * @param dateTime 需要格式化的日期时间\n     * @param pattern 格式化的模式，如 yyyy-MM-dd hh(HH):mm:ss.S a k K E D F w W z Z\n     * @returns {*}\n     */\n    var handlerFormat = function (dateTime, pattern) {\n        var date = new Date(dateTime);\n        if (pattern == null || pattern.length == 0) {\n            return date.toLocaleString();\n        }\n        return pattern.replace(/([a-z])\\1*/ig, function (matchStr, group1) {\n            var replacement = &quot;&quot;;\n            switch (group1) {\n                case patterns.PATTERN_ERA: //G\n                    break;\n                case patterns.PATTERN_WEEK_YEAR: //Y\n                case patterns.PATTERN_YEAR: //y\n                    replacement = date.getFullYear();\n                    break;\n                case patterns.PATTERN_MONTH: //M\n                    var month = date.getMonth() + 1;\n                    replacement = (month &lt; 10 &amp;&amp; matchStr.length &gt;= 2) ? &quot;0&quot; + month : month;\n                    break;\n                case patterns.PATTERN_DAY_OF_MONTH: //d\n                    var days = date.getDate();\n                    replacement = (days &lt; 10 &amp;&amp; matchStr.length &gt;= 2) ? &quot;0&quot; + days : days;\n                    break;\n                case patterns.PATTERN_HOUR_OF_DAY1: //k(1~24)\n                    var hours24 = date.getHours();\n                    replacement = hours24;\n                    break;\n                case patterns.PATTERN_HOUR_OF_DAY0: //H(0~23)\n                    var hours24 = date.getHours();\n                    replacement = (hours24 &lt; 10 &amp;&amp; matchStr.length &gt;= 2) ? &quot;0&quot; + hours24 : hours24;\n                    break;\n                case patterns.PATTERN_MINUTE: //m\n                    var minutes = date.getMinutes();\n                    replacement = (minutes &lt; 10 &amp;&amp; matchStr.length &gt;= 2) ? &quot;0&quot; + minutes : minutes;\n                    break;\n                case patterns.PATTERN_SECOND: //s\n                    var seconds = date.getSeconds();\n                    replacement = (seconds &lt; 10 &amp;&amp; matchStr.length &gt;= 2) ? &quot;0&quot; + seconds : seconds;\n                    break;\n                case patterns.PATTERN_MILLISECOND: //S\n                    var milliSeconds = date.getMilliseconds();\n                    replacement = milliSeconds;\n                    break;\n                case patterns.PATTERN_DAY_OF_WEEK: //E\n                    var day = date.getDay();\n                    replacement = week[&#39;ch&#39;][day];\n                    break;\n                case patterns.PATTERN_DAY_OF_YEAR: //D\n                    replacement = dayOfTheYear(date);\n                    break;\n                case patterns.PATTERN_DAY_OF_WEEK_IN_MONTH: //F\n                    var days = date.getDate();\n                    replacement = Math.floor(days / 7);\n                    break;\n                case patterns.PATTERN_WEEK_OF_YEAR: //w\n                    var days = dayOfTheYear(date);\n                    replacement = Math.ceil(days / 7);\n                    break;\n                case patterns.PATTERN_WEEK_OF_MONTH: //W\n                    var days = date.getDate();\n                    replacement = Math.ceil(days / 7);\n                    break;\n                case patterns.PATTERN_AM_PM: //a\n                    var hours24 = date.getHours();\n                    replacement = hours24 &lt; 12 ? &quot;\\u4e0a\\u5348&quot; : &quot;\\u4e0b\\u5348&quot;;\n                    break;\n                case patterns.PATTERN_HOUR1: //h(1~12)\n                    var hours12 = date.getHours() % 12 || 12; //0转为12\n                    replacement = (hours12 &lt; 10 &amp;&amp; matchStr.length &gt;= 2) ? &quot;0&quot; + hours12 : hours12;\n                    break;\n                case patterns.PATTERN_HOUR0: //K(0~11)\n                    var hours12 = date.getHours() % 12;\n                    replacement = hours12;\n                    break;\n                case patterns.PATTERN_ZONE_NAME: //z\n                    replacement = handlerGetZoneNameValue(date)[&#39;name&#39;];\n                    break;\n                case patterns.PATTERN_ZONE_VALUE: //Z\n                    replacement = handlerGetZoneNameValue(date)[&#39;value&#39;];\n                    break;\n                case patterns.PATTERN_ISO_DAY_OF_WEEK: //u\n                    break;\n                case patterns.PATTERN_ISO_ZONE: //X\n                    break;\n                default:\n                    break;\n            }\n            return replacement;\n        });\n    };\n\n    /**\n     * 计算一个日期是当年的第几天\n     * @param date\n     * @returns {number}\n     */\n    var handlerDayOfTheYear = function (date) {\n        var obj = new Date(date);\n        var year = obj.getFullYear();\n        var month = obj.getMonth(); //从0开始\n        var days = obj.getDate();\n        var daysArr = [31, (this.isLeapYear(year) ? 29 : 28), 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];\n        for (var i = 0; i &lt; month; i++) {\n            days += daysArr[i];\n        }\n        return days;\n    };\n\n    /**\n     * 获得时区名和值\n     * @param dateObj\n     * @returns {{name: string, value: string}}\n     */\n    var handlerGetZoneNameValue = function (dateObj) {\n        var date = new Date(dateObj);\n        date = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));\n        var arr = date.toString().match(/([A-Z]+)([-+]\\d+:?\\d+)/);\n        var obj = {\n            &#39;name&#39;: arr[1],\n            &#39;value&#39;: arr[2]\n        };\n        return obj;\n    };\n\n    return {\n        getCurrentTime: function () {\n            return handlerGetCurrentTime();\n        },\n\n        compareTime: function (time1, time2) {\n            return handlerCompareTime(time1, time2);\n        },\n\n        isLeapYear: function (year) {\n            return handlerIsLeapYear(year);\n        },\n\n        getDaysOfMonth: function (year, month) {\n            return handlerGetDaysOfMonth(year, month);\n        },\n\n        getDaysOfMonth2: function (year, month) {\n            return handlerGetDaysOfMonth2(year, month);\n        },\n\n        fromToday: function (days) {\n            return handlerFromToday(days);\n        },\n\n        format: function (dateTime, pattern) {\n            return handlerFormat(dateTime, pattern);\n        },\n\n        dayOfTheYear: function (date) {\n            return handlerDayOfTheYear(date);\n        },\n\n        getZoneNameValue: function (dateObj) {\n            return handlerGetZoneNameValue(dateObj);\n        }\n    }\n}();\n\n</code></pre>\n"},{"title":"Eureka配置大全","author":"Asia Cui","date":"2019-01-28T10:28:00.000Z","_content":"##  Eureka客户端配置\n\n1、RegistryFetchIntervalSeconds\n\n从 eureka 服务器注册表中获取注册信息的时间间隔（s），默认为 30 秒\n\n2、InstanceInfoReplicationIntervalSeconds\n\n复制实例变化信息到 eureka 服务器所需要的时间间隔（s），默认为 30 秒\n\n3、InitialInstanceInfoReplicationIntervalSeconds\n\n最初复制实例信息到 eureka 服务器所需的时间（s），默认为 40 秒\n\n4、EurekaServiceUrlPollIntervalSeconds\n\n询问 Eureka 服务 url 信息变化的时间间隔（s），默认为 300 秒\n\n5、ProxyHost\n\n获取 eureka 服务的代理主机，默认为 null\n\n6、ProxyProxyPort\n\n获取 eureka 服务的代理端口, 默认为 null \n\n 7、ProxyUserName\n\n获取 eureka 服务的代理用户名，默认为 null\n\n 8、ProxyPassword\n\n获取 eureka 服务的代理密码，默认为 null \n\n 9、GZipContent\n\n eureka 注册表的内容是否被压缩，默认为 true，并且是在最好的网络流量下被压缩\n\n10、EurekaServerReadTimeoutSeconds\n\neureka 需要超时读取之前需要等待的时间，默认为 8 秒\n\n11、EurekaServerConnectTimeoutSeconds\n\neureka 需要超时连接之前需要等待的时间，默认为 5 秒\n\n12、BackupRegistryImpl\n\n获取实现了 eureka 客户端在第一次启动时读取注册表的信息作为回退选项的实现名称\n\n13、EurekaServerTotalConnections\n\n eureka 客户端允许所有 eureka 服务器连接的总数目，默认是 200\n\n 14、EurekaServerTotalConnectionsPerHost\n\n eureka 客户端允许 eureka 服务器主机连接的总数目，默认是 50\n\n 15、EurekaServerURLContext\n\n表示 eureka 注册中心的路径，如果配置为 eureka，则为 http://x.x.x.x:x/eureka/，在 eureka 的配置文件中加入此配置表示 eureka 作为客户端向注册中心注册，从而构成 eureka 集群。此配置只有在 eureka 服务器 ip 地址列表是在 DNS 中才会用到，默认为 null\n\n16、EurekaServerPort\n\n获取 eureka 服务器的端口，此配置只有在 eureka 服务器 ip 地址列表是在 DNS 中才会用到。默认为 null\n\n17、EurekaServerDNSName\n\n获取要查询的 DNS 名称来获得 eureka 服务器，此配置只有在 eureka 服务器 ip 地址列表是在 DNS 中才会用到。默认为 null\n\n18、UseDnsForFetchingServiceUrls\n\neureka 客户端是否应该使用 DNS 机制来获取 eureka 服务器的地址列表，默认为 false\n\n19、RegisterWithEureka\n\n实例是否在 eureka 服务器上注册自己的信息以供其他服务发现，默认为 true\n\n20、PreferSameZoneEureka\n\n实例是否使用同一 zone 里的 eureka 服务器，默认为 true，理想状态下，eureka 客户端与服务端是在同一 zone 下\n\n21、AllowRedirects\n\n服务器是否能够重定向客户端请求到备份服务器。 如果设置为 false，服务器将直接处理请求，如果设置为 true，它可能发送 HTTP 重定向到客户端。默认为 false\n\n22、LogDeltaDiff\n\n是否记录 eureka 服务器和客户端之间在注册表的信息方面的差异，默认为 false\n\n23、DisableDelta(*)\n\n默认为 false\n\n24、fetchRegistryForRemoteRegions\n\neureka服务注册表信息里的以逗号隔开的地区名单，如果不这样返回这些地区名单，则客户端启动将会出错。默认为 null\n\n25、Region\n\n获取实例所在的地区。默认为 us-east-1\n\n26、AvailabilityZones\n\n获取实例所在的地区下可用性的区域列表，用逗号隔开。\n\n27、EurekaServerServiceUrls\n\nEureka 服务器的连接，默认为 http：//XXXX：X/eureka/, 但是如果采用 DNS方式获取服务地址，则不需要配置此设置。\n\n28、FilterOnlyUpInstances（*）\n\n是否获得处于开启状态的实例的应用程序过滤之后的应用程序。默认为 true\n\n29、EurekaConnectionIdleTimeoutSeconds\n\nEureka 服务的 http 请求关闭之前其响应的时间，默认为 30 秒\n\n30、FetchRegistry\n\n此客户端是否获取 eureka 服务器注册表上的注册信息，默认为 true\n\n31、RegistryRefreshSingleVipAddress\n\n此客户端只对一个单一的 VIP 注册表的信息感兴趣。默认为 null\n\n32、HeartbeatExecutorThreadPoolSize(*)\n\n心跳执行程序线程池的大小, 默认为 5\n\n33、HeartbeatExecutorExponentialBackOffBound(*)\n\n心跳执行程序回退相关的属性，是重试延迟的最大倍数值，默认为 10\n\n34、CacheRefreshExecutorThreadPoolSize(*)\n\n执行程序缓存刷新线程池的大小，默认为 5\n\n35、CacheRefreshExecutorExponentialBackOffBound\n\n执行程序指数回退刷新的相关属性，是重试延迟的最大倍数值，默认为 10\n\n36、DollarReplacement\n\neureka 服务器序列化 / 反序列化的信息中获取 “$” 符号的的替换字符串。默认为 “_-”\n\n37、EscapeCharReplacement\n\neureka 服务器序列化 / 反序列化的信息中获取 “_” 符号的的替换字符串。默认为 “__”\n\n38、OnDemandUpdateStatusChange（*）\n\n如果设置为 true, 客户端的状态更新将会点播更新到远程服务器上，默认为 true\n\n39、EncoderName\n\n这是一个短暂的编码器的配置，如果最新的编码器是稳定的，则可以去除，默认为 null\n\n40、DecoderName\n\n这是一个短暂的解码器的配置，如果最新的解码器是稳定的，则可以去除，默认为 null\n\n41、ClientDataAccept（*）\n\n客户端数据接收\n\n42、Experimental（*）\n\n当尝试新功能迁移过程时，为了避免配置 API 污染，相应的配置即可投入实验配置部分，默认为 null\n\n##  Eureka微服务端配置\n\n1、InstanceId\n\n此实例注册到 eureka 服务端的唯一的实例 ID, 其组成为 、`${spring.application.name}:${spring.application.instance_id:${random.value}}`\n\n2、Appname\n\n获得在 eureka 服务上注册的应用程序的名字，默认为 unknow\n\n3、AppGroupName\n\n获得在 eureka 服务上注册的应用程序组的名字，默认为 unknow\n\n4、InstanceEnabledOnit（*）\n\n实例注册到 eureka 服务器时，是否开启通讯，默认为 false\n\n5、NonSecurePort\n\n获取该实例应该接收通信的非安全端口。默认为 80\n\n6、SecurePort\n\n获取该实例应该接收通信的安全端口，默认为 443\n\n7、NonSecurePortEnabled\n\n该实例应该接收通信的非安全端口是否启用，默认为 true\n\n8、SecurePortEnabled\n\n该实例应该接收通信的安全端口是否启用，默认为 false\n\n9、LeaseRenewalIntervalInSeconds\n\neureka 客户需要多长时间发送心跳给 eureka 服务器，表明它仍然活着, 默认为 30 秒\n\n10、LeaseExpirationDurationInSeconds\n\nEureka 服务器在接收到实例的最后一次发出的心跳后，需要等待多久才可以将此实例删除，默认为 90 秒\n\n11、VirtualHostName\n\n此实例定义的虚拟主机名，其他实例将通过使用虚拟主机名找到该实例。\n\n12、SecureVirtualHostName\n\n此实例定义的安全虚拟主机名\n\n13、ASGName（*）\n\n与此实例相关联 AWS 自动缩放组名称。此项配置是在 AWS环境专门使用的实例启动，它已被用于流量停用后自动把一个实例退出服务。\n\n14、HostName\n\n与此实例相关联的主机名，是其他实例可以用来进行请求的准确名称\n\n15、MetadataMap(*)\n\n获取与此实例相关联的元数据 (key,value)。这个信息被发送到 eureka 服务器，其他实例可以使用。\n\n16、DataCenterInfo（*）\n\n该实例被部署在数据中心\n\n17、IpAddress\n\n获取实例的 ip 地址\n\n18、StatusPageUrlPath（*）\n\n获取此实例状态页的 URL 路径，然后构造出主机名，安全端口等，默认为 /info\n\n19、StatusPageUrl(*)\n\n获取此实例绝对状态页的 URL 路径，为其他服务提供信息时来找到这个实例的状态的路径，默认为 null\n\n20、HomePageUrlPath（*）\n\n获取此实例的相关主页 URL 路径，然后构造出主机名，安全端口等，默认为 /\n\n21、HomePageUrl(*)\n\n获取此实例的绝对主页 URL 路径，为其他服务提供信息时使用的路径, 默认为 null\n\n22、HealthCheckUrlPath\n\n获取此实例的相对健康检查 URL 路径，默认为 /health\n\n23、HealthCheckUrl\n\n获取此实例的绝对健康检查 URL 路径, 默认为 null\n\n24、SecureHealthCheckUrl\n\n获取此实例的绝对安全健康检查网页的 URL 路径，默认为 null\n\n25、DefaultAddressResolutionOrder\n\n获取实例的网络地址，默认为 []\n\n26、Namespace\n\n获取用于查找属性的命名空间，默认为 eureka\n\nEureka服务端配置\n\n1、AWSAccessId\n\n获取 aws 访问的 id，主要用于弹性 ip 绑定，此配置是用于 aws 上的，默认为 null\n\n2、AWSSecretKey\n\n获取 aws 私有秘钥，主要用于弹性 ip 绑定，此配置是用于 aws 上的，默认为 null\n\n3、EIPBindRebindRetries\n\n获取服务器尝试绑定到候选的 EIP 的次数，默认为 3\n\n4、EIPBindingRetryIntervalMsWhenUnbound(*)\n\n服务器检查 ip 绑定的时间间隔，单位为毫秒，默认为 1 * 60 * 1000\n\n5、EIPBindingRetryIntervalMs\n\n与上面的是同一作用，仅仅是稳定状态检查，默认为 5 * 60 * 1000\n\n6、EnableSelfPreservation\n\n自我保护模式，当出现出现网络分区、eureka 在短时间内丢失过多客户端时，会进入自我保护模式，即一个服务长时间没有发送心跳，eureka 也不会将其删除，默认为 true\n\n7、RenewalPercentThreshold(*)\n\n![](/images/微服务/952935-20170623150643570-1733575926.png)\n\n阈值因子，默认是 0.85，如果阈值比最小值大，则自我保护模式开启\n\n8、RenewalThresholdUpdateIntervalMs\n\n阈值更新的时间间隔，单位为毫秒，默认为 15 * 60 * 1000\n\n9、PeerEurekaNodesUpdateIntervalMs(*)\n\n集群里 eureka 节点的变化信息更新的时间间隔，单位为毫秒，默认为 10 * 60 * 1000\n\n10、EnableReplicatedRequestCompression\n\n复制的数据在发送请求时是否被压缩，默认为 false\n\n11、NumberOfReplicationRetries\n\n获取集群里服务器尝试复制数据的次数，默认为 5\n\n12、PeerEurekaStatusRefreshTimeIntervalMs\n\n服务器节点的状态信息被更新的时间间隔，单位为毫秒，默认为 30 * 1000\n\n13、WaitTimeInMsWhenSyncEmpty(*)\n\n在 Eureka 服务器获取不到集群里对等服务器上的实例时，需要等待的时间，单位为毫秒，默认为 1000 * 60 * 5\n\n14、PeerNodeConnectTimeoutMs\n\n连接对等节点服务器复制的超时的时间，单位为毫秒，默认为 200\n\n15、PeerNodeReadTimeoutMs\n\n读取对等节点服务器复制的超时的时间，单位为毫秒，默认为 200\n\n16、PeerNodeTotalConnections\n\n获取对等节点上 http 连接的总数，默认为 1000\n\n17、PeerNodeTotalConnectionsPerHost(*)\n\n获取特定的对等节点上 http 连接的总数，默认为 500\n\n18、PeerNodeConnectionIdleTimeoutSeconds(*)\n\nhttp 连接被清理之后服务器的空闲时间，默认为 30 秒\n\n19、RetentionTimeInMSInDeltaQueue(*)\n\n客户端保持增量信息缓存的时间，从而保证不会丢失这些信息，单位为毫秒，默认为 3 * 60 * 1000\n\n20、DeltaRetentionTimerIntervalInMs\n\n清理任务程序被唤醒的时间间隔，清理过期的增量信息，单位为毫秒，默认为 30 * 1000\n\n21、EvictionIntervalTimerInMs\n\n过期实例应该启动并运行的时间间隔，单位为毫秒，默认为 60 * 1000\n\n22、ASGQueryTimeoutMs（*）\n\n查询 AWS 上 ASG（自动缩放组）信息的超时值，单位为毫秒，默认为 300\n\n23、ASGUpdateIntervalMs\n\n从 AWS 上更新 ASG 信息的时间间隔，单位为毫秒，默认为 5 * 60 * 1000\n\n24、ASGCacheExpiryTimeoutMs(*)\n\n缓存 ASG 信息的到期时间，单位为毫秒，默认为 10 * 60 * 1000\n\n25、ResponseCacheAutoExpirationInSeconds（*）\n\n当注册表信息被改变时，则其被保存在缓存中不失效的时间，默认为 180 秒\n\n26、ResponseCacheUpdateIntervalMs（*）\n\n客户端的有效负载缓存应该更新的时间间隔，默认为 30 * 1000 毫秒\n\n27、UseReadOnlyResponseCache（*）\n\n目前采用的是二级缓存策略，一个是读写高速缓存过期策略，另一个没有过期只有只读缓存，默认为 true，表示只读缓存\n\n28、DisableDelta（*）\n\n增量信息是否可以提供给客户端看，默认为 false\n\n29、MaxIdleThreadInMinutesAgeForStatusReplication（*）\n\n状态复制线程可以保持存活的空闲时间，默认为 10 分钟\n\n30、MinThreadsForStatusReplication\n\n被用于状态复制的线程的最小数目，默认为 1\n\n31、MaxThreadsForStatusReplication\n\n被用于状态复制的线程的最大数目，默认为 1\n\n32、MaxElementsInStatusReplicationPool\n\n可允许的状态复制池备份复制事件的最大数量，默认为 10000\n\n33、SyncWhenTimestampDiffers\n\n当时间变化实例是否跟着同步，默认为 true\n\n34、RegistrySyncRetries\n\n当 eureka 服务器启动时尝试去获取集群里其他服务器上的注册信息的次数，默认为 5\n\n35、RegistrySyncRetryWaitMs\n\n当 eureka 服务器启动时获取其他服务器的注册信息失败时，会再次尝试获取，期间需要等待的时间，默认为 30 * 1000 毫秒\n\n36、MaxElementsInPeerReplicationPool（*）\n\n复制池备份复制事件的最大数量，默认为 10000\n\n37、MaxIdleThreadAgeInMinutesForPeerReplication（*）\n\n复制线程可以保持存活的空闲时间，默认为 15 分钟\n\n38、MinThreadsForPeerReplication（*）\n\n获取将被用于复制线程的最小数目，默认为 5\n\n39、MaxThreadsForPeerReplication\n\n获取将被用于复制线程的最大数目，默认为 20\n\n40、MaxTimeForReplication（*）\n\n尝试在丢弃复制事件之前进行复制的时间，默认为 30000 毫秒\n\n41、PrimeAwsReplicaConnections（*）\n\n对集群中服务器节点的连接是否应该准备，默认为 true\n\n42、DisableDeltaForRemoteRegions（*）\n\n增量信息是否可以提供给客户端或一些远程地区，默认为 false\n\n43、RemoteRegionConnectTimeoutMs（*）\n\n连接到对等远程地 eureka 节点的超时时间，默认为 1000 毫秒\n\n44、RemoteRegionReadTimeoutMs（*）\n\n获取从远程地区 eureka 节点读取信息的超时时间，默认为 1000 毫秒\n\n45、RemoteRegionTotalConnections\n\n获取远程地区对等节点上 http 连接的总数，默认为 1000\n\n46、RemoteRegionTotalConnectionsPerHost\n\n获取远程地区特定的对等节点上 http 连接的总数，默认为 500\n\n47、RemoteRegionConnectionIdleTimeoutSeconds\n\nhttp 连接被清理之后远程地区服务器的空闲时间，默认为 30 秒\n\n48、GZipContentFromRemoteRegion（*）\n\neureka 服务器中获取的内容是否在远程地区被压缩，默认为 true\n\n49、RemoteRegionUrlsWithName\n\n针对远程地区发现的网址域名的 map\n\n50、RemoteRegionUrls\n\n远程地区的 URL 列表\n\n51、RemoteRegionAppWhitelist（*）\n\n必须通过远程区域中检索的应用程序的列表\n\n52、RemoteRegionRegistryFetchInterval\n\n从远程区域取出该注册表的信息的时间间隔，默认为 30 秒\n\n53、RemoteRegionFetchThreadPoolSize\n\n用于执行远程区域注册表请求的线程池的大小，默认为 20\n\n54、RemoteRegionTrustStore\n\n用来合格请求远程区域注册表的信任存储文件，默认为空\n\n55、RemoteRegionTrustStorePassword\n\n获取偏远地区信任存储文件的密码，默认为 “changeit”\n\n56、disableTransparentFallbackToOtherRegion(*)\n\n如果在远程区域本地没有实例运行，对于应用程序回退的旧行为是否被禁用， 默认为 false\n\n57、BatchReplication(*)\n\n表示集群节点之间的复制是否为了网络效率而进行批处理，默认为 false\n\n58、LogIdentityHeaders(*)\n\nEureka 服务器是否应该登录 clientAuthHeaders，默认为 true\n\n59、RateLimiterEnabled\n\n限流是否应启用或禁用，默认为 false\n\n60、RateLimiterThrottleStandardClients\n\n是否对标准客户端进行限流，默认 false\n\n61、RateLimiterPrivilegedClients（*）\n\n认证的客户端列表，这里是除了标准的 eureka Java 客户端。\n\n62、RateLimiterBurstSize（*）\n\n速率限制的 burst size ，默认为 10，这里用的是令牌桶算法\n\n63、RateLimiterRegistryFetchAverageRate(*)\n\n速率限制器用的是令牌桶算法，此配置指定平均执行注册请求速率，默认为 500\n\n64、RateLimiterFullFetchAverageRate（*）\n\n速率限制器用的是令牌桶算法，此配置指定平均执行请求速率，默认为 100\n\n65、ListAutoScalingGroupsRoleName（*）\n\n用来描述从 AWS 第三账户的自动缩放组中的角色名称，默认为 “ListAutoScalingGroups”\n\n66、JsonCodecName（*）\n\n如果没有设置默认的编解码器将使用全 JSON 编解码器，获取的是编码器的类名称\n\n67、XmlCodecName(*)\n\n如果没有设置默认的编解码器将使用 xml 编解码器，获取的是编码器的类名称\n\n68、BindingStrategy(*)\n\n获取配置绑定 EIP 或 Route53 的策略。\n\n69、Route53DomainTTL（*）\n\n用于建立 route53 域的 ttl，默认为 301\n\n70、Route53BindRebindRetries（*）\n\n服务器尝试绑定到候选 Route53 域的次数，默认为 3\n\n71、Route53BindingRetryIntervalMs（*）\n\n服务器应该检查是否和 Route53 域绑定的时间间隔，默认为 5 * 60 * 1000 毫秒\n\n72、Experimental(*)\n\n当尝试新功能迁移过程时，为了避免配置 API 污染，相应的配置即可投入实验配置部分，默认为 null\n\n以上是 Eureka 配置项的详细说明，分为 Eureka 客户端配置、Eureka 服务端配置和微服务端配置，一共 100 多项，其中有很多配置参数并不需要我们去修改，使用默认的就好，有些跟我们业务相关的配置参数可根据需要自行设置。\n\n## Eureka配置案例\n\n### 开发环境服务实例及时下线\n\n##### [Eureka自我保护机制](https://www.cnblogs.com/xishuai/p/spring-cloud-eureka-safe.html)\n\nEureka Server 在运行期间会去统计心跳失败比例在 15 分钟之内是否低于 85%，如果低于 85%，Eureka Server 会将这些实例保护起来，让这些实例不会过期，但是在保护期内如果服务刚好这个服务提供者非正常下线了，此时服务消费者就会拿到一个无效的服务实例，此时会调用失败，对于这个问题需要服务消费者端要有一些容错机制，如重试，断路器等。\n\n我们在单机测试的时候很容易满足心跳失败比例在 15 分钟之内低于 85%，这个时候就会触发 Eureka 的保护机制，一旦开启了保护机制，则服务注册中心维护的服务实例就不是那么准确了，此时我们可以使用`eureka.server.enable-self-preservation=false`来关闭保护机制，这样可以确保注册中心中不可用的实例被及时的剔除（**不推荐**）。\n\n自我保护模式被激活的条件是：在 1 分钟后，`Renews (last min) < Renews threshold`。\n\n这两个参数的意思：\n\n- `Renews threshold`：**Eureka Server 期望每分钟收到客户端实例续约的总数**。\n- `Renews (last min)`：**Eureka Server 最后 1 分钟收到客户端实例续约的总数**。\n\n具体的值，我们可以在 Eureka Server 界面可以看到。\n\nRenews threshold 计算代码：\n\n```java\nthis.expectedNumberOfRenewsPerMin = count * 2;\nthis.numberOfRenewsPerMinThreshold = (int) (this.expectedNumberOfRenewsPerMin * serverConfig.getRenewalPercentThreshold());\n```\n\n解决方式有三种：\n\n- 关闭自我保护模式（`eureka.server.enable-self-preservation`设为`false`），**不推荐**。\n- 降低`renewalPercentThreshold`的比例（`eureka.server.renewal-percent-threshold`设置为`0.5`以下，比如`0.49`），**不推荐**。\n- 部署多个 Eureka Server 并开启其客户端行为（`eureka.client.register-with-eureka`不要设为`false`，默认为`true`），**推荐**。\n\nEureka 的自我保护模式是有意义的，该模式被激活后，它不会从注册列表中剔除因长时间没收到心跳导致租期过期的服务，而是等待修复，直到心跳恢复正常之后，它自动退出自我保护模式。这种模式旨在避免因网络分区故障导致服务不可用的问题。例如，两个客户端实例 C1 和 C2 的连通性是良好的，但是由于网络故障，C2 未能及时向 Eureka 发送心跳续约，这时候 Eureka 不能简单的将 C2 从注册表中剔除。因为如果剔除了，C1 就无法从 Eureka 服务器中获取 C2 注册的服务，但是这时候 C2 服务是可用的。\n\n所以，Eureka 的自我保护模式最好还是开启它。\n\n##### 开发环境需要及时快速下线配置\n\n- 服务端配置\n\n  ```yaml\n  eureka:\n    instance:\n      #心跳时间间隔（秒）\n      lease-renewal-interval-in-seconds: 5\n    server:\n      #eureka自我保护机制\n      enable-self-preservation: false\n      #删除失效或下线服务间隔 （毫秒），具体删除时间还要加上心跳时间间隔和等待时间间隔\n      eviction-interval-timer-in-ms: 1000\n  ```\n\n- 客户端配置\n\n  ```yaml\n  eureka:\n    instance:\n    \t#Eureka客户端向服务端发送心跳的时间间隔（秒）（客户端告诉服务端自己会按照该规则）\n      lease-renewal-interval-in-seconds: 3\n      ##Eureka服务端在收到最后一次心跳之后等待的时间上限（秒），超过则剔除（客户端告诉服务端按照此规则等待自己）\n      lease-expiration-duration-in-seconds: 4\n  ```\n","source":"_posts/Eureka配置大全.md","raw":"title: Eureka配置大全\nauthor: Asia Cui\ntags:\n  - Spring Cloud\ncategories:\n  - Eureka\ndate: 2019-01-28 18:28:00\n---\n##  Eureka客户端配置\n\n1、RegistryFetchIntervalSeconds\n\n从 eureka 服务器注册表中获取注册信息的时间间隔（s），默认为 30 秒\n\n2、InstanceInfoReplicationIntervalSeconds\n\n复制实例变化信息到 eureka 服务器所需要的时间间隔（s），默认为 30 秒\n\n3、InitialInstanceInfoReplicationIntervalSeconds\n\n最初复制实例信息到 eureka 服务器所需的时间（s），默认为 40 秒\n\n4、EurekaServiceUrlPollIntervalSeconds\n\n询问 Eureka 服务 url 信息变化的时间间隔（s），默认为 300 秒\n\n5、ProxyHost\n\n获取 eureka 服务的代理主机，默认为 null\n\n6、ProxyProxyPort\n\n获取 eureka 服务的代理端口, 默认为 null \n\n 7、ProxyUserName\n\n获取 eureka 服务的代理用户名，默认为 null\n\n 8、ProxyPassword\n\n获取 eureka 服务的代理密码，默认为 null \n\n 9、GZipContent\n\n eureka 注册表的内容是否被压缩，默认为 true，并且是在最好的网络流量下被压缩\n\n10、EurekaServerReadTimeoutSeconds\n\neureka 需要超时读取之前需要等待的时间，默认为 8 秒\n\n11、EurekaServerConnectTimeoutSeconds\n\neureka 需要超时连接之前需要等待的时间，默认为 5 秒\n\n12、BackupRegistryImpl\n\n获取实现了 eureka 客户端在第一次启动时读取注册表的信息作为回退选项的实现名称\n\n13、EurekaServerTotalConnections\n\n eureka 客户端允许所有 eureka 服务器连接的总数目，默认是 200\n\n 14、EurekaServerTotalConnectionsPerHost\n\n eureka 客户端允许 eureka 服务器主机连接的总数目，默认是 50\n\n 15、EurekaServerURLContext\n\n表示 eureka 注册中心的路径，如果配置为 eureka，则为 http://x.x.x.x:x/eureka/，在 eureka 的配置文件中加入此配置表示 eureka 作为客户端向注册中心注册，从而构成 eureka 集群。此配置只有在 eureka 服务器 ip 地址列表是在 DNS 中才会用到，默认为 null\n\n16、EurekaServerPort\n\n获取 eureka 服务器的端口，此配置只有在 eureka 服务器 ip 地址列表是在 DNS 中才会用到。默认为 null\n\n17、EurekaServerDNSName\n\n获取要查询的 DNS 名称来获得 eureka 服务器，此配置只有在 eureka 服务器 ip 地址列表是在 DNS 中才会用到。默认为 null\n\n18、UseDnsForFetchingServiceUrls\n\neureka 客户端是否应该使用 DNS 机制来获取 eureka 服务器的地址列表，默认为 false\n\n19、RegisterWithEureka\n\n实例是否在 eureka 服务器上注册自己的信息以供其他服务发现，默认为 true\n\n20、PreferSameZoneEureka\n\n实例是否使用同一 zone 里的 eureka 服务器，默认为 true，理想状态下，eureka 客户端与服务端是在同一 zone 下\n\n21、AllowRedirects\n\n服务器是否能够重定向客户端请求到备份服务器。 如果设置为 false，服务器将直接处理请求，如果设置为 true，它可能发送 HTTP 重定向到客户端。默认为 false\n\n22、LogDeltaDiff\n\n是否记录 eureka 服务器和客户端之间在注册表的信息方面的差异，默认为 false\n\n23、DisableDelta(*)\n\n默认为 false\n\n24、fetchRegistryForRemoteRegions\n\neureka服务注册表信息里的以逗号隔开的地区名单，如果不这样返回这些地区名单，则客户端启动将会出错。默认为 null\n\n25、Region\n\n获取实例所在的地区。默认为 us-east-1\n\n26、AvailabilityZones\n\n获取实例所在的地区下可用性的区域列表，用逗号隔开。\n\n27、EurekaServerServiceUrls\n\nEureka 服务器的连接，默认为 http：//XXXX：X/eureka/, 但是如果采用 DNS方式获取服务地址，则不需要配置此设置。\n\n28、FilterOnlyUpInstances（*）\n\n是否获得处于开启状态的实例的应用程序过滤之后的应用程序。默认为 true\n\n29、EurekaConnectionIdleTimeoutSeconds\n\nEureka 服务的 http 请求关闭之前其响应的时间，默认为 30 秒\n\n30、FetchRegistry\n\n此客户端是否获取 eureka 服务器注册表上的注册信息，默认为 true\n\n31、RegistryRefreshSingleVipAddress\n\n此客户端只对一个单一的 VIP 注册表的信息感兴趣。默认为 null\n\n32、HeartbeatExecutorThreadPoolSize(*)\n\n心跳执行程序线程池的大小, 默认为 5\n\n33、HeartbeatExecutorExponentialBackOffBound(*)\n\n心跳执行程序回退相关的属性，是重试延迟的最大倍数值，默认为 10\n\n34、CacheRefreshExecutorThreadPoolSize(*)\n\n执行程序缓存刷新线程池的大小，默认为 5\n\n35、CacheRefreshExecutorExponentialBackOffBound\n\n执行程序指数回退刷新的相关属性，是重试延迟的最大倍数值，默认为 10\n\n36、DollarReplacement\n\neureka 服务器序列化 / 反序列化的信息中获取 “$” 符号的的替换字符串。默认为 “_-”\n\n37、EscapeCharReplacement\n\neureka 服务器序列化 / 反序列化的信息中获取 “_” 符号的的替换字符串。默认为 “__”\n\n38、OnDemandUpdateStatusChange（*）\n\n如果设置为 true, 客户端的状态更新将会点播更新到远程服务器上，默认为 true\n\n39、EncoderName\n\n这是一个短暂的编码器的配置，如果最新的编码器是稳定的，则可以去除，默认为 null\n\n40、DecoderName\n\n这是一个短暂的解码器的配置，如果最新的解码器是稳定的，则可以去除，默认为 null\n\n41、ClientDataAccept（*）\n\n客户端数据接收\n\n42、Experimental（*）\n\n当尝试新功能迁移过程时，为了避免配置 API 污染，相应的配置即可投入实验配置部分，默认为 null\n\n##  Eureka微服务端配置\n\n1、InstanceId\n\n此实例注册到 eureka 服务端的唯一的实例 ID, 其组成为 、`${spring.application.name}:${spring.application.instance_id:${random.value}}`\n\n2、Appname\n\n获得在 eureka 服务上注册的应用程序的名字，默认为 unknow\n\n3、AppGroupName\n\n获得在 eureka 服务上注册的应用程序组的名字，默认为 unknow\n\n4、InstanceEnabledOnit（*）\n\n实例注册到 eureka 服务器时，是否开启通讯，默认为 false\n\n5、NonSecurePort\n\n获取该实例应该接收通信的非安全端口。默认为 80\n\n6、SecurePort\n\n获取该实例应该接收通信的安全端口，默认为 443\n\n7、NonSecurePortEnabled\n\n该实例应该接收通信的非安全端口是否启用，默认为 true\n\n8、SecurePortEnabled\n\n该实例应该接收通信的安全端口是否启用，默认为 false\n\n9、LeaseRenewalIntervalInSeconds\n\neureka 客户需要多长时间发送心跳给 eureka 服务器，表明它仍然活着, 默认为 30 秒\n\n10、LeaseExpirationDurationInSeconds\n\nEureka 服务器在接收到实例的最后一次发出的心跳后，需要等待多久才可以将此实例删除，默认为 90 秒\n\n11、VirtualHostName\n\n此实例定义的虚拟主机名，其他实例将通过使用虚拟主机名找到该实例。\n\n12、SecureVirtualHostName\n\n此实例定义的安全虚拟主机名\n\n13、ASGName（*）\n\n与此实例相关联 AWS 自动缩放组名称。此项配置是在 AWS环境专门使用的实例启动，它已被用于流量停用后自动把一个实例退出服务。\n\n14、HostName\n\n与此实例相关联的主机名，是其他实例可以用来进行请求的准确名称\n\n15、MetadataMap(*)\n\n获取与此实例相关联的元数据 (key,value)。这个信息被发送到 eureka 服务器，其他实例可以使用。\n\n16、DataCenterInfo（*）\n\n该实例被部署在数据中心\n\n17、IpAddress\n\n获取实例的 ip 地址\n\n18、StatusPageUrlPath（*）\n\n获取此实例状态页的 URL 路径，然后构造出主机名，安全端口等，默认为 /info\n\n19、StatusPageUrl(*)\n\n获取此实例绝对状态页的 URL 路径，为其他服务提供信息时来找到这个实例的状态的路径，默认为 null\n\n20、HomePageUrlPath（*）\n\n获取此实例的相关主页 URL 路径，然后构造出主机名，安全端口等，默认为 /\n\n21、HomePageUrl(*)\n\n获取此实例的绝对主页 URL 路径，为其他服务提供信息时使用的路径, 默认为 null\n\n22、HealthCheckUrlPath\n\n获取此实例的相对健康检查 URL 路径，默认为 /health\n\n23、HealthCheckUrl\n\n获取此实例的绝对健康检查 URL 路径, 默认为 null\n\n24、SecureHealthCheckUrl\n\n获取此实例的绝对安全健康检查网页的 URL 路径，默认为 null\n\n25、DefaultAddressResolutionOrder\n\n获取实例的网络地址，默认为 []\n\n26、Namespace\n\n获取用于查找属性的命名空间，默认为 eureka\n\nEureka服务端配置\n\n1、AWSAccessId\n\n获取 aws 访问的 id，主要用于弹性 ip 绑定，此配置是用于 aws 上的，默认为 null\n\n2、AWSSecretKey\n\n获取 aws 私有秘钥，主要用于弹性 ip 绑定，此配置是用于 aws 上的，默认为 null\n\n3、EIPBindRebindRetries\n\n获取服务器尝试绑定到候选的 EIP 的次数，默认为 3\n\n4、EIPBindingRetryIntervalMsWhenUnbound(*)\n\n服务器检查 ip 绑定的时间间隔，单位为毫秒，默认为 1 * 60 * 1000\n\n5、EIPBindingRetryIntervalMs\n\n与上面的是同一作用，仅仅是稳定状态检查，默认为 5 * 60 * 1000\n\n6、EnableSelfPreservation\n\n自我保护模式，当出现出现网络分区、eureka 在短时间内丢失过多客户端时，会进入自我保护模式，即一个服务长时间没有发送心跳，eureka 也不会将其删除，默认为 true\n\n7、RenewalPercentThreshold(*)\n\n![](/images/微服务/952935-20170623150643570-1733575926.png)\n\n阈值因子，默认是 0.85，如果阈值比最小值大，则自我保护模式开启\n\n8、RenewalThresholdUpdateIntervalMs\n\n阈值更新的时间间隔，单位为毫秒，默认为 15 * 60 * 1000\n\n9、PeerEurekaNodesUpdateIntervalMs(*)\n\n集群里 eureka 节点的变化信息更新的时间间隔，单位为毫秒，默认为 10 * 60 * 1000\n\n10、EnableReplicatedRequestCompression\n\n复制的数据在发送请求时是否被压缩，默认为 false\n\n11、NumberOfReplicationRetries\n\n获取集群里服务器尝试复制数据的次数，默认为 5\n\n12、PeerEurekaStatusRefreshTimeIntervalMs\n\n服务器节点的状态信息被更新的时间间隔，单位为毫秒，默认为 30 * 1000\n\n13、WaitTimeInMsWhenSyncEmpty(*)\n\n在 Eureka 服务器获取不到集群里对等服务器上的实例时，需要等待的时间，单位为毫秒，默认为 1000 * 60 * 5\n\n14、PeerNodeConnectTimeoutMs\n\n连接对等节点服务器复制的超时的时间，单位为毫秒，默认为 200\n\n15、PeerNodeReadTimeoutMs\n\n读取对等节点服务器复制的超时的时间，单位为毫秒，默认为 200\n\n16、PeerNodeTotalConnections\n\n获取对等节点上 http 连接的总数，默认为 1000\n\n17、PeerNodeTotalConnectionsPerHost(*)\n\n获取特定的对等节点上 http 连接的总数，默认为 500\n\n18、PeerNodeConnectionIdleTimeoutSeconds(*)\n\nhttp 连接被清理之后服务器的空闲时间，默认为 30 秒\n\n19、RetentionTimeInMSInDeltaQueue(*)\n\n客户端保持增量信息缓存的时间，从而保证不会丢失这些信息，单位为毫秒，默认为 3 * 60 * 1000\n\n20、DeltaRetentionTimerIntervalInMs\n\n清理任务程序被唤醒的时间间隔，清理过期的增量信息，单位为毫秒，默认为 30 * 1000\n\n21、EvictionIntervalTimerInMs\n\n过期实例应该启动并运行的时间间隔，单位为毫秒，默认为 60 * 1000\n\n22、ASGQueryTimeoutMs（*）\n\n查询 AWS 上 ASG（自动缩放组）信息的超时值，单位为毫秒，默认为 300\n\n23、ASGUpdateIntervalMs\n\n从 AWS 上更新 ASG 信息的时间间隔，单位为毫秒，默认为 5 * 60 * 1000\n\n24、ASGCacheExpiryTimeoutMs(*)\n\n缓存 ASG 信息的到期时间，单位为毫秒，默认为 10 * 60 * 1000\n\n25、ResponseCacheAutoExpirationInSeconds（*）\n\n当注册表信息被改变时，则其被保存在缓存中不失效的时间，默认为 180 秒\n\n26、ResponseCacheUpdateIntervalMs（*）\n\n客户端的有效负载缓存应该更新的时间间隔，默认为 30 * 1000 毫秒\n\n27、UseReadOnlyResponseCache（*）\n\n目前采用的是二级缓存策略，一个是读写高速缓存过期策略，另一个没有过期只有只读缓存，默认为 true，表示只读缓存\n\n28、DisableDelta（*）\n\n增量信息是否可以提供给客户端看，默认为 false\n\n29、MaxIdleThreadInMinutesAgeForStatusReplication（*）\n\n状态复制线程可以保持存活的空闲时间，默认为 10 分钟\n\n30、MinThreadsForStatusReplication\n\n被用于状态复制的线程的最小数目，默认为 1\n\n31、MaxThreadsForStatusReplication\n\n被用于状态复制的线程的最大数目，默认为 1\n\n32、MaxElementsInStatusReplicationPool\n\n可允许的状态复制池备份复制事件的最大数量，默认为 10000\n\n33、SyncWhenTimestampDiffers\n\n当时间变化实例是否跟着同步，默认为 true\n\n34、RegistrySyncRetries\n\n当 eureka 服务器启动时尝试去获取集群里其他服务器上的注册信息的次数，默认为 5\n\n35、RegistrySyncRetryWaitMs\n\n当 eureka 服务器启动时获取其他服务器的注册信息失败时，会再次尝试获取，期间需要等待的时间，默认为 30 * 1000 毫秒\n\n36、MaxElementsInPeerReplicationPool（*）\n\n复制池备份复制事件的最大数量，默认为 10000\n\n37、MaxIdleThreadAgeInMinutesForPeerReplication（*）\n\n复制线程可以保持存活的空闲时间，默认为 15 分钟\n\n38、MinThreadsForPeerReplication（*）\n\n获取将被用于复制线程的最小数目，默认为 5\n\n39、MaxThreadsForPeerReplication\n\n获取将被用于复制线程的最大数目，默认为 20\n\n40、MaxTimeForReplication（*）\n\n尝试在丢弃复制事件之前进行复制的时间，默认为 30000 毫秒\n\n41、PrimeAwsReplicaConnections（*）\n\n对集群中服务器节点的连接是否应该准备，默认为 true\n\n42、DisableDeltaForRemoteRegions（*）\n\n增量信息是否可以提供给客户端或一些远程地区，默认为 false\n\n43、RemoteRegionConnectTimeoutMs（*）\n\n连接到对等远程地 eureka 节点的超时时间，默认为 1000 毫秒\n\n44、RemoteRegionReadTimeoutMs（*）\n\n获取从远程地区 eureka 节点读取信息的超时时间，默认为 1000 毫秒\n\n45、RemoteRegionTotalConnections\n\n获取远程地区对等节点上 http 连接的总数，默认为 1000\n\n46、RemoteRegionTotalConnectionsPerHost\n\n获取远程地区特定的对等节点上 http 连接的总数，默认为 500\n\n47、RemoteRegionConnectionIdleTimeoutSeconds\n\nhttp 连接被清理之后远程地区服务器的空闲时间，默认为 30 秒\n\n48、GZipContentFromRemoteRegion（*）\n\neureka 服务器中获取的内容是否在远程地区被压缩，默认为 true\n\n49、RemoteRegionUrlsWithName\n\n针对远程地区发现的网址域名的 map\n\n50、RemoteRegionUrls\n\n远程地区的 URL 列表\n\n51、RemoteRegionAppWhitelist（*）\n\n必须通过远程区域中检索的应用程序的列表\n\n52、RemoteRegionRegistryFetchInterval\n\n从远程区域取出该注册表的信息的时间间隔，默认为 30 秒\n\n53、RemoteRegionFetchThreadPoolSize\n\n用于执行远程区域注册表请求的线程池的大小，默认为 20\n\n54、RemoteRegionTrustStore\n\n用来合格请求远程区域注册表的信任存储文件，默认为空\n\n55、RemoteRegionTrustStorePassword\n\n获取偏远地区信任存储文件的密码，默认为 “changeit”\n\n56、disableTransparentFallbackToOtherRegion(*)\n\n如果在远程区域本地没有实例运行，对于应用程序回退的旧行为是否被禁用， 默认为 false\n\n57、BatchReplication(*)\n\n表示集群节点之间的复制是否为了网络效率而进行批处理，默认为 false\n\n58、LogIdentityHeaders(*)\n\nEureka 服务器是否应该登录 clientAuthHeaders，默认为 true\n\n59、RateLimiterEnabled\n\n限流是否应启用或禁用，默认为 false\n\n60、RateLimiterThrottleStandardClients\n\n是否对标准客户端进行限流，默认 false\n\n61、RateLimiterPrivilegedClients（*）\n\n认证的客户端列表，这里是除了标准的 eureka Java 客户端。\n\n62、RateLimiterBurstSize（*）\n\n速率限制的 burst size ，默认为 10，这里用的是令牌桶算法\n\n63、RateLimiterRegistryFetchAverageRate(*)\n\n速率限制器用的是令牌桶算法，此配置指定平均执行注册请求速率，默认为 500\n\n64、RateLimiterFullFetchAverageRate（*）\n\n速率限制器用的是令牌桶算法，此配置指定平均执行请求速率，默认为 100\n\n65、ListAutoScalingGroupsRoleName（*）\n\n用来描述从 AWS 第三账户的自动缩放组中的角色名称，默认为 “ListAutoScalingGroups”\n\n66、JsonCodecName（*）\n\n如果没有设置默认的编解码器将使用全 JSON 编解码器，获取的是编码器的类名称\n\n67、XmlCodecName(*)\n\n如果没有设置默认的编解码器将使用 xml 编解码器，获取的是编码器的类名称\n\n68、BindingStrategy(*)\n\n获取配置绑定 EIP 或 Route53 的策略。\n\n69、Route53DomainTTL（*）\n\n用于建立 route53 域的 ttl，默认为 301\n\n70、Route53BindRebindRetries（*）\n\n服务器尝试绑定到候选 Route53 域的次数，默认为 3\n\n71、Route53BindingRetryIntervalMs（*）\n\n服务器应该检查是否和 Route53 域绑定的时间间隔，默认为 5 * 60 * 1000 毫秒\n\n72、Experimental(*)\n\n当尝试新功能迁移过程时，为了避免配置 API 污染，相应的配置即可投入实验配置部分，默认为 null\n\n以上是 Eureka 配置项的详细说明，分为 Eureka 客户端配置、Eureka 服务端配置和微服务端配置，一共 100 多项，其中有很多配置参数并不需要我们去修改，使用默认的就好，有些跟我们业务相关的配置参数可根据需要自行设置。\n\n## Eureka配置案例\n\n### 开发环境服务实例及时下线\n\n##### [Eureka自我保护机制](https://www.cnblogs.com/xishuai/p/spring-cloud-eureka-safe.html)\n\nEureka Server 在运行期间会去统计心跳失败比例在 15 分钟之内是否低于 85%，如果低于 85%，Eureka Server 会将这些实例保护起来，让这些实例不会过期，但是在保护期内如果服务刚好这个服务提供者非正常下线了，此时服务消费者就会拿到一个无效的服务实例，此时会调用失败，对于这个问题需要服务消费者端要有一些容错机制，如重试，断路器等。\n\n我们在单机测试的时候很容易满足心跳失败比例在 15 分钟之内低于 85%，这个时候就会触发 Eureka 的保护机制，一旦开启了保护机制，则服务注册中心维护的服务实例就不是那么准确了，此时我们可以使用`eureka.server.enable-self-preservation=false`来关闭保护机制，这样可以确保注册中心中不可用的实例被及时的剔除（**不推荐**）。\n\n自我保护模式被激活的条件是：在 1 分钟后，`Renews (last min) < Renews threshold`。\n\n这两个参数的意思：\n\n- `Renews threshold`：**Eureka Server 期望每分钟收到客户端实例续约的总数**。\n- `Renews (last min)`：**Eureka Server 最后 1 分钟收到客户端实例续约的总数**。\n\n具体的值，我们可以在 Eureka Server 界面可以看到。\n\nRenews threshold 计算代码：\n\n```java\nthis.expectedNumberOfRenewsPerMin = count * 2;\nthis.numberOfRenewsPerMinThreshold = (int) (this.expectedNumberOfRenewsPerMin * serverConfig.getRenewalPercentThreshold());\n```\n\n解决方式有三种：\n\n- 关闭自我保护模式（`eureka.server.enable-self-preservation`设为`false`），**不推荐**。\n- 降低`renewalPercentThreshold`的比例（`eureka.server.renewal-percent-threshold`设置为`0.5`以下，比如`0.49`），**不推荐**。\n- 部署多个 Eureka Server 并开启其客户端行为（`eureka.client.register-with-eureka`不要设为`false`，默认为`true`），**推荐**。\n\nEureka 的自我保护模式是有意义的，该模式被激活后，它不会从注册列表中剔除因长时间没收到心跳导致租期过期的服务，而是等待修复，直到心跳恢复正常之后，它自动退出自我保护模式。这种模式旨在避免因网络分区故障导致服务不可用的问题。例如，两个客户端实例 C1 和 C2 的连通性是良好的，但是由于网络故障，C2 未能及时向 Eureka 发送心跳续约，这时候 Eureka 不能简单的将 C2 从注册表中剔除。因为如果剔除了，C1 就无法从 Eureka 服务器中获取 C2 注册的服务，但是这时候 C2 服务是可用的。\n\n所以，Eureka 的自我保护模式最好还是开启它。\n\n##### 开发环境需要及时快速下线配置\n\n- 服务端配置\n\n  ```yaml\n  eureka:\n    instance:\n      #心跳时间间隔（秒）\n      lease-renewal-interval-in-seconds: 5\n    server:\n      #eureka自我保护机制\n      enable-self-preservation: false\n      #删除失效或下线服务间隔 （毫秒），具体删除时间还要加上心跳时间间隔和等待时间间隔\n      eviction-interval-timer-in-ms: 1000\n  ```\n\n- 客户端配置\n\n  ```yaml\n  eureka:\n    instance:\n    \t#Eureka客户端向服务端发送心跳的时间间隔（秒）（客户端告诉服务端自己会按照该规则）\n      lease-renewal-interval-in-seconds: 3\n      ##Eureka服务端在收到最后一次心跳之后等待的时间上限（秒），超过则剔除（客户端告诉服务端按照此规则等待自己）\n      lease-expiration-duration-in-seconds: 4\n  ```\n","slug":"Eureka配置大全","published":1,"updated":"2019-01-29T06:35:53.236Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjs17mi1p003npwgt9ft1w5o4","content":"<h2 id=\"Eureka客户端配置\"><a href=\"#Eureka客户端配置\" class=\"headerlink\" title=\"Eureka客户端配置\"></a>Eureka客户端配置</h2><p>1、RegistryFetchIntervalSeconds</p>\n<p>从 eureka 服务器注册表中获取注册信息的时间间隔（s），默认为 30 秒</p>\n<p>2、InstanceInfoReplicationIntervalSeconds</p>\n<p>复制实例变化信息到 eureka 服务器所需要的时间间隔（s），默认为 30 秒</p>\n<p>3、InitialInstanceInfoReplicationIntervalSeconds</p>\n<p>最初复制实例信息到 eureka 服务器所需的时间（s），默认为 40 秒</p>\n<p>4、EurekaServiceUrlPollIntervalSeconds</p>\n<p>询问 Eureka 服务 url 信息变化的时间间隔（s），默认为 300 秒</p>\n<p>5、ProxyHost</p>\n<p>获取 eureka 服务的代理主机，默认为 null</p>\n<p>6、ProxyProxyPort</p>\n<p>获取 eureka 服务的代理端口, 默认为 null </p>\n<p> 7、ProxyUserName</p>\n<p>获取 eureka 服务的代理用户名，默认为 null</p>\n<p> 8、ProxyPassword</p>\n<p>获取 eureka 服务的代理密码，默认为 null </p>\n<p> 9、GZipContent</p>\n<p> eureka 注册表的内容是否被压缩，默认为 true，并且是在最好的网络流量下被压缩</p>\n<p>10、EurekaServerReadTimeoutSeconds</p>\n<p>eureka 需要超时读取之前需要等待的时间，默认为 8 秒</p>\n<p>11、EurekaServerConnectTimeoutSeconds</p>\n<p>eureka 需要超时连接之前需要等待的时间，默认为 5 秒</p>\n<p>12、BackupRegistryImpl</p>\n<p>获取实现了 eureka 客户端在第一次启动时读取注册表的信息作为回退选项的实现名称</p>\n<p>13、EurekaServerTotalConnections</p>\n<p> eureka 客户端允许所有 eureka 服务器连接的总数目，默认是 200</p>\n<p> 14、EurekaServerTotalConnectionsPerHost</p>\n<p> eureka 客户端允许 eureka 服务器主机连接的总数目，默认是 50</p>\n<p> 15、EurekaServerURLContext</p>\n<p>表示 eureka 注册中心的路径，如果配置为 eureka，则为 <a href=\"http://x.x.x.x:x/eureka/，在\" target=\"_blank\" rel=\"noopener\">http://x.x.x.x:x/eureka/，在</a> eureka 的配置文件中加入此配置表示 eureka 作为客户端向注册中心注册，从而构成 eureka 集群。此配置只有在 eureka 服务器 ip 地址列表是在 DNS 中才会用到，默认为 null</p>\n<p>16、EurekaServerPort</p>\n<p>获取 eureka 服务器的端口，此配置只有在 eureka 服务器 ip 地址列表是在 DNS 中才会用到。默认为 null</p>\n<p>17、EurekaServerDNSName</p>\n<p>获取要查询的 DNS 名称来获得 eureka 服务器，此配置只有在 eureka 服务器 ip 地址列表是在 DNS 中才会用到。默认为 null</p>\n<p>18、UseDnsForFetchingServiceUrls</p>\n<p>eureka 客户端是否应该使用 DNS 机制来获取 eureka 服务器的地址列表，默认为 false</p>\n<p>19、RegisterWithEureka</p>\n<p>实例是否在 eureka 服务器上注册自己的信息以供其他服务发现，默认为 true</p>\n<p>20、PreferSameZoneEureka</p>\n<p>实例是否使用同一 zone 里的 eureka 服务器，默认为 true，理想状态下，eureka 客户端与服务端是在同一 zone 下</p>\n<p>21、AllowRedirects</p>\n<p>服务器是否能够重定向客户端请求到备份服务器。 如果设置为 false，服务器将直接处理请求，如果设置为 true，它可能发送 HTTP 重定向到客户端。默认为 false</p>\n<p>22、LogDeltaDiff</p>\n<p>是否记录 eureka 服务器和客户端之间在注册表的信息方面的差异，默认为 false</p>\n<p>23、DisableDelta(*)</p>\n<p>默认为 false</p>\n<p>24、fetchRegistryForRemoteRegions</p>\n<p>eureka服务注册表信息里的以逗号隔开的地区名单，如果不这样返回这些地区名单，则客户端启动将会出错。默认为 null</p>\n<p>25、Region</p>\n<p>获取实例所在的地区。默认为 us-east-1</p>\n<p>26、AvailabilityZones</p>\n<p>获取实例所在的地区下可用性的区域列表，用逗号隔开。</p>\n<p>27、EurekaServerServiceUrls</p>\n<p>Eureka 服务器的连接，默认为 http：//XXXX：X/eureka/, 但是如果采用 DNS方式获取服务地址，则不需要配置此设置。</p>\n<p>28、FilterOnlyUpInstances（*）</p>\n<p>是否获得处于开启状态的实例的应用程序过滤之后的应用程序。默认为 true</p>\n<p>29、EurekaConnectionIdleTimeoutSeconds</p>\n<p>Eureka 服务的 http 请求关闭之前其响应的时间，默认为 30 秒</p>\n<p>30、FetchRegistry</p>\n<p>此客户端是否获取 eureka 服务器注册表上的注册信息，默认为 true</p>\n<p>31、RegistryRefreshSingleVipAddress</p>\n<p>此客户端只对一个单一的 VIP 注册表的信息感兴趣。默认为 null</p>\n<p>32、HeartbeatExecutorThreadPoolSize(*)</p>\n<p>心跳执行程序线程池的大小, 默认为 5</p>\n<p>33、HeartbeatExecutorExponentialBackOffBound(*)</p>\n<p>心跳执行程序回退相关的属性，是重试延迟的最大倍数值，默认为 10</p>\n<p>34、CacheRefreshExecutorThreadPoolSize(*)</p>\n<p>执行程序缓存刷新线程池的大小，默认为 5</p>\n<p>35、CacheRefreshExecutorExponentialBackOffBound</p>\n<p>执行程序指数回退刷新的相关属性，是重试延迟的最大倍数值，默认为 10</p>\n<p>36、DollarReplacement</p>\n<p>eureka 服务器序列化 / 反序列化的信息中获取 “$” 符号的的替换字符串。默认为 “_-”</p>\n<p>37、EscapeCharReplacement</p>\n<p>eureka 服务器序列化 / 反序列化的信息中获取 “_” 符号的的替换字符串。默认为 “__”</p>\n<p>38、OnDemandUpdateStatusChange（*）</p>\n<p>如果设置为 true, 客户端的状态更新将会点播更新到远程服务器上，默认为 true</p>\n<p>39、EncoderName</p>\n<p>这是一个短暂的编码器的配置，如果最新的编码器是稳定的，则可以去除，默认为 null</p>\n<p>40、DecoderName</p>\n<p>这是一个短暂的解码器的配置，如果最新的解码器是稳定的，则可以去除，默认为 null</p>\n<p>41、ClientDataAccept（*）</p>\n<p>客户端数据接收</p>\n<p>42、Experimental（*）</p>\n<p>当尝试新功能迁移过程时，为了避免配置 API 污染，相应的配置即可投入实验配置部分，默认为 null</p>\n<h2 id=\"Eureka微服务端配置\"><a href=\"#Eureka微服务端配置\" class=\"headerlink\" title=\"Eureka微服务端配置\"></a>Eureka微服务端配置</h2><p>1、InstanceId</p>\n<p>此实例注册到 eureka 服务端的唯一的实例 ID, 其组成为 、<code>${spring.application.name}:${spring.application.instance_id:${random.value}}</code></p>\n<p>2、Appname</p>\n<p>获得在 eureka 服务上注册的应用程序的名字，默认为 unknow</p>\n<p>3、AppGroupName</p>\n<p>获得在 eureka 服务上注册的应用程序组的名字，默认为 unknow</p>\n<p>4、InstanceEnabledOnit（*）</p>\n<p>实例注册到 eureka 服务器时，是否开启通讯，默认为 false</p>\n<p>5、NonSecurePort</p>\n<p>获取该实例应该接收通信的非安全端口。默认为 80</p>\n<p>6、SecurePort</p>\n<p>获取该实例应该接收通信的安全端口，默认为 443</p>\n<p>7、NonSecurePortEnabled</p>\n<p>该实例应该接收通信的非安全端口是否启用，默认为 true</p>\n<p>8、SecurePortEnabled</p>\n<p>该实例应该接收通信的安全端口是否启用，默认为 false</p>\n<p>9、LeaseRenewalIntervalInSeconds</p>\n<p>eureka 客户需要多长时间发送心跳给 eureka 服务器，表明它仍然活着, 默认为 30 秒</p>\n<p>10、LeaseExpirationDurationInSeconds</p>\n<p>Eureka 服务器在接收到实例的最后一次发出的心跳后，需要等待多久才可以将此实例删除，默认为 90 秒</p>\n<p>11、VirtualHostName</p>\n<p>此实例定义的虚拟主机名，其他实例将通过使用虚拟主机名找到该实例。</p>\n<p>12、SecureVirtualHostName</p>\n<p>此实例定义的安全虚拟主机名</p>\n<p>13、ASGName（*）</p>\n<p>与此实例相关联 AWS 自动缩放组名称。此项配置是在 AWS环境专门使用的实例启动，它已被用于流量停用后自动把一个实例退出服务。</p>\n<p>14、HostName</p>\n<p>与此实例相关联的主机名，是其他实例可以用来进行请求的准确名称</p>\n<p>15、MetadataMap(*)</p>\n<p>获取与此实例相关联的元数据 (key,value)。这个信息被发送到 eureka 服务器，其他实例可以使用。</p>\n<p>16、DataCenterInfo（*）</p>\n<p>该实例被部署在数据中心</p>\n<p>17、IpAddress</p>\n<p>获取实例的 ip 地址</p>\n<p>18、StatusPageUrlPath（*）</p>\n<p>获取此实例状态页的 URL 路径，然后构造出主机名，安全端口等，默认为 /info</p>\n<p>19、StatusPageUrl(*)</p>\n<p>获取此实例绝对状态页的 URL 路径，为其他服务提供信息时来找到这个实例的状态的路径，默认为 null</p>\n<p>20、HomePageUrlPath（*）</p>\n<p>获取此实例的相关主页 URL 路径，然后构造出主机名，安全端口等，默认为 /</p>\n<p>21、HomePageUrl(*)</p>\n<p>获取此实例的绝对主页 URL 路径，为其他服务提供信息时使用的路径, 默认为 null</p>\n<p>22、HealthCheckUrlPath</p>\n<p>获取此实例的相对健康检查 URL 路径，默认为 /health</p>\n<p>23、HealthCheckUrl</p>\n<p>获取此实例的绝对健康检查 URL 路径, 默认为 null</p>\n<p>24、SecureHealthCheckUrl</p>\n<p>获取此实例的绝对安全健康检查网页的 URL 路径，默认为 null</p>\n<p>25、DefaultAddressResolutionOrder</p>\n<p>获取实例的网络地址，默认为 []</p>\n<p>26、Namespace</p>\n<p>获取用于查找属性的命名空间，默认为 eureka</p>\n<p>Eureka服务端配置</p>\n<p>1、AWSAccessId</p>\n<p>获取 aws 访问的 id，主要用于弹性 ip 绑定，此配置是用于 aws 上的，默认为 null</p>\n<p>2、AWSSecretKey</p>\n<p>获取 aws 私有秘钥，主要用于弹性 ip 绑定，此配置是用于 aws 上的，默认为 null</p>\n<p>3、EIPBindRebindRetries</p>\n<p>获取服务器尝试绑定到候选的 EIP 的次数，默认为 3</p>\n<p>4、EIPBindingRetryIntervalMsWhenUnbound(*)</p>\n<p>服务器检查 ip 绑定的时间间隔，单位为毫秒，默认为 1 <em> 60 </em> 1000</p>\n<p>5、EIPBindingRetryIntervalMs</p>\n<p>与上面的是同一作用，仅仅是稳定状态检查，默认为 5 <em> 60 </em> 1000</p>\n<p>6、EnableSelfPreservation</p>\n<p>自我保护模式，当出现出现网络分区、eureka 在短时间内丢失过多客户端时，会进入自我保护模式，即一个服务长时间没有发送心跳，eureka 也不会将其删除，默认为 true</p>\n<p>7、RenewalPercentThreshold(*)</p>\n<p><img src=\"/images/微服务/952935-20170623150643570-1733575926.png\" alt=\"\"></p>\n<p>阈值因子，默认是 0.85，如果阈值比最小值大，则自我保护模式开启</p>\n<p>8、RenewalThresholdUpdateIntervalMs</p>\n<p>阈值更新的时间间隔，单位为毫秒，默认为 15 <em> 60 </em> 1000</p>\n<p>9、PeerEurekaNodesUpdateIntervalMs(*)</p>\n<p>集群里 eureka 节点的变化信息更新的时间间隔，单位为毫秒，默认为 10 <em> 60 </em> 1000</p>\n<p>10、EnableReplicatedRequestCompression</p>\n<p>复制的数据在发送请求时是否被压缩，默认为 false</p>\n<p>11、NumberOfReplicationRetries</p>\n<p>获取集群里服务器尝试复制数据的次数，默认为 5</p>\n<p>12、PeerEurekaStatusRefreshTimeIntervalMs</p>\n<p>服务器节点的状态信息被更新的时间间隔，单位为毫秒，默认为 30 * 1000</p>\n<p>13、WaitTimeInMsWhenSyncEmpty(*)</p>\n<p>在 Eureka 服务器获取不到集群里对等服务器上的实例时，需要等待的时间，单位为毫秒，默认为 1000 <em> 60 </em> 5</p>\n<p>14、PeerNodeConnectTimeoutMs</p>\n<p>连接对等节点服务器复制的超时的时间，单位为毫秒，默认为 200</p>\n<p>15、PeerNodeReadTimeoutMs</p>\n<p>读取对等节点服务器复制的超时的时间，单位为毫秒，默认为 200</p>\n<p>16、PeerNodeTotalConnections</p>\n<p>获取对等节点上 http 连接的总数，默认为 1000</p>\n<p>17、PeerNodeTotalConnectionsPerHost(*)</p>\n<p>获取特定的对等节点上 http 连接的总数，默认为 500</p>\n<p>18、PeerNodeConnectionIdleTimeoutSeconds(*)</p>\n<p>http 连接被清理之后服务器的空闲时间，默认为 30 秒</p>\n<p>19、RetentionTimeInMSInDeltaQueue(*)</p>\n<p>客户端保持增量信息缓存的时间，从而保证不会丢失这些信息，单位为毫秒，默认为 3 <em> 60 </em> 1000</p>\n<p>20、DeltaRetentionTimerIntervalInMs</p>\n<p>清理任务程序被唤醒的时间间隔，清理过期的增量信息，单位为毫秒，默认为 30 * 1000</p>\n<p>21、EvictionIntervalTimerInMs</p>\n<p>过期实例应该启动并运行的时间间隔，单位为毫秒，默认为 60 * 1000</p>\n<p>22、ASGQueryTimeoutMs（*）</p>\n<p>查询 AWS 上 ASG（自动缩放组）信息的超时值，单位为毫秒，默认为 300</p>\n<p>23、ASGUpdateIntervalMs</p>\n<p>从 AWS 上更新 ASG 信息的时间间隔，单位为毫秒，默认为 5 <em> 60 </em> 1000</p>\n<p>24、ASGCacheExpiryTimeoutMs(*)</p>\n<p>缓存 ASG 信息的到期时间，单位为毫秒，默认为 10 <em> 60 </em> 1000</p>\n<p>25、ResponseCacheAutoExpirationInSeconds（*）</p>\n<p>当注册表信息被改变时，则其被保存在缓存中不失效的时间，默认为 180 秒</p>\n<p>26、ResponseCacheUpdateIntervalMs（*）</p>\n<p>客户端的有效负载缓存应该更新的时间间隔，默认为 30 * 1000 毫秒</p>\n<p>27、UseReadOnlyResponseCache（*）</p>\n<p>目前采用的是二级缓存策略，一个是读写高速缓存过期策略，另一个没有过期只有只读缓存，默认为 true，表示只读缓存</p>\n<p>28、DisableDelta（*）</p>\n<p>增量信息是否可以提供给客户端看，默认为 false</p>\n<p>29、MaxIdleThreadInMinutesAgeForStatusReplication（*）</p>\n<p>状态复制线程可以保持存活的空闲时间，默认为 10 分钟</p>\n<p>30、MinThreadsForStatusReplication</p>\n<p>被用于状态复制的线程的最小数目，默认为 1</p>\n<p>31、MaxThreadsForStatusReplication</p>\n<p>被用于状态复制的线程的最大数目，默认为 1</p>\n<p>32、MaxElementsInStatusReplicationPool</p>\n<p>可允许的状态复制池备份复制事件的最大数量，默认为 10000</p>\n<p>33、SyncWhenTimestampDiffers</p>\n<p>当时间变化实例是否跟着同步，默认为 true</p>\n<p>34、RegistrySyncRetries</p>\n<p>当 eureka 服务器启动时尝试去获取集群里其他服务器上的注册信息的次数，默认为 5</p>\n<p>35、RegistrySyncRetryWaitMs</p>\n<p>当 eureka 服务器启动时获取其他服务器的注册信息失败时，会再次尝试获取，期间需要等待的时间，默认为 30 * 1000 毫秒</p>\n<p>36、MaxElementsInPeerReplicationPool（*）</p>\n<p>复制池备份复制事件的最大数量，默认为 10000</p>\n<p>37、MaxIdleThreadAgeInMinutesForPeerReplication（*）</p>\n<p>复制线程可以保持存活的空闲时间，默认为 15 分钟</p>\n<p>38、MinThreadsForPeerReplication（*）</p>\n<p>获取将被用于复制线程的最小数目，默认为 5</p>\n<p>39、MaxThreadsForPeerReplication</p>\n<p>获取将被用于复制线程的最大数目，默认为 20</p>\n<p>40、MaxTimeForReplication（*）</p>\n<p>尝试在丢弃复制事件之前进行复制的时间，默认为 30000 毫秒</p>\n<p>41、PrimeAwsReplicaConnections（*）</p>\n<p>对集群中服务器节点的连接是否应该准备，默认为 true</p>\n<p>42、DisableDeltaForRemoteRegions（*）</p>\n<p>增量信息是否可以提供给客户端或一些远程地区，默认为 false</p>\n<p>43、RemoteRegionConnectTimeoutMs（*）</p>\n<p>连接到对等远程地 eureka 节点的超时时间，默认为 1000 毫秒</p>\n<p>44、RemoteRegionReadTimeoutMs（*）</p>\n<p>获取从远程地区 eureka 节点读取信息的超时时间，默认为 1000 毫秒</p>\n<p>45、RemoteRegionTotalConnections</p>\n<p>获取远程地区对等节点上 http 连接的总数，默认为 1000</p>\n<p>46、RemoteRegionTotalConnectionsPerHost</p>\n<p>获取远程地区特定的对等节点上 http 连接的总数，默认为 500</p>\n<p>47、RemoteRegionConnectionIdleTimeoutSeconds</p>\n<p>http 连接被清理之后远程地区服务器的空闲时间，默认为 30 秒</p>\n<p>48、GZipContentFromRemoteRegion（*）</p>\n<p>eureka 服务器中获取的内容是否在远程地区被压缩，默认为 true</p>\n<p>49、RemoteRegionUrlsWithName</p>\n<p>针对远程地区发现的网址域名的 map</p>\n<p>50、RemoteRegionUrls</p>\n<p>远程地区的 URL 列表</p>\n<p>51、RemoteRegionAppWhitelist（*）</p>\n<p>必须通过远程区域中检索的应用程序的列表</p>\n<p>52、RemoteRegionRegistryFetchInterval</p>\n<p>从远程区域取出该注册表的信息的时间间隔，默认为 30 秒</p>\n<p>53、RemoteRegionFetchThreadPoolSize</p>\n<p>用于执行远程区域注册表请求的线程池的大小，默认为 20</p>\n<p>54、RemoteRegionTrustStore</p>\n<p>用来合格请求远程区域注册表的信任存储文件，默认为空</p>\n<p>55、RemoteRegionTrustStorePassword</p>\n<p>获取偏远地区信任存储文件的密码，默认为 “changeit”</p>\n<p>56、disableTransparentFallbackToOtherRegion(*)</p>\n<p>如果在远程区域本地没有实例运行，对于应用程序回退的旧行为是否被禁用， 默认为 false</p>\n<p>57、BatchReplication(*)</p>\n<p>表示集群节点之间的复制是否为了网络效率而进行批处理，默认为 false</p>\n<p>58、LogIdentityHeaders(*)</p>\n<p>Eureka 服务器是否应该登录 clientAuthHeaders，默认为 true</p>\n<p>59、RateLimiterEnabled</p>\n<p>限流是否应启用或禁用，默认为 false</p>\n<p>60、RateLimiterThrottleStandardClients</p>\n<p>是否对标准客户端进行限流，默认 false</p>\n<p>61、RateLimiterPrivilegedClients（*）</p>\n<p>认证的客户端列表，这里是除了标准的 eureka Java 客户端。</p>\n<p>62、RateLimiterBurstSize（*）</p>\n<p>速率限制的 burst size ，默认为 10，这里用的是令牌桶算法</p>\n<p>63、RateLimiterRegistryFetchAverageRate(*)</p>\n<p>速率限制器用的是令牌桶算法，此配置指定平均执行注册请求速率，默认为 500</p>\n<p>64、RateLimiterFullFetchAverageRate（*）</p>\n<p>速率限制器用的是令牌桶算法，此配置指定平均执行请求速率，默认为 100</p>\n<p>65、ListAutoScalingGroupsRoleName（*）</p>\n<p>用来描述从 AWS 第三账户的自动缩放组中的角色名称，默认为 “ListAutoScalingGroups”</p>\n<p>66、JsonCodecName（*）</p>\n<p>如果没有设置默认的编解码器将使用全 JSON 编解码器，获取的是编码器的类名称</p>\n<p>67、XmlCodecName(*)</p>\n<p>如果没有设置默认的编解码器将使用 xml 编解码器，获取的是编码器的类名称</p>\n<p>68、BindingStrategy(*)</p>\n<p>获取配置绑定 EIP 或 Route53 的策略。</p>\n<p>69、Route53DomainTTL（*）</p>\n<p>用于建立 route53 域的 ttl，默认为 301</p>\n<p>70、Route53BindRebindRetries（*）</p>\n<p>服务器尝试绑定到候选 Route53 域的次数，默认为 3</p>\n<p>71、Route53BindingRetryIntervalMs（*）</p>\n<p>服务器应该检查是否和 Route53 域绑定的时间间隔，默认为 5 <em> 60 </em> 1000 毫秒</p>\n<p>72、Experimental(*)</p>\n<p>当尝试新功能迁移过程时，为了避免配置 API 污染，相应的配置即可投入实验配置部分，默认为 null</p>\n<p>以上是 Eureka 配置项的详细说明，分为 Eureka 客户端配置、Eureka 服务端配置和微服务端配置，一共 100 多项，其中有很多配置参数并不需要我们去修改，使用默认的就好，有些跟我们业务相关的配置参数可根据需要自行设置。</p>\n<h2 id=\"Eureka配置案例\"><a href=\"#Eureka配置案例\" class=\"headerlink\" title=\"Eureka配置案例\"></a>Eureka配置案例</h2><h3 id=\"开发环境服务实例及时下线\"><a href=\"#开发环境服务实例及时下线\" class=\"headerlink\" title=\"开发环境服务实例及时下线\"></a>开发环境服务实例及时下线</h3><h5 id=\"Eureka自我保护机制\"><a href=\"#Eureka自我保护机制\" class=\"headerlink\" title=\"Eureka自我保护机制\"></a><a href=\"https://www.cnblogs.com/xishuai/p/spring-cloud-eureka-safe.html\" target=\"_blank\" rel=\"noopener\">Eureka自我保护机制</a></h5><p>Eureka Server 在运行期间会去统计心跳失败比例在 15 分钟之内是否低于 85%，如果低于 85%，Eureka Server 会将这些实例保护起来，让这些实例不会过期，但是在保护期内如果服务刚好这个服务提供者非正常下线了，此时服务消费者就会拿到一个无效的服务实例，此时会调用失败，对于这个问题需要服务消费者端要有一些容错机制，如重试，断路器等。</p>\n<p>我们在单机测试的时候很容易满足心跳失败比例在 15 分钟之内低于 85%，这个时候就会触发 Eureka 的保护机制，一旦开启了保护机制，则服务注册中心维护的服务实例就不是那么准确了，此时我们可以使用<code>eureka.server.enable-self-preservation=false</code>来关闭保护机制，这样可以确保注册中心中不可用的实例被及时的剔除（<strong>不推荐</strong>）。</p>\n<p>自我保护模式被激活的条件是：在 1 分钟后，<code>Renews (last min) &lt; Renews threshold</code>。</p>\n<p>这两个参数的意思：</p>\n<ul>\n<li><code>Renews threshold</code>：<strong>Eureka Server 期望每分钟收到客户端实例续约的总数</strong>。</li>\n<li><code>Renews (last min)</code>：<strong>Eureka Server 最后 1 分钟收到客户端实例续约的总数</strong>。</li>\n</ul>\n<p>具体的值，我们可以在 Eureka Server 界面可以看到。</p>\n<p>Renews threshold 计算代码：</p>\n<pre class=\"line-numbers language-java\"><code class=\"language-java\"><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>expectedNumberOfRenewsPerMin <span class=\"token operator\">=</span> count <span class=\"token operator\">*</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>numberOfRenewsPerMinThreshold <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>expectedNumberOfRenewsPerMin <span class=\"token operator\">*</span> serverConfig<span class=\"token punctuation\">.</span><span class=\"token function\">getRenewalPercentThreshold</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>解决方式有三种：</p>\n<ul>\n<li>关闭自我保护模式（<code>eureka.server.enable-self-preservation</code>设为<code>false</code>），<strong>不推荐</strong>。</li>\n<li>降低<code>renewalPercentThreshold</code>的比例（<code>eureka.server.renewal-percent-threshold</code>设置为<code>0.5</code>以下，比如<code>0.49</code>），<strong>不推荐</strong>。</li>\n<li>部署多个 Eureka Server 并开启其客户端行为（<code>eureka.client.register-with-eureka</code>不要设为<code>false</code>，默认为<code>true</code>），<strong>推荐</strong>。</li>\n</ul>\n<p>Eureka 的自我保护模式是有意义的，该模式被激活后，它不会从注册列表中剔除因长时间没收到心跳导致租期过期的服务，而是等待修复，直到心跳恢复正常之后，它自动退出自我保护模式。这种模式旨在避免因网络分区故障导致服务不可用的问题。例如，两个客户端实例 C1 和 C2 的连通性是良好的，但是由于网络故障，C2 未能及时向 Eureka 发送心跳续约，这时候 Eureka 不能简单的将 C2 从注册表中剔除。因为如果剔除了，C1 就无法从 Eureka 服务器中获取 C2 注册的服务，但是这时候 C2 服务是可用的。</p>\n<p>所以，Eureka 的自我保护模式最好还是开启它。</p>\n<h5 id=\"开发环境需要及时快速下线配置\"><a href=\"#开发环境需要及时快速下线配置\" class=\"headerlink\" title=\"开发环境需要及时快速下线配置\"></a>开发环境需要及时快速下线配置</h5><ul>\n<li><p>服务端配置</p>\n<pre class=\"line-numbers language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">eureka</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">instance</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\" spellcheck=\"true\">#心跳时间间隔（秒）</span>\n    <span class=\"token key atrule\">lease-renewal-interval-in-seconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5</span>\n  <span class=\"token key atrule\">server</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\" spellcheck=\"true\">#eureka自我保护机制</span>\n    <span class=\"token key atrule\">enable-self-preservation</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n    <span class=\"token comment\" spellcheck=\"true\">#删除失效或下线服务间隔 （毫秒），具体删除时间还要加上心跳时间间隔和等待时间间隔</span>\n    <span class=\"token key atrule\">eviction-interval-timer-in-ms</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1000</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n</li>\n<li><p>客户端配置</p>\n<pre class=\"line-numbers language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">eureka</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">instance</span><span class=\"token punctuation\">:</span>\n      <span class=\"token comment\" spellcheck=\"true\">#Eureka客户端向服务端发送心跳的时间间隔（秒）（客户端告诉服务端自己会按照该规则）</span>\n    <span class=\"token key atrule\">lease-renewal-interval-in-seconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3</span>\n    <span class=\"token comment\" spellcheck=\"true\">##Eureka服务端在收到最后一次心跳之后等待的时间上限（秒），超过则剔除（客户端告诉服务端按照此规则等待自己）</span>\n    <span class=\"token key atrule\">lease-expiration-duration-in-seconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">4</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"Eureka客户端配置\"><a href=\"#Eureka客户端配置\" class=\"headerlink\" title=\"Eureka客户端配置\"></a>Eureka客户端配置</h2><p>1、RegistryFetchIntervalSeconds</p>\n<p>从 eureka 服务器注册表中获取注册信息的时间间隔（s），默认为 30 秒</p>\n<p>2、InstanceInfoReplicationIntervalSeconds</p>\n<p>复制实例变化信息到 eureka 服务器所需要的时间间隔（s），默认为 30 秒</p>\n<p>3、InitialInstanceInfoReplicationIntervalSeconds</p>\n<p>最初复制实例信息到 eureka 服务器所需的时间（s），默认为 40 秒</p>\n<p>4、EurekaServiceUrlPollIntervalSeconds</p>\n<p>询问 Eureka 服务 url 信息变化的时间间隔（s），默认为 300 秒</p>\n<p>5、ProxyHost</p>\n<p>获取 eureka 服务的代理主机，默认为 null</p>\n<p>6、ProxyProxyPort</p>\n<p>获取 eureka 服务的代理端口, 默认为 null </p>\n<p> 7、ProxyUserName</p>\n<p>获取 eureka 服务的代理用户名，默认为 null</p>\n<p> 8、ProxyPassword</p>\n<p>获取 eureka 服务的代理密码，默认为 null </p>\n<p> 9、GZipContent</p>\n<p> eureka 注册表的内容是否被压缩，默认为 true，并且是在最好的网络流量下被压缩</p>\n<p>10、EurekaServerReadTimeoutSeconds</p>\n<p>eureka 需要超时读取之前需要等待的时间，默认为 8 秒</p>\n<p>11、EurekaServerConnectTimeoutSeconds</p>\n<p>eureka 需要超时连接之前需要等待的时间，默认为 5 秒</p>\n<p>12、BackupRegistryImpl</p>\n<p>获取实现了 eureka 客户端在第一次启动时读取注册表的信息作为回退选项的实现名称</p>\n<p>13、EurekaServerTotalConnections</p>\n<p> eureka 客户端允许所有 eureka 服务器连接的总数目，默认是 200</p>\n<p> 14、EurekaServerTotalConnectionsPerHost</p>\n<p> eureka 客户端允许 eureka 服务器主机连接的总数目，默认是 50</p>\n<p> 15、EurekaServerURLContext</p>\n<p>表示 eureka 注册中心的路径，如果配置为 eureka，则为 <a href=\"http://x.x.x.x:x/eureka/，在\" target=\"_blank\" rel=\"noopener\">http://x.x.x.x:x/eureka/，在</a> eureka 的配置文件中加入此配置表示 eureka 作为客户端向注册中心注册，从而构成 eureka 集群。此配置只有在 eureka 服务器 ip 地址列表是在 DNS 中才会用到，默认为 null</p>\n<p>16、EurekaServerPort</p>\n<p>获取 eureka 服务器的端口，此配置只有在 eureka 服务器 ip 地址列表是在 DNS 中才会用到。默认为 null</p>\n<p>17、EurekaServerDNSName</p>\n<p>获取要查询的 DNS 名称来获得 eureka 服务器，此配置只有在 eureka 服务器 ip 地址列表是在 DNS 中才会用到。默认为 null</p>\n<p>18、UseDnsForFetchingServiceUrls</p>\n<p>eureka 客户端是否应该使用 DNS 机制来获取 eureka 服务器的地址列表，默认为 false</p>\n<p>19、RegisterWithEureka</p>\n<p>实例是否在 eureka 服务器上注册自己的信息以供其他服务发现，默认为 true</p>\n<p>20、PreferSameZoneEureka</p>\n<p>实例是否使用同一 zone 里的 eureka 服务器，默认为 true，理想状态下，eureka 客户端与服务端是在同一 zone 下</p>\n<p>21、AllowRedirects</p>\n<p>服务器是否能够重定向客户端请求到备份服务器。 如果设置为 false，服务器将直接处理请求，如果设置为 true，它可能发送 HTTP 重定向到客户端。默认为 false</p>\n<p>22、LogDeltaDiff</p>\n<p>是否记录 eureka 服务器和客户端之间在注册表的信息方面的差异，默认为 false</p>\n<p>23、DisableDelta(*)</p>\n<p>默认为 false</p>\n<p>24、fetchRegistryForRemoteRegions</p>\n<p>eureka服务注册表信息里的以逗号隔开的地区名单，如果不这样返回这些地区名单，则客户端启动将会出错。默认为 null</p>\n<p>25、Region</p>\n<p>获取实例所在的地区。默认为 us-east-1</p>\n<p>26、AvailabilityZones</p>\n<p>获取实例所在的地区下可用性的区域列表，用逗号隔开。</p>\n<p>27、EurekaServerServiceUrls</p>\n<p>Eureka 服务器的连接，默认为 http：//XXXX：X/eureka/, 但是如果采用 DNS方式获取服务地址，则不需要配置此设置。</p>\n<p>28、FilterOnlyUpInstances（*）</p>\n<p>是否获得处于开启状态的实例的应用程序过滤之后的应用程序。默认为 true</p>\n<p>29、EurekaConnectionIdleTimeoutSeconds</p>\n<p>Eureka 服务的 http 请求关闭之前其响应的时间，默认为 30 秒</p>\n<p>30、FetchRegistry</p>\n<p>此客户端是否获取 eureka 服务器注册表上的注册信息，默认为 true</p>\n<p>31、RegistryRefreshSingleVipAddress</p>\n<p>此客户端只对一个单一的 VIP 注册表的信息感兴趣。默认为 null</p>\n<p>32、HeartbeatExecutorThreadPoolSize(*)</p>\n<p>心跳执行程序线程池的大小, 默认为 5</p>\n<p>33、HeartbeatExecutorExponentialBackOffBound(*)</p>\n<p>心跳执行程序回退相关的属性，是重试延迟的最大倍数值，默认为 10</p>\n<p>34、CacheRefreshExecutorThreadPoolSize(*)</p>\n<p>执行程序缓存刷新线程池的大小，默认为 5</p>\n<p>35、CacheRefreshExecutorExponentialBackOffBound</p>\n<p>执行程序指数回退刷新的相关属性，是重试延迟的最大倍数值，默认为 10</p>\n<p>36、DollarReplacement</p>\n<p>eureka 服务器序列化 / 反序列化的信息中获取 “$” 符号的的替换字符串。默认为 “_-”</p>\n<p>37、EscapeCharReplacement</p>\n<p>eureka 服务器序列化 / 反序列化的信息中获取 “_” 符号的的替换字符串。默认为 “__”</p>\n<p>38、OnDemandUpdateStatusChange（*）</p>\n<p>如果设置为 true, 客户端的状态更新将会点播更新到远程服务器上，默认为 true</p>\n<p>39、EncoderName</p>\n<p>这是一个短暂的编码器的配置，如果最新的编码器是稳定的，则可以去除，默认为 null</p>\n<p>40、DecoderName</p>\n<p>这是一个短暂的解码器的配置，如果最新的解码器是稳定的，则可以去除，默认为 null</p>\n<p>41、ClientDataAccept（*）</p>\n<p>客户端数据接收</p>\n<p>42、Experimental（*）</p>\n<p>当尝试新功能迁移过程时，为了避免配置 API 污染，相应的配置即可投入实验配置部分，默认为 null</p>\n<h2 id=\"Eureka微服务端配置\"><a href=\"#Eureka微服务端配置\" class=\"headerlink\" title=\"Eureka微服务端配置\"></a>Eureka微服务端配置</h2><p>1、InstanceId</p>\n<p>此实例注册到 eureka 服务端的唯一的实例 ID, 其组成为 、<code>${spring.application.name}:${spring.application.instance_id:${random.value}}</code></p>\n<p>2、Appname</p>\n<p>获得在 eureka 服务上注册的应用程序的名字，默认为 unknow</p>\n<p>3、AppGroupName</p>\n<p>获得在 eureka 服务上注册的应用程序组的名字，默认为 unknow</p>\n<p>4、InstanceEnabledOnit（*）</p>\n<p>实例注册到 eureka 服务器时，是否开启通讯，默认为 false</p>\n<p>5、NonSecurePort</p>\n<p>获取该实例应该接收通信的非安全端口。默认为 80</p>\n<p>6、SecurePort</p>\n<p>获取该实例应该接收通信的安全端口，默认为 443</p>\n<p>7、NonSecurePortEnabled</p>\n<p>该实例应该接收通信的非安全端口是否启用，默认为 true</p>\n<p>8、SecurePortEnabled</p>\n<p>该实例应该接收通信的安全端口是否启用，默认为 false</p>\n<p>9、LeaseRenewalIntervalInSeconds</p>\n<p>eureka 客户需要多长时间发送心跳给 eureka 服务器，表明它仍然活着, 默认为 30 秒</p>\n<p>10、LeaseExpirationDurationInSeconds</p>\n<p>Eureka 服务器在接收到实例的最后一次发出的心跳后，需要等待多久才可以将此实例删除，默认为 90 秒</p>\n<p>11、VirtualHostName</p>\n<p>此实例定义的虚拟主机名，其他实例将通过使用虚拟主机名找到该实例。</p>\n<p>12、SecureVirtualHostName</p>\n<p>此实例定义的安全虚拟主机名</p>\n<p>13、ASGName（*）</p>\n<p>与此实例相关联 AWS 自动缩放组名称。此项配置是在 AWS环境专门使用的实例启动，它已被用于流量停用后自动把一个实例退出服务。</p>\n<p>14、HostName</p>\n<p>与此实例相关联的主机名，是其他实例可以用来进行请求的准确名称</p>\n<p>15、MetadataMap(*)</p>\n<p>获取与此实例相关联的元数据 (key,value)。这个信息被发送到 eureka 服务器，其他实例可以使用。</p>\n<p>16、DataCenterInfo（*）</p>\n<p>该实例被部署在数据中心</p>\n<p>17、IpAddress</p>\n<p>获取实例的 ip 地址</p>\n<p>18、StatusPageUrlPath（*）</p>\n<p>获取此实例状态页的 URL 路径，然后构造出主机名，安全端口等，默认为 /info</p>\n<p>19、StatusPageUrl(*)</p>\n<p>获取此实例绝对状态页的 URL 路径，为其他服务提供信息时来找到这个实例的状态的路径，默认为 null</p>\n<p>20、HomePageUrlPath（*）</p>\n<p>获取此实例的相关主页 URL 路径，然后构造出主机名，安全端口等，默认为 /</p>\n<p>21、HomePageUrl(*)</p>\n<p>获取此实例的绝对主页 URL 路径，为其他服务提供信息时使用的路径, 默认为 null</p>\n<p>22、HealthCheckUrlPath</p>\n<p>获取此实例的相对健康检查 URL 路径，默认为 /health</p>\n<p>23、HealthCheckUrl</p>\n<p>获取此实例的绝对健康检查 URL 路径, 默认为 null</p>\n<p>24、SecureHealthCheckUrl</p>\n<p>获取此实例的绝对安全健康检查网页的 URL 路径，默认为 null</p>\n<p>25、DefaultAddressResolutionOrder</p>\n<p>获取实例的网络地址，默认为 []</p>\n<p>26、Namespace</p>\n<p>获取用于查找属性的命名空间，默认为 eureka</p>\n<p>Eureka服务端配置</p>\n<p>1、AWSAccessId</p>\n<p>获取 aws 访问的 id，主要用于弹性 ip 绑定，此配置是用于 aws 上的，默认为 null</p>\n<p>2、AWSSecretKey</p>\n<p>获取 aws 私有秘钥，主要用于弹性 ip 绑定，此配置是用于 aws 上的，默认为 null</p>\n<p>3、EIPBindRebindRetries</p>\n<p>获取服务器尝试绑定到候选的 EIP 的次数，默认为 3</p>\n<p>4、EIPBindingRetryIntervalMsWhenUnbound(*)</p>\n<p>服务器检查 ip 绑定的时间间隔，单位为毫秒，默认为 1 <em> 60 </em> 1000</p>\n<p>5、EIPBindingRetryIntervalMs</p>\n<p>与上面的是同一作用，仅仅是稳定状态检查，默认为 5 <em> 60 </em> 1000</p>\n<p>6、EnableSelfPreservation</p>\n<p>自我保护模式，当出现出现网络分区、eureka 在短时间内丢失过多客户端时，会进入自我保护模式，即一个服务长时间没有发送心跳，eureka 也不会将其删除，默认为 true</p>\n<p>7、RenewalPercentThreshold(*)</p>\n<p><img src=\"/images/微服务/952935-20170623150643570-1733575926.png\" alt=\"\"></p>\n<p>阈值因子，默认是 0.85，如果阈值比最小值大，则自我保护模式开启</p>\n<p>8、RenewalThresholdUpdateIntervalMs</p>\n<p>阈值更新的时间间隔，单位为毫秒，默认为 15 <em> 60 </em> 1000</p>\n<p>9、PeerEurekaNodesUpdateIntervalMs(*)</p>\n<p>集群里 eureka 节点的变化信息更新的时间间隔，单位为毫秒，默认为 10 <em> 60 </em> 1000</p>\n<p>10、EnableReplicatedRequestCompression</p>\n<p>复制的数据在发送请求时是否被压缩，默认为 false</p>\n<p>11、NumberOfReplicationRetries</p>\n<p>获取集群里服务器尝试复制数据的次数，默认为 5</p>\n<p>12、PeerEurekaStatusRefreshTimeIntervalMs</p>\n<p>服务器节点的状态信息被更新的时间间隔，单位为毫秒，默认为 30 * 1000</p>\n<p>13、WaitTimeInMsWhenSyncEmpty(*)</p>\n<p>在 Eureka 服务器获取不到集群里对等服务器上的实例时，需要等待的时间，单位为毫秒，默认为 1000 <em> 60 </em> 5</p>\n<p>14、PeerNodeConnectTimeoutMs</p>\n<p>连接对等节点服务器复制的超时的时间，单位为毫秒，默认为 200</p>\n<p>15、PeerNodeReadTimeoutMs</p>\n<p>读取对等节点服务器复制的超时的时间，单位为毫秒，默认为 200</p>\n<p>16、PeerNodeTotalConnections</p>\n<p>获取对等节点上 http 连接的总数，默认为 1000</p>\n<p>17、PeerNodeTotalConnectionsPerHost(*)</p>\n<p>获取特定的对等节点上 http 连接的总数，默认为 500</p>\n<p>18、PeerNodeConnectionIdleTimeoutSeconds(*)</p>\n<p>http 连接被清理之后服务器的空闲时间，默认为 30 秒</p>\n<p>19、RetentionTimeInMSInDeltaQueue(*)</p>\n<p>客户端保持增量信息缓存的时间，从而保证不会丢失这些信息，单位为毫秒，默认为 3 <em> 60 </em> 1000</p>\n<p>20、DeltaRetentionTimerIntervalInMs</p>\n<p>清理任务程序被唤醒的时间间隔，清理过期的增量信息，单位为毫秒，默认为 30 * 1000</p>\n<p>21、EvictionIntervalTimerInMs</p>\n<p>过期实例应该启动并运行的时间间隔，单位为毫秒，默认为 60 * 1000</p>\n<p>22、ASGQueryTimeoutMs（*）</p>\n<p>查询 AWS 上 ASG（自动缩放组）信息的超时值，单位为毫秒，默认为 300</p>\n<p>23、ASGUpdateIntervalMs</p>\n<p>从 AWS 上更新 ASG 信息的时间间隔，单位为毫秒，默认为 5 <em> 60 </em> 1000</p>\n<p>24、ASGCacheExpiryTimeoutMs(*)</p>\n<p>缓存 ASG 信息的到期时间，单位为毫秒，默认为 10 <em> 60 </em> 1000</p>\n<p>25、ResponseCacheAutoExpirationInSeconds（*）</p>\n<p>当注册表信息被改变时，则其被保存在缓存中不失效的时间，默认为 180 秒</p>\n<p>26、ResponseCacheUpdateIntervalMs（*）</p>\n<p>客户端的有效负载缓存应该更新的时间间隔，默认为 30 * 1000 毫秒</p>\n<p>27、UseReadOnlyResponseCache（*）</p>\n<p>目前采用的是二级缓存策略，一个是读写高速缓存过期策略，另一个没有过期只有只读缓存，默认为 true，表示只读缓存</p>\n<p>28、DisableDelta（*）</p>\n<p>增量信息是否可以提供给客户端看，默认为 false</p>\n<p>29、MaxIdleThreadInMinutesAgeForStatusReplication（*）</p>\n<p>状态复制线程可以保持存活的空闲时间，默认为 10 分钟</p>\n<p>30、MinThreadsForStatusReplication</p>\n<p>被用于状态复制的线程的最小数目，默认为 1</p>\n<p>31、MaxThreadsForStatusReplication</p>\n<p>被用于状态复制的线程的最大数目，默认为 1</p>\n<p>32、MaxElementsInStatusReplicationPool</p>\n<p>可允许的状态复制池备份复制事件的最大数量，默认为 10000</p>\n<p>33、SyncWhenTimestampDiffers</p>\n<p>当时间变化实例是否跟着同步，默认为 true</p>\n<p>34、RegistrySyncRetries</p>\n<p>当 eureka 服务器启动时尝试去获取集群里其他服务器上的注册信息的次数，默认为 5</p>\n<p>35、RegistrySyncRetryWaitMs</p>\n<p>当 eureka 服务器启动时获取其他服务器的注册信息失败时，会再次尝试获取，期间需要等待的时间，默认为 30 * 1000 毫秒</p>\n<p>36、MaxElementsInPeerReplicationPool（*）</p>\n<p>复制池备份复制事件的最大数量，默认为 10000</p>\n<p>37、MaxIdleThreadAgeInMinutesForPeerReplication（*）</p>\n<p>复制线程可以保持存活的空闲时间，默认为 15 分钟</p>\n<p>38、MinThreadsForPeerReplication（*）</p>\n<p>获取将被用于复制线程的最小数目，默认为 5</p>\n<p>39、MaxThreadsForPeerReplication</p>\n<p>获取将被用于复制线程的最大数目，默认为 20</p>\n<p>40、MaxTimeForReplication（*）</p>\n<p>尝试在丢弃复制事件之前进行复制的时间，默认为 30000 毫秒</p>\n<p>41、PrimeAwsReplicaConnections（*）</p>\n<p>对集群中服务器节点的连接是否应该准备，默认为 true</p>\n<p>42、DisableDeltaForRemoteRegions（*）</p>\n<p>增量信息是否可以提供给客户端或一些远程地区，默认为 false</p>\n<p>43、RemoteRegionConnectTimeoutMs（*）</p>\n<p>连接到对等远程地 eureka 节点的超时时间，默认为 1000 毫秒</p>\n<p>44、RemoteRegionReadTimeoutMs（*）</p>\n<p>获取从远程地区 eureka 节点读取信息的超时时间，默认为 1000 毫秒</p>\n<p>45、RemoteRegionTotalConnections</p>\n<p>获取远程地区对等节点上 http 连接的总数，默认为 1000</p>\n<p>46、RemoteRegionTotalConnectionsPerHost</p>\n<p>获取远程地区特定的对等节点上 http 连接的总数，默认为 500</p>\n<p>47、RemoteRegionConnectionIdleTimeoutSeconds</p>\n<p>http 连接被清理之后远程地区服务器的空闲时间，默认为 30 秒</p>\n<p>48、GZipContentFromRemoteRegion（*）</p>\n<p>eureka 服务器中获取的内容是否在远程地区被压缩，默认为 true</p>\n<p>49、RemoteRegionUrlsWithName</p>\n<p>针对远程地区发现的网址域名的 map</p>\n<p>50、RemoteRegionUrls</p>\n<p>远程地区的 URL 列表</p>\n<p>51、RemoteRegionAppWhitelist（*）</p>\n<p>必须通过远程区域中检索的应用程序的列表</p>\n<p>52、RemoteRegionRegistryFetchInterval</p>\n<p>从远程区域取出该注册表的信息的时间间隔，默认为 30 秒</p>\n<p>53、RemoteRegionFetchThreadPoolSize</p>\n<p>用于执行远程区域注册表请求的线程池的大小，默认为 20</p>\n<p>54、RemoteRegionTrustStore</p>\n<p>用来合格请求远程区域注册表的信任存储文件，默认为空</p>\n<p>55、RemoteRegionTrustStorePassword</p>\n<p>获取偏远地区信任存储文件的密码，默认为 “changeit”</p>\n<p>56、disableTransparentFallbackToOtherRegion(*)</p>\n<p>如果在远程区域本地没有实例运行，对于应用程序回退的旧行为是否被禁用， 默认为 false</p>\n<p>57、BatchReplication(*)</p>\n<p>表示集群节点之间的复制是否为了网络效率而进行批处理，默认为 false</p>\n<p>58、LogIdentityHeaders(*)</p>\n<p>Eureka 服务器是否应该登录 clientAuthHeaders，默认为 true</p>\n<p>59、RateLimiterEnabled</p>\n<p>限流是否应启用或禁用，默认为 false</p>\n<p>60、RateLimiterThrottleStandardClients</p>\n<p>是否对标准客户端进行限流，默认 false</p>\n<p>61、RateLimiterPrivilegedClients（*）</p>\n<p>认证的客户端列表，这里是除了标准的 eureka Java 客户端。</p>\n<p>62、RateLimiterBurstSize（*）</p>\n<p>速率限制的 burst size ，默认为 10，这里用的是令牌桶算法</p>\n<p>63、RateLimiterRegistryFetchAverageRate(*)</p>\n<p>速率限制器用的是令牌桶算法，此配置指定平均执行注册请求速率，默认为 500</p>\n<p>64、RateLimiterFullFetchAverageRate（*）</p>\n<p>速率限制器用的是令牌桶算法，此配置指定平均执行请求速率，默认为 100</p>\n<p>65、ListAutoScalingGroupsRoleName（*）</p>\n<p>用来描述从 AWS 第三账户的自动缩放组中的角色名称，默认为 “ListAutoScalingGroups”</p>\n<p>66、JsonCodecName（*）</p>\n<p>如果没有设置默认的编解码器将使用全 JSON 编解码器，获取的是编码器的类名称</p>\n<p>67、XmlCodecName(*)</p>\n<p>如果没有设置默认的编解码器将使用 xml 编解码器，获取的是编码器的类名称</p>\n<p>68、BindingStrategy(*)</p>\n<p>获取配置绑定 EIP 或 Route53 的策略。</p>\n<p>69、Route53DomainTTL（*）</p>\n<p>用于建立 route53 域的 ttl，默认为 301</p>\n<p>70、Route53BindRebindRetries（*）</p>\n<p>服务器尝试绑定到候选 Route53 域的次数，默认为 3</p>\n<p>71、Route53BindingRetryIntervalMs（*）</p>\n<p>服务器应该检查是否和 Route53 域绑定的时间间隔，默认为 5 <em> 60 </em> 1000 毫秒</p>\n<p>72、Experimental(*)</p>\n<p>当尝试新功能迁移过程时，为了避免配置 API 污染，相应的配置即可投入实验配置部分，默认为 null</p>\n<p>以上是 Eureka 配置项的详细说明，分为 Eureka 客户端配置、Eureka 服务端配置和微服务端配置，一共 100 多项，其中有很多配置参数并不需要我们去修改，使用默认的就好，有些跟我们业务相关的配置参数可根据需要自行设置。</p>\n<h2 id=\"Eureka配置案例\"><a href=\"#Eureka配置案例\" class=\"headerlink\" title=\"Eureka配置案例\"></a>Eureka配置案例</h2><h3 id=\"开发环境服务实例及时下线\"><a href=\"#开发环境服务实例及时下线\" class=\"headerlink\" title=\"开发环境服务实例及时下线\"></a>开发环境服务实例及时下线</h3><h5 id=\"Eureka自我保护机制\"><a href=\"#Eureka自我保护机制\" class=\"headerlink\" title=\"Eureka自我保护机制\"></a><a href=\"https://www.cnblogs.com/xishuai/p/spring-cloud-eureka-safe.html\" target=\"_blank\" rel=\"noopener\">Eureka自我保护机制</a></h5><p>Eureka Server 在运行期间会去统计心跳失败比例在 15 分钟之内是否低于 85%，如果低于 85%，Eureka Server 会将这些实例保护起来，让这些实例不会过期，但是在保护期内如果服务刚好这个服务提供者非正常下线了，此时服务消费者就会拿到一个无效的服务实例，此时会调用失败，对于这个问题需要服务消费者端要有一些容错机制，如重试，断路器等。</p>\n<p>我们在单机测试的时候很容易满足心跳失败比例在 15 分钟之内低于 85%，这个时候就会触发 Eureka 的保护机制，一旦开启了保护机制，则服务注册中心维护的服务实例就不是那么准确了，此时我们可以使用<code>eureka.server.enable-self-preservation=false</code>来关闭保护机制，这样可以确保注册中心中不可用的实例被及时的剔除（<strong>不推荐</strong>）。</p>\n<p>自我保护模式被激活的条件是：在 1 分钟后，<code>Renews (last min) &lt; Renews threshold</code>。</p>\n<p>这两个参数的意思：</p>\n<ul>\n<li><code>Renews threshold</code>：<strong>Eureka Server 期望每分钟收到客户端实例续约的总数</strong>。</li>\n<li><code>Renews (last min)</code>：<strong>Eureka Server 最后 1 分钟收到客户端实例续约的总数</strong>。</li>\n</ul>\n<p>具体的值，我们可以在 Eureka Server 界面可以看到。</p>\n<p>Renews threshold 计算代码：</p>\n<pre><code class=\"java\">this.expectedNumberOfRenewsPerMin = count * 2;\nthis.numberOfRenewsPerMinThreshold = (int) (this.expectedNumberOfRenewsPerMin * serverConfig.getRenewalPercentThreshold());\n</code></pre>\n<p>解决方式有三种：</p>\n<ul>\n<li>关闭自我保护模式（<code>eureka.server.enable-self-preservation</code>设为<code>false</code>），<strong>不推荐</strong>。</li>\n<li>降低<code>renewalPercentThreshold</code>的比例（<code>eureka.server.renewal-percent-threshold</code>设置为<code>0.5</code>以下，比如<code>0.49</code>），<strong>不推荐</strong>。</li>\n<li>部署多个 Eureka Server 并开启其客户端行为（<code>eureka.client.register-with-eureka</code>不要设为<code>false</code>，默认为<code>true</code>），<strong>推荐</strong>。</li>\n</ul>\n<p>Eureka 的自我保护模式是有意义的，该模式被激活后，它不会从注册列表中剔除因长时间没收到心跳导致租期过期的服务，而是等待修复，直到心跳恢复正常之后，它自动退出自我保护模式。这种模式旨在避免因网络分区故障导致服务不可用的问题。例如，两个客户端实例 C1 和 C2 的连通性是良好的，但是由于网络故障，C2 未能及时向 Eureka 发送心跳续约，这时候 Eureka 不能简单的将 C2 从注册表中剔除。因为如果剔除了，C1 就无法从 Eureka 服务器中获取 C2 注册的服务，但是这时候 C2 服务是可用的。</p>\n<p>所以，Eureka 的自我保护模式最好还是开启它。</p>\n<h5 id=\"开发环境需要及时快速下线配置\"><a href=\"#开发环境需要及时快速下线配置\" class=\"headerlink\" title=\"开发环境需要及时快速下线配置\"></a>开发环境需要及时快速下线配置</h5><ul>\n<li><p>服务端配置</p>\n<pre><code class=\"yaml\">eureka:\n  instance:\n    #心跳时间间隔（秒）\n    lease-renewal-interval-in-seconds: 5\n  server:\n    #eureka自我保护机制\n    enable-self-preservation: false\n    #删除失效或下线服务间隔 （毫秒），具体删除时间还要加上心跳时间间隔和等待时间间隔\n    eviction-interval-timer-in-ms: 1000\n</code></pre>\n</li>\n<li><p>客户端配置</p>\n<pre><code class=\"yaml\">eureka:\n  instance:\n      #Eureka客户端向服务端发送心跳的时间间隔（秒）（客户端告诉服务端自己会按照该规则）\n    lease-renewal-interval-in-seconds: 3\n    ##Eureka服务端在收到最后一次心跳之后等待的时间上限（秒），超过则剔除（客户端告诉服务端按照此规则等待自己）\n    lease-expiration-duration-in-seconds: 4\n</code></pre>\n</li>\n</ul>\n"},{"title":"ZooKeeper介绍","author":"Asia Cui","date":"2019-01-28T05:08:00.000Z","_content":"# 一 什么是 ZooKeeper\n\n**ZooKeeper 的由来**\n\n**下面这段内容摘自《从 Paxos 到 Zookeeper 》第四章第一节的某段内容，推荐大家阅读以下：**\n\n> Zookeeper 最早起源于雅虎研究院的一个研究小组。在当时，研究人员发现，在雅虎内部很多大型系统基本都需要依赖一个类似的系统来进行分布式协调，但是这些系统往往都存在分布式单点问题。所以，**雅虎的开发人员就试图开发一个通用的无单点问题的分布式协调框架，以便让开发人员将精力集中在处理业务逻辑上。**\n> \n> 关于 “ZooKeeper” 这个项目的名字，其实也有一段趣闻。在立项初期，考虑到之前内部很多项目都是使用动物的名字来命名的（例如著名的 Pig 项目), 雅虎的工程师希望给这个项目也取一个动物的名字。时任研究院的首席科学家 RaghuRamakrishnan 开玩笑地说：“在这样下去，我们这儿就变成动物园了！”此话一出，大家纷纷表示就叫动物园管理员吧一一一因为各个以动物命名的分布式组件放在一起，**雅虎的整个分布式系统看上去就像一个大型的动物园了，而 Zookeeper 正好要用来进行分布式环境的协调一一于是，Zookeeper 的名字也就由此诞生了。**\n\n**1.1 ZooKeeper 概览**\n\nZooKeeper 是一个开源的分布式协调服务，ZooKeeper 框架最初是在 “Yahoo!\" 上构建的，用于以简单而稳健的方式访问他们的应用程序。 后来，Apache ZooKeeper 成为 Hadoop，HBase 和其他分布式框架使用的有组织服务的标准。 例如，Apache HBase 使用 ZooKeeper 跟踪分布式数据的状态。**ZooKeeper 的设计目标是将那些复杂且容易出错的分布式一致性服务封装起来，构成一个高效可靠的原语集，并以一系列简单易用的接口提供给用户使用。**\n\n> **原语：** 操作系统或计算机网络用语范畴。是由若干条指令组成的，用于完成一定功能的一个过程。具有不可分割性 · 即原语的执行必须是连续的，在执行过程中不允许被中断。\n\n**ZooKeeper 是一个典型的分布式数据一致性解决方案，分布式应用程序可以基于 ZooKeeper 实现诸如数据发布 / 订阅、负载均衡、命名服务、分布式协调 / 通知、集群管理、Master 选举、分布式锁和分布式队列等功能。**\n\n**Zookeeper 一个最常用的使用场景就是用于担任服务生产者和服务消费者的注册中心。** 服务生产者将自己提供的服务注册到 Zookeeper 中心，服务的消费者在进行服务调用的时候先到 Zookeeper 中查找服务，获取到服务生产者的详细信息之后，再去调用服务生产者的内容与数据。如下图所示，在 Dubbo 架构中 Zookeeper 就担任了注册中心这一角色。\n\n![](/images/zookeeper/0a3e0527ec7a4dcdbbd5597d20d77fe3.jpg)\n\n**1.2 结合个人使用情况的讲一下 ZooKeeper**\n\n在我自己做过的项目中，主要使用到了 ZooKeeper 作为 Dubbo 的注册中心 (Dubbo 官方推荐使用 ZooKeeper 注册中心)。另外在搭建 solr 集群的时候，我使用 ZooKeeper 作为 solr 集群的管理工具。这时，ZooKeeper 主要提供下面几个功能：1、集群管理：容错、负载均衡。2、配置文件的集中管理 3、集群的入口。\n\n我个人觉得在使用 ZooKeeper 的时候，最好是使用 集群版的 ZooKeeper 而不是单机版的。官网给出的架构图就描述的是一个集群版的 ZooKeeper 。通常 3 台服务器就可以构成一个 ZooKeeper 集群了。\n\n**为什么最好使用奇数台服务器构成 ZooKeeper 集群？**\n\n我们知道在 Zookeeper 中 Leader 选举算法采用了 Zab 协议。Zab 核心思想是当多数 Server 写成功，则任务数据写成功。\n\n①如果有 3 个 Server，则最多允许 1 个 Server 挂掉。\n\n②如果有 4 个 Server，则同样最多允许 1 个 Server 挂掉。\n\n既然 3 个或者 4 个 Server，同样最多允许 1 个 Server 挂掉，那么它们的可靠性是一样的，所以选择奇数个 ZooKeeper Server 即可，这里选择 3 个 Server。12341234\n\n# 二 关于 ZooKeeper 的一些重要概念\n\n**2.1 重要概念总结**\n\n**● ZooKeeper 本身就是一个分布式程序（只要半数以上节点存活，ZooKeeper 就能正常服务）。**\n\n**● 为了保证高可用，最好是以集群形态来部署 ZooKeeper，这样只要集群中大部分机器是可用的（能够容忍一定的机器故障），那么 ZooKeeper 本身仍然是可用的。**\n\n**● ZooKeeper 将数据保存在内存中，这也就保证了 高吞吐量和低延迟**（但是内存限制了能够存储的容量不太大，此限制也是保持 znode 中存储的数据量较小的进一步原因）。\n\n**● ZooKeeper 是高性能的。 在 “读” 多于 “写” 的应用程序中尤其地高性能，因为 “写” 会导致所有的服务器间同步状态。**（“读”多于 “写” 是协调服务的典型场景。）\n\n**● ZooKeeper 有临时节点的概念。 当创建临时节点的客户端会话一直保持活动，瞬时节点就一直存在。而当会话终结时，瞬时节点被删除。持久节点是指一旦这个 ZNode 被创建了，除非主动进行 ZNode 的移除操作，否则这个 ZNode 将一直保存在 Zookeeper 上。**\n\n**●** ZooKeeper 底层其实只提供了两个功能：\n​\t①管理（存储、读取）用户程序提交的数据；\n​\t②为用户程序提交数据节点监听服务。\n\n**下面关于会话（Session）、 Znode、版本、Watcher、ACL 概念的总结都在《从 Paxos 到 Zookeeper 》第四章第一节以及第七章第八节有提到，感兴趣的可以看看！**\n\n**2.2 会话（Session）**\n\nSession 指的是 ZooKeeper 服务器与客户端会话。**在 ZooKeeper 中，一个客户端连接是指客户端和服务器之间的一个 TCP 长连接**。客户端启动的时候，首先会与服务器建立一个 TCP 连接，从第一次连接建立开始，客户端会话的生命周期也开始了。**通过这个连接，客户端能够通过心跳检测与服务器保持有效的会话，也能够向 Zookeeper 服务器发送请求并接受响应，同时还能够通过该连接接收来自服务器的 Watch 事件通知。** Session 的 sessionTimeout 值用来设置一个客户端会话的超时时间。当由于服务器压力太大、网络故障或是客户端主动断开连接等各种原因导致客户端连接断开时，**只要在 sessionTimeout 规定的时间内能够重新连接上集群中任意一台服务器，那么之前创建的会话仍然有效。**\n\n**在为客户端创建会话之前，服务端首先会为每个客户端都分配一个 sessionID。由于 sessionID 是 Zookeeper 会话的一个重要标识，许多与会话相关的运行机制都是基于这个 sessionID 的，因此，无论是哪台服务器为客户端分配的 sessionID，都务必保证全局唯一。**\n\n**2.3 Znode**\n\n**在谈到分布式的时候，我们通常说的 “节点 \"是指组成集群的每一台机器。然而，在 Zookeeper 中，“节点\" 分为两类，第一类同样是指构成集群的机器，我们称之为机器节点；第二类则是指数据模型中的数据单元，我们称之为数据节点一一 ZNode。**\n\nZookeeper 将所有数据存储在内存中，数据模型是一棵树（Znode Tree)，由斜杠（/）的进行分割的路径，就是一个 Znode，例如 / foo/path1。每个上都会保存自己的数据内容，同时还会保存一系列属性信息。\n> ZooKeeper有一个分层名称空间，很像分布式文件系统。和文件系统不同的是，  zookeeper的数据存储是是结构化存储，没有文件和目录的概念，文件和目录被抽象 成了节点（node），上图中的每个node称为znode， 每个znode由三个部分组成：\n > 1.  stat: 描述该znode的版本号、权限等信息。<br>\n > 2.  data:与该znode关联的数据。<br>\n > 3.  children: 该znode下的子节点\n\n每次znode的数据更改时，版本号都会增加。例如，每当客户端检索数据时，它会接收数据的版本。当客户端执行更新或删除时，它必须提供正在更改的znode的数据版本。如果它提供的版本与实际数据的版本不匹配，则更新失败。\n\n\n**在 Zookeeper 中，node 可以分为持久节点和临时节点两类。所谓持久节点是指一旦这个 ZNode 被创建了，除非主动进行 ZNode 的移除操作，否则这个 ZNode 将一直保存在 Zookeeper 上。而临时节点就不一样了，它的生命周期和客户端会话绑定，一旦客户端会话失效，那么这个客户端创建的所有临时节点都会被移除。**另外，ZooKeeper 还允许用户为每个节点添加一个特殊的属性：**SEQUENTIAL**. 一旦节点被标记上这个属性，那么在这个节点被创建的时候，Zookeeper 会自动在其节点名后面追加上一个整型数字，这个整型数字是一个由父节点维护的自增数字。\n\n\n**2.4 版本**\n\n在前面我们已经提到，Zookeeper 的每个 ZNode 上都会存储数据，对应于每个 ZNode，Zookeeper 都会为其维护一个叫作 **Stat** 的数据结构，Stat 中记录了这个 ZNode 的三个数据版本，分别是 version（当前 ZNode 的版本）、cversion（当前 ZNode 子节点的版本）和 cversion（当前 ZNode 的 ACL 版本）。\n\n**2.5 Watcher**\n\n**Watcher（事件监听器），是 Zookeeper 中的一个很重要的特性。Zookeeper 允许用户在指定节点上注册一些 Watcher，并且在一些特定事件触发的时候，ZooKeeper 服务端会将事件通知到感兴趣的客户端上去，该机制是 Zookeeper 实现分布式协调服务的重要特性。**\n\n**2.6 ACL**\n\nZookeeper 采用 ACL（AccessControlLists）策略来进行权限控制，类似于 UNIX 文件系统的权限控制。Zookeeper 定义了如下 5 种权限。\n\n![](/images/zookeeper/ff857235dba54561a41ff49bbea15795.jpg)\n\n其中尤其需要注意的是，CREATE 和 DELETE 这两种权限都是针对子节点的权限控制。\n\n# **三 ZooKeeper 特点**\n\n**● 顺序一致性：** 从同一客户端发起的事务请求，最终将会严格地按照顺序被应用到 ZooKeeper 中去。\n\n**● 原子性：** 所有事务请求的处理结果在整个集群中所有机器上的应用情况是一致的，也就是说，要么整个集群中所有的机器都成功应用了某一个事务，要么都没有应用。\n\n**● 单一系统映像 ：** 无论客户端连到哪一个 ZooKeeper 服务器上，其看到的服务端数据模型都是一致的。\n\n**● 可靠性：** 一旦一次更改请求被应用，更改的结果就会被持久化，直到被下一次更改覆盖。\n\n# 四 ZooKeeper 设计目标\n\n**4.1 简单的数据模型**\n\nZooKeeper 允许分布式进程通过共享的层次结构命名空间进行相互协调，这与标准文件系统类似。 名称空间由 ZooKeeper 中的数据寄存器组成 - 称为 znode，这些类似于文件和目录。 与为存储设计的典型文件系统不同，ZooKeeper 数据保存在内存中，这意味着 ZooKeeper 可以实现高吞吐量和低延迟。\n\n![](/images/zookeeper/13c3e24881a7471cb180590d884568ba.jpg)\n\n**4.2 可构建集群**\n\n**为了保证高可用，最好是以集群形态来部署 ZooKeeper，这样只要集群中大部分机器是可用的（能够容忍一定的机器故障），那么 zookeeper 本身仍然是可用的。** 客户端在使用 ZooKeeper 时，需要知道集群机器列表，通过与集群中的某一台机器建立 TCP 连接来使用服务，客户端使用这个 TCP 链接来发送请求、获取结果、获取监听事件以及发送心跳包。如果这个连接异常断开了，客户端可以连接到另外的机器上。\n\n**ZooKeeper 官方提供的架构图：**\n\n![](/images/zookeeper/zkservice.jpg)\n\n上图中每一个 Server 代表一个安装 Zookeeper 服务的服务器。组成 ZooKeeper 服务的服务器都会在内存中维护当前的服务器状态，并且每台服务器之间都互相保持着通信。集群间通过 Zab 协议（Zookeeper Atomic Broadcast）来保持数据的一致性。\n\n**4.3 顺序访问**\n\n**对于来自客户端的每个更新请求，ZooKeeper 都会分配一个全局唯一的递增编号，这个编号反应了所有事务操作的先后顺序，应用程序可以使用 ZooKeeper 这个特性来实现更高层次的同步原语。** **这个编号也叫做时间戳——zxid（Zookeeper Transaction Id）**\n\n**4.4 高性能**\n\n**ZooKeeper 是高性能的。 在 “读” 多于 “写” 的应用程序中尤其地高性能，因为 “写” 会导致所有的服务器间同步状态。（“读”多于 “写” 是协调服务的典型场景。）**\n\n# 五 ZooKeeper 集群角色介绍\n\n**最典型集群模式： Master/Slave 模式（主备模式）**。在这种模式中，通常 Master 服务器作为主服务器提供写服务，其他的 Slave 服务器从服务器通过异步复制的方式获取 Master 服务器最新的数据提供读服务。\n\n但是，**在 ZooKeeper 中没有选择传统的 Master/Slave 概念，而是引入了 Leader、Follower 和 Observer 三种角色**。如下图所示\n\n![](/images/zookeeper/6102d866d5e14718958b2a0ab193e9ea.jpg)\n\n**ZooKeeper 集群中的所有机器通过一个 Leader 选举过程来选定一台称为 “Leader” 的机器，Leader 既可以为客户端提供写服务又能提供读服务。除了 Leader 外，Follower 和 Observer 都只能提供读服务。Follower 和 Observer 唯一的区别在于 Observer 机器不参与 Leader 的选举过程，也不参与写操作的 “过半写成功” 策略，因此 Observer 机器可以在不影响写性能的情况下提升集群的读性能。**\n\n![](/images/zookeeper/f04752a7eb974518b9221e509f14cc00.jpg)\n\n# 六 ZooKeeper &ZAB 协议 & Paxos 算法\n\n**6.1 ZAB 协议 & Paxos 算法**\n\nPaxos 算法应该可以说是 ZooKeeper 的灵魂了。但是，ZooKeeper 并没有完全采用 Paxos 算法 ，而是使用 ZAB 协议作为其保证数据一致性的核心算法。另外，在 ZooKeeper 的官方文档中也指出，ZAB 协议并不像 Paxos 算法那样，是一种通用的分布式一致性算法，它是一种特别为 Zookeeper 设计的崩溃可恢复的原子消息广播算法。\n\n**6.2 ZAB 协议介绍**\n\n**ZAB（ZooKeeper Atomic Broadcast 原子广播） 协议是为分布式协调服务 ZooKeeper 专门设计的一种支持崩溃恢复的原子广播协议。 在 ZooKeeper 中，主要依赖 ZAB 协议来实现分布式数据一致性，基于该协议，ZooKeeper 实现了一种主备模式的系统架构来保持集群中各个副本之间的数据一致性。**\n\n**6.3 ZAB 协议两种基本的模式：崩溃恢复和消息广播**\n\nZAB 协议包括两种基本的模式，分别是 **崩溃恢复和消息广播**。当整个服务框架在启动过程中，或是当 Leader 服务器出现网络中断、崩溃退出与重启等异常情况时，ZAB 协议就会进人恢复模式并选举产生新的 Leader 服务器。当选举产生了新的 Leader 服务器，同时集群中已经有过半的机器与该 Leader 服务器完成了状态同步之后，ZAB 协议就会退出恢复模式。其中，**所谓的状态同步是指数据同步，用来保证集群中存在过半的机器能够和 Leader 服务器的数据状态保持一致**。\n\n**当集群中已经有过半的 Follower 服务器完成了和 Leader 服务器的状态同步，那么整个服务框架就可以进人消息广播模式了。** 当一台同样遵守 ZAB 协议的服务器启动后加人到集群中时，如果此时集群中已经存在一个 Leader 服务器在负责进行消息广播，那么新加人的服务器就会自觉地进人数据恢复模式：找到 Leader 所在的服务器，并与其进行数据同步，然后一起参与到消息广播流程中去。正如上文介绍中所说的，ZooKeeper 设计成只允许唯一的一个 Leader 服务器来进行事务请求的处理。Leader 服务器在接收到客户端的事务请求后，会生成对应的事务提案并发起一轮广播协议；而如果集群中的其他机器接收到客户端的事务请求，那么这些非 Leader 服务器会首先将这个事务请求转发给 Leader 服务器。\n\n# 七 总结\n\n通过阅读本文，想必大家已从 **①ZooKeeper 的由来。** -> **②ZooKeeper 到底是什么 。**-> **③ ZooKeeper 的一些重要概念**（会话（Session）、 Znode、版本、Watcher、ACL）-> **④ZooKeeper 的特点。** -> **⑤ZooKeeper 的设计目标。**-> **⑥ ZooKeeper 集群角色介绍** （Leader、Follower 和 Observer 三种角色）-> **⑦ZooKeeper &ZAB 协议 & Paxos 算法。** 这七点了解了 ZooKeeper 。","source":"_posts/ZooKeeper介绍.md","raw":"title: ZooKeeper介绍\nauthor: Asia Cui\ntags:\n  - 道\ncategories:\n  - Zookeeper\ndate: 2019-01-28 13:08:00\n---\n# 一 什么是 ZooKeeper\n\n**ZooKeeper 的由来**\n\n**下面这段内容摘自《从 Paxos 到 Zookeeper 》第四章第一节的某段内容，推荐大家阅读以下：**\n\n> Zookeeper 最早起源于雅虎研究院的一个研究小组。在当时，研究人员发现，在雅虎内部很多大型系统基本都需要依赖一个类似的系统来进行分布式协调，但是这些系统往往都存在分布式单点问题。所以，**雅虎的开发人员就试图开发一个通用的无单点问题的分布式协调框架，以便让开发人员将精力集中在处理业务逻辑上。**\n> \n> 关于 “ZooKeeper” 这个项目的名字，其实也有一段趣闻。在立项初期，考虑到之前内部很多项目都是使用动物的名字来命名的（例如著名的 Pig 项目), 雅虎的工程师希望给这个项目也取一个动物的名字。时任研究院的首席科学家 RaghuRamakrishnan 开玩笑地说：“在这样下去，我们这儿就变成动物园了！”此话一出，大家纷纷表示就叫动物园管理员吧一一一因为各个以动物命名的分布式组件放在一起，**雅虎的整个分布式系统看上去就像一个大型的动物园了，而 Zookeeper 正好要用来进行分布式环境的协调一一于是，Zookeeper 的名字也就由此诞生了。**\n\n**1.1 ZooKeeper 概览**\n\nZooKeeper 是一个开源的分布式协调服务，ZooKeeper 框架最初是在 “Yahoo!\" 上构建的，用于以简单而稳健的方式访问他们的应用程序。 后来，Apache ZooKeeper 成为 Hadoop，HBase 和其他分布式框架使用的有组织服务的标准。 例如，Apache HBase 使用 ZooKeeper 跟踪分布式数据的状态。**ZooKeeper 的设计目标是将那些复杂且容易出错的分布式一致性服务封装起来，构成一个高效可靠的原语集，并以一系列简单易用的接口提供给用户使用。**\n\n> **原语：** 操作系统或计算机网络用语范畴。是由若干条指令组成的，用于完成一定功能的一个过程。具有不可分割性 · 即原语的执行必须是连续的，在执行过程中不允许被中断。\n\n**ZooKeeper 是一个典型的分布式数据一致性解决方案，分布式应用程序可以基于 ZooKeeper 实现诸如数据发布 / 订阅、负载均衡、命名服务、分布式协调 / 通知、集群管理、Master 选举、分布式锁和分布式队列等功能。**\n\n**Zookeeper 一个最常用的使用场景就是用于担任服务生产者和服务消费者的注册中心。** 服务生产者将自己提供的服务注册到 Zookeeper 中心，服务的消费者在进行服务调用的时候先到 Zookeeper 中查找服务，获取到服务生产者的详细信息之后，再去调用服务生产者的内容与数据。如下图所示，在 Dubbo 架构中 Zookeeper 就担任了注册中心这一角色。\n\n![](/images/zookeeper/0a3e0527ec7a4dcdbbd5597d20d77fe3.jpg)\n\n**1.2 结合个人使用情况的讲一下 ZooKeeper**\n\n在我自己做过的项目中，主要使用到了 ZooKeeper 作为 Dubbo 的注册中心 (Dubbo 官方推荐使用 ZooKeeper 注册中心)。另外在搭建 solr 集群的时候，我使用 ZooKeeper 作为 solr 集群的管理工具。这时，ZooKeeper 主要提供下面几个功能：1、集群管理：容错、负载均衡。2、配置文件的集中管理 3、集群的入口。\n\n我个人觉得在使用 ZooKeeper 的时候，最好是使用 集群版的 ZooKeeper 而不是单机版的。官网给出的架构图就描述的是一个集群版的 ZooKeeper 。通常 3 台服务器就可以构成一个 ZooKeeper 集群了。\n\n**为什么最好使用奇数台服务器构成 ZooKeeper 集群？**\n\n我们知道在 Zookeeper 中 Leader 选举算法采用了 Zab 协议。Zab 核心思想是当多数 Server 写成功，则任务数据写成功。\n\n①如果有 3 个 Server，则最多允许 1 个 Server 挂掉。\n\n②如果有 4 个 Server，则同样最多允许 1 个 Server 挂掉。\n\n既然 3 个或者 4 个 Server，同样最多允许 1 个 Server 挂掉，那么它们的可靠性是一样的，所以选择奇数个 ZooKeeper Server 即可，这里选择 3 个 Server。12341234\n\n# 二 关于 ZooKeeper 的一些重要概念\n\n**2.1 重要概念总结**\n\n**● ZooKeeper 本身就是一个分布式程序（只要半数以上节点存活，ZooKeeper 就能正常服务）。**\n\n**● 为了保证高可用，最好是以集群形态来部署 ZooKeeper，这样只要集群中大部分机器是可用的（能够容忍一定的机器故障），那么 ZooKeeper 本身仍然是可用的。**\n\n**● ZooKeeper 将数据保存在内存中，这也就保证了 高吞吐量和低延迟**（但是内存限制了能够存储的容量不太大，此限制也是保持 znode 中存储的数据量较小的进一步原因）。\n\n**● ZooKeeper 是高性能的。 在 “读” 多于 “写” 的应用程序中尤其地高性能，因为 “写” 会导致所有的服务器间同步状态。**（“读”多于 “写” 是协调服务的典型场景。）\n\n**● ZooKeeper 有临时节点的概念。 当创建临时节点的客户端会话一直保持活动，瞬时节点就一直存在。而当会话终结时，瞬时节点被删除。持久节点是指一旦这个 ZNode 被创建了，除非主动进行 ZNode 的移除操作，否则这个 ZNode 将一直保存在 Zookeeper 上。**\n\n**●** ZooKeeper 底层其实只提供了两个功能：\n​\t①管理（存储、读取）用户程序提交的数据；\n​\t②为用户程序提交数据节点监听服务。\n\n**下面关于会话（Session）、 Znode、版本、Watcher、ACL 概念的总结都在《从 Paxos 到 Zookeeper 》第四章第一节以及第七章第八节有提到，感兴趣的可以看看！**\n\n**2.2 会话（Session）**\n\nSession 指的是 ZooKeeper 服务器与客户端会话。**在 ZooKeeper 中，一个客户端连接是指客户端和服务器之间的一个 TCP 长连接**。客户端启动的时候，首先会与服务器建立一个 TCP 连接，从第一次连接建立开始，客户端会话的生命周期也开始了。**通过这个连接，客户端能够通过心跳检测与服务器保持有效的会话，也能够向 Zookeeper 服务器发送请求并接受响应，同时还能够通过该连接接收来自服务器的 Watch 事件通知。** Session 的 sessionTimeout 值用来设置一个客户端会话的超时时间。当由于服务器压力太大、网络故障或是客户端主动断开连接等各种原因导致客户端连接断开时，**只要在 sessionTimeout 规定的时间内能够重新连接上集群中任意一台服务器，那么之前创建的会话仍然有效。**\n\n**在为客户端创建会话之前，服务端首先会为每个客户端都分配一个 sessionID。由于 sessionID 是 Zookeeper 会话的一个重要标识，许多与会话相关的运行机制都是基于这个 sessionID 的，因此，无论是哪台服务器为客户端分配的 sessionID，都务必保证全局唯一。**\n\n**2.3 Znode**\n\n**在谈到分布式的时候，我们通常说的 “节点 \"是指组成集群的每一台机器。然而，在 Zookeeper 中，“节点\" 分为两类，第一类同样是指构成集群的机器，我们称之为机器节点；第二类则是指数据模型中的数据单元，我们称之为数据节点一一 ZNode。**\n\nZookeeper 将所有数据存储在内存中，数据模型是一棵树（Znode Tree)，由斜杠（/）的进行分割的路径，就是一个 Znode，例如 / foo/path1。每个上都会保存自己的数据内容，同时还会保存一系列属性信息。\n> ZooKeeper有一个分层名称空间，很像分布式文件系统。和文件系统不同的是，  zookeeper的数据存储是是结构化存储，没有文件和目录的概念，文件和目录被抽象 成了节点（node），上图中的每个node称为znode， 每个znode由三个部分组成：\n > 1.  stat: 描述该znode的版本号、权限等信息。<br>\n > 2.  data:与该znode关联的数据。<br>\n > 3.  children: 该znode下的子节点\n\n每次znode的数据更改时，版本号都会增加。例如，每当客户端检索数据时，它会接收数据的版本。当客户端执行更新或删除时，它必须提供正在更改的znode的数据版本。如果它提供的版本与实际数据的版本不匹配，则更新失败。\n\n\n**在 Zookeeper 中，node 可以分为持久节点和临时节点两类。所谓持久节点是指一旦这个 ZNode 被创建了，除非主动进行 ZNode 的移除操作，否则这个 ZNode 将一直保存在 Zookeeper 上。而临时节点就不一样了，它的生命周期和客户端会话绑定，一旦客户端会话失效，那么这个客户端创建的所有临时节点都会被移除。**另外，ZooKeeper 还允许用户为每个节点添加一个特殊的属性：**SEQUENTIAL**. 一旦节点被标记上这个属性，那么在这个节点被创建的时候，Zookeeper 会自动在其节点名后面追加上一个整型数字，这个整型数字是一个由父节点维护的自增数字。\n\n\n**2.4 版本**\n\n在前面我们已经提到，Zookeeper 的每个 ZNode 上都会存储数据，对应于每个 ZNode，Zookeeper 都会为其维护一个叫作 **Stat** 的数据结构，Stat 中记录了这个 ZNode 的三个数据版本，分别是 version（当前 ZNode 的版本）、cversion（当前 ZNode 子节点的版本）和 cversion（当前 ZNode 的 ACL 版本）。\n\n**2.5 Watcher**\n\n**Watcher（事件监听器），是 Zookeeper 中的一个很重要的特性。Zookeeper 允许用户在指定节点上注册一些 Watcher，并且在一些特定事件触发的时候，ZooKeeper 服务端会将事件通知到感兴趣的客户端上去，该机制是 Zookeeper 实现分布式协调服务的重要特性。**\n\n**2.6 ACL**\n\nZookeeper 采用 ACL（AccessControlLists）策略来进行权限控制，类似于 UNIX 文件系统的权限控制。Zookeeper 定义了如下 5 种权限。\n\n![](/images/zookeeper/ff857235dba54561a41ff49bbea15795.jpg)\n\n其中尤其需要注意的是，CREATE 和 DELETE 这两种权限都是针对子节点的权限控制。\n\n# **三 ZooKeeper 特点**\n\n**● 顺序一致性：** 从同一客户端发起的事务请求，最终将会严格地按照顺序被应用到 ZooKeeper 中去。\n\n**● 原子性：** 所有事务请求的处理结果在整个集群中所有机器上的应用情况是一致的，也就是说，要么整个集群中所有的机器都成功应用了某一个事务，要么都没有应用。\n\n**● 单一系统映像 ：** 无论客户端连到哪一个 ZooKeeper 服务器上，其看到的服务端数据模型都是一致的。\n\n**● 可靠性：** 一旦一次更改请求被应用，更改的结果就会被持久化，直到被下一次更改覆盖。\n\n# 四 ZooKeeper 设计目标\n\n**4.1 简单的数据模型**\n\nZooKeeper 允许分布式进程通过共享的层次结构命名空间进行相互协调，这与标准文件系统类似。 名称空间由 ZooKeeper 中的数据寄存器组成 - 称为 znode，这些类似于文件和目录。 与为存储设计的典型文件系统不同，ZooKeeper 数据保存在内存中，这意味着 ZooKeeper 可以实现高吞吐量和低延迟。\n\n![](/images/zookeeper/13c3e24881a7471cb180590d884568ba.jpg)\n\n**4.2 可构建集群**\n\n**为了保证高可用，最好是以集群形态来部署 ZooKeeper，这样只要集群中大部分机器是可用的（能够容忍一定的机器故障），那么 zookeeper 本身仍然是可用的。** 客户端在使用 ZooKeeper 时，需要知道集群机器列表，通过与集群中的某一台机器建立 TCP 连接来使用服务，客户端使用这个 TCP 链接来发送请求、获取结果、获取监听事件以及发送心跳包。如果这个连接异常断开了，客户端可以连接到另外的机器上。\n\n**ZooKeeper 官方提供的架构图：**\n\n![](/images/zookeeper/zkservice.jpg)\n\n上图中每一个 Server 代表一个安装 Zookeeper 服务的服务器。组成 ZooKeeper 服务的服务器都会在内存中维护当前的服务器状态，并且每台服务器之间都互相保持着通信。集群间通过 Zab 协议（Zookeeper Atomic Broadcast）来保持数据的一致性。\n\n**4.3 顺序访问**\n\n**对于来自客户端的每个更新请求，ZooKeeper 都会分配一个全局唯一的递增编号，这个编号反应了所有事务操作的先后顺序，应用程序可以使用 ZooKeeper 这个特性来实现更高层次的同步原语。** **这个编号也叫做时间戳——zxid（Zookeeper Transaction Id）**\n\n**4.4 高性能**\n\n**ZooKeeper 是高性能的。 在 “读” 多于 “写” 的应用程序中尤其地高性能，因为 “写” 会导致所有的服务器间同步状态。（“读”多于 “写” 是协调服务的典型场景。）**\n\n# 五 ZooKeeper 集群角色介绍\n\n**最典型集群模式： Master/Slave 模式（主备模式）**。在这种模式中，通常 Master 服务器作为主服务器提供写服务，其他的 Slave 服务器从服务器通过异步复制的方式获取 Master 服务器最新的数据提供读服务。\n\n但是，**在 ZooKeeper 中没有选择传统的 Master/Slave 概念，而是引入了 Leader、Follower 和 Observer 三种角色**。如下图所示\n\n![](/images/zookeeper/6102d866d5e14718958b2a0ab193e9ea.jpg)\n\n**ZooKeeper 集群中的所有机器通过一个 Leader 选举过程来选定一台称为 “Leader” 的机器，Leader 既可以为客户端提供写服务又能提供读服务。除了 Leader 外，Follower 和 Observer 都只能提供读服务。Follower 和 Observer 唯一的区别在于 Observer 机器不参与 Leader 的选举过程，也不参与写操作的 “过半写成功” 策略，因此 Observer 机器可以在不影响写性能的情况下提升集群的读性能。**\n\n![](/images/zookeeper/f04752a7eb974518b9221e509f14cc00.jpg)\n\n# 六 ZooKeeper &ZAB 协议 & Paxos 算法\n\n**6.1 ZAB 协议 & Paxos 算法**\n\nPaxos 算法应该可以说是 ZooKeeper 的灵魂了。但是，ZooKeeper 并没有完全采用 Paxos 算法 ，而是使用 ZAB 协议作为其保证数据一致性的核心算法。另外，在 ZooKeeper 的官方文档中也指出，ZAB 协议并不像 Paxos 算法那样，是一种通用的分布式一致性算法，它是一种特别为 Zookeeper 设计的崩溃可恢复的原子消息广播算法。\n\n**6.2 ZAB 协议介绍**\n\n**ZAB（ZooKeeper Atomic Broadcast 原子广播） 协议是为分布式协调服务 ZooKeeper 专门设计的一种支持崩溃恢复的原子广播协议。 在 ZooKeeper 中，主要依赖 ZAB 协议来实现分布式数据一致性，基于该协议，ZooKeeper 实现了一种主备模式的系统架构来保持集群中各个副本之间的数据一致性。**\n\n**6.3 ZAB 协议两种基本的模式：崩溃恢复和消息广播**\n\nZAB 协议包括两种基本的模式，分别是 **崩溃恢复和消息广播**。当整个服务框架在启动过程中，或是当 Leader 服务器出现网络中断、崩溃退出与重启等异常情况时，ZAB 协议就会进人恢复模式并选举产生新的 Leader 服务器。当选举产生了新的 Leader 服务器，同时集群中已经有过半的机器与该 Leader 服务器完成了状态同步之后，ZAB 协议就会退出恢复模式。其中，**所谓的状态同步是指数据同步，用来保证集群中存在过半的机器能够和 Leader 服务器的数据状态保持一致**。\n\n**当集群中已经有过半的 Follower 服务器完成了和 Leader 服务器的状态同步，那么整个服务框架就可以进人消息广播模式了。** 当一台同样遵守 ZAB 协议的服务器启动后加人到集群中时，如果此时集群中已经存在一个 Leader 服务器在负责进行消息广播，那么新加人的服务器就会自觉地进人数据恢复模式：找到 Leader 所在的服务器，并与其进行数据同步，然后一起参与到消息广播流程中去。正如上文介绍中所说的，ZooKeeper 设计成只允许唯一的一个 Leader 服务器来进行事务请求的处理。Leader 服务器在接收到客户端的事务请求后，会生成对应的事务提案并发起一轮广播协议；而如果集群中的其他机器接收到客户端的事务请求，那么这些非 Leader 服务器会首先将这个事务请求转发给 Leader 服务器。\n\n# 七 总结\n\n通过阅读本文，想必大家已从 **①ZooKeeper 的由来。** -> **②ZooKeeper 到底是什么 。**-> **③ ZooKeeper 的一些重要概念**（会话（Session）、 Znode、版本、Watcher、ACL）-> **④ZooKeeper 的特点。** -> **⑤ZooKeeper 的设计目标。**-> **⑥ ZooKeeper 集群角色介绍** （Leader、Follower 和 Observer 三种角色）-> **⑦ZooKeeper &ZAB 协议 & Paxos 算法。** 这七点了解了 ZooKeeper 。","slug":"ZooKeeper介绍","published":1,"updated":"2019-01-28T05:56:18.326Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjs17mi1s003opwgtdne5xjny","content":"<h1 id=\"一-什么是-ZooKeeper\"><a href=\"#一-什么是-ZooKeeper\" class=\"headerlink\" title=\"一 什么是 ZooKeeper\"></a>一 什么是 ZooKeeper</h1><p><strong>ZooKeeper 的由来</strong></p>\n<p><strong>下面这段内容摘自《从 Paxos 到 Zookeeper 》第四章第一节的某段内容，推荐大家阅读以下：</strong></p>\n<blockquote>\n<p>Zookeeper 最早起源于雅虎研究院的一个研究小组。在当时，研究人员发现，在雅虎内部很多大型系统基本都需要依赖一个类似的系统来进行分布式协调，但是这些系统往往都存在分布式单点问题。所以，<strong>雅虎的开发人员就试图开发一个通用的无单点问题的分布式协调框架，以便让开发人员将精力集中在处理业务逻辑上。</strong></p>\n<p>关于 “ZooKeeper” 这个项目的名字，其实也有一段趣闻。在立项初期，考虑到之前内部很多项目都是使用动物的名字来命名的（例如著名的 Pig 项目), 雅虎的工程师希望给这个项目也取一个动物的名字。时任研究院的首席科学家 RaghuRamakrishnan 开玩笑地说：“在这样下去，我们这儿就变成动物园了！”此话一出，大家纷纷表示就叫动物园管理员吧一一一因为各个以动物命名的分布式组件放在一起，<strong>雅虎的整个分布式系统看上去就像一个大型的动物园了，而 Zookeeper 正好要用来进行分布式环境的协调一一于是，Zookeeper 的名字也就由此诞生了。</strong></p>\n</blockquote>\n<p><strong>1.1 ZooKeeper 概览</strong></p>\n<p>ZooKeeper 是一个开源的分布式协调服务，ZooKeeper 框架最初是在 “Yahoo!” 上构建的，用于以简单而稳健的方式访问他们的应用程序。 后来，Apache ZooKeeper 成为 Hadoop，HBase 和其他分布式框架使用的有组织服务的标准。 例如，Apache HBase 使用 ZooKeeper 跟踪分布式数据的状态。<strong>ZooKeeper 的设计目标是将那些复杂且容易出错的分布式一致性服务封装起来，构成一个高效可靠的原语集，并以一系列简单易用的接口提供给用户使用。</strong></p>\n<blockquote>\n<p><strong>原语：</strong> 操作系统或计算机网络用语范畴。是由若干条指令组成的，用于完成一定功能的一个过程。具有不可分割性 · 即原语的执行必须是连续的，在执行过程中不允许被中断。</p>\n</blockquote>\n<p><strong>ZooKeeper 是一个典型的分布式数据一致性解决方案，分布式应用程序可以基于 ZooKeeper 实现诸如数据发布 / 订阅、负载均衡、命名服务、分布式协调 / 通知、集群管理、Master 选举、分布式锁和分布式队列等功能。</strong></p>\n<p><strong>Zookeeper 一个最常用的使用场景就是用于担任服务生产者和服务消费者的注册中心。</strong> 服务生产者将自己提供的服务注册到 Zookeeper 中心，服务的消费者在进行服务调用的时候先到 Zookeeper 中查找服务，获取到服务生产者的详细信息之后，再去调用服务生产者的内容与数据。如下图所示，在 Dubbo 架构中 Zookeeper 就担任了注册中心这一角色。</p>\n<p><img src=\"/images/zookeeper/0a3e0527ec7a4dcdbbd5597d20d77fe3.jpg\" alt=\"\"></p>\n<p><strong>1.2 结合个人使用情况的讲一下 ZooKeeper</strong></p>\n<p>在我自己做过的项目中，主要使用到了 ZooKeeper 作为 Dubbo 的注册中心 (Dubbo 官方推荐使用 ZooKeeper 注册中心)。另外在搭建 solr 集群的时候，我使用 ZooKeeper 作为 solr 集群的管理工具。这时，ZooKeeper 主要提供下面几个功能：1、集群管理：容错、负载均衡。2、配置文件的集中管理 3、集群的入口。</p>\n<p>我个人觉得在使用 ZooKeeper 的时候，最好是使用 集群版的 ZooKeeper 而不是单机版的。官网给出的架构图就描述的是一个集群版的 ZooKeeper 。通常 3 台服务器就可以构成一个 ZooKeeper 集群了。</p>\n<p><strong>为什么最好使用奇数台服务器构成 ZooKeeper 集群？</strong></p>\n<p>我们知道在 Zookeeper 中 Leader 选举算法采用了 Zab 协议。Zab 核心思想是当多数 Server 写成功，则任务数据写成功。</p>\n<p>①如果有 3 个 Server，则最多允许 1 个 Server 挂掉。</p>\n<p>②如果有 4 个 Server，则同样最多允许 1 个 Server 挂掉。</p>\n<p>既然 3 个或者 4 个 Server，同样最多允许 1 个 Server 挂掉，那么它们的可靠性是一样的，所以选择奇数个 ZooKeeper Server 即可，这里选择 3 个 Server。12341234</p>\n<h1 id=\"二-关于-ZooKeeper-的一些重要概念\"><a href=\"#二-关于-ZooKeeper-的一些重要概念\" class=\"headerlink\" title=\"二 关于 ZooKeeper 的一些重要概念\"></a>二 关于 ZooKeeper 的一些重要概念</h1><p><strong>2.1 重要概念总结</strong></p>\n<p><strong>● ZooKeeper 本身就是一个分布式程序（只要半数以上节点存活，ZooKeeper 就能正常服务）。</strong></p>\n<p><strong>● 为了保证高可用，最好是以集群形态来部署 ZooKeeper，这样只要集群中大部分机器是可用的（能够容忍一定的机器故障），那么 ZooKeeper 本身仍然是可用的。</strong></p>\n<p><strong>● ZooKeeper 将数据保存在内存中，这也就保证了 高吞吐量和低延迟</strong>（但是内存限制了能够存储的容量不太大，此限制也是保持 znode 中存储的数据量较小的进一步原因）。</p>\n<p><strong>● ZooKeeper 是高性能的。 在 “读” 多于 “写” 的应用程序中尤其地高性能，因为 “写” 会导致所有的服务器间同步状态。</strong>（“读”多于 “写” 是协调服务的典型场景。）</p>\n<p><strong>● ZooKeeper 有临时节点的概念。 当创建临时节点的客户端会话一直保持活动，瞬时节点就一直存在。而当会话终结时，瞬时节点被删除。持久节点是指一旦这个 ZNode 被创建了，除非主动进行 ZNode 的移除操作，否则这个 ZNode 将一直保存在 Zookeeper 上。</strong></p>\n<p><strong>●</strong> ZooKeeper 底层其实只提供了两个功能：<br>​    ①管理（存储、读取）用户程序提交的数据；<br>​    ②为用户程序提交数据节点监听服务。</p>\n<p><strong>下面关于会话（Session）、 Znode、版本、Watcher、ACL 概念的总结都在《从 Paxos 到 Zookeeper 》第四章第一节以及第七章第八节有提到，感兴趣的可以看看！</strong></p>\n<p><strong>2.2 会话（Session）</strong></p>\n<p>Session 指的是 ZooKeeper 服务器与客户端会话。<strong>在 ZooKeeper 中，一个客户端连接是指客户端和服务器之间的一个 TCP 长连接</strong>。客户端启动的时候，首先会与服务器建立一个 TCP 连接，从第一次连接建立开始，客户端会话的生命周期也开始了。<strong>通过这个连接，客户端能够通过心跳检测与服务器保持有效的会话，也能够向 Zookeeper 服务器发送请求并接受响应，同时还能够通过该连接接收来自服务器的 Watch 事件通知。</strong> Session 的 sessionTimeout 值用来设置一个客户端会话的超时时间。当由于服务器压力太大、网络故障或是客户端主动断开连接等各种原因导致客户端连接断开时，<strong>只要在 sessionTimeout 规定的时间内能够重新连接上集群中任意一台服务器，那么之前创建的会话仍然有效。</strong></p>\n<p><strong>在为客户端创建会话之前，服务端首先会为每个客户端都分配一个 sessionID。由于 sessionID 是 Zookeeper 会话的一个重要标识，许多与会话相关的运行机制都是基于这个 sessionID 的，因此，无论是哪台服务器为客户端分配的 sessionID，都务必保证全局唯一。</strong></p>\n<p><strong>2.3 Znode</strong></p>\n<p><strong>在谈到分布式的时候，我们通常说的 “节点 “是指组成集群的每一台机器。然而，在 Zookeeper 中，“节点” 分为两类，第一类同样是指构成集群的机器，我们称之为机器节点；第二类则是指数据模型中的数据单元，我们称之为数据节点一一 ZNode。</strong></p>\n<p>Zookeeper 将所有数据存储在内存中，数据模型是一棵树（Znode Tree)，由斜杠（/）的进行分割的路径，就是一个 Znode，例如 / foo/path1。每个上都会保存自己的数据内容，同时还会保存一系列属性信息。</p>\n<blockquote>\n<p>ZooKeeper有一个分层名称空间，很像分布式文件系统。和文件系统不同的是，  zookeeper的数据存储是是结构化存储，没有文件和目录的概念，文件和目录被抽象 成了节点（node），上图中的每个node称为znode， 每个znode由三个部分组成：</p>\n<ol>\n<li>stat: 描述该znode的版本号、权限等信息。<br></li>\n<li>data:与该znode关联的数据。<br></li>\n<li>children: 该znode下的子节点</li>\n</ol>\n</blockquote>\n<p>每次znode的数据更改时，版本号都会增加。例如，每当客户端检索数据时，它会接收数据的版本。当客户端执行更新或删除时，它必须提供正在更改的znode的数据版本。如果它提供的版本与实际数据的版本不匹配，则更新失败。</p>\n<p><strong>在 Zookeeper 中，node 可以分为持久节点和临时节点两类。所谓持久节点是指一旦这个 ZNode 被创建了，除非主动进行 ZNode 的移除操作，否则这个 ZNode 将一直保存在 Zookeeper 上。而临时节点就不一样了，它的生命周期和客户端会话绑定，一旦客户端会话失效，那么这个客户端创建的所有临时节点都会被移除。</strong>另外，ZooKeeper 还允许用户为每个节点添加一个特殊的属性：<strong>SEQUENTIAL</strong>. 一旦节点被标记上这个属性，那么在这个节点被创建的时候，Zookeeper 会自动在其节点名后面追加上一个整型数字，这个整型数字是一个由父节点维护的自增数字。</p>\n<p><strong>2.4 版本</strong></p>\n<p>在前面我们已经提到，Zookeeper 的每个 ZNode 上都会存储数据，对应于每个 ZNode，Zookeeper 都会为其维护一个叫作 <strong>Stat</strong> 的数据结构，Stat 中记录了这个 ZNode 的三个数据版本，分别是 version（当前 ZNode 的版本）、cversion（当前 ZNode 子节点的版本）和 cversion（当前 ZNode 的 ACL 版本）。</p>\n<p><strong>2.5 Watcher</strong></p>\n<p><strong>Watcher（事件监听器），是 Zookeeper 中的一个很重要的特性。Zookeeper 允许用户在指定节点上注册一些 Watcher，并且在一些特定事件触发的时候，ZooKeeper 服务端会将事件通知到感兴趣的客户端上去，该机制是 Zookeeper 实现分布式协调服务的重要特性。</strong></p>\n<p><strong>2.6 ACL</strong></p>\n<p>Zookeeper 采用 ACL（AccessControlLists）策略来进行权限控制，类似于 UNIX 文件系统的权限控制。Zookeeper 定义了如下 5 种权限。</p>\n<p><img src=\"/images/zookeeper/ff857235dba54561a41ff49bbea15795.jpg\" alt=\"\"></p>\n<p>其中尤其需要注意的是，CREATE 和 DELETE 这两种权限都是针对子节点的权限控制。</p>\n<h1 id=\"三-ZooKeeper-特点\"><a href=\"#三-ZooKeeper-特点\" class=\"headerlink\" title=\"三 ZooKeeper 特点\"></a><strong>三 ZooKeeper 特点</strong></h1><p><strong>● 顺序一致性：</strong> 从同一客户端发起的事务请求，最终将会严格地按照顺序被应用到 ZooKeeper 中去。</p>\n<p><strong>● 原子性：</strong> 所有事务请求的处理结果在整个集群中所有机器上的应用情况是一致的，也就是说，要么整个集群中所有的机器都成功应用了某一个事务，要么都没有应用。</p>\n<p><strong>● 单一系统映像 ：</strong> 无论客户端连到哪一个 ZooKeeper 服务器上，其看到的服务端数据模型都是一致的。</p>\n<p><strong>● 可靠性：</strong> 一旦一次更改请求被应用，更改的结果就会被持久化，直到被下一次更改覆盖。</p>\n<h1 id=\"四-ZooKeeper-设计目标\"><a href=\"#四-ZooKeeper-设计目标\" class=\"headerlink\" title=\"四 ZooKeeper 设计目标\"></a>四 ZooKeeper 设计目标</h1><p><strong>4.1 简单的数据模型</strong></p>\n<p>ZooKeeper 允许分布式进程通过共享的层次结构命名空间进行相互协调，这与标准文件系统类似。 名称空间由 ZooKeeper 中的数据寄存器组成 - 称为 znode，这些类似于文件和目录。 与为存储设计的典型文件系统不同，ZooKeeper 数据保存在内存中，这意味着 ZooKeeper 可以实现高吞吐量和低延迟。</p>\n<p><img src=\"/images/zookeeper/13c3e24881a7471cb180590d884568ba.jpg\" alt=\"\"></p>\n<p><strong>4.2 可构建集群</strong></p>\n<p><strong>为了保证高可用，最好是以集群形态来部署 ZooKeeper，这样只要集群中大部分机器是可用的（能够容忍一定的机器故障），那么 zookeeper 本身仍然是可用的。</strong> 客户端在使用 ZooKeeper 时，需要知道集群机器列表，通过与集群中的某一台机器建立 TCP 连接来使用服务，客户端使用这个 TCP 链接来发送请求、获取结果、获取监听事件以及发送心跳包。如果这个连接异常断开了，客户端可以连接到另外的机器上。</p>\n<p><strong>ZooKeeper 官方提供的架构图：</strong></p>\n<p><img src=\"/images/zookeeper/zkservice.jpg\" alt=\"\"></p>\n<p>上图中每一个 Server 代表一个安装 Zookeeper 服务的服务器。组成 ZooKeeper 服务的服务器都会在内存中维护当前的服务器状态，并且每台服务器之间都互相保持着通信。集群间通过 Zab 协议（Zookeeper Atomic Broadcast）来保持数据的一致性。</p>\n<p><strong>4.3 顺序访问</strong></p>\n<p><strong>对于来自客户端的每个更新请求，ZooKeeper 都会分配一个全局唯一的递增编号，这个编号反应了所有事务操作的先后顺序，应用程序可以使用 ZooKeeper 这个特性来实现更高层次的同步原语。</strong> <strong>这个编号也叫做时间戳——zxid（Zookeeper Transaction Id）</strong></p>\n<p><strong>4.4 高性能</strong></p>\n<p><strong>ZooKeeper 是高性能的。 在 “读” 多于 “写” 的应用程序中尤其地高性能，因为 “写” 会导致所有的服务器间同步状态。（“读”多于 “写” 是协调服务的典型场景。）</strong></p>\n<h1 id=\"五-ZooKeeper-集群角色介绍\"><a href=\"#五-ZooKeeper-集群角色介绍\" class=\"headerlink\" title=\"五 ZooKeeper 集群角色介绍\"></a>五 ZooKeeper 集群角色介绍</h1><p><strong>最典型集群模式： Master/Slave 模式（主备模式）</strong>。在这种模式中，通常 Master 服务器作为主服务器提供写服务，其他的 Slave 服务器从服务器通过异步复制的方式获取 Master 服务器最新的数据提供读服务。</p>\n<p>但是，<strong>在 ZooKeeper 中没有选择传统的 Master/Slave 概念，而是引入了 Leader、Follower 和 Observer 三种角色</strong>。如下图所示</p>\n<p><img src=\"/images/zookeeper/6102d866d5e14718958b2a0ab193e9ea.jpg\" alt=\"\"></p>\n<p><strong>ZooKeeper 集群中的所有机器通过一个 Leader 选举过程来选定一台称为 “Leader” 的机器，Leader 既可以为客户端提供写服务又能提供读服务。除了 Leader 外，Follower 和 Observer 都只能提供读服务。Follower 和 Observer 唯一的区别在于 Observer 机器不参与 Leader 的选举过程，也不参与写操作的 “过半写成功” 策略，因此 Observer 机器可以在不影响写性能的情况下提升集群的读性能。</strong></p>\n<p><img src=\"/images/zookeeper/f04752a7eb974518b9221e509f14cc00.jpg\" alt=\"\"></p>\n<h1 id=\"六-ZooKeeper-amp-ZAB-协议-amp-Paxos-算法\"><a href=\"#六-ZooKeeper-amp-ZAB-协议-amp-Paxos-算法\" class=\"headerlink\" title=\"六 ZooKeeper &amp;ZAB 协议 &amp; Paxos 算法\"></a>六 ZooKeeper &amp;ZAB 协议 &amp; Paxos 算法</h1><p><strong>6.1 ZAB 协议 &amp; Paxos 算法</strong></p>\n<p>Paxos 算法应该可以说是 ZooKeeper 的灵魂了。但是，ZooKeeper 并没有完全采用 Paxos 算法 ，而是使用 ZAB 协议作为其保证数据一致性的核心算法。另外，在 ZooKeeper 的官方文档中也指出，ZAB 协议并不像 Paxos 算法那样，是一种通用的分布式一致性算法，它是一种特别为 Zookeeper 设计的崩溃可恢复的原子消息广播算法。</p>\n<p><strong>6.2 ZAB 协议介绍</strong></p>\n<p><strong>ZAB（ZooKeeper Atomic Broadcast 原子广播） 协议是为分布式协调服务 ZooKeeper 专门设计的一种支持崩溃恢复的原子广播协议。 在 ZooKeeper 中，主要依赖 ZAB 协议来实现分布式数据一致性，基于该协议，ZooKeeper 实现了一种主备模式的系统架构来保持集群中各个副本之间的数据一致性。</strong></p>\n<p><strong>6.3 ZAB 协议两种基本的模式：崩溃恢复和消息广播</strong></p>\n<p>ZAB 协议包括两种基本的模式，分别是 <strong>崩溃恢复和消息广播</strong>。当整个服务框架在启动过程中，或是当 Leader 服务器出现网络中断、崩溃退出与重启等异常情况时，ZAB 协议就会进人恢复模式并选举产生新的 Leader 服务器。当选举产生了新的 Leader 服务器，同时集群中已经有过半的机器与该 Leader 服务器完成了状态同步之后，ZAB 协议就会退出恢复模式。其中，<strong>所谓的状态同步是指数据同步，用来保证集群中存在过半的机器能够和 Leader 服务器的数据状态保持一致</strong>。</p>\n<p><strong>当集群中已经有过半的 Follower 服务器完成了和 Leader 服务器的状态同步，那么整个服务框架就可以进人消息广播模式了。</strong> 当一台同样遵守 ZAB 协议的服务器启动后加人到集群中时，如果此时集群中已经存在一个 Leader 服务器在负责进行消息广播，那么新加人的服务器就会自觉地进人数据恢复模式：找到 Leader 所在的服务器，并与其进行数据同步，然后一起参与到消息广播流程中去。正如上文介绍中所说的，ZooKeeper 设计成只允许唯一的一个 Leader 服务器来进行事务请求的处理。Leader 服务器在接收到客户端的事务请求后，会生成对应的事务提案并发起一轮广播协议；而如果集群中的其他机器接收到客户端的事务请求，那么这些非 Leader 服务器会首先将这个事务请求转发给 Leader 服务器。</p>\n<h1 id=\"七-总结\"><a href=\"#七-总结\" class=\"headerlink\" title=\"七 总结\"></a>七 总结</h1><p>通过阅读本文，想必大家已从 <strong>①ZooKeeper 的由来。</strong> -&gt; <strong>②ZooKeeper 到底是什么 。</strong>-&gt; <strong>③ ZooKeeper 的一些重要概念</strong>（会话（Session）、 Znode、版本、Watcher、ACL）-&gt; <strong>④ZooKeeper 的特点。</strong> -&gt; <strong>⑤ZooKeeper 的设计目标。</strong>-&gt; <strong>⑥ ZooKeeper 集群角色介绍</strong> （Leader、Follower 和 Observer 三种角色）-&gt; <strong>⑦ZooKeeper &amp;ZAB 协议 &amp; Paxos 算法。</strong> 这七点了解了 ZooKeeper 。</p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"一-什么是-ZooKeeper\"><a href=\"#一-什么是-ZooKeeper\" class=\"headerlink\" title=\"一 什么是 ZooKeeper\"></a>一 什么是 ZooKeeper</h1><p><strong>ZooKeeper 的由来</strong></p>\n<p><strong>下面这段内容摘自《从 Paxos 到 Zookeeper 》第四章第一节的某段内容，推荐大家阅读以下：</strong></p>\n<blockquote>\n<p>Zookeeper 最早起源于雅虎研究院的一个研究小组。在当时，研究人员发现，在雅虎内部很多大型系统基本都需要依赖一个类似的系统来进行分布式协调，但是这些系统往往都存在分布式单点问题。所以，<strong>雅虎的开发人员就试图开发一个通用的无单点问题的分布式协调框架，以便让开发人员将精力集中在处理业务逻辑上。</strong></p>\n<p>关于 “ZooKeeper” 这个项目的名字，其实也有一段趣闻。在立项初期，考虑到之前内部很多项目都是使用动物的名字来命名的（例如著名的 Pig 项目), 雅虎的工程师希望给这个项目也取一个动物的名字。时任研究院的首席科学家 RaghuRamakrishnan 开玩笑地说：“在这样下去，我们这儿就变成动物园了！”此话一出，大家纷纷表示就叫动物园管理员吧一一一因为各个以动物命名的分布式组件放在一起，<strong>雅虎的整个分布式系统看上去就像一个大型的动物园了，而 Zookeeper 正好要用来进行分布式环境的协调一一于是，Zookeeper 的名字也就由此诞生了。</strong></p>\n</blockquote>\n<p><strong>1.1 ZooKeeper 概览</strong></p>\n<p>ZooKeeper 是一个开源的分布式协调服务，ZooKeeper 框架最初是在 “Yahoo!” 上构建的，用于以简单而稳健的方式访问他们的应用程序。 后来，Apache ZooKeeper 成为 Hadoop，HBase 和其他分布式框架使用的有组织服务的标准。 例如，Apache HBase 使用 ZooKeeper 跟踪分布式数据的状态。<strong>ZooKeeper 的设计目标是将那些复杂且容易出错的分布式一致性服务封装起来，构成一个高效可靠的原语集，并以一系列简单易用的接口提供给用户使用。</strong></p>\n<blockquote>\n<p><strong>原语：</strong> 操作系统或计算机网络用语范畴。是由若干条指令组成的，用于完成一定功能的一个过程。具有不可分割性 · 即原语的执行必须是连续的，在执行过程中不允许被中断。</p>\n</blockquote>\n<p><strong>ZooKeeper 是一个典型的分布式数据一致性解决方案，分布式应用程序可以基于 ZooKeeper 实现诸如数据发布 / 订阅、负载均衡、命名服务、分布式协调 / 通知、集群管理、Master 选举、分布式锁和分布式队列等功能。</strong></p>\n<p><strong>Zookeeper 一个最常用的使用场景就是用于担任服务生产者和服务消费者的注册中心。</strong> 服务生产者将自己提供的服务注册到 Zookeeper 中心，服务的消费者在进行服务调用的时候先到 Zookeeper 中查找服务，获取到服务生产者的详细信息之后，再去调用服务生产者的内容与数据。如下图所示，在 Dubbo 架构中 Zookeeper 就担任了注册中心这一角色。</p>\n<p><img src=\"/images/zookeeper/0a3e0527ec7a4dcdbbd5597d20d77fe3.jpg\" alt=\"\"></p>\n<p><strong>1.2 结合个人使用情况的讲一下 ZooKeeper</strong></p>\n<p>在我自己做过的项目中，主要使用到了 ZooKeeper 作为 Dubbo 的注册中心 (Dubbo 官方推荐使用 ZooKeeper 注册中心)。另外在搭建 solr 集群的时候，我使用 ZooKeeper 作为 solr 集群的管理工具。这时，ZooKeeper 主要提供下面几个功能：1、集群管理：容错、负载均衡。2、配置文件的集中管理 3、集群的入口。</p>\n<p>我个人觉得在使用 ZooKeeper 的时候，最好是使用 集群版的 ZooKeeper 而不是单机版的。官网给出的架构图就描述的是一个集群版的 ZooKeeper 。通常 3 台服务器就可以构成一个 ZooKeeper 集群了。</p>\n<p><strong>为什么最好使用奇数台服务器构成 ZooKeeper 集群？</strong></p>\n<p>我们知道在 Zookeeper 中 Leader 选举算法采用了 Zab 协议。Zab 核心思想是当多数 Server 写成功，则任务数据写成功。</p>\n<p>①如果有 3 个 Server，则最多允许 1 个 Server 挂掉。</p>\n<p>②如果有 4 个 Server，则同样最多允许 1 个 Server 挂掉。</p>\n<p>既然 3 个或者 4 个 Server，同样最多允许 1 个 Server 挂掉，那么它们的可靠性是一样的，所以选择奇数个 ZooKeeper Server 即可，这里选择 3 个 Server。12341234</p>\n<h1 id=\"二-关于-ZooKeeper-的一些重要概念\"><a href=\"#二-关于-ZooKeeper-的一些重要概念\" class=\"headerlink\" title=\"二 关于 ZooKeeper 的一些重要概念\"></a>二 关于 ZooKeeper 的一些重要概念</h1><p><strong>2.1 重要概念总结</strong></p>\n<p><strong>● ZooKeeper 本身就是一个分布式程序（只要半数以上节点存活，ZooKeeper 就能正常服务）。</strong></p>\n<p><strong>● 为了保证高可用，最好是以集群形态来部署 ZooKeeper，这样只要集群中大部分机器是可用的（能够容忍一定的机器故障），那么 ZooKeeper 本身仍然是可用的。</strong></p>\n<p><strong>● ZooKeeper 将数据保存在内存中，这也就保证了 高吞吐量和低延迟</strong>（但是内存限制了能够存储的容量不太大，此限制也是保持 znode 中存储的数据量较小的进一步原因）。</p>\n<p><strong>● ZooKeeper 是高性能的。 在 “读” 多于 “写” 的应用程序中尤其地高性能，因为 “写” 会导致所有的服务器间同步状态。</strong>（“读”多于 “写” 是协调服务的典型场景。）</p>\n<p><strong>● ZooKeeper 有临时节点的概念。 当创建临时节点的客户端会话一直保持活动，瞬时节点就一直存在。而当会话终结时，瞬时节点被删除。持久节点是指一旦这个 ZNode 被创建了，除非主动进行 ZNode 的移除操作，否则这个 ZNode 将一直保存在 Zookeeper 上。</strong></p>\n<p><strong>●</strong> ZooKeeper 底层其实只提供了两个功能：<br>​    ①管理（存储、读取）用户程序提交的数据；<br>​    ②为用户程序提交数据节点监听服务。</p>\n<p><strong>下面关于会话（Session）、 Znode、版本、Watcher、ACL 概念的总结都在《从 Paxos 到 Zookeeper 》第四章第一节以及第七章第八节有提到，感兴趣的可以看看！</strong></p>\n<p><strong>2.2 会话（Session）</strong></p>\n<p>Session 指的是 ZooKeeper 服务器与客户端会话。<strong>在 ZooKeeper 中，一个客户端连接是指客户端和服务器之间的一个 TCP 长连接</strong>。客户端启动的时候，首先会与服务器建立一个 TCP 连接，从第一次连接建立开始，客户端会话的生命周期也开始了。<strong>通过这个连接，客户端能够通过心跳检测与服务器保持有效的会话，也能够向 Zookeeper 服务器发送请求并接受响应，同时还能够通过该连接接收来自服务器的 Watch 事件通知。</strong> Session 的 sessionTimeout 值用来设置一个客户端会话的超时时间。当由于服务器压力太大、网络故障或是客户端主动断开连接等各种原因导致客户端连接断开时，<strong>只要在 sessionTimeout 规定的时间内能够重新连接上集群中任意一台服务器，那么之前创建的会话仍然有效。</strong></p>\n<p><strong>在为客户端创建会话之前，服务端首先会为每个客户端都分配一个 sessionID。由于 sessionID 是 Zookeeper 会话的一个重要标识，许多与会话相关的运行机制都是基于这个 sessionID 的，因此，无论是哪台服务器为客户端分配的 sessionID，都务必保证全局唯一。</strong></p>\n<p><strong>2.3 Znode</strong></p>\n<p><strong>在谈到分布式的时候，我们通常说的 “节点 “是指组成集群的每一台机器。然而，在 Zookeeper 中，“节点” 分为两类，第一类同样是指构成集群的机器，我们称之为机器节点；第二类则是指数据模型中的数据单元，我们称之为数据节点一一 ZNode。</strong></p>\n<p>Zookeeper 将所有数据存储在内存中，数据模型是一棵树（Znode Tree)，由斜杠（/）的进行分割的路径，就是一个 Znode，例如 / foo/path1。每个上都会保存自己的数据内容，同时还会保存一系列属性信息。</p>\n<blockquote>\n<p>ZooKeeper有一个分层名称空间，很像分布式文件系统。和文件系统不同的是，  zookeeper的数据存储是是结构化存储，没有文件和目录的概念，文件和目录被抽象 成了节点（node），上图中的每个node称为znode， 每个znode由三个部分组成：</p>\n<ol>\n<li>stat: 描述该znode的版本号、权限等信息。<br></li>\n<li>data:与该znode关联的数据。<br></li>\n<li>children: 该znode下的子节点</li>\n</ol>\n</blockquote>\n<p>每次znode的数据更改时，版本号都会增加。例如，每当客户端检索数据时，它会接收数据的版本。当客户端执行更新或删除时，它必须提供正在更改的znode的数据版本。如果它提供的版本与实际数据的版本不匹配，则更新失败。</p>\n<p><strong>在 Zookeeper 中，node 可以分为持久节点和临时节点两类。所谓持久节点是指一旦这个 ZNode 被创建了，除非主动进行 ZNode 的移除操作，否则这个 ZNode 将一直保存在 Zookeeper 上。而临时节点就不一样了，它的生命周期和客户端会话绑定，一旦客户端会话失效，那么这个客户端创建的所有临时节点都会被移除。</strong>另外，ZooKeeper 还允许用户为每个节点添加一个特殊的属性：<strong>SEQUENTIAL</strong>. 一旦节点被标记上这个属性，那么在这个节点被创建的时候，Zookeeper 会自动在其节点名后面追加上一个整型数字，这个整型数字是一个由父节点维护的自增数字。</p>\n<p><strong>2.4 版本</strong></p>\n<p>在前面我们已经提到，Zookeeper 的每个 ZNode 上都会存储数据，对应于每个 ZNode，Zookeeper 都会为其维护一个叫作 <strong>Stat</strong> 的数据结构，Stat 中记录了这个 ZNode 的三个数据版本，分别是 version（当前 ZNode 的版本）、cversion（当前 ZNode 子节点的版本）和 cversion（当前 ZNode 的 ACL 版本）。</p>\n<p><strong>2.5 Watcher</strong></p>\n<p><strong>Watcher（事件监听器），是 Zookeeper 中的一个很重要的特性。Zookeeper 允许用户在指定节点上注册一些 Watcher，并且在一些特定事件触发的时候，ZooKeeper 服务端会将事件通知到感兴趣的客户端上去，该机制是 Zookeeper 实现分布式协调服务的重要特性。</strong></p>\n<p><strong>2.6 ACL</strong></p>\n<p>Zookeeper 采用 ACL（AccessControlLists）策略来进行权限控制，类似于 UNIX 文件系统的权限控制。Zookeeper 定义了如下 5 种权限。</p>\n<p><img src=\"/images/zookeeper/ff857235dba54561a41ff49bbea15795.jpg\" alt=\"\"></p>\n<p>其中尤其需要注意的是，CREATE 和 DELETE 这两种权限都是针对子节点的权限控制。</p>\n<h1 id=\"三-ZooKeeper-特点\"><a href=\"#三-ZooKeeper-特点\" class=\"headerlink\" title=\"三 ZooKeeper 特点\"></a><strong>三 ZooKeeper 特点</strong></h1><p><strong>● 顺序一致性：</strong> 从同一客户端发起的事务请求，最终将会严格地按照顺序被应用到 ZooKeeper 中去。</p>\n<p><strong>● 原子性：</strong> 所有事务请求的处理结果在整个集群中所有机器上的应用情况是一致的，也就是说，要么整个集群中所有的机器都成功应用了某一个事务，要么都没有应用。</p>\n<p><strong>● 单一系统映像 ：</strong> 无论客户端连到哪一个 ZooKeeper 服务器上，其看到的服务端数据模型都是一致的。</p>\n<p><strong>● 可靠性：</strong> 一旦一次更改请求被应用，更改的结果就会被持久化，直到被下一次更改覆盖。</p>\n<h1 id=\"四-ZooKeeper-设计目标\"><a href=\"#四-ZooKeeper-设计目标\" class=\"headerlink\" title=\"四 ZooKeeper 设计目标\"></a>四 ZooKeeper 设计目标</h1><p><strong>4.1 简单的数据模型</strong></p>\n<p>ZooKeeper 允许分布式进程通过共享的层次结构命名空间进行相互协调，这与标准文件系统类似。 名称空间由 ZooKeeper 中的数据寄存器组成 - 称为 znode，这些类似于文件和目录。 与为存储设计的典型文件系统不同，ZooKeeper 数据保存在内存中，这意味着 ZooKeeper 可以实现高吞吐量和低延迟。</p>\n<p><img src=\"/images/zookeeper/13c3e24881a7471cb180590d884568ba.jpg\" alt=\"\"></p>\n<p><strong>4.2 可构建集群</strong></p>\n<p><strong>为了保证高可用，最好是以集群形态来部署 ZooKeeper，这样只要集群中大部分机器是可用的（能够容忍一定的机器故障），那么 zookeeper 本身仍然是可用的。</strong> 客户端在使用 ZooKeeper 时，需要知道集群机器列表，通过与集群中的某一台机器建立 TCP 连接来使用服务，客户端使用这个 TCP 链接来发送请求、获取结果、获取监听事件以及发送心跳包。如果这个连接异常断开了，客户端可以连接到另外的机器上。</p>\n<p><strong>ZooKeeper 官方提供的架构图：</strong></p>\n<p><img src=\"/images/zookeeper/zkservice.jpg\" alt=\"\"></p>\n<p>上图中每一个 Server 代表一个安装 Zookeeper 服务的服务器。组成 ZooKeeper 服务的服务器都会在内存中维护当前的服务器状态，并且每台服务器之间都互相保持着通信。集群间通过 Zab 协议（Zookeeper Atomic Broadcast）来保持数据的一致性。</p>\n<p><strong>4.3 顺序访问</strong></p>\n<p><strong>对于来自客户端的每个更新请求，ZooKeeper 都会分配一个全局唯一的递增编号，这个编号反应了所有事务操作的先后顺序，应用程序可以使用 ZooKeeper 这个特性来实现更高层次的同步原语。</strong> <strong>这个编号也叫做时间戳——zxid（Zookeeper Transaction Id）</strong></p>\n<p><strong>4.4 高性能</strong></p>\n<p><strong>ZooKeeper 是高性能的。 在 “读” 多于 “写” 的应用程序中尤其地高性能，因为 “写” 会导致所有的服务器间同步状态。（“读”多于 “写” 是协调服务的典型场景。）</strong></p>\n<h1 id=\"五-ZooKeeper-集群角色介绍\"><a href=\"#五-ZooKeeper-集群角色介绍\" class=\"headerlink\" title=\"五 ZooKeeper 集群角色介绍\"></a>五 ZooKeeper 集群角色介绍</h1><p><strong>最典型集群模式： Master/Slave 模式（主备模式）</strong>。在这种模式中，通常 Master 服务器作为主服务器提供写服务，其他的 Slave 服务器从服务器通过异步复制的方式获取 Master 服务器最新的数据提供读服务。</p>\n<p>但是，<strong>在 ZooKeeper 中没有选择传统的 Master/Slave 概念，而是引入了 Leader、Follower 和 Observer 三种角色</strong>。如下图所示</p>\n<p><img src=\"/images/zookeeper/6102d866d5e14718958b2a0ab193e9ea.jpg\" alt=\"\"></p>\n<p><strong>ZooKeeper 集群中的所有机器通过一个 Leader 选举过程来选定一台称为 “Leader” 的机器，Leader 既可以为客户端提供写服务又能提供读服务。除了 Leader 外，Follower 和 Observer 都只能提供读服务。Follower 和 Observer 唯一的区别在于 Observer 机器不参与 Leader 的选举过程，也不参与写操作的 “过半写成功” 策略，因此 Observer 机器可以在不影响写性能的情况下提升集群的读性能。</strong></p>\n<p><img src=\"/images/zookeeper/f04752a7eb974518b9221e509f14cc00.jpg\" alt=\"\"></p>\n<h1 id=\"六-ZooKeeper-amp-ZAB-协议-amp-Paxos-算法\"><a href=\"#六-ZooKeeper-amp-ZAB-协议-amp-Paxos-算法\" class=\"headerlink\" title=\"六 ZooKeeper &amp;ZAB 协议 &amp; Paxos 算法\"></a>六 ZooKeeper &amp;ZAB 协议 &amp; Paxos 算法</h1><p><strong>6.1 ZAB 协议 &amp; Paxos 算法</strong></p>\n<p>Paxos 算法应该可以说是 ZooKeeper 的灵魂了。但是，ZooKeeper 并没有完全采用 Paxos 算法 ，而是使用 ZAB 协议作为其保证数据一致性的核心算法。另外，在 ZooKeeper 的官方文档中也指出，ZAB 协议并不像 Paxos 算法那样，是一种通用的分布式一致性算法，它是一种特别为 Zookeeper 设计的崩溃可恢复的原子消息广播算法。</p>\n<p><strong>6.2 ZAB 协议介绍</strong></p>\n<p><strong>ZAB（ZooKeeper Atomic Broadcast 原子广播） 协议是为分布式协调服务 ZooKeeper 专门设计的一种支持崩溃恢复的原子广播协议。 在 ZooKeeper 中，主要依赖 ZAB 协议来实现分布式数据一致性，基于该协议，ZooKeeper 实现了一种主备模式的系统架构来保持集群中各个副本之间的数据一致性。</strong></p>\n<p><strong>6.3 ZAB 协议两种基本的模式：崩溃恢复和消息广播</strong></p>\n<p>ZAB 协议包括两种基本的模式，分别是 <strong>崩溃恢复和消息广播</strong>。当整个服务框架在启动过程中，或是当 Leader 服务器出现网络中断、崩溃退出与重启等异常情况时，ZAB 协议就会进人恢复模式并选举产生新的 Leader 服务器。当选举产生了新的 Leader 服务器，同时集群中已经有过半的机器与该 Leader 服务器完成了状态同步之后，ZAB 协议就会退出恢复模式。其中，<strong>所谓的状态同步是指数据同步，用来保证集群中存在过半的机器能够和 Leader 服务器的数据状态保持一致</strong>。</p>\n<p><strong>当集群中已经有过半的 Follower 服务器完成了和 Leader 服务器的状态同步，那么整个服务框架就可以进人消息广播模式了。</strong> 当一台同样遵守 ZAB 协议的服务器启动后加人到集群中时，如果此时集群中已经存在一个 Leader 服务器在负责进行消息广播，那么新加人的服务器就会自觉地进人数据恢复模式：找到 Leader 所在的服务器，并与其进行数据同步，然后一起参与到消息广播流程中去。正如上文介绍中所说的，ZooKeeper 设计成只允许唯一的一个 Leader 服务器来进行事务请求的处理。Leader 服务器在接收到客户端的事务请求后，会生成对应的事务提案并发起一轮广播协议；而如果集群中的其他机器接收到客户端的事务请求，那么这些非 Leader 服务器会首先将这个事务请求转发给 Leader 服务器。</p>\n<h1 id=\"七-总结\"><a href=\"#七-总结\" class=\"headerlink\" title=\"七 总结\"></a>七 总结</h1><p>通过阅读本文，想必大家已从 <strong>①ZooKeeper 的由来。</strong> -&gt; <strong>②ZooKeeper 到底是什么 。</strong>-&gt; <strong>③ ZooKeeper 的一些重要概念</strong>（会话（Session）、 Znode、版本、Watcher、ACL）-&gt; <strong>④ZooKeeper 的特点。</strong> -&gt; <strong>⑤ZooKeeper 的设计目标。</strong>-&gt; <strong>⑥ ZooKeeper 集群角色介绍</strong> （Leader、Follower 和 Observer 三种角色）-&gt; <strong>⑦ZooKeeper &amp;ZAB 协议 &amp; Paxos 算法。</strong> 这七点了解了 ZooKeeper 。</p>\n"},{"title":"配置 MyBatis Redis 二级缓存","author":"Asia Cui","date":"2019-01-02T08:15:00.000Z","_content":"\n\n注：由于之前的文章已经配置过 Redis 这里不再赘述\n\n### [](#MyBatis-缓存介绍 \"MyBatis 缓存介绍\")MyBatis 缓存介绍\n\n#### [](#一级缓存 \"一级缓存\")一级缓存\n\nMyBatis 会在表示会话的 `SqlSession` 对象中建立一个简单的缓存，将每次查询到的结果结果缓存起来，当下次查询的时候，如果判断先前有个完全一样的查询，会直接从缓存中直接将结果取出，返回给用户，不需要再进行一次数据库查询了。\n\n一级缓存是 `SqlSession` 级别的缓存。在操作数据库时需要构造 sqlSession 对象，在对象中有一个（内存区域）数据结构（HashMap）用于存储缓存数据。不同的 sqlSession 之间的缓存数据区域（HashMap）是互相不影响的。其作用域是同一个 SqlSession，在同一个 sqlSession 中两次执行相同的 sql 语句，第一次执行完毕会将数据库中查询的数据写到缓存（内存），第二次会从缓存中获取数据将不再从数据库查询，从而提高查询效率。当一个 sqlSession 结束后该 sqlSession 中的一级缓存也就不存在了。Mybatis 默认开启一级缓存。\n\n#### [](#二级缓存 \"二级缓存\")二级缓存\n\n二级缓存是 mapper 级别的缓存，多个 `SqlSession` 去操作同一个 Mapper 的 sql 语句，多个 SqlSession 去操作数据库得到数据会存在二级缓存区域，多个 SqlSession 可以共用二级缓存，二级缓存是跨 SqlSession 的。其作用域是 mapper 的同一个 `namespace`，不同的 sqlSession 两次执行相同 namespace 下的 sql 语句且向 sql 中传递参数也相同即最终执行相同的 sql 语句，第一次执行完毕会将数据库中查询的数据写到缓存（内存），第二次会从缓存中获取数据将不再从数据库查询，从而提高查询效率。Mybatis 默认没有开启二级缓存需要在 setting 全局参数中配置开启二级缓存。\n\n### [](#配置-MyBatis-二级缓存 \"配置 MyBatis 二级缓存\")配置 MyBatis 二级缓存\n\n#### [](#开启-MyBatis-二级缓存 \"开启 MyBatis 二级缓存\")开启 MyBatis 二级缓存\n\n在 Spring Boot 配置文件中开启 MyBatis 二级缓存，配置代码如下：\n\n```yaml\nmybatis:\n  configuration:\n    cache-enabled: true\n\n```\n\n#### [](#实体类实现序列化接口并声明序列号 \"实体类实现序列化接口并声明序列号\")实体类实现序列化接口并声明序列号\n\n```java\nprivate static final long serialVersionUID = 8289770415244673535L;\n\n```\n\n##### [](#IDEA-提示生成序列号 \"IDEA 提示生成序列号\")IDEA 提示生成序列号\n\n默认情况下 Intellij IDEA 不会提示继承了 Serializable 接口的类生成 serialVersionUID 的警告。如果需要生成 serialVersionUID，需要手动配置。\n\nFile -> Settings -> Inspections -> Serialization issues -> Serialization class without ‘serialVersionUID’\n\n![](https://note.youdao.com/yws/public/resource/f453eedf1eaa47d8bf912acaf4ba0e3e/xmlnote/CC89940C2A364B6EBD88A3366C6821BA/3353)\n\n#### [](#创建相关工具类 \"创建相关工具类\")创建相关工具类\n\n##### [](#实现-Spring-ApplicationContextAware-接口，用于手动注入-Bean \"实现 Spring ApplicationContextAware 接口，用于手动注入 Bean\")实现 Spring ApplicationContextAware 接口，用于手动注入 Bean\n\n创建一个名为 `ApplicationContextHolder` 的工具类，代码如下：\n\n```java\npackage com.funtl.itoken.common.context;\n\nimport org.apache.commons.lang3.Validate;\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\nimport org.springframework.beans.BeansException;\nimport org.springframework.beans.factory.DisposableBean;\nimport org.springframework.context.ApplicationContext;\nimport org.springframework.context.ApplicationContextAware;\nimport org.springframework.stereotype.Component;\n\n@Component\npublic class ApplicationContextHolder implements ApplicationContextAware, DisposableBean {\n    private static final Logger logger = LoggerFactory.getLogger(ApplicationContextHolder.class);\n\n    private static ApplicationContext applicationContext;\n\n    /**\n     * 获取存储在静态变量中的 ApplicationContext\n     *\n     * @return\n     */\n    public static ApplicationContext getApplicationContext() {\n        assertContextInjected();\n        return applicationContext;\n    }\n\n    /**\n     * 从静态变量 applicationContext 中获取 Bean，自动转型成所赋值对象的类型\n     *\n     * @param name\n     * @param <T>\n     * @return\n     */\n    public static <T> T getBean(String name) {\n        assertContextInjected();\n        return (T) applicationContext.getBean(name);\n    }\n\n    /**\n     * 从静态变量 applicationContext 中获取 Bean，自动转型成所赋值对象的类型\n     *\n     * @param clazz\n     * @param <T>\n     * @return\n     */\n    public static <T> T getBean(Class<T> clazz) {\n        assertContextInjected();\n        return applicationContext.getBean(clazz);\n    }\n\n    /**\n     * 实现 DisposableBean 接口，在 Context 关闭时清理静态变量\n     *\n     * @throws Exception\n     */\n    public void destroy() throws Exception {\n        logger.debug(\"清除 SpringContext 中的 ApplicationContext: {}\", applicationContext);\n        applicationContext = null;\n    }\n\n    /**\n     * 实现 ApplicationContextAware 接口，注入 Context 到静态变量中\n     *\n     * @param applicationContext\n     * @throws BeansException\n     */\n    public void setApplicationContext(ApplicationContext applicationContext) throws BeansException {\n        ApplicationContextHolder.applicationContext = applicationContext;\n    }\n\n    /**\n     * 断言 Context 已经注入\n     */\n    private static void assertContextInjected() {\n        Validate.validState(applicationContext != null, \"applicationContext 属性未注入，请在 spring-context.xml 配置中定义 ApplicationContextHolder\");\n    }\n}\n\n```\n\n##### [](#实现-MyBatis-Cache-接口，用于自定义缓存为-Redis \"实现 MyBatis Cache 接口，用于自定义缓存为 Redis\")实现 MyBatis Cache 接口，用于自定义缓存为 Redis\n\n创建一个名为 `RedisCache` 的工具类，代码如下：\n\n```java\npackage com.funtl.itoken.common.utils;\n\nimport com.funtl.itoken.common.context.ApplicationContextHolder;\nimport org.apache.ibatis.cache.Cache;\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\nimport org.springframework.data.redis.core.RedisCallback;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.core.ValueOperations;\n\nimport java.util.concurrent.TimeUnit;\nimport java.util.concurrent.locks.ReadWriteLock;\nimport java.util.concurrent.locks.ReentrantReadWriteLock;\n\n/**\n * Redis 缓存工具类\n * <p>Title: RedisCache</p>\n * <p>Description: </p>\n *\n * @author Lusifer\n * @version 1.0.0\n * @date 2018/8/13 6:03\n */\npublic class RedisCache implements Cache {\n    private static final Logger logger = LoggerFactory.getLogger(RedisCache.class);\n\n    private final ReadWriteLock readWriteLock = new ReentrantReadWriteLock();\n    private final String id; // cache instance id\n    private RedisTemplate redisTemplate;\n\n    private static final long EXPIRE_TIME_IN_MINUTES = 30; // redis过期时间\n\n    public RedisCache(String id) {\n        if (id == null) {\n            throw new IllegalArgumentException(\"Cache instances require an ID\");\n        }\n        this.id = id;\n    }\n\n    @Override\n    public String getId() {\n        return id;\n    }\n\n    /**\n     * Put query result to redis\n     *\n     * @param key\n     * @param value\n     */\n    @Override\n    public void putObject(Object key, Object value) {\n        try {\n            RedisTemplate redisTemplate = getRedisTemplate();\n            ValueOperations opsForValue = redisTemplate.opsForValue();\n            opsForValue.set(key, value, EXPIRE_TIME_IN_MINUTES, TimeUnit.MINUTES);\n            logger.debug(\"Put query result to redis\");\n        } catch (Throwable t) {\n            logger.error(\"Redis put failed\", t);\n        }\n    }\n\n    /**\n     * Get cached query result from redis\n     *\n     * @param key\n     * @return\n     */\n    @Override\n    public Object getObject(Object key) {\n        try {\n            RedisTemplate redisTemplate = getRedisTemplate();\n            ValueOperations opsForValue = redisTemplate.opsForValue();\n            logger.debug(\"Get cached query result from redis\");\n//            System.out.println(\"****\" + opsForValue.get(key).toString());\n            return opsForValue.get(key);\n        } catch (Throwable t) {\n            logger.error(\"Redis get failed, fail over to db\", t);\n            return null;\n        }\n    }\n\n    /**\n     * Remove cached query result from redis\n     *\n     * @param key\n     * @return\n     */\n    @Override\n    @SuppressWarnings(\"unchecked\")\n    public Object removeObject(Object key) {\n        try {\n            RedisTemplate redisTemplate = getRedisTemplate();\n            redisTemplate.delete(key);\n            logger.debug(\"Remove cached query result from redis\");\n        } catch (Throwable t) {\n            logger.error(\"Redis remove failed\", t);\n        }\n        return null;\n    }\n\n    /**\n     * Clears this cache instance\n     */\n    @Override\n    public void clear() {\n        RedisTemplate redisTemplate = getRedisTemplate();\n        redisTemplate.execute((RedisCallback) connection -> {\n            connection.flushDb();\n            return null;\n        });\n        logger.debug(\"Clear all the cached query result from redis\");\n    }\n\n    /**\n     * This method is not used\n     *\n     * @return\n     */\n    @Override\n    public int getSize() {\n        return 0;\n    }\n\n    @Override\n    public ReadWriteLock getReadWriteLock() {\n        return readWriteLock;\n    }\n\n    private RedisTemplate getRedisTemplate() {\n        if (redisTemplate == null) {\n            redisTemplate = ApplicationContextHolder.getBean(\"redisTemplate\");\n        }\n        return redisTemplate;\n    }\n}\n\n```\n\n#### [](#Mapper-接口中增加注解 \"Mapper 接口中增加注解\")Mapper 接口中增加注解\n\n在 Mapper 接口中增加注解，声明需要使用二级缓存\n\n```java\npackage com.funtl.itoken.common.mapper;\n\nimport com.funtl.itoken.common.domain.TbSysUser;\nimport com.funtl.itoken.common.utils.RedisCache;\nimport org.apache.ibatis.annotations.CacheNamespace;\nimport tk.mybatis.mapper.MyMapper;\n\n@CacheNamespace(implementation = RedisCache.class)\npublic interface TbSysUserMapper extends MyMapper<TbSysUser> {\n}\n\n```","source":"_posts/配置MyBatis Redis 二级缓存.md","raw":"title: 配置 MyBatis Redis 二级缓存\nauthor: Asia Cui\ntags:\n  - Spring Boot\ncategories:\n  - 配置 MyBatis Redis 二级缓存\ndate: 2019-01-02 16:15:00\n---\n\n\n注：由于之前的文章已经配置过 Redis 这里不再赘述\n\n### [](#MyBatis-缓存介绍 \"MyBatis 缓存介绍\")MyBatis 缓存介绍\n\n#### [](#一级缓存 \"一级缓存\")一级缓存\n\nMyBatis 会在表示会话的 `SqlSession` 对象中建立一个简单的缓存，将每次查询到的结果结果缓存起来，当下次查询的时候，如果判断先前有个完全一样的查询，会直接从缓存中直接将结果取出，返回给用户，不需要再进行一次数据库查询了。\n\n一级缓存是 `SqlSession` 级别的缓存。在操作数据库时需要构造 sqlSession 对象，在对象中有一个（内存区域）数据结构（HashMap）用于存储缓存数据。不同的 sqlSession 之间的缓存数据区域（HashMap）是互相不影响的。其作用域是同一个 SqlSession，在同一个 sqlSession 中两次执行相同的 sql 语句，第一次执行完毕会将数据库中查询的数据写到缓存（内存），第二次会从缓存中获取数据将不再从数据库查询，从而提高查询效率。当一个 sqlSession 结束后该 sqlSession 中的一级缓存也就不存在了。Mybatis 默认开启一级缓存。\n\n#### [](#二级缓存 \"二级缓存\")二级缓存\n\n二级缓存是 mapper 级别的缓存，多个 `SqlSession` 去操作同一个 Mapper 的 sql 语句，多个 SqlSession 去操作数据库得到数据会存在二级缓存区域，多个 SqlSession 可以共用二级缓存，二级缓存是跨 SqlSession 的。其作用域是 mapper 的同一个 `namespace`，不同的 sqlSession 两次执行相同 namespace 下的 sql 语句且向 sql 中传递参数也相同即最终执行相同的 sql 语句，第一次执行完毕会将数据库中查询的数据写到缓存（内存），第二次会从缓存中获取数据将不再从数据库查询，从而提高查询效率。Mybatis 默认没有开启二级缓存需要在 setting 全局参数中配置开启二级缓存。\n\n### [](#配置-MyBatis-二级缓存 \"配置 MyBatis 二级缓存\")配置 MyBatis 二级缓存\n\n#### [](#开启-MyBatis-二级缓存 \"开启 MyBatis 二级缓存\")开启 MyBatis 二级缓存\n\n在 Spring Boot 配置文件中开启 MyBatis 二级缓存，配置代码如下：\n\n```yaml\nmybatis:\n  configuration:\n    cache-enabled: true\n\n```\n\n#### [](#实体类实现序列化接口并声明序列号 \"实体类实现序列化接口并声明序列号\")实体类实现序列化接口并声明序列号\n\n```java\nprivate static final long serialVersionUID = 8289770415244673535L;\n\n```\n\n##### [](#IDEA-提示生成序列号 \"IDEA 提示生成序列号\")IDEA 提示生成序列号\n\n默认情况下 Intellij IDEA 不会提示继承了 Serializable 接口的类生成 serialVersionUID 的警告。如果需要生成 serialVersionUID，需要手动配置。\n\nFile -> Settings -> Inspections -> Serialization issues -> Serialization class without ‘serialVersionUID’\n\n![](https://note.youdao.com/yws/public/resource/f453eedf1eaa47d8bf912acaf4ba0e3e/xmlnote/CC89940C2A364B6EBD88A3366C6821BA/3353)\n\n#### [](#创建相关工具类 \"创建相关工具类\")创建相关工具类\n\n##### [](#实现-Spring-ApplicationContextAware-接口，用于手动注入-Bean \"实现 Spring ApplicationContextAware 接口，用于手动注入 Bean\")实现 Spring ApplicationContextAware 接口，用于手动注入 Bean\n\n创建一个名为 `ApplicationContextHolder` 的工具类，代码如下：\n\n```java\npackage com.funtl.itoken.common.context;\n\nimport org.apache.commons.lang3.Validate;\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\nimport org.springframework.beans.BeansException;\nimport org.springframework.beans.factory.DisposableBean;\nimport org.springframework.context.ApplicationContext;\nimport org.springframework.context.ApplicationContextAware;\nimport org.springframework.stereotype.Component;\n\n@Component\npublic class ApplicationContextHolder implements ApplicationContextAware, DisposableBean {\n    private static final Logger logger = LoggerFactory.getLogger(ApplicationContextHolder.class);\n\n    private static ApplicationContext applicationContext;\n\n    /**\n     * 获取存储在静态变量中的 ApplicationContext\n     *\n     * @return\n     */\n    public static ApplicationContext getApplicationContext() {\n        assertContextInjected();\n        return applicationContext;\n    }\n\n    /**\n     * 从静态变量 applicationContext 中获取 Bean，自动转型成所赋值对象的类型\n     *\n     * @param name\n     * @param <T>\n     * @return\n     */\n    public static <T> T getBean(String name) {\n        assertContextInjected();\n        return (T) applicationContext.getBean(name);\n    }\n\n    /**\n     * 从静态变量 applicationContext 中获取 Bean，自动转型成所赋值对象的类型\n     *\n     * @param clazz\n     * @param <T>\n     * @return\n     */\n    public static <T> T getBean(Class<T> clazz) {\n        assertContextInjected();\n        return applicationContext.getBean(clazz);\n    }\n\n    /**\n     * 实现 DisposableBean 接口，在 Context 关闭时清理静态变量\n     *\n     * @throws Exception\n     */\n    public void destroy() throws Exception {\n        logger.debug(\"清除 SpringContext 中的 ApplicationContext: {}\", applicationContext);\n        applicationContext = null;\n    }\n\n    /**\n     * 实现 ApplicationContextAware 接口，注入 Context 到静态变量中\n     *\n     * @param applicationContext\n     * @throws BeansException\n     */\n    public void setApplicationContext(ApplicationContext applicationContext) throws BeansException {\n        ApplicationContextHolder.applicationContext = applicationContext;\n    }\n\n    /**\n     * 断言 Context 已经注入\n     */\n    private static void assertContextInjected() {\n        Validate.validState(applicationContext != null, \"applicationContext 属性未注入，请在 spring-context.xml 配置中定义 ApplicationContextHolder\");\n    }\n}\n\n```\n\n##### [](#实现-MyBatis-Cache-接口，用于自定义缓存为-Redis \"实现 MyBatis Cache 接口，用于自定义缓存为 Redis\")实现 MyBatis Cache 接口，用于自定义缓存为 Redis\n\n创建一个名为 `RedisCache` 的工具类，代码如下：\n\n```java\npackage com.funtl.itoken.common.utils;\n\nimport com.funtl.itoken.common.context.ApplicationContextHolder;\nimport org.apache.ibatis.cache.Cache;\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\nimport org.springframework.data.redis.core.RedisCallback;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.core.ValueOperations;\n\nimport java.util.concurrent.TimeUnit;\nimport java.util.concurrent.locks.ReadWriteLock;\nimport java.util.concurrent.locks.ReentrantReadWriteLock;\n\n/**\n * Redis 缓存工具类\n * <p>Title: RedisCache</p>\n * <p>Description: </p>\n *\n * @author Lusifer\n * @version 1.0.0\n * @date 2018/8/13 6:03\n */\npublic class RedisCache implements Cache {\n    private static final Logger logger = LoggerFactory.getLogger(RedisCache.class);\n\n    private final ReadWriteLock readWriteLock = new ReentrantReadWriteLock();\n    private final String id; // cache instance id\n    private RedisTemplate redisTemplate;\n\n    private static final long EXPIRE_TIME_IN_MINUTES = 30; // redis过期时间\n\n    public RedisCache(String id) {\n        if (id == null) {\n            throw new IllegalArgumentException(\"Cache instances require an ID\");\n        }\n        this.id = id;\n    }\n\n    @Override\n    public String getId() {\n        return id;\n    }\n\n    /**\n     * Put query result to redis\n     *\n     * @param key\n     * @param value\n     */\n    @Override\n    public void putObject(Object key, Object value) {\n        try {\n            RedisTemplate redisTemplate = getRedisTemplate();\n            ValueOperations opsForValue = redisTemplate.opsForValue();\n            opsForValue.set(key, value, EXPIRE_TIME_IN_MINUTES, TimeUnit.MINUTES);\n            logger.debug(\"Put query result to redis\");\n        } catch (Throwable t) {\n            logger.error(\"Redis put failed\", t);\n        }\n    }\n\n    /**\n     * Get cached query result from redis\n     *\n     * @param key\n     * @return\n     */\n    @Override\n    public Object getObject(Object key) {\n        try {\n            RedisTemplate redisTemplate = getRedisTemplate();\n            ValueOperations opsForValue = redisTemplate.opsForValue();\n            logger.debug(\"Get cached query result from redis\");\n//            System.out.println(\"****\" + opsForValue.get(key).toString());\n            return opsForValue.get(key);\n        } catch (Throwable t) {\n            logger.error(\"Redis get failed, fail over to db\", t);\n            return null;\n        }\n    }\n\n    /**\n     * Remove cached query result from redis\n     *\n     * @param key\n     * @return\n     */\n    @Override\n    @SuppressWarnings(\"unchecked\")\n    public Object removeObject(Object key) {\n        try {\n            RedisTemplate redisTemplate = getRedisTemplate();\n            redisTemplate.delete(key);\n            logger.debug(\"Remove cached query result from redis\");\n        } catch (Throwable t) {\n            logger.error(\"Redis remove failed\", t);\n        }\n        return null;\n    }\n\n    /**\n     * Clears this cache instance\n     */\n    @Override\n    public void clear() {\n        RedisTemplate redisTemplate = getRedisTemplate();\n        redisTemplate.execute((RedisCallback) connection -> {\n            connection.flushDb();\n            return null;\n        });\n        logger.debug(\"Clear all the cached query result from redis\");\n    }\n\n    /**\n     * This method is not used\n     *\n     * @return\n     */\n    @Override\n    public int getSize() {\n        return 0;\n    }\n\n    @Override\n    public ReadWriteLock getReadWriteLock() {\n        return readWriteLock;\n    }\n\n    private RedisTemplate getRedisTemplate() {\n        if (redisTemplate == null) {\n            redisTemplate = ApplicationContextHolder.getBean(\"redisTemplate\");\n        }\n        return redisTemplate;\n    }\n}\n\n```\n\n#### [](#Mapper-接口中增加注解 \"Mapper 接口中增加注解\")Mapper 接口中增加注解\n\n在 Mapper 接口中增加注解，声明需要使用二级缓存\n\n```java\npackage com.funtl.itoken.common.mapper;\n\nimport com.funtl.itoken.common.domain.TbSysUser;\nimport com.funtl.itoken.common.utils.RedisCache;\nimport org.apache.ibatis.annotations.CacheNamespace;\nimport tk.mybatis.mapper.MyMapper;\n\n@CacheNamespace(implementation = RedisCache.class)\npublic interface TbSysUserMapper extends MyMapper<TbSysUser> {\n}\n\n```","slug":"配置MyBatis Redis 二级缓存","published":1,"updated":"2019-01-02T09:56:51.199Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjs17mi1u003rpwgts2s1a1jb","content":"<p>注：由于之前的文章已经配置过 Redis 这里不再赘述</p>\n<h3 id=\"MyBatis-缓存介绍\"><a href=\"#MyBatis-缓存介绍\" class=\"headerlink\" title=\"MyBatis 缓存介绍\"></a><a href=\"#MyBatis-缓存介绍\" title=\"MyBatis 缓存介绍\"></a>MyBatis 缓存介绍</h3><h4 id=\"一级缓存\"><a href=\"#一级缓存\" class=\"headerlink\" title=\"一级缓存\"></a><a href=\"#一级缓存\" title=\"一级缓存\"></a>一级缓存</h4><p>MyBatis 会在表示会话的 <code>SqlSession</code> 对象中建立一个简单的缓存，将每次查询到的结果结果缓存起来，当下次查询的时候，如果判断先前有个完全一样的查询，会直接从缓存中直接将结果取出，返回给用户，不需要再进行一次数据库查询了。</p>\n<p>一级缓存是 <code>SqlSession</code> 级别的缓存。在操作数据库时需要构造 sqlSession 对象，在对象中有一个（内存区域）数据结构（HashMap）用于存储缓存数据。不同的 sqlSession 之间的缓存数据区域（HashMap）是互相不影响的。其作用域是同一个 SqlSession，在同一个 sqlSession 中两次执行相同的 sql 语句，第一次执行完毕会将数据库中查询的数据写到缓存（内存），第二次会从缓存中获取数据将不再从数据库查询，从而提高查询效率。当一个 sqlSession 结束后该 sqlSession 中的一级缓存也就不存在了。Mybatis 默认开启一级缓存。</p>\n<h4 id=\"二级缓存\"><a href=\"#二级缓存\" class=\"headerlink\" title=\"二级缓存\"></a><a href=\"#二级缓存\" title=\"二级缓存\"></a>二级缓存</h4><p>二级缓存是 mapper 级别的缓存，多个 <code>SqlSession</code> 去操作同一个 Mapper 的 sql 语句，多个 SqlSession 去操作数据库得到数据会存在二级缓存区域，多个 SqlSession 可以共用二级缓存，二级缓存是跨 SqlSession 的。其作用域是 mapper 的同一个 <code>namespace</code>，不同的 sqlSession 两次执行相同 namespace 下的 sql 语句且向 sql 中传递参数也相同即最终执行相同的 sql 语句，第一次执行完毕会将数据库中查询的数据写到缓存（内存），第二次会从缓存中获取数据将不再从数据库查询，从而提高查询效率。Mybatis 默认没有开启二级缓存需要在 setting 全局参数中配置开启二级缓存。</p>\n<h3 id=\"配置-MyBatis-二级缓存\"><a href=\"#配置-MyBatis-二级缓存\" class=\"headerlink\" title=\"配置 MyBatis 二级缓存\"></a><a href=\"#配置-MyBatis-二级缓存\" title=\"配置 MyBatis 二级缓存\"></a>配置 MyBatis 二级缓存</h3><h4 id=\"开启-MyBatis-二级缓存\"><a href=\"#开启-MyBatis-二级缓存\" class=\"headerlink\" title=\"开启 MyBatis 二级缓存\"></a><a href=\"#开启-MyBatis-二级缓存\" title=\"开启 MyBatis 二级缓存\"></a>开启 MyBatis 二级缓存</h4><p>在 Spring Boot 配置文件中开启 MyBatis 二级缓存，配置代码如下：</p>\n<pre class=\"line-numbers language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">mybatis</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">configuration</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">cache-enabled</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<h4 id=\"实体类实现序列化接口并声明序列号\"><a href=\"#实体类实现序列化接口并声明序列号\" class=\"headerlink\" title=\"实体类实现序列化接口并声明序列号\"></a><a href=\"#实体类实现序列化接口并声明序列号\" title=\"实体类实现序列化接口并声明序列号\"></a>实体类实现序列化接口并声明序列号</h4><pre class=\"line-numbers language-java\"><code class=\"language-java\"><span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">long</span> serialVersionUID <span class=\"token operator\">=</span> 8289770415244673535L<span class=\"token punctuation\">;</span>\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h5 id=\"IDEA-提示生成序列号\"><a href=\"#IDEA-提示生成序列号\" class=\"headerlink\" title=\"IDEA 提示生成序列号\"></a><a href=\"#IDEA-提示生成序列号\" title=\"IDEA 提示生成序列号\"></a>IDEA 提示生成序列号</h5><p>默认情况下 Intellij IDEA 不会提示继承了 Serializable 接口的类生成 serialVersionUID 的警告。如果需要生成 serialVersionUID，需要手动配置。</p>\n<p>File -&gt; Settings -&gt; Inspections -&gt; Serialization issues -&gt; Serialization class without ‘serialVersionUID’</p>\n<p><img src=\"https://note.youdao.com/yws/public/resource/f453eedf1eaa47d8bf912acaf4ba0e3e/xmlnote/CC89940C2A364B6EBD88A3366C6821BA/3353\" alt=\"\"></p>\n<h4 id=\"创建相关工具类\"><a href=\"#创建相关工具类\" class=\"headerlink\" title=\"创建相关工具类\"></a><a href=\"#创建相关工具类\" title=\"创建相关工具类\"></a>创建相关工具类</h4><h5 id=\"实现-Spring-ApplicationContextAware-接口，用于手动注入-Bean\"><a href=\"#实现-Spring-ApplicationContextAware-接口，用于手动注入-Bean\" class=\"headerlink\" title=\"实现 Spring ApplicationContextAware 接口，用于手动注入 Bean\"></a><a href=\"#实现-Spring-ApplicationContextAware-接口，用于手动注入-Bean\" title=\"实现 Spring ApplicationContextAware 接口，用于手动注入 Bean\"></a>实现 Spring ApplicationContextAware 接口，用于手动注入 Bean</h5><p>创建一个名为 <code>ApplicationContextHolder</code> 的工具类，代码如下：</p>\n<pre class=\"line-numbers language-java\"><code class=\"language-java\"><span class=\"token keyword\">package</span> com<span class=\"token punctuation\">.</span>funtl<span class=\"token punctuation\">.</span>itoken<span class=\"token punctuation\">.</span>common<span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>commons<span class=\"token punctuation\">.</span>lang3<span class=\"token punctuation\">.</span>Validate<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> org<span class=\"token punctuation\">.</span>slf4j<span class=\"token punctuation\">.</span>Logger<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> org<span class=\"token punctuation\">.</span>slf4j<span class=\"token punctuation\">.</span>LoggerFactory<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>beans<span class=\"token punctuation\">.</span>BeansException<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>beans<span class=\"token punctuation\">.</span>factory<span class=\"token punctuation\">.</span>DisposableBean<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span>ApplicationContext<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span>ApplicationContextAware<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>stereotype<span class=\"token punctuation\">.</span>Component<span class=\"token punctuation\">;</span>\n\n<span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ApplicationContextHolder</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">ApplicationContextAware</span><span class=\"token punctuation\">,</span> DisposableBean <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> Logger logger <span class=\"token operator\">=</span> LoggerFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getLogger</span><span class=\"token punctuation\">(</span>ApplicationContextHolder<span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> ApplicationContext applicationContext<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">/**\n     * 获取存储在静态变量中的 ApplicationContext\n     *\n     * @return\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> ApplicationContext <span class=\"token function\">getApplicationContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">assertContextInjected</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> applicationContext<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">/**\n     * 从静态变量 applicationContext 中获取 Bean，自动转型成所赋值对象的类型\n     *\n     * @param name\n     * @param &lt;T>\n     * @return\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token operator\">&lt;</span>T<span class=\"token operator\">></span> T <span class=\"token function\">getBean</span><span class=\"token punctuation\">(</span>String name<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">assertContextInjected</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>T<span class=\"token punctuation\">)</span> applicationContext<span class=\"token punctuation\">.</span><span class=\"token function\">getBean</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">/**\n     * 从静态变量 applicationContext 中获取 Bean，自动转型成所赋值对象的类型\n     *\n     * @param clazz\n     * @param &lt;T>\n     * @return\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token operator\">&lt;</span>T<span class=\"token operator\">></span> T <span class=\"token function\">getBean</span><span class=\"token punctuation\">(</span>Class<span class=\"token operator\">&lt;</span>T<span class=\"token operator\">></span> clazz<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">assertContextInjected</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> applicationContext<span class=\"token punctuation\">.</span><span class=\"token function\">getBean</span><span class=\"token punctuation\">(</span>clazz<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">/**\n     * 实现 DisposableBean 接口，在 Context 关闭时清理静态变量\n     *\n     * @throws Exception\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">destroy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> Exception <span class=\"token punctuation\">{</span>\n        logger<span class=\"token punctuation\">.</span><span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"清除 SpringContext 中的 ApplicationContext: {}\"</span><span class=\"token punctuation\">,</span> applicationContext<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        applicationContext <span class=\"token operator\">=</span> null<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">/**\n     * 实现 ApplicationContextAware 接口，注入 Context 到静态变量中\n     *\n     * @param applicationContext\n     * @throws BeansException\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setApplicationContext</span><span class=\"token punctuation\">(</span>ApplicationContext applicationContext<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> BeansException <span class=\"token punctuation\">{</span>\n        ApplicationContextHolder<span class=\"token punctuation\">.</span>applicationContext <span class=\"token operator\">=</span> applicationContext<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">/**\n     * 断言 Context 已经注入\n     */</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">assertContextInjected</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        Validate<span class=\"token punctuation\">.</span><span class=\"token function\">validState</span><span class=\"token punctuation\">(</span>applicationContext <span class=\"token operator\">!=</span> null<span class=\"token punctuation\">,</span> <span class=\"token string\">\"applicationContext 属性未注入，请在 spring-context.xml 配置中定义 ApplicationContextHolder\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h5 id=\"实现-MyBatis-Cache-接口，用于自定义缓存为-Redis\"><a href=\"#实现-MyBatis-Cache-接口，用于自定义缓存为-Redis\" class=\"headerlink\" title=\"实现 MyBatis Cache 接口，用于自定义缓存为 Redis\"></a><a href=\"#实现-MyBatis-Cache-接口，用于自定义缓存为-Redis\" title=\"实现 MyBatis Cache 接口，用于自定义缓存为 Redis\"></a>实现 MyBatis Cache 接口，用于自定义缓存为 Redis</h5><p>创建一个名为 <code>RedisCache</code> 的工具类，代码如下：</p>\n<pre class=\"line-numbers language-java\"><code class=\"language-java\"><span class=\"token keyword\">package</span> com<span class=\"token punctuation\">.</span>funtl<span class=\"token punctuation\">.</span>itoken<span class=\"token punctuation\">.</span>common<span class=\"token punctuation\">.</span>utils<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> com<span class=\"token punctuation\">.</span>funtl<span class=\"token punctuation\">.</span>itoken<span class=\"token punctuation\">.</span>common<span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span>ApplicationContextHolder<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>ibatis<span class=\"token punctuation\">.</span>cache<span class=\"token punctuation\">.</span>Cache<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> org<span class=\"token punctuation\">.</span>slf4j<span class=\"token punctuation\">.</span>Logger<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> org<span class=\"token punctuation\">.</span>slf4j<span class=\"token punctuation\">.</span>LoggerFactory<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>redis<span class=\"token punctuation\">.</span>core<span class=\"token punctuation\">.</span>RedisCallback<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>redis<span class=\"token punctuation\">.</span>core<span class=\"token punctuation\">.</span>RedisTemplate<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>redis<span class=\"token punctuation\">.</span>core<span class=\"token punctuation\">.</span>ValueOperations<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span>concurrent<span class=\"token punctuation\">.</span>TimeUnit<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span>concurrent<span class=\"token punctuation\">.</span>locks<span class=\"token punctuation\">.</span>ReadWriteLock<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span>concurrent<span class=\"token punctuation\">.</span>locks<span class=\"token punctuation\">.</span>ReentrantReadWriteLock<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\" spellcheck=\"true\">/**\n * Redis 缓存工具类\n * &lt;p>Title: RedisCache&lt;/p>\n * &lt;p>Description: &lt;/p>\n *\n * @author Lusifer\n * @version 1.0.0\n * @date 2018/8/13 6:03\n */</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">RedisCache</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Cache</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> Logger logger <span class=\"token operator\">=</span> LoggerFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getLogger</span><span class=\"token punctuation\">(</span>RedisCache<span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> ReadWriteLock readWriteLock <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ReentrantReadWriteLock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> String id<span class=\"token punctuation\">;</span> <span class=\"token comment\" spellcheck=\"true\">// cache instance id</span>\n    <span class=\"token keyword\">private</span> RedisTemplate redisTemplate<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">long</span> EXPIRE_TIME_IN_MINUTES <span class=\"token operator\">=</span> <span class=\"token number\">30</span><span class=\"token punctuation\">;</span> <span class=\"token comment\" spellcheck=\"true\">// redis过期时间</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token function\">RedisCache</span><span class=\"token punctuation\">(</span>String id<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>id <span class=\"token operator\">==</span> null<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalArgumentException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Cache instances require an ID\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>id <span class=\"token operator\">=</span> id<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> String <span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> id<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">/**\n     * Put query result to redis\n     *\n     * @param key\n     * @param value\n     */</span>\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">putObject</span><span class=\"token punctuation\">(</span>Object key<span class=\"token punctuation\">,</span> Object value<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n            RedisTemplate redisTemplate <span class=\"token operator\">=</span> <span class=\"token function\">getRedisTemplate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            ValueOperations opsForValue <span class=\"token operator\">=</span> redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">opsForValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            opsForValue<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">,</span> EXPIRE_TIME_IN_MINUTES<span class=\"token punctuation\">,</span> TimeUnit<span class=\"token punctuation\">.</span>MINUTES<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            logger<span class=\"token punctuation\">.</span><span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Put query result to redis\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Throwable</span> t<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            logger<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Redis put failed\"</span><span class=\"token punctuation\">,</span> t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">/**\n     * Get cached query result from redis\n     *\n     * @param key\n     * @return\n     */</span>\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> Object <span class=\"token function\">getObject</span><span class=\"token punctuation\">(</span>Object key<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n            RedisTemplate redisTemplate <span class=\"token operator\">=</span> <span class=\"token function\">getRedisTemplate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            ValueOperations opsForValue <span class=\"token operator\">=</span> redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">opsForValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            logger<span class=\"token punctuation\">.</span><span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Get cached query result from redis\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\" spellcheck=\"true\">//            System.out.println(\"****\" + opsForValue.get(key).toString());</span>\n            <span class=\"token keyword\">return</span> opsForValue<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Throwable</span> t<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            logger<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Redis get failed, fail over to db\"</span><span class=\"token punctuation\">,</span> t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">return</span> null<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">/**\n     * Remove cached query result from redis\n     *\n     * @param key\n     * @return\n     */</span>\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token annotation punctuation\">@SuppressWarnings</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"unchecked\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> Object <span class=\"token function\">removeObject</span><span class=\"token punctuation\">(</span>Object key<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n            RedisTemplate redisTemplate <span class=\"token operator\">=</span> <span class=\"token function\">getRedisTemplate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            logger<span class=\"token punctuation\">.</span><span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Remove cached query result from redis\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Throwable</span> t<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            logger<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Redis remove failed\"</span><span class=\"token punctuation\">,</span> t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span> null<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">/**\n     * Clears this cache instance\n     */</span>\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        RedisTemplate redisTemplate <span class=\"token operator\">=</span> <span class=\"token function\">getRedisTemplate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">execute</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>RedisCallback<span class=\"token punctuation\">)</span> connection <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n            connection<span class=\"token punctuation\">.</span><span class=\"token function\">flushDb</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">return</span> null<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        logger<span class=\"token punctuation\">.</span><span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Clear all the cached query result from redis\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">/**\n     * This method is not used\n     *\n     * @return\n     */</span>\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">int</span> <span class=\"token function\">getSize</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> ReadWriteLock <span class=\"token function\">getReadWriteLock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> readWriteLock<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> RedisTemplate <span class=\"token function\">getRedisTemplate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>redisTemplate <span class=\"token operator\">==</span> null<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            redisTemplate <span class=\"token operator\">=</span> ApplicationContextHolder<span class=\"token punctuation\">.</span><span class=\"token function\">getBean</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"redisTemplate\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span> redisTemplate<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h4 id=\"Mapper-接口中增加注解\"><a href=\"#Mapper-接口中增加注解\" class=\"headerlink\" title=\"Mapper 接口中增加注解\"></a><a href=\"#Mapper-接口中增加注解\" title=\"Mapper 接口中增加注解\"></a>Mapper 接口中增加注解</h4><p>在 Mapper 接口中增加注解，声明需要使用二级缓存</p>\n<pre class=\"line-numbers language-java\"><code class=\"language-java\"><span class=\"token keyword\">package</span> com<span class=\"token punctuation\">.</span>funtl<span class=\"token punctuation\">.</span>itoken<span class=\"token punctuation\">.</span>common<span class=\"token punctuation\">.</span>mapper<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> com<span class=\"token punctuation\">.</span>funtl<span class=\"token punctuation\">.</span>itoken<span class=\"token punctuation\">.</span>common<span class=\"token punctuation\">.</span>domain<span class=\"token punctuation\">.</span>TbSysUser<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> com<span class=\"token punctuation\">.</span>funtl<span class=\"token punctuation\">.</span>itoken<span class=\"token punctuation\">.</span>common<span class=\"token punctuation\">.</span>utils<span class=\"token punctuation\">.</span>RedisCache<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>ibatis<span class=\"token punctuation\">.</span>annotations<span class=\"token punctuation\">.</span>CacheNamespace<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> tk<span class=\"token punctuation\">.</span>mybatis<span class=\"token punctuation\">.</span>mapper<span class=\"token punctuation\">.</span>MyMapper<span class=\"token punctuation\">;</span>\n\n<span class=\"token annotation punctuation\">@CacheNamespace</span><span class=\"token punctuation\">(</span>implementation <span class=\"token operator\">=</span> RedisCache<span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">TbSysUserMapper</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">MyMapper</span><span class=\"token operator\">&lt;</span>TbSysUser<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n<span class=\"token punctuation\">}</span>\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n","site":{"data":{}},"excerpt":"","more":"<p>注：由于之前的文章已经配置过 Redis 这里不再赘述</p>\n<h3 id=\"MyBatis-缓存介绍\"><a href=\"#MyBatis-缓存介绍\" class=\"headerlink\" title=\"MyBatis 缓存介绍\"></a><a href=\"#MyBatis-缓存介绍\" title=\"MyBatis 缓存介绍\"></a>MyBatis 缓存介绍</h3><h4 id=\"一级缓存\"><a href=\"#一级缓存\" class=\"headerlink\" title=\"一级缓存\"></a><a href=\"#一级缓存\" title=\"一级缓存\"></a>一级缓存</h4><p>MyBatis 会在表示会话的 <code>SqlSession</code> 对象中建立一个简单的缓存，将每次查询到的结果结果缓存起来，当下次查询的时候，如果判断先前有个完全一样的查询，会直接从缓存中直接将结果取出，返回给用户，不需要再进行一次数据库查询了。</p>\n<p>一级缓存是 <code>SqlSession</code> 级别的缓存。在操作数据库时需要构造 sqlSession 对象，在对象中有一个（内存区域）数据结构（HashMap）用于存储缓存数据。不同的 sqlSession 之间的缓存数据区域（HashMap）是互相不影响的。其作用域是同一个 SqlSession，在同一个 sqlSession 中两次执行相同的 sql 语句，第一次执行完毕会将数据库中查询的数据写到缓存（内存），第二次会从缓存中获取数据将不再从数据库查询，从而提高查询效率。当一个 sqlSession 结束后该 sqlSession 中的一级缓存也就不存在了。Mybatis 默认开启一级缓存。</p>\n<h4 id=\"二级缓存\"><a href=\"#二级缓存\" class=\"headerlink\" title=\"二级缓存\"></a><a href=\"#二级缓存\" title=\"二级缓存\"></a>二级缓存</h4><p>二级缓存是 mapper 级别的缓存，多个 <code>SqlSession</code> 去操作同一个 Mapper 的 sql 语句，多个 SqlSession 去操作数据库得到数据会存在二级缓存区域，多个 SqlSession 可以共用二级缓存，二级缓存是跨 SqlSession 的。其作用域是 mapper 的同一个 <code>namespace</code>，不同的 sqlSession 两次执行相同 namespace 下的 sql 语句且向 sql 中传递参数也相同即最终执行相同的 sql 语句，第一次执行完毕会将数据库中查询的数据写到缓存（内存），第二次会从缓存中获取数据将不再从数据库查询，从而提高查询效率。Mybatis 默认没有开启二级缓存需要在 setting 全局参数中配置开启二级缓存。</p>\n<h3 id=\"配置-MyBatis-二级缓存\"><a href=\"#配置-MyBatis-二级缓存\" class=\"headerlink\" title=\"配置 MyBatis 二级缓存\"></a><a href=\"#配置-MyBatis-二级缓存\" title=\"配置 MyBatis 二级缓存\"></a>配置 MyBatis 二级缓存</h3><h4 id=\"开启-MyBatis-二级缓存\"><a href=\"#开启-MyBatis-二级缓存\" class=\"headerlink\" title=\"开启 MyBatis 二级缓存\"></a><a href=\"#开启-MyBatis-二级缓存\" title=\"开启 MyBatis 二级缓存\"></a>开启 MyBatis 二级缓存</h4><p>在 Spring Boot 配置文件中开启 MyBatis 二级缓存，配置代码如下：</p>\n<pre><code class=\"yaml\">mybatis:\n  configuration:\n    cache-enabled: true\n\n</code></pre>\n<h4 id=\"实体类实现序列化接口并声明序列号\"><a href=\"#实体类实现序列化接口并声明序列号\" class=\"headerlink\" title=\"实体类实现序列化接口并声明序列号\"></a><a href=\"#实体类实现序列化接口并声明序列号\" title=\"实体类实现序列化接口并声明序列号\"></a>实体类实现序列化接口并声明序列号</h4><pre><code class=\"java\">private static final long serialVersionUID = 8289770415244673535L;\n\n</code></pre>\n<h5 id=\"IDEA-提示生成序列号\"><a href=\"#IDEA-提示生成序列号\" class=\"headerlink\" title=\"IDEA 提示生成序列号\"></a><a href=\"#IDEA-提示生成序列号\" title=\"IDEA 提示生成序列号\"></a>IDEA 提示生成序列号</h5><p>默认情况下 Intellij IDEA 不会提示继承了 Serializable 接口的类生成 serialVersionUID 的警告。如果需要生成 serialVersionUID，需要手动配置。</p>\n<p>File -&gt; Settings -&gt; Inspections -&gt; Serialization issues -&gt; Serialization class without ‘serialVersionUID’</p>\n<p><img src=\"https://note.youdao.com/yws/public/resource/f453eedf1eaa47d8bf912acaf4ba0e3e/xmlnote/CC89940C2A364B6EBD88A3366C6821BA/3353\" alt=\"\"></p>\n<h4 id=\"创建相关工具类\"><a href=\"#创建相关工具类\" class=\"headerlink\" title=\"创建相关工具类\"></a><a href=\"#创建相关工具类\" title=\"创建相关工具类\"></a>创建相关工具类</h4><h5 id=\"实现-Spring-ApplicationContextAware-接口，用于手动注入-Bean\"><a href=\"#实现-Spring-ApplicationContextAware-接口，用于手动注入-Bean\" class=\"headerlink\" title=\"实现 Spring ApplicationContextAware 接口，用于手动注入 Bean\"></a><a href=\"#实现-Spring-ApplicationContextAware-接口，用于手动注入-Bean\" title=\"实现 Spring ApplicationContextAware 接口，用于手动注入 Bean\"></a>实现 Spring ApplicationContextAware 接口，用于手动注入 Bean</h5><p>创建一个名为 <code>ApplicationContextHolder</code> 的工具类，代码如下：</p>\n<pre><code class=\"java\">package com.funtl.itoken.common.context;\n\nimport org.apache.commons.lang3.Validate;\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\nimport org.springframework.beans.BeansException;\nimport org.springframework.beans.factory.DisposableBean;\nimport org.springframework.context.ApplicationContext;\nimport org.springframework.context.ApplicationContextAware;\nimport org.springframework.stereotype.Component;\n\n@Component\npublic class ApplicationContextHolder implements ApplicationContextAware, DisposableBean {\n    private static final Logger logger = LoggerFactory.getLogger(ApplicationContextHolder.class);\n\n    private static ApplicationContext applicationContext;\n\n    /**\n     * 获取存储在静态变量中的 ApplicationContext\n     *\n     * @return\n     */\n    public static ApplicationContext getApplicationContext() {\n        assertContextInjected();\n        return applicationContext;\n    }\n\n    /**\n     * 从静态变量 applicationContext 中获取 Bean，自动转型成所赋值对象的类型\n     *\n     * @param name\n     * @param &lt;T&gt;\n     * @return\n     */\n    public static &lt;T&gt; T getBean(String name) {\n        assertContextInjected();\n        return (T) applicationContext.getBean(name);\n    }\n\n    /**\n     * 从静态变量 applicationContext 中获取 Bean，自动转型成所赋值对象的类型\n     *\n     * @param clazz\n     * @param &lt;T&gt;\n     * @return\n     */\n    public static &lt;T&gt; T getBean(Class&lt;T&gt; clazz) {\n        assertContextInjected();\n        return applicationContext.getBean(clazz);\n    }\n\n    /**\n     * 实现 DisposableBean 接口，在 Context 关闭时清理静态变量\n     *\n     * @throws Exception\n     */\n    public void destroy() throws Exception {\n        logger.debug(&quot;清除 SpringContext 中的 ApplicationContext: {}&quot;, applicationContext);\n        applicationContext = null;\n    }\n\n    /**\n     * 实现 ApplicationContextAware 接口，注入 Context 到静态变量中\n     *\n     * @param applicationContext\n     * @throws BeansException\n     */\n    public void setApplicationContext(ApplicationContext applicationContext) throws BeansException {\n        ApplicationContextHolder.applicationContext = applicationContext;\n    }\n\n    /**\n     * 断言 Context 已经注入\n     */\n    private static void assertContextInjected() {\n        Validate.validState(applicationContext != null, &quot;applicationContext 属性未注入，请在 spring-context.xml 配置中定义 ApplicationContextHolder&quot;);\n    }\n}\n\n</code></pre>\n<h5 id=\"实现-MyBatis-Cache-接口，用于自定义缓存为-Redis\"><a href=\"#实现-MyBatis-Cache-接口，用于自定义缓存为-Redis\" class=\"headerlink\" title=\"实现 MyBatis Cache 接口，用于自定义缓存为 Redis\"></a><a href=\"#实现-MyBatis-Cache-接口，用于自定义缓存为-Redis\" title=\"实现 MyBatis Cache 接口，用于自定义缓存为 Redis\"></a>实现 MyBatis Cache 接口，用于自定义缓存为 Redis</h5><p>创建一个名为 <code>RedisCache</code> 的工具类，代码如下：</p>\n<pre><code class=\"java\">package com.funtl.itoken.common.utils;\n\nimport com.funtl.itoken.common.context.ApplicationContextHolder;\nimport org.apache.ibatis.cache.Cache;\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\nimport org.springframework.data.redis.core.RedisCallback;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.core.ValueOperations;\n\nimport java.util.concurrent.TimeUnit;\nimport java.util.concurrent.locks.ReadWriteLock;\nimport java.util.concurrent.locks.ReentrantReadWriteLock;\n\n/**\n * Redis 缓存工具类\n * &lt;p&gt;Title: RedisCache&lt;/p&gt;\n * &lt;p&gt;Description: &lt;/p&gt;\n *\n * @author Lusifer\n * @version 1.0.0\n * @date 2018/8/13 6:03\n */\npublic class RedisCache implements Cache {\n    private static final Logger logger = LoggerFactory.getLogger(RedisCache.class);\n\n    private final ReadWriteLock readWriteLock = new ReentrantReadWriteLock();\n    private final String id; // cache instance id\n    private RedisTemplate redisTemplate;\n\n    private static final long EXPIRE_TIME_IN_MINUTES = 30; // redis过期时间\n\n    public RedisCache(String id) {\n        if (id == null) {\n            throw new IllegalArgumentException(&quot;Cache instances require an ID&quot;);\n        }\n        this.id = id;\n    }\n\n    @Override\n    public String getId() {\n        return id;\n    }\n\n    /**\n     * Put query result to redis\n     *\n     * @param key\n     * @param value\n     */\n    @Override\n    public void putObject(Object key, Object value) {\n        try {\n            RedisTemplate redisTemplate = getRedisTemplate();\n            ValueOperations opsForValue = redisTemplate.opsForValue();\n            opsForValue.set(key, value, EXPIRE_TIME_IN_MINUTES, TimeUnit.MINUTES);\n            logger.debug(&quot;Put query result to redis&quot;);\n        } catch (Throwable t) {\n            logger.error(&quot;Redis put failed&quot;, t);\n        }\n    }\n\n    /**\n     * Get cached query result from redis\n     *\n     * @param key\n     * @return\n     */\n    @Override\n    public Object getObject(Object key) {\n        try {\n            RedisTemplate redisTemplate = getRedisTemplate();\n            ValueOperations opsForValue = redisTemplate.opsForValue();\n            logger.debug(&quot;Get cached query result from redis&quot;);\n//            System.out.println(&quot;****&quot; + opsForValue.get(key).toString());\n            return opsForValue.get(key);\n        } catch (Throwable t) {\n            logger.error(&quot;Redis get failed, fail over to db&quot;, t);\n            return null;\n        }\n    }\n\n    /**\n     * Remove cached query result from redis\n     *\n     * @param key\n     * @return\n     */\n    @Override\n    @SuppressWarnings(&quot;unchecked&quot;)\n    public Object removeObject(Object key) {\n        try {\n            RedisTemplate redisTemplate = getRedisTemplate();\n            redisTemplate.delete(key);\n            logger.debug(&quot;Remove cached query result from redis&quot;);\n        } catch (Throwable t) {\n            logger.error(&quot;Redis remove failed&quot;, t);\n        }\n        return null;\n    }\n\n    /**\n     * Clears this cache instance\n     */\n    @Override\n    public void clear() {\n        RedisTemplate redisTemplate = getRedisTemplate();\n        redisTemplate.execute((RedisCallback) connection -&gt; {\n            connection.flushDb();\n            return null;\n        });\n        logger.debug(&quot;Clear all the cached query result from redis&quot;);\n    }\n\n    /**\n     * This method is not used\n     *\n     * @return\n     */\n    @Override\n    public int getSize() {\n        return 0;\n    }\n\n    @Override\n    public ReadWriteLock getReadWriteLock() {\n        return readWriteLock;\n    }\n\n    private RedisTemplate getRedisTemplate() {\n        if (redisTemplate == null) {\n            redisTemplate = ApplicationContextHolder.getBean(&quot;redisTemplate&quot;);\n        }\n        return redisTemplate;\n    }\n}\n\n</code></pre>\n<h4 id=\"Mapper-接口中增加注解\"><a href=\"#Mapper-接口中增加注解\" class=\"headerlink\" title=\"Mapper 接口中增加注解\"></a><a href=\"#Mapper-接口中增加注解\" title=\"Mapper 接口中增加注解\"></a>Mapper 接口中增加注解</h4><p>在 Mapper 接口中增加注解，声明需要使用二级缓存</p>\n<pre><code class=\"java\">package com.funtl.itoken.common.mapper;\n\nimport com.funtl.itoken.common.domain.TbSysUser;\nimport com.funtl.itoken.common.utils.RedisCache;\nimport org.apache.ibatis.annotations.CacheNamespace;\nimport tk.mybatis.mapper.MyMapper;\n\n@CacheNamespace(implementation = RedisCache.class)\npublic interface TbSysUserMapper extends MyMapper&lt;TbSysUser&gt; {\n}\n\n</code></pre>\n"},{"title":"Java规范","author":"Asia Cui","date":"2019-01-08T07:01:00.000Z","_content":"\n\n# 介绍\n\n## 1 目的\n\n编码规范对于程序员而言尤为首要，有以下几个原因：\n\n> - 一个软件的生命周期中，80％的花费在于维护。\n> - 几乎没有任何一个软件，在其全部生命周期中，均由最初的开辟人员来维护。编码规范可以改良软件的可读性，可以让程序员尽快而彻底地懂得新的代码。\n\n最佳实践主要是包括编码习惯、禁忌等，能有效避免常见问题，提高代码质量。\n\n## 2 适用范围\n\n本规范适用于Java开发人员。\n\n## 3 术语\n\n强制：编程时强制必须遵守的原则。\n\n推荐：编程时必须加以考虑的习惯、写法等。参考：编程时无法用代码量化的原则或描述。说明：对此规范或建议进行必要的解释。\n\n正例、反例：对此规范或建议从正、反两个方面给出例子。\n\n## 4 总体原则\n\n简单、易读、易实施执行\n\n# 命名规范\n\n## 1 基本原则\n\n命名力求做到**统一、达意、简洁**。\n\n- 统一\n\n> 统一即对于同一个概念，在程序中用同一种表示方法，比如对于供应商，既可以用supplier，也可以用provider，但是我们只能选定一个使用，至少在一个Java项目中保持统一。\n>\n> 说明:如果对同一概念有不同的表示方法，会使代码混乱难以理解。即使不能取得好的名称，但是只要统一，阅读起来也不会太困难，因为阅读者只要理解一次。\n>\n\n- 达意\n\n> 达意是指，标识符能准确的表达出它所代表的意义，比如：newSupplier,OrderPaymentGatewayService等；而supplier1,service2，idtts等则不是好的命名方式。\n>\n> 说明:准确有两成含义，一是正确，二是丰富。如果给一个代表供应商的变量起名是order，显然没有正确表达。同样的，supplier1远没有targetSupplier意义丰富。\n>\n\n- 简洁\n\n> 简 洁 是 指 ， 在 统 一 和 达 意 的 前 提 下 ， 用 尽 量 少 的 标 识 符 。 如 果 不 能 达 意 ， 宁 愿 不 要 简 洁 。 比 如 ： theOrderNameOfTheTargetSupplierWhichIsTransfered太长， transferedTargetSupplierOrderName则较好，但是transTgtSplOrdNm就不好了。注意：杜绝完全不规范的缩写,避免望文不知义。\n>\n> 反例: AbstractClass\"缩写\"命名成AbsClass;condition\"缩写\"命名成condi,此类随意缩写严重降低了代码的可阅读性。\n>\n\n\n\n## 2 通用命名规范\n\n【强制】代码中所有命名必须以英文开头，名称只能由英文字母、数字、下划线、\"-\"符号组成。严禁使用拼音与英文混合的方式,更不允许直接使用中文的方式。如下表：\n\n说明:正确的英文拼写和语法可以让阅读者易于理解,避免歧义。注意,即使纯拼音命名方式也要尽量避免采用。\n\n| 类型                               | 规范                                                         | 示例                                    |\n| ---------------------------------- | ------------------------------------------------------------ | --------------------------------------- |\n| 项目名                             | 工程名或模块名全部小写，多个英文单词以\"- \"连接。应用名与模块名，采用英文单词，不建议使用3个以上的单词，禁止使用特殊字符与数字 | lx-web-vaclient lx-dubbo-user           |\n| 文件                               | 跟类名保持一致                                               | PayController.java                      |\n| 包                                 | 包名只允许使用小写字母和数字，并且单词之间点分隔符连接（不允许使用下划线） | com.iflytek.cbg.lx. web.user.controller |\n| 类 接口                            | 类名、接口名使用UpperCamelCase风格,必须遵从驼峰形式，类名如果有复数含义,可以使用复数形式。另类名通常使用名词或名词短语 | PayController UserService               |\n| 方 法 名 参 数 名 成员变量局部变量 | 方法名、参数名、成员变量、局部变量都统一使用lowerCamelCase 风格,必须遵从驼峰形式。另方法名通常使用动词、动词短语、形容词 在单测方法中可以含有下划线，通常用来指定特定场景：test<测试方法名>_<场景>，比如：testPop_emptyStack。对于测试方法的命名没有强制性要求，也可以采用其他的命名方式 | getScore userId                         |\n| 常量                               | 常量命名全部大写,单词间用下划线隔开,力求语义表达完整清楚,不要嫌名字长 | MAX_PAY_TIMEOUT                         |\n\n\n\n## 3 类命名\n\n类名往往用不同的前缀或后缀表达额外的意思。如下表：\n\n| 前缀/后缀                                                    | 意义                                                         | 要求     |\n| ------------------------------------------------------------ | ------------------------------------------------------------ | -------- |\n| xxxController                                                | 直接处理页面请求、管理页面逻辑类、Http请求处理类             | 【强制】 |\n| xxxService                                                   | 表明这个类是个服务类，里面包含了给其他类提同业务服务的方法   | 【强制】 |\n| xxxDao                                                       | 这个类封装了数据访问方法                                     | 【强制】 |\n| xxxEntity<br />xxxDTO<br />xxxVO<br />xxxReq<br />xxxResp<br /> | 不同用处的POJO类，VO，DTO中不要出现@Entity注解数据传输对象：xxxDTO，xxx 为业务领域相关的名称展示对象：xxxVO，xxx 一般为网页名称 | 【推荐】 |\n| xxxEnum                                                      | 枚举类                                                       | 【强制】 |\n| Ixxx                                                         | 这个类是一个接口                                             | 【强制】 |\n| xxxImpl                                                      | 这个类是一个实现类，而不是接口                               | 【强制】 |\n| Abstractxxx                                                  | 抽象类                                                       | 【强制】 |\n| xxxBase                                                      | 其他类的基类                                                 | 【推荐】 |\n| xxxFactory<br />xxxProxy<br />xxxAdapter<br />xxxObserver    | 如果使用到了设计模式,建议通过后缀在类名中体现出具体模式      | 【推荐】 |\n| xxxWrapper                                                   | 这是一个包装类，为了给某个类提供没有的能力                   | 【推荐】 |\n| xxxListener<br />xxxEvent                                    | 响应某种事件相关的类                                         | 【推荐】 |\n| xxxJob                                                       | 某种按时间运行的任务                                         | 【推荐】 |\n| xxxUtils                                                     | 工具类                                                       | 【推荐】 |\n| xxxException                                                 | 异常类                                                       | 【强制】 |\n| xxxTest                                                      | 测试类                                                       | 【强制】 |\n\n \n\n## 4 方法命名\n\n方法名往往用不同的前缀表达特定的含义，如下表：\n\n| 前缀/后缀         | 意义                 | 要求     |\n| ----------------- | -------------------- | -------- |\n| getxxx()         | 获取单个对象         | 【推荐】 |\n| listxxx()        | 获取多个对象         | 【推荐】 |\n| countxxx()        | 计数，获取统计值     | 【推荐】 |\n| savexxx()         | 插入                 | 【推荐】 |\n| removexxx()         | 删除                 | 【推荐】 |\n| updatexxx()         | 更新                 | 【推荐】 |\n| findxxx()<br />searchxxx() | 搜索、查询           | 【推荐】 |\n| doxxx()<br />executexxx() | 执行某个过程或者流程 | 【推荐】 |\n| initxxx()            | 初始化               | 【推荐】 |\n| checkxxx()<br />validatexxx() | 校验合法性 | 【推荐】 |\n\n\n\n\n# 排版规范\n\n## 1 源文件结构\n\n1.【强制】所有源文件必须使用utf-8编码。\n\n2.【强制】所有未使用的import语句应该被删除。\n\n3.【强制】禁止使用通配符import。\n\n说明：Eclipse中可以通过快捷键将不需要的引入包去掉。快捷键：Ctrl + Shift + O。 IntelliJ IDEA自动导入包去除星号：\n\n打开File> Settings>Editor>Code Style>Java>Scheme Default>Imports \n\n1. 将Class count to use import with \"*\"改为99（导入同一个包的类超过这个数值自动变为 * ） \n2. 将Names count to use static import with \"*\"改为99（同上，但这是静态导入的） \n3. 将Package to Use import with \"*\"删掉默认的这两个包（不管使用多少个类，只要在这个列表里都会变为 * ）\n\n自动删除没有用到的导入包：\n\n打开File> Settings>Editor> General > Auto Import\n\n勾上 ![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsED41.tmp.jpg)                                               \n\n4.【推荐】同名的构造函数或方法之间禁止插入其他成员，例如重载的方法必须放在一起；不建议把新添加的方法一律放在最后，而是应该插入到合适的地方。\n\n说明:当一个类有多个构造方法,或者多个同名方法，或者类似方法,这些方法应该按顺序放置在一起,便于阅读。\n\n5.【推荐】类内定义顺序依次是:常量>公共变量或保护变量>私有变量>构造方法>静态公共方法>静态私有方法>公有方法或保护方法>getter/setter方法>main方法。\n\n引入lombok插件，IDEA中安装lombok插件使POJO类代码更加简洁，省去写getter/setter，构造函数的方法。具体参考：<https://yq.aliyun.com/articles/59972>, <https://www.projectlombok.org/>\n\n \n\n## 2 代码格式\n\n【强制】代码格式规范主要是缩进、空格、换行、空行的运用。具体规范如下表：\n\n说明:合理的运用缩进、空格、换行、空行，对代码的结构、可读性有非常大影响；另外，可以直接使用IDE自带的格式化快捷键进行全局或局部代码格式化。\n\n \n\n| 分类   | 规范解释                                                     | 其他描述                                                     |\n| ------ | ------------------------------------------------------------ | ------------------------------------------------------------ |\n| 行长度 | 单行字符数限制不超过120个,超出需要换行， 换行时遵循换行原则； | 设置IDE单行字符数配置                                        |\n| 缩进   | 1. 缩进采用4个空格,禁止使用tab字符；<br />2. 方法体的开始、类的定义、以及if、 for、do、while、switch、case语句中的代码都要采用缩进方式；<br />3. 由于列宽限制需要缩进的情况遵循换行原则； | 设置IDE Tab键相关配置                                        |\n| 空格   | 1. 左小括号和字符之间不出现空格;同样,右小括号和字符之间也不出现空格；2. if/for/while/switch/do等保留字与括号之间都必须加空格；<br />3. 任何二目、三目运算符的左右两边都需要加一个空格；一元操作符如\"!\"、\" ~\"、\" ++\"、\" --\"等前后不加空格；<br />4. 方法参数在定义和传入时,多个参数逗号后边必须加空格；5. 强制转型后必须跟一个空格; | 在if、else、for、do和while语句中，即使没有语句或者只有一行，也不得省略花括号。 |\n| 换行 | 1、每行最多只能写一条语句，每条语句之后都要换行。 <br />2、单行字符数超过120个限制需换行： 第二行相对第一行缩进,从第三行开始,不再继续缩进；运算符与下文一起换行；方法调用的点符号与下文一起换行；在多个参数超长,在逗号后换行；在括号前不要换行；<br />3、大括号：如果是大括号内为空,则简洁地写成{}即可,不需要换行;如果是非空代码块则:左大括号前不换行；左大括号后换行； 右大括号前换行；右大括号后还有else等代码则不换行;表示终止的右大括号后必须换行； |                                                              |\n| 空行 | 空行可以表达代码在语义逻辑上的分割，注释的作用范围，等等。将类似操作，或一组操作放在一起不用空行隔开，而用空行隔开不同组的代码。例如： 1、在类的不同的成员间增加空行，包括：成员变量、构造函数、方法、内部类、静态初始化块、实例初始化块等； 2、方法体内，按需增加空行，以便从逻辑上对语句进行分组；执行语句组、变量的定义语句组、不同的业务逻辑之间或者不同的语义之间插入一个空行。相同业务逻辑和语义之间不需要插入空行； 3、注释与其上面的代码用空行隔开； | 说明:超过十行的代码如果还不用空行分割， 就会增加阅读困难。另外，没有必要插入多个空行进行隔开。 |\n\n正例:\n\n![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsED99.tmp.png) \n\n\n\n\n\n \n\n# 注释\n\n## 1 基本原则\n- 注释力求精简准确、表达到位。\n\n>1. 能够准确反应设计思想和代码逻辑;\n>2. 能够描述业务含义,使别的程序员能够迅速了解到代码背后的信息。好的命名、代码结构是自解释的,往往不需要或者只需要很少注释，就可以让人读懂；相反，不能正确表达代码意义的注释，只会损害代码的可读性。\n\n- 注释宜少而精，不宜多而滥，更不能误导，过多的注释会成为后期维护的负担。\n\n> 防止过多过滥的注释，没必要的重复注释，或对显而易见的代码添加注释。\n\n- 代码混乱，再多的注释都不能弥补，所以，应当先在代码本身下功夫。\n\n- \n  注释要和代码同步。代码修改的同时,注释也要进行相应的修改,尤其是参数、返回值、异常、核心逻辑等的修改。\n\n\n> 说明:代码与注释更新不同步,就像路网与导航软件更新不同步一样,如果导航软件严重滞后,就失去了导航的意义。\n>\n\n- 注释不是用来管理代码版本的，如果有代码不要了，直接删除，svn会有记录的，不要注释掉，否则以后没人知道那段注释掉的代码该不该删除。\n\n\n\n\n## 2 Javadoc说明\n\n\n\nJava程序有两类注释：实现注释和文档注释。\n\n实现注释是那些在C++中见过的，应用/.../和//界定的注释。文档注释是Java独有的（即Javadoc），由/*.../界定,文档注释可以经由Javadoc工具转换成HTML文件。 Javadoc注释是给类的使用者来看的，主要介绍是什么功能，什么含义，怎么用等信息。凡是类的使用者需要知道，都要用Javadoc来写。Javadoc注释只负责描述类(class)、接口(interface)、方法(method)、构造器(constructor)、成员字段(field)。相应地，文档注释必须写在类、接口、方法、构造器、成员字段前面，而写在其他位置，比如函数内部，是无效的文档注释。\n\n非Javadoc的注释往往是给代码的维护者看的，用以注释代码或者实现细节，着重告述读者功能以及逻辑，特殊或者复杂的逻辑可以注释说明为什么这样写，如何修改，注意什么问题等。 Javadoc说明可参考文档：<http://docs.oracle.com/javase/8/docs/technotes/tools/windows/javadoc.html> <http://blog.csdn.net/garfielder007/article/details/54959597>\n\n\n\n![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEDBF.tmp.png)正例:\n\n## 3 Javadoc规范\n\n下面规范要求不包括符合\"注释-基本原则\"中代码能自解释的例外情况。\n\n1. 【强制】所有的类都必须添加类功能描述、创建者和创建日期。\n\n2. 【推荐】类公共属性、类公共方法需要增加Javadoc注释,即使用/*内容/格式,不得使用//xxx方式。\n\n3. 【强制】所有对外暴露的服务(RPC..)中类、方法、输入参数、输出参数必须添加Javadoc注释。\n\n4. 【强制】项目组内通用类库或者开发的可复用的类库中对使用者暴露的类、方法、属性必须增加Javadoc注释。\n\n5. 【强制】所有抽象类和接口必须要用Javadoc注释；另外，子类中override的方法和接口的实现类对应的方法实现大部分情况下不需要添加注释。\n\n6. 【强制】对已经不推荐使用的类和方法需要注明@Deprecated，并说明替代的类或者方法。\n\n7. 【推荐】枚举类和常量类字段尽量要有注释, 说明每个字段的含义。说明：字段命名能自解释的除外。\n\n8. 【推荐】特殊注释标记,请注明标记人与标记时间。注意及时处理这些标记,通过标记扫描,经常清理此类标记。线上故障有时候就是来源于这些标记处的代码。\n\n   ```Java\n   待办事宜(TODO):(标记人,标记时间,[预计处理时间])\n   ```\n\n表示需要实现,但目前还未实现的功能。这实际上是一个 Javadoc 的标签,目前的 Javadoc还没有实现,但已经被广泛使用。只能应用于类,接口和方法(因为它是一个 Javadoc 标签)。\n\n```java\n错误,不能工作(FIXME):(标记人,标记时间,[预计处理时间])\n```\n\n在注释中用 FIXME 标记某代码是错误的,而且不能工作,需要及时纠正的情况。\n\n9.【强制】注释的双斜线与注释内容之间有且仅有一个空格。 正例：// 注释内容，注意在`//`和`注释内容`之间有一个空格。\n\n \n\n# 编码规范\n\n## 1 声明、赋值等语句\n\n1. 【强制】一行只声明一个变量，不允许一行声明多个变量；在需要时声明变量，声明后尽快初始化，即初始化和被使用尽量放在一起。\n2. 【强制】不允许把多个短语句写在一行中，即一行只写一条语句。\n3. 【强制】避免在一个语句中执行多种操作，例如：给多个变量赋雷同的值，或赋值运算符与相等关系运算符混合使用，它很难读懂。\n\n<span style=\"color: #ff0000\">反例:</span> \n\n```c\nfooBar.fChar = barFoo.lchar = \"c\";\n\nif （c++ = d++） {\n\n//TODO\n\n}\n\nd = （a = b + c） + r;\n```\n\n4. 【强制】所有的相同类型的包装类对象之间值的比较,全部使用equals方法比较。另外equals方法容易抛空指针异常,应使用常量或确定有值的对象来调用equals。 说明:对于Integer var = ?在-128至127范围内的赋值,Integer对象是在IntegerCache.cache产生,会复用已有对象,这个区间内的Integer值可以直接使用==进行判断,但是这个区间之外的所有数据,都会在堆上产生,并不会复用已有对象,这是一个大坑。 正例: \"test\".equals(object); 反例: object.equals(\"test\"); \n5. 【强制】定义 DO/DTO/VO 等 POJO 类时，不要设定任何属性默认值。 反例：POJO 类的 gmtCreate 默认值为 new Date();但是这个属性在数据提取时并没有置入具体值，在更新其它字段时又附带更新了此字段，导致创建时间被修改成当前时间。 \n6. 【强制】序列化类新增属性时，请不要修改 serialVersionUID 字段，避免反序列失败；如果完全不兼容升级，避免反序列化混乱，那么请修改 serialVersionUID 值。 说明：注意 serialVersionUID 不一致会抛出序列化运行时异常。 \n7. 【强制】构造方法里面禁止加入任何业务逻辑，如果有初始化逻辑，请放在 init 方法中。\n8. 【推荐】当一个类有多个构造方法，或者多个同名方法，这些方法应该按顺序放置在一起， 便于阅读。 \n9. 【推荐】 类内方法定义顺序依次是：公有方法或保护方法 > 私有方法 > getter/setter 方法。 说明：公有方法是类的调用者和维护者最关心的方法，首屏展示最好；保护方法虽然只是子类关心，也可能是\"模板设计模式\"下的核心方法；而私有方法外部一般不需要特别关心，是一个 黑盒实现；因为承载的信息价值较低，所有Service 和 DAO 的 getter/setter 方法放在类体最后。\n\n \n\n## 2 控制语句、程序结构\n\n1.  【强制】在一个switch块内,每个case要么通过break/return等来终止,要么注释说明程序将继续执行到哪一个case为止;在一个switch块内,都必须包含一个default语句并且放在最后,即使它什么代码也没有。\n2. 【强制】在if/else/for/while/do语句中必须使用大括号，即使只有一行代码,避免使用单行的形式:if (condition) statements。\n3. 【强制】不要在if语句中使用等号=进行赋值操作。\n4. 【强制】不要在条件判断中执行其它复杂的语句,将复杂逻辑判断的结果赋值给一个有意义的布尔变量名,提高可读性。\n\n> 说明:很多if语句内的逻辑相当复杂,阅读者需要分析条件表达式的最终结果,才能明确什么样的条件执行什么样的语句,那么,如果阅读者分析逻辑表达式错误呢?\n>\n\n正例:\n![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEDE2.tmp.png) \n\n反例:\n\n```java\nif ((file.open(fileName, \"w\") != null) && (...) || (...)) {\n\n...\n\n}\n```\n5.【推荐】代码嵌套层次不要超过3层。\n说明:代码嵌套层次达3层以上时，一般人理解起来都会困难。减少嵌套的方法有很多：合并条件、利用return以省略后面的else、利用子方法(将嵌套的程序提取出来放到另外的方法里)等。\n\n6.【推荐】类超过2000行的程序难以阅读，应该尽量避免出现超过2000行的程序；\n\n7.【推荐】注意运算符的优先级，避免使用默认优先级。一般而言，在含有多种运算符的表达式中应用圆括号来明确表达式的操作顺序，是个好办法。\n\n> 说明：防止阅读程序时产生误解，防止因默认的优先级与设计思想不符而导致程序出错。\n>\n\n8.【推荐】可以通过return语句减少嵌套层次: if (condition) {\n\n... return obj;\n\n}\n\n// 接着写 else 的业务逻辑代码;\n\n## 3 常量\n\n1.【推荐】魔法值(未经定义的常量)尽量不要直接出现在代码中，代之以有名字的static final静态常量或者enum值。\n\n说明：魔法值使代码的可读性大大下降，而且，如果同样的数值多次出现时，到底这些数值是不是带有同样的含义呢，谁也说不清楚。另一方面， 如果本来应该使用相同数值的地方，一旦用错了，也很难发现，修改维护也不方便。因此，需要注意以下几点，极力避免使用魔法数值。\n\n反例:\n\nString key = \"Id#taobao_\" + tradeId; cache.put(key, value);\n\n2.【推荐】不要使用一个常量类维护所有常量,应该按常量功能进行归类分开维护。如:缓存相关的常量放在类:CacheConsts下;系统配置相关的常量放在类:ConfigConsts 下。\n\n说明:大而全的常量类,非得使用查找功能才能定位到修改的常量,不利于理解和维护。\n\n3.【推荐】常量的复用层次有五层:跨应用共享常量、应用内共享常量、子工程内共享常量、包内共享常量、类内共享常量。\n\n4.【推荐】如果变量值仅在一个范围内变化,且带有名称之外的延伸属性,定义为枚举类。下面正例中的数字就是延伸信息,表示星期几。正例:\n\n```java\npublic enum WeekEnum{\n\nMONDAY(1), TUESDAY(2), WEDNESDAY(3), THURSDAY(4), FRIDAY(5), SATURDAY(6), SUNDAY(7);\n\n}\n```\n\n5.【推荐】避免使用不易理解的数字，用有意义的标识来替代。涉及物理状态或者含有物理意义的常量，不应直接使用数字，用有意义的静态变量来代替更好。\n\n反例：如下的程序可读性差。 \n\n```java\nif (state == 0) {\n\nstate = 1;\n\n// program code\n\n}\n```\n\n正例:\n\n```java\nprivate final static int TRUNK_IDLE = 0; private final static int TRUNK_BUSY = 1; private final static int TRUNK_UNKNOWN = -1; if (state == TRUNK_IDLE) {\n\nstate = TRUNK_BUSY;\n\n// program code\n\n}\n```\n\n\n\n## 4 并发、线程、性能\n\n1. 【强制】获取单例对象需要保证线程安全，其中的方法也要保证线程安全。说明：资源驱动类、工具类、单例工厂类都需要注意。\n2. 【强制】创建线程或线程池时请指定有意义的线程名称，方便出错时回溯。正例：\n\n```java\npublic class TimerTaskThread extends Thread { \npublic TimerTaskThread() { \nsuper.setName(\"TimerTaskThread\");\n\n...\n\n}\n```\n\n3. 【强制】线程资源必须通过线程池提供，不允许在应用中自行显式创建线程。 说明：使用线程池的好处是减少在创建和销毁线程上所花的时间以及系统资源的开销，解决资 源不足的问题。如果不使用线程池，有可能造成系统创建大量同类线程而导致消耗完内存或者 \"过度切换\"的问题。\n\n4. 【强制】线程池不允许使用 Executors 去创建，而是通过 ThreadPoolExecutor 的方式，这样 的处理方式让写的同学更加明确线程池的运行规则，规避资源耗尽的风险。\n\n说明：Executors 返回的线程池对象的弊端如下：\n\n> FixedThreadPool 和 SingleThreadPool:\n\n允许的请求队列长度为Integer.MAX_VALUE，可能会堆积大量的请求，从而导致 OOM。\n\n> CachedThreadPool 和 ScheduledThreadPool:\n\n允许的创建线程数量为Integer.MAX_VALUE，可能会创建大量的线程，从而导致OOM。\n\n5. 【强制】SimpleDateFormat是线程不安全的类,一般不要定义为static变量,如果定义为static,必须加锁,或者使用JodaTime。\n6. 【强制】在使用正则表达式时,利用好其预编译功能,可以有效加快正则匹配速度。说明:不要在方法体内定义:Pattern pattern = Pattern.compile(规则);\n7. 【推荐】避免Random实例被多线程使用,虽然共享该实例是线程安全的,但会因竞争同一seed导致的性能下降。说明:Random实例包括java.util.Random的实例或者Math.random()的方式。\n8. 【推荐】注意Math.random()这个方法返回是double类型,注意取值的范围0≤x<1(能够 取到零值,注意除零异常),如果想获取整数类型的随机数, 不要将x放大10的若干倍然后取整,直接使用Random对象的nextInt或者nextLong法。\n9. 【强制】并发修改同一记录时，避免更新丢失，需要加锁。要么在应用层加锁，要么在缓存加 锁，要么在数据库层使用乐观锁，使用 version 作为更新依据。\n\n> 说明:如果每次访问冲突概率小于20%，推荐使用乐观锁，否则使用悲观锁。乐观锁的重试次 数不得小于3次。 \n\n10.【强制】多线程并行处理定时任务时，Timer 运行多个 TimeTask 时，只要其中之一没有捕获 抛出的异常，其它任务便会自动终止运行，使用ScheduledExecutorService 则没有这个问题。\n\n11.【推荐】循环体中的语句要考量性能,循环体是最容易发生性能问题的地方。以下操作尽量移至循环体外处理,如定义对象、变量、获取数据库连接,进行不必要的try-catch 操作(这个try-catch是否可以移至循环体外)。\n\n12.【强制】循环体内字符串的连接方式,使用StringBuilder的append方法进行扩展。\n\n说明:反编译出的字节码文件显示每次循环都会new出一个StringBuilder对象,然后进行append操作,最后通过toString方法返回String对象,造成内存资源浪费。\n\n反例:\n\n```java\nString str = \"start\";\n\nfor (int i = 0; i < 100; i++) { \n  str = str + \"hello\";\n}\n```\n\n13.【推荐】任何数据结构的构造或初始化,都应指定大小,避免数据结构无限增长吃光内存。\n\n14.【推荐】[在明确的场景下,为集合指定初始容量](http://www.cnblogs.com/DreamDrive/p/5422175.html)。\n\n说明:集合有默认大小，首先每次新增时都会判断是否达到临界点，且当长度不足时动态扩展严重影响性能。\n\n15.【强制】使用entrySet遍历Map类集合KV,而不是keySet方式进行遍历。\n\n说明:keySet其实是遍历了2次,一次是转为Iterator对象,另一次是从hashMap中取出key所对应的value。而entrySet只是遍历了一次就把key和value 都放到了 entry中,效率更高。\n\n\\16. 【推荐】高度注意 Map 类集合 K/V 能不能存储 null 值的情况，如下表格：\n\n \n\n| 集合类            | Key           | Value        | Super       | 说明       |\n| ----------------- | ------------- | ------------ | ----------- | ---------- |\n| Hashtable         | 不允许为null  | 不允许为null | Dictionary  | 线程安全   |\n| ConcurrentHashMap | 不允许为 null | 不允许为 nul | AbstractMap | 锁分段技术 |\n| TreeMap           | 不允许为 nul  | 允许为 null  | AbstractMap | 线程不安全 |\n| HashMap           | 允许为 null   | 允许为 null  | AbstractMap | 线程不安全 |\n\n \n\n反例： 由于 HashMap 的干扰，很多人认为 ConcurrentHashMap 是可以置入 null 值，而事实上， 存储 null 值时会抛出 NPE 异常。\n\n \n\n## 5 日志\n\n1.【强制】不允许使用System.out.print，也不可直接使用日志系统(Log4j、Logback)中的API,而应依赖使用日志框架SLF4J中的API,使用门面模式的日志框架,有利于维护和各个类的日志处理方式统一和更换日志系统。\n\n说明：日志框架可以设定级别，可以控制输出到哪里，容易区分是在代码的什么地方打印的，而System.out.print则不行。而且System.out.print的速度很慢。所以，除非是有意的，否则都要用日志框架。至少在提交到版本库之前把System.out.print换成日志框架。\n\n正例：\n\n```java\nimport org.slf4j.Logger;\n\nimport org.slf4j.LoggerFactory; public class Demo {\n\nprivate static final Logger logger = LoggerFactory.getLogger(Abc.class);\n\n}\n```\n\n2.【强制】避免重复打印日志,浪费磁盘空间,务必在log4j.xml或logback.xml中设置 additivity=false。正例:\n\n<logger name=\"com.iflytek.lx.config\" additivity=\"false\">\n\n3.【强制】生产环境禁止输出debug、trace和其他调试日志；相应的，生产环境一定要记录下错误日志和异常异常，利于现网故障或用户投诉时排查问题。\n\n说明：谨慎地根据需要配置日志级别。例如测试环境可以打开info日志，性能测试需要关闭debug和其他调试日志，保持与生存环境一致。日志的级别由高到低分别为：ERROR >> WARN >> INFO >> DEBUG >> TRACE。\n\n\n\n- Error：用于记录影响系统正常运行的一切信息，包括：Throwable、Error、Exception、与其他系统通讯错误，例如：SQL执行异常、其他系统返回的错误信息；\n\n\n- Warn：用于记录不影响系统正常运行，但需要注意需要及时解决，例如：某个信息；                                        Info：通常生产环境的最低级别，用于记录这种重要的提示信息，例如：各种通讯信息，关键的提示信息，以及这种需要在生产环境下提示的信息；\n- Debug： 记录一些详细的数据，比如我们想知道一个方法的多个入参值，那么在生产环境中，一般不会打印出来，在开发阶段和调试阶段，建议使用debug进行记录查看。在生产环境中将不会出现此类信息（当然可能在某些特定情况下，通过特殊手段某一时间段打开用于生产环境调试）。\n- Trace：用于代替System.out.println()和System.err.println()，供开发阶段调试用。\n\n4.【推荐】在生产环境中配置日志框架自动加载刷新，即不重启应用就可以调整日志的配置。例如在logback.xml的配置中开源加上：\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n\n<configuration scan=\"true\" scanPeriod=\"60 seconds\">\n\n</configuration>\n```\n\n\n\n## 6 异常\n\n1.【强制】不允许使用printStackTrace打印异常日志。\n\n2.【强制】记录异常日志时不要只保存exception.getMessage()，记录整个异常堆栈信息。\n\n3.【强制】捕获异常是为了处理它,不要捕获了却什么都不处理而抛弃之,如果不想处理它,请将该异常抛给它的调用者。另外自己抛出的异常必须要填写详细的描述信息，且必须保留原来的异常，便于问题定位，例如：throw new IOException(\"Writing data error! Data: \" + data. toString(), e)。\n\n4.【强制】不能在finally块中使用return,finally块中的return返回后方法结束执行,不会再执行try块中的return语句。\n\n5.【强制】finally块必须对资源对象、流对象进行关闭，例如数据库操作、IO操作,且有异常也要进行try-catch，因为finally块中如果发生异常, 不会再执行try块中的return语句。\n\n6.【推荐】防止NullPointerException,IndexOutOfBoundsException是程序员的基本修养,代码中可以通过预先检查进行规避,而不应该通过catch来处理。\n\n正例:\n\nif (obj != null) {\n\n...\n\n}\n\n反例: try {\n\nobj.method();\n\n} catch (NullPointerException e) {\n\n...\n\n}\n\n## 7 其他\n\n1.【强制】关于hashCode和equals的处理,遵循如下规则:\n\n** 只要重写equals,就必须重写 hashCode。\n\n** 因为Set存储的是不重复的对象,依据hashCode和equals进行判断,所以Set存储的对象必须重写这两个方法。\n\n** 如果自定义对象做为Map的键,那么必须重写hashCode和equals。\n\n说明:String重写了hashCode和equals方法,所以我们可以非常愉快地使用String 对象作为key来使用。2.【强制】所有的覆写方法,必须加@Override注解。\n\n3.【强制】不能使用过时的类或方法。       4.【推荐】慎用Object的clone方法来拷贝对象。\n\n说明:对象的clone方法默认是浅拷贝,若想实现深拷贝需要重写clone方法实现属性对象的拷贝。                                       5.【推荐】POJO类重写toString方法。使用 IDE 的中工具：source> generate toString 时，如果继承了另一个 POJO 类，注意在前面加一下super.toString。\n\n说明：在方法执行抛出异常时，可以直接调用 POJO 的 toString()方法打印其属性值，便于排查问题。或者使用lombok插件，自动生成toString()方法。使用lomok可以防止在getter/setter加入业务逻辑。\n\n6.【强制】不要在foreach循环里进行集合元素的remove/add操作。remove 元素请使用 Iterator 方式，如果并发操作，需要对 Iterator 对象加锁。\n\n7.【推荐】使用索引访问用String的split方法得到的数组时,做边界检查,否则会有抛IndexOutOfBoundsException的风险。\n\n8.【强制】禁止在代码中显示调用System.gc()。\n\n9.【强制】避免通过一个类的对象引用访问此类的静态变量或静态方法,无谓增加编译器解析成本,直接用类名来访问即可。正例：\n\nFoo.aStaticMethod(); // good反例：\n\nFoo aFoo = ...; aFoo.aStaticMethod();\n\nsomethingThatYieldsAFoo().aStaticMethod();\n\n10.【推荐】类成员与方法访问控制从严，不是必须使用public属性的，请使用protected，不是必须使用protected,请使用private。\n\n![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE18.tmp.png)![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE28.tmp.png)如果不允许外部直接通过new来创建对象,那么构造方法必须是private。\n\n** 工具类不允许有public或default构造方法。\n\n** 类非static成员变量并且与子类共享,必须是protected。\n\n** 类非static成员变量并且仅在本类使用,必须是private。\n\n** 类static成员变量如果仅在本类使用,必须是private。\n\n** 若是 static 成员变量,必须考虑是否为final。\n\n** 类成员方法只供类内部调用,必须是private。\n\n![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE29.tmp.png)类成员方法只对继承类公开,那么限制为protected。\n\n\n\n说明:良好的程序设计应该尽可能减小类与类之间耦合，所遵循的经验法则是：尽量限制成员函数的可见性。\n\n11.【强制】在一个项目组内开发环境、测试环境、生产环境使用统一版本的JDK。\n\n说明:不同版本的JDK编译出来的class不一样，可能存在冲突，不同版本的JDK也会带来莫名奇妙的问题且很难定位，所以一开始就要求必须统一。\n\n12.【推荐】避免出现重复的代码(Don't Repeat Yourself),即DRY原则。\n\n说明:随意复制和粘贴代码,必然会导致代码的重复,在以后需要修改时,需要修改所有的副本,容易遗漏。必要时抽取共性方法,或者抽象公共类,甚至是共用模块。\n\n13.【推荐】在代码中使用\"抛异常\"还是\"返回错误码\",对于公司外的 http/api 开放接口必须使用\"错误码\";而应用内部推荐异常抛出;跨应用间RPC 调用优先考虑使用Result方式,封装isSuccess()方法、\"错误码\"、\"错误简短信息\"。\n\n说明:关于RPC方法返回方式使用Result方式的理由:\n\n![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE3A.tmp.png)使用抛异常返回方式,调用方如果没有捕获到就会产生运行时错误。\n\n![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE3B.tmp.png)如果不加栈信息,只是new自定义异常,加入自己的理解的error message,对于调用端解决问题的帮助不会太多。如果加了栈信息,在频繁调用出错的情况下,数据序列化和传输的性能损耗也是问题。\n\n \n\n14.【推荐】logback比log4j性能要好很多，但是logback和log4j互斥，只能使用其中之一。因此，使用logback需要排除掉log4j依赖所有相关jar 包依赖，且为了兼容一些二方库、三方库（可能使用了log4j），需要引入引入log4j-over-slf4j.jar; 15.【推荐】对于\"明确停止使用的代码和配置\",如方法、变量、类、配置文件、动态配置属性等要坚决从程序中清理出去,避免造成过多垃圾。\n\n \n\n# 系统工程\n\n## 1 工程化\n\n1.【推荐】针对业务形态，工程分为以下几种情况：\n\n![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE3C.tmp.png)Web工程\n\n![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE4D.tmp.png)![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE4E.tmp.png)web-应用名，以\"web-\"前缀开头。Dubbo工程\n\n![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE4F.tmp.png)![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE5F.tmp.png)service-应用名，以\"service-\"前缀开头。Interface工程\n\n![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE60.tmp.png)![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE71.tmp.png)interface-应用名，以\"interface-\"前缀开头。工具或者任务\n\n![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE72.tmp.png)![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE73.tmp.png)tool-应用名，以\"tool-\"前缀开头，或以\"job-\"前缀开头。Java公共Jar包\n\n![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE84.tmp.png)common-模块名，以\"common-\"前缀开头。\n\n![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE85.tmp.jpg)2.【推荐】J2SE项目工程结构\n\n \n\n说明：J2SE项目有两种情况：\n\n一个是小工具，可以独立运行，处理一些简单的业务，打包为zip包。\n\n另一个是公共开发包，打包为jar包。以API方式提供给其它应用程序，以专业专注的精神进行分包，例如：通信协议包，常用工具包，加密解密包等等。公共开发包可能无法独立运行，所有的服务API都需要进行单元测试，并要保证线程安全。\n\n \n\n## 2 包管理、版本管理\n\n1.【推荐】Maven定义GAV遵从以下规则:\n\n\\* GroupID格式:com.{公司}.{部门}.业务线.[子业务线],最多4级。\n\n\\* 正例:com.iflytek.cbg.lx 或 com.iflytek.cgb.kuyin\n\n\n\n![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE86.tmp.png)![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE96.tmp.png)ArtifactID格式:产品线名-模块名。语义不重复不遗漏,先到中央仓库去查证一下。正例:lx-web-user/lx-dubbo-user/lx-common\n\n\\* Version:详细规定参考下方。\n\n2.【推荐】二方库版本号命名方式:主版本号.次版本号.修订号\n\n![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE97.tmp.png)![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE98.tmp.png)主版本号:当做了不兼容的API修改,或者增加了能改变产品方向的新功能。次版本号:当做了向下兼容的功能性新增(新增类、接口等)。\n\n![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEEA9.tmp.png)修订号:修复bug,没有修改方法签名的功能加强,保持API兼容性。\n\n说明:正式发布的类库必须先去中央仓库进行查证,使版本号有延续性,正式版本号不允许覆盖升级。如当前版本:1.3.3,那么下一个合理的版本号: 1.3.4或1.4.0或2.0.0\n\n3.【推荐】线上应用不要依赖SNAPSHOT版本(安全包除外)。\n\n说明:不依赖SNAPSHOT版本是保证应用发布的幂等性。另外,也可以加快编译时的打包构建。\n\n4.【推荐】上传代码至svn时，项目相关的配置文件（.settings、.classpath、.project）不要上传本地调试文件，仅上传src文件夹、pom.xml或bin文件夹。\n\n5.【推荐】Maven工程需要在POM配置仓库地址，避免在本地maven setting中配置，其他组员check out后无法下载或者需要从远程仓库下载；\n\n \n\n## 3 安全性\n\n【备注】公司已经有大量项目被恶意攻击历史，所以研发必须提高安全意识和相关技术、方法、手段。\n\n1.【强制】对外提供的Http Api，必须进行签名、加密。\n\n2.【强制】用户敏感数据禁止直接展示,必须对展示数据进行脱敏。接口对敏感数据也必须加密，例如：用户密码。显示成****\n\n3.【强制】隶属于用户个人的页面或者功能必须进行权限控制校验。\n\n说明：防止没有做水平权限校验就可随意访问、修改、删除别人的数据，比如查看他人的私信内容、修改他人的订单。\n\n3.【参考】用户请求传入的任何参数必须做有效性验证。说明:忽略参数校验可能导致:\n\npage size过大导致内存溢出\n\n恶意order by导致数据库慢查询任意重定向\n\nSQL注入\n\n4.【参考】表单、AJAX请求必须执行CSRF安全过滤。\n\n说明:CSRF(Cross-site request forgery)跨站请求伪造是一类常见编程漏洞。对于存在CSRF漏洞的应用/网站,攻击者可以事先构造好 URL,只要受害者用户一访问,后台便在用户不知情情况下对数据库中用户参数进行相应修改。\n\n5.【参考】在使用平台资源,譬如短信、邮件、电话、下单、支付,必须实现正确的防重放限制,如数量限制、疲劳度控制、验证码校验,避免被滥刷、资损。\n\n说明:如注册时发送验证码到手机,如果没有限制次数和频率,那么可以利用此功能骚扰到其它用户,并造成短信平台资源浪费。\n\n6.【参考】活动类需求，尤其是中奖类活动，必须实现防刷策略。\n\n \n\n## 4 系统、服务器\n\n1.【推荐】高并发服务器建议调小TCP协议的time_wait超时时间。\n\n说明:操作系统默认240秒后,才会关闭处于time_wait状态的连接,在高并发访问下,服务器端会因为处于time_wait的连接数太多,可能无法建立新的连接,所以需要在服务器上调小此等待值。\n\n正例:在 linux服务器上请通过变更/etc/sysctl.conf文件去修改该缺省值(秒): net.ipv4.tcp_fin_timeout = 30\n\n2.【推荐】调大服务器所支持的最大文件句柄数(File Descriptor,简写为fd)。\n\n说明:主流操作系统的设计是将TCP/UDP连接采用与文件一样的方式去管理,即一个连接对应于一个fd。主流的linux服务器默认所支持最大fd数量为1024,当并发连接数很大时很容易因为fd不足而出现\"open too many files\"错误,导致新的连接无法建立。建议将linux服务器所支持的最大句柄数调高数倍(与服务器的内存数量相关)。\n\n3.【推荐】给JVM设置-XX:+HeapDumpOnOutOfMemoryError 参数,让JVM碰到OOM场景时输出dump信息。\n\n说明:OOM的发生是有概率的,甚至有规律地相隔数月才出现一例,出现时的现场信息对查错 非常有价值。\n\n4.【推荐】当生产环境组件异常、无响应、假死时，务必使用jstack dump线程堆栈，使用jstat –gcutil查看下gc信息，方便后期定位、分析问题。\n\n \n\n# 七、MySql数据库\n\n## 1 建表\n\n1.【推荐】使用InnoDB存储引擎、UTF-8(utf8mb4)字符集。\n\n2.【强制】表要有主键。\n\n3.【推荐】若业务上非实时一致性要求，禁止使用外键，由程序保证最终一致性。说明:外键会导致表与表之间耦合，影响sql性能，高并发下有可能会导致死锁。\n\n4.【推荐】表名、字段名必须使用小写字母或数字,禁止出现数字开头,禁止两个下划线中间只出现数字。数据库字段名的修改代价很大,因为无法进行预发布,所以字段名称需要慎重考虑。\n\n正例:getter_admin,task_config,level3_name反例:GetterAdmin,taskConfig,level_3_name\n\n5.【推荐】表名最好不使用复数名词。\n\n说明:表名应该仅仅表示表里面的实体内容,不应该表示实体数量。6.【推荐】表的命名最好是加上\"模块名称_表名\"。\n\n\n\n正例:score_rule / score_user /score_log\n\n7.【强制】千万不要使用mysql中关键字命名，例如：desc, order等；\n\n8.【推荐】如果修改字段含义或对字段表示的状态追加时,需要及时更新字段注释。\n\n9.【强制】主键索引名为pk_字段名;唯一索引名为uk_字段名;普通索引名则为idx_字段名。说明:pk_即 primary key;uk_即unique key;idx_即index的简称。\n\n10.【强制】所有字段定义为Not Null。说明：\n\n \n\n![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEEAA.tmp.png)![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEEBA.tmp.png)![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEEBB.tmp.png)![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEEBC.tmp.png)null列影响索引。                     MySql内部需要对null进行特殊处理,会影响性能null需要更多的存储空间 null查询必须使用is 或is not,不能使用=、in等\n\n11.【强制】禁止使用ENUM类型。\n\n说明：增加新的枚举值时，需要DDL操作。\n\n12.【推荐】小数类型为decimal,禁止使用float和double。\n\n说明:float和double在存储的时候,存在精度损失的问题,很可能在值的比较时,得到不 正确的结果。如果存储的数据范围超过decimal的范围,建议将数据拆成整数和小数分开存储。\n\n13.【推荐】如果存储的字符串长度几乎相等,使用char定长字符串类型。                                                         varchar是可变长字符串,不预先分配存储空间,长度不要超过5000,如果存储长度大于此值,定义字段类型为text,独立出来一张表,用主键来对应,避免影响其它字段索引效率。\n\n14.【推荐】字段允许适当冗余,以提高查询性能,但必须考虑数据一致。冗余字段应遵循:\n\n![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEECD.tmp.png)不是频繁修改的字段。\n\n![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEECE.tmp.png)不是varchar超长字段,更不能是text字段。\n\n正例:商品类目名称使用频率高,字段长度短,名称基本一成不变,可在相关联的表中冗余存储类目名称,避免关联查询。\n\n15.【参考】合适的字符存储长度,不但节约数据库表空间、节约索引存储,更重要的是提升检索速度。\n\n \n\n## 2 索引\n\n说明：务必用explain确认SQL语句是否走了索引。\n\n1.【参考】创建索引时避免有如下极端误解:\n\n![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEECF.tmp.png)宁滥勿缺。误认为一个查询就需要建一个索引。\n\n![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEEE0.tmp.png)宁缺勿滥。误认为索引会消耗空间、严重拖慢更新和新增速度。\n\n![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEEE1.tmp.png)抵制惟一索引。误认为业务的惟一性一律需要在应用层通过\"先查后插\"方式解决。\n\n2.【强制】业务上具有唯一特性的字段,即使是多个字段的组合,也必须建成唯一索引。\n\n说明:不要以为唯一索引影响了insert速度,这个速度损耗可以忽略,但提高查找速度是明显的;另外,即使在应用层做了非常完善的校验控制,只要没有唯一索引,根据墨菲定律,必然有脏数据产生。\n\n3.【参考】建立组合索引，必须根据业务上的查询需求使用合理顺序。\n\n说明:联合索引左前缀原则：(a,b,c)只有查询条件为a|(a,b)|(a,b,c)才会走该组合索引，但跟条件顺序无关，例如：ba、bac、bca、cab都会走索引，而bc、ac不会走索引。\n\n4.【参考】负向查询(!=、not in、not exists)、前导模糊查询(like ![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEEE2.tmp.jpg)xxx')、在查询条件属性上进行函数计算、字段类型需强制转换都不会走索引。\n\n反例：\n\nselect * from score where status!=2 select * from score where name like ![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEEF2.tmp.jpg)XX'\n\nselect * from score where YEAR(create_time) <= '2017' select * from user where phone=13800001234\n\n6.【推荐】数据区分度不大的字段不宜使用索引，效果不明显。\n\n说明：\"状态\"、\"性别\"这种区分度不大的属性，建立索引是没有什么意义的，不能有效过滤数据，性能与全表扫描类似。反例：select * from user whre sex=1\n\n7.【推荐】OR查询最好改为IN查询。\n\n说明：InnoDB引擎中OR查询不能命中索引，MyISAM能命中索引，但会耗费更多的CPU。\n\n8.【推荐】超过三个表不要使用join。需要join的字段,数据类型必须绝对一致;多表关联查询时,保证被关联的字段需要有索引。说明:即使双表join也要注意表索引、SQL性能。\n\n9.【推荐】如果有order by的场景,请注意利用索引的有序性。order by最后的字段是组合 索引的一部分,并且放在索引组合顺序的最后,避免出现file_sort的情况,影响查询性能。\n\n正例:where a=? and b=? order by c; 索引:a_b_c\n\n反例:索引中有范围查找,那么索引有序性无法利用,如:WHERE a>10 ORDER BY b;索引a_b无法排序。10.建组合索引的时候,区分度最高的在最左边。\n\n正例:如果where a=? and b=? ,a列的几乎接近于唯一值,那么只需要单建 idx_a索引即可。\n\n说明:存在非等号和等号混合判断条件时,在建索引时,请把等号条件的列前置。如:where a>? and b=?那么即使a的区分度更高,也必须把b放在索引的最前列。\n\n \n\n## 3 SQL语句\n\n1.【推荐】尽量不要使用select *。\n\n2.【推荐】禁止大表使用join，禁止大表使用子查询。\n\n3.【推荐】不要使用count(列名)或count(常量)来替代count,count(*)是SQL92定义的标准统计行数的语法,跟数据库无关,跟NULL和非NULL无关。说明:count(*)会统计值为NULL的行,而count(列名)不会统计此列为NULL值的行。\n\n4.【强制】使用ISNULL()来判断是否为NULL值。注意:NULL与任何值的直接比较都为NULL。\n\n> 说明:\n>\n> NULL<>NULL的返回结果是NULL,而不是false。\n>\n> NULL=NULL的返回结果是NULL,而不是true。\n>\n> \\* NULL<>1的返回结果是NULL,而不是true。\n>\n\n5.【推荐】在代码中写分页查询逻辑时,若count为0应直接返回,避免执行后面的分页语句。\n\n6.【推荐】不要使用存储过程,存储过程难以调试和扩展,更没有移植性。\n\n \n\n## 4其他\n\n1.【强制】不要使用BLOB相关类型存储大文件或者大照片。说明：文件应使用文件系统存储，数据库存文件的URI\n\n2.【推荐】把计算尽量放到业务层(代码层)而不是数据库层，可以节省数据库服务的CPU资源，还可以根据场景在业务层进行缓存等优化，减少数据库压力。","source":"_posts/Java规范.md","raw":"title: Java规范\nauthor: Asia Cui\ntags:\n  - 规范\ncategories:\n  - Java规范\ndate: 2019-01-08 15:01:00\n---\n\n\n# 介绍\n\n## 1 目的\n\n编码规范对于程序员而言尤为首要，有以下几个原因：\n\n> - 一个软件的生命周期中，80％的花费在于维护。\n> - 几乎没有任何一个软件，在其全部生命周期中，均由最初的开辟人员来维护。编码规范可以改良软件的可读性，可以让程序员尽快而彻底地懂得新的代码。\n\n最佳实践主要是包括编码习惯、禁忌等，能有效避免常见问题，提高代码质量。\n\n## 2 适用范围\n\n本规范适用于Java开发人员。\n\n## 3 术语\n\n强制：编程时强制必须遵守的原则。\n\n推荐：编程时必须加以考虑的习惯、写法等。参考：编程时无法用代码量化的原则或描述。说明：对此规范或建议进行必要的解释。\n\n正例、反例：对此规范或建议从正、反两个方面给出例子。\n\n## 4 总体原则\n\n简单、易读、易实施执行\n\n# 命名规范\n\n## 1 基本原则\n\n命名力求做到**统一、达意、简洁**。\n\n- 统一\n\n> 统一即对于同一个概念，在程序中用同一种表示方法，比如对于供应商，既可以用supplier，也可以用provider，但是我们只能选定一个使用，至少在一个Java项目中保持统一。\n>\n> 说明:如果对同一概念有不同的表示方法，会使代码混乱难以理解。即使不能取得好的名称，但是只要统一，阅读起来也不会太困难，因为阅读者只要理解一次。\n>\n\n- 达意\n\n> 达意是指，标识符能准确的表达出它所代表的意义，比如：newSupplier,OrderPaymentGatewayService等；而supplier1,service2，idtts等则不是好的命名方式。\n>\n> 说明:准确有两成含义，一是正确，二是丰富。如果给一个代表供应商的变量起名是order，显然没有正确表达。同样的，supplier1远没有targetSupplier意义丰富。\n>\n\n- 简洁\n\n> 简 洁 是 指 ， 在 统 一 和 达 意 的 前 提 下 ， 用 尽 量 少 的 标 识 符 。 如 果 不 能 达 意 ， 宁 愿 不 要 简 洁 。 比 如 ： theOrderNameOfTheTargetSupplierWhichIsTransfered太长， transferedTargetSupplierOrderName则较好，但是transTgtSplOrdNm就不好了。注意：杜绝完全不规范的缩写,避免望文不知义。\n>\n> 反例: AbstractClass\"缩写\"命名成AbsClass;condition\"缩写\"命名成condi,此类随意缩写严重降低了代码的可阅读性。\n>\n\n\n\n## 2 通用命名规范\n\n【强制】代码中所有命名必须以英文开头，名称只能由英文字母、数字、下划线、\"-\"符号组成。严禁使用拼音与英文混合的方式,更不允许直接使用中文的方式。如下表：\n\n说明:正确的英文拼写和语法可以让阅读者易于理解,避免歧义。注意,即使纯拼音命名方式也要尽量避免采用。\n\n| 类型                               | 规范                                                         | 示例                                    |\n| ---------------------------------- | ------------------------------------------------------------ | --------------------------------------- |\n| 项目名                             | 工程名或模块名全部小写，多个英文单词以\"- \"连接。应用名与模块名，采用英文单词，不建议使用3个以上的单词，禁止使用特殊字符与数字 | lx-web-vaclient lx-dubbo-user           |\n| 文件                               | 跟类名保持一致                                               | PayController.java                      |\n| 包                                 | 包名只允许使用小写字母和数字，并且单词之间点分隔符连接（不允许使用下划线） | com.iflytek.cbg.lx. web.user.controller |\n| 类 接口                            | 类名、接口名使用UpperCamelCase风格,必须遵从驼峰形式，类名如果有复数含义,可以使用复数形式。另类名通常使用名词或名词短语 | PayController UserService               |\n| 方 法 名 参 数 名 成员变量局部变量 | 方法名、参数名、成员变量、局部变量都统一使用lowerCamelCase 风格,必须遵从驼峰形式。另方法名通常使用动词、动词短语、形容词 在单测方法中可以含有下划线，通常用来指定特定场景：test<测试方法名>_<场景>，比如：testPop_emptyStack。对于测试方法的命名没有强制性要求，也可以采用其他的命名方式 | getScore userId                         |\n| 常量                               | 常量命名全部大写,单词间用下划线隔开,力求语义表达完整清楚,不要嫌名字长 | MAX_PAY_TIMEOUT                         |\n\n\n\n## 3 类命名\n\n类名往往用不同的前缀或后缀表达额外的意思。如下表：\n\n| 前缀/后缀                                                    | 意义                                                         | 要求     |\n| ------------------------------------------------------------ | ------------------------------------------------------------ | -------- |\n| xxxController                                                | 直接处理页面请求、管理页面逻辑类、Http请求处理类             | 【强制】 |\n| xxxService                                                   | 表明这个类是个服务类，里面包含了给其他类提同业务服务的方法   | 【强制】 |\n| xxxDao                                                       | 这个类封装了数据访问方法                                     | 【强制】 |\n| xxxEntity<br />xxxDTO<br />xxxVO<br />xxxReq<br />xxxResp<br /> | 不同用处的POJO类，VO，DTO中不要出现@Entity注解数据传输对象：xxxDTO，xxx 为业务领域相关的名称展示对象：xxxVO，xxx 一般为网页名称 | 【推荐】 |\n| xxxEnum                                                      | 枚举类                                                       | 【强制】 |\n| Ixxx                                                         | 这个类是一个接口                                             | 【强制】 |\n| xxxImpl                                                      | 这个类是一个实现类，而不是接口                               | 【强制】 |\n| Abstractxxx                                                  | 抽象类                                                       | 【强制】 |\n| xxxBase                                                      | 其他类的基类                                                 | 【推荐】 |\n| xxxFactory<br />xxxProxy<br />xxxAdapter<br />xxxObserver    | 如果使用到了设计模式,建议通过后缀在类名中体现出具体模式      | 【推荐】 |\n| xxxWrapper                                                   | 这是一个包装类，为了给某个类提供没有的能力                   | 【推荐】 |\n| xxxListener<br />xxxEvent                                    | 响应某种事件相关的类                                         | 【推荐】 |\n| xxxJob                                                       | 某种按时间运行的任务                                         | 【推荐】 |\n| xxxUtils                                                     | 工具类                                                       | 【推荐】 |\n| xxxException                                                 | 异常类                                                       | 【强制】 |\n| xxxTest                                                      | 测试类                                                       | 【强制】 |\n\n \n\n## 4 方法命名\n\n方法名往往用不同的前缀表达特定的含义，如下表：\n\n| 前缀/后缀         | 意义                 | 要求     |\n| ----------------- | -------------------- | -------- |\n| getxxx()         | 获取单个对象         | 【推荐】 |\n| listxxx()        | 获取多个对象         | 【推荐】 |\n| countxxx()        | 计数，获取统计值     | 【推荐】 |\n| savexxx()         | 插入                 | 【推荐】 |\n| removexxx()         | 删除                 | 【推荐】 |\n| updatexxx()         | 更新                 | 【推荐】 |\n| findxxx()<br />searchxxx() | 搜索、查询           | 【推荐】 |\n| doxxx()<br />executexxx() | 执行某个过程或者流程 | 【推荐】 |\n| initxxx()            | 初始化               | 【推荐】 |\n| checkxxx()<br />validatexxx() | 校验合法性 | 【推荐】 |\n\n\n\n\n# 排版规范\n\n## 1 源文件结构\n\n1.【强制】所有源文件必须使用utf-8编码。\n\n2.【强制】所有未使用的import语句应该被删除。\n\n3.【强制】禁止使用通配符import。\n\n说明：Eclipse中可以通过快捷键将不需要的引入包去掉。快捷键：Ctrl + Shift + O。 IntelliJ IDEA自动导入包去除星号：\n\n打开File> Settings>Editor>Code Style>Java>Scheme Default>Imports \n\n1. 将Class count to use import with \"*\"改为99（导入同一个包的类超过这个数值自动变为 * ） \n2. 将Names count to use static import with \"*\"改为99（同上，但这是静态导入的） \n3. 将Package to Use import with \"*\"删掉默认的这两个包（不管使用多少个类，只要在这个列表里都会变为 * ）\n\n自动删除没有用到的导入包：\n\n打开File> Settings>Editor> General > Auto Import\n\n勾上 ![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsED41.tmp.jpg)                                               \n\n4.【推荐】同名的构造函数或方法之间禁止插入其他成员，例如重载的方法必须放在一起；不建议把新添加的方法一律放在最后，而是应该插入到合适的地方。\n\n说明:当一个类有多个构造方法,或者多个同名方法，或者类似方法,这些方法应该按顺序放置在一起,便于阅读。\n\n5.【推荐】类内定义顺序依次是:常量>公共变量或保护变量>私有变量>构造方法>静态公共方法>静态私有方法>公有方法或保护方法>getter/setter方法>main方法。\n\n引入lombok插件，IDEA中安装lombok插件使POJO类代码更加简洁，省去写getter/setter，构造函数的方法。具体参考：<https://yq.aliyun.com/articles/59972>, <https://www.projectlombok.org/>\n\n \n\n## 2 代码格式\n\n【强制】代码格式规范主要是缩进、空格、换行、空行的运用。具体规范如下表：\n\n说明:合理的运用缩进、空格、换行、空行，对代码的结构、可读性有非常大影响；另外，可以直接使用IDE自带的格式化快捷键进行全局或局部代码格式化。\n\n \n\n| 分类   | 规范解释                                                     | 其他描述                                                     |\n| ------ | ------------------------------------------------------------ | ------------------------------------------------------------ |\n| 行长度 | 单行字符数限制不超过120个,超出需要换行， 换行时遵循换行原则； | 设置IDE单行字符数配置                                        |\n| 缩进   | 1. 缩进采用4个空格,禁止使用tab字符；<br />2. 方法体的开始、类的定义、以及if、 for、do、while、switch、case语句中的代码都要采用缩进方式；<br />3. 由于列宽限制需要缩进的情况遵循换行原则； | 设置IDE Tab键相关配置                                        |\n| 空格   | 1. 左小括号和字符之间不出现空格;同样,右小括号和字符之间也不出现空格；2. if/for/while/switch/do等保留字与括号之间都必须加空格；<br />3. 任何二目、三目运算符的左右两边都需要加一个空格；一元操作符如\"!\"、\" ~\"、\" ++\"、\" --\"等前后不加空格；<br />4. 方法参数在定义和传入时,多个参数逗号后边必须加空格；5. 强制转型后必须跟一个空格; | 在if、else、for、do和while语句中，即使没有语句或者只有一行，也不得省略花括号。 |\n| 换行 | 1、每行最多只能写一条语句，每条语句之后都要换行。 <br />2、单行字符数超过120个限制需换行： 第二行相对第一行缩进,从第三行开始,不再继续缩进；运算符与下文一起换行；方法调用的点符号与下文一起换行；在多个参数超长,在逗号后换行；在括号前不要换行；<br />3、大括号：如果是大括号内为空,则简洁地写成{}即可,不需要换行;如果是非空代码块则:左大括号前不换行；左大括号后换行； 右大括号前换行；右大括号后还有else等代码则不换行;表示终止的右大括号后必须换行； |                                                              |\n| 空行 | 空行可以表达代码在语义逻辑上的分割，注释的作用范围，等等。将类似操作，或一组操作放在一起不用空行隔开，而用空行隔开不同组的代码。例如： 1、在类的不同的成员间增加空行，包括：成员变量、构造函数、方法、内部类、静态初始化块、实例初始化块等； 2、方法体内，按需增加空行，以便从逻辑上对语句进行分组；执行语句组、变量的定义语句组、不同的业务逻辑之间或者不同的语义之间插入一个空行。相同业务逻辑和语义之间不需要插入空行； 3、注释与其上面的代码用空行隔开； | 说明:超过十行的代码如果还不用空行分割， 就会增加阅读困难。另外，没有必要插入多个空行进行隔开。 |\n\n正例:\n\n![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsED99.tmp.png) \n\n\n\n\n\n \n\n# 注释\n\n## 1 基本原则\n- 注释力求精简准确、表达到位。\n\n>1. 能够准确反应设计思想和代码逻辑;\n>2. 能够描述业务含义,使别的程序员能够迅速了解到代码背后的信息。好的命名、代码结构是自解释的,往往不需要或者只需要很少注释，就可以让人读懂；相反，不能正确表达代码意义的注释，只会损害代码的可读性。\n\n- 注释宜少而精，不宜多而滥，更不能误导，过多的注释会成为后期维护的负担。\n\n> 防止过多过滥的注释，没必要的重复注释，或对显而易见的代码添加注释。\n\n- 代码混乱，再多的注释都不能弥补，所以，应当先在代码本身下功夫。\n\n- \n  注释要和代码同步。代码修改的同时,注释也要进行相应的修改,尤其是参数、返回值、异常、核心逻辑等的修改。\n\n\n> 说明:代码与注释更新不同步,就像路网与导航软件更新不同步一样,如果导航软件严重滞后,就失去了导航的意义。\n>\n\n- 注释不是用来管理代码版本的，如果有代码不要了，直接删除，svn会有记录的，不要注释掉，否则以后没人知道那段注释掉的代码该不该删除。\n\n\n\n\n## 2 Javadoc说明\n\n\n\nJava程序有两类注释：实现注释和文档注释。\n\n实现注释是那些在C++中见过的，应用/.../和//界定的注释。文档注释是Java独有的（即Javadoc），由/*.../界定,文档注释可以经由Javadoc工具转换成HTML文件。 Javadoc注释是给类的使用者来看的，主要介绍是什么功能，什么含义，怎么用等信息。凡是类的使用者需要知道，都要用Javadoc来写。Javadoc注释只负责描述类(class)、接口(interface)、方法(method)、构造器(constructor)、成员字段(field)。相应地，文档注释必须写在类、接口、方法、构造器、成员字段前面，而写在其他位置，比如函数内部，是无效的文档注释。\n\n非Javadoc的注释往往是给代码的维护者看的，用以注释代码或者实现细节，着重告述读者功能以及逻辑，特殊或者复杂的逻辑可以注释说明为什么这样写，如何修改，注意什么问题等。 Javadoc说明可参考文档：<http://docs.oracle.com/javase/8/docs/technotes/tools/windows/javadoc.html> <http://blog.csdn.net/garfielder007/article/details/54959597>\n\n\n\n![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEDBF.tmp.png)正例:\n\n## 3 Javadoc规范\n\n下面规范要求不包括符合\"注释-基本原则\"中代码能自解释的例外情况。\n\n1. 【强制】所有的类都必须添加类功能描述、创建者和创建日期。\n\n2. 【推荐】类公共属性、类公共方法需要增加Javadoc注释,即使用/*内容/格式,不得使用//xxx方式。\n\n3. 【强制】所有对外暴露的服务(RPC..)中类、方法、输入参数、输出参数必须添加Javadoc注释。\n\n4. 【强制】项目组内通用类库或者开发的可复用的类库中对使用者暴露的类、方法、属性必须增加Javadoc注释。\n\n5. 【强制】所有抽象类和接口必须要用Javadoc注释；另外，子类中override的方法和接口的实现类对应的方法实现大部分情况下不需要添加注释。\n\n6. 【强制】对已经不推荐使用的类和方法需要注明@Deprecated，并说明替代的类或者方法。\n\n7. 【推荐】枚举类和常量类字段尽量要有注释, 说明每个字段的含义。说明：字段命名能自解释的除外。\n\n8. 【推荐】特殊注释标记,请注明标记人与标记时间。注意及时处理这些标记,通过标记扫描,经常清理此类标记。线上故障有时候就是来源于这些标记处的代码。\n\n   ```Java\n   待办事宜(TODO):(标记人,标记时间,[预计处理时间])\n   ```\n\n表示需要实现,但目前还未实现的功能。这实际上是一个 Javadoc 的标签,目前的 Javadoc还没有实现,但已经被广泛使用。只能应用于类,接口和方法(因为它是一个 Javadoc 标签)。\n\n```java\n错误,不能工作(FIXME):(标记人,标记时间,[预计处理时间])\n```\n\n在注释中用 FIXME 标记某代码是错误的,而且不能工作,需要及时纠正的情况。\n\n9.【强制】注释的双斜线与注释内容之间有且仅有一个空格。 正例：// 注释内容，注意在`//`和`注释内容`之间有一个空格。\n\n \n\n# 编码规范\n\n## 1 声明、赋值等语句\n\n1. 【强制】一行只声明一个变量，不允许一行声明多个变量；在需要时声明变量，声明后尽快初始化，即初始化和被使用尽量放在一起。\n2. 【强制】不允许把多个短语句写在一行中，即一行只写一条语句。\n3. 【强制】避免在一个语句中执行多种操作，例如：给多个变量赋雷同的值，或赋值运算符与相等关系运算符混合使用，它很难读懂。\n\n<span style=\"color: #ff0000\">反例:</span> \n\n```c\nfooBar.fChar = barFoo.lchar = \"c\";\n\nif （c++ = d++） {\n\n//TODO\n\n}\n\nd = （a = b + c） + r;\n```\n\n4. 【强制】所有的相同类型的包装类对象之间值的比较,全部使用equals方法比较。另外equals方法容易抛空指针异常,应使用常量或确定有值的对象来调用equals。 说明:对于Integer var = ?在-128至127范围内的赋值,Integer对象是在IntegerCache.cache产生,会复用已有对象,这个区间内的Integer值可以直接使用==进行判断,但是这个区间之外的所有数据,都会在堆上产生,并不会复用已有对象,这是一个大坑。 正例: \"test\".equals(object); 反例: object.equals(\"test\"); \n5. 【强制】定义 DO/DTO/VO 等 POJO 类时，不要设定任何属性默认值。 反例：POJO 类的 gmtCreate 默认值为 new Date();但是这个属性在数据提取时并没有置入具体值，在更新其它字段时又附带更新了此字段，导致创建时间被修改成当前时间。 \n6. 【强制】序列化类新增属性时，请不要修改 serialVersionUID 字段，避免反序列失败；如果完全不兼容升级，避免反序列化混乱，那么请修改 serialVersionUID 值。 说明：注意 serialVersionUID 不一致会抛出序列化运行时异常。 \n7. 【强制】构造方法里面禁止加入任何业务逻辑，如果有初始化逻辑，请放在 init 方法中。\n8. 【推荐】当一个类有多个构造方法，或者多个同名方法，这些方法应该按顺序放置在一起， 便于阅读。 \n9. 【推荐】 类内方法定义顺序依次是：公有方法或保护方法 > 私有方法 > getter/setter 方法。 说明：公有方法是类的调用者和维护者最关心的方法，首屏展示最好；保护方法虽然只是子类关心，也可能是\"模板设计模式\"下的核心方法；而私有方法外部一般不需要特别关心，是一个 黑盒实现；因为承载的信息价值较低，所有Service 和 DAO 的 getter/setter 方法放在类体最后。\n\n \n\n## 2 控制语句、程序结构\n\n1.  【强制】在一个switch块内,每个case要么通过break/return等来终止,要么注释说明程序将继续执行到哪一个case为止;在一个switch块内,都必须包含一个default语句并且放在最后,即使它什么代码也没有。\n2. 【强制】在if/else/for/while/do语句中必须使用大括号，即使只有一行代码,避免使用单行的形式:if (condition) statements。\n3. 【强制】不要在if语句中使用等号=进行赋值操作。\n4. 【强制】不要在条件判断中执行其它复杂的语句,将复杂逻辑判断的结果赋值给一个有意义的布尔变量名,提高可读性。\n\n> 说明:很多if语句内的逻辑相当复杂,阅读者需要分析条件表达式的最终结果,才能明确什么样的条件执行什么样的语句,那么,如果阅读者分析逻辑表达式错误呢?\n>\n\n正例:\n![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEDE2.tmp.png) \n\n反例:\n\n```java\nif ((file.open(fileName, \"w\") != null) && (...) || (...)) {\n\n...\n\n}\n```\n5.【推荐】代码嵌套层次不要超过3层。\n说明:代码嵌套层次达3层以上时，一般人理解起来都会困难。减少嵌套的方法有很多：合并条件、利用return以省略后面的else、利用子方法(将嵌套的程序提取出来放到另外的方法里)等。\n\n6.【推荐】类超过2000行的程序难以阅读，应该尽量避免出现超过2000行的程序；\n\n7.【推荐】注意运算符的优先级，避免使用默认优先级。一般而言，在含有多种运算符的表达式中应用圆括号来明确表达式的操作顺序，是个好办法。\n\n> 说明：防止阅读程序时产生误解，防止因默认的优先级与设计思想不符而导致程序出错。\n>\n\n8.【推荐】可以通过return语句减少嵌套层次: if (condition) {\n\n... return obj;\n\n}\n\n// 接着写 else 的业务逻辑代码;\n\n## 3 常量\n\n1.【推荐】魔法值(未经定义的常量)尽量不要直接出现在代码中，代之以有名字的static final静态常量或者enum值。\n\n说明：魔法值使代码的可读性大大下降，而且，如果同样的数值多次出现时，到底这些数值是不是带有同样的含义呢，谁也说不清楚。另一方面， 如果本来应该使用相同数值的地方，一旦用错了，也很难发现，修改维护也不方便。因此，需要注意以下几点，极力避免使用魔法数值。\n\n反例:\n\nString key = \"Id#taobao_\" + tradeId; cache.put(key, value);\n\n2.【推荐】不要使用一个常量类维护所有常量,应该按常量功能进行归类分开维护。如:缓存相关的常量放在类:CacheConsts下;系统配置相关的常量放在类:ConfigConsts 下。\n\n说明:大而全的常量类,非得使用查找功能才能定位到修改的常量,不利于理解和维护。\n\n3.【推荐】常量的复用层次有五层:跨应用共享常量、应用内共享常量、子工程内共享常量、包内共享常量、类内共享常量。\n\n4.【推荐】如果变量值仅在一个范围内变化,且带有名称之外的延伸属性,定义为枚举类。下面正例中的数字就是延伸信息,表示星期几。正例:\n\n```java\npublic enum WeekEnum{\n\nMONDAY(1), TUESDAY(2), WEDNESDAY(3), THURSDAY(4), FRIDAY(5), SATURDAY(6), SUNDAY(7);\n\n}\n```\n\n5.【推荐】避免使用不易理解的数字，用有意义的标识来替代。涉及物理状态或者含有物理意义的常量，不应直接使用数字，用有意义的静态变量来代替更好。\n\n反例：如下的程序可读性差。 \n\n```java\nif (state == 0) {\n\nstate = 1;\n\n// program code\n\n}\n```\n\n正例:\n\n```java\nprivate final static int TRUNK_IDLE = 0; private final static int TRUNK_BUSY = 1; private final static int TRUNK_UNKNOWN = -1; if (state == TRUNK_IDLE) {\n\nstate = TRUNK_BUSY;\n\n// program code\n\n}\n```\n\n\n\n## 4 并发、线程、性能\n\n1. 【强制】获取单例对象需要保证线程安全，其中的方法也要保证线程安全。说明：资源驱动类、工具类、单例工厂类都需要注意。\n2. 【强制】创建线程或线程池时请指定有意义的线程名称，方便出错时回溯。正例：\n\n```java\npublic class TimerTaskThread extends Thread { \npublic TimerTaskThread() { \nsuper.setName(\"TimerTaskThread\");\n\n...\n\n}\n```\n\n3. 【强制】线程资源必须通过线程池提供，不允许在应用中自行显式创建线程。 说明：使用线程池的好处是减少在创建和销毁线程上所花的时间以及系统资源的开销，解决资 源不足的问题。如果不使用线程池，有可能造成系统创建大量同类线程而导致消耗完内存或者 \"过度切换\"的问题。\n\n4. 【强制】线程池不允许使用 Executors 去创建，而是通过 ThreadPoolExecutor 的方式，这样 的处理方式让写的同学更加明确线程池的运行规则，规避资源耗尽的风险。\n\n说明：Executors 返回的线程池对象的弊端如下：\n\n> FixedThreadPool 和 SingleThreadPool:\n\n允许的请求队列长度为Integer.MAX_VALUE，可能会堆积大量的请求，从而导致 OOM。\n\n> CachedThreadPool 和 ScheduledThreadPool:\n\n允许的创建线程数量为Integer.MAX_VALUE，可能会创建大量的线程，从而导致OOM。\n\n5. 【强制】SimpleDateFormat是线程不安全的类,一般不要定义为static变量,如果定义为static,必须加锁,或者使用JodaTime。\n6. 【强制】在使用正则表达式时,利用好其预编译功能,可以有效加快正则匹配速度。说明:不要在方法体内定义:Pattern pattern = Pattern.compile(规则);\n7. 【推荐】避免Random实例被多线程使用,虽然共享该实例是线程安全的,但会因竞争同一seed导致的性能下降。说明:Random实例包括java.util.Random的实例或者Math.random()的方式。\n8. 【推荐】注意Math.random()这个方法返回是double类型,注意取值的范围0≤x<1(能够 取到零值,注意除零异常),如果想获取整数类型的随机数, 不要将x放大10的若干倍然后取整,直接使用Random对象的nextInt或者nextLong法。\n9. 【强制】并发修改同一记录时，避免更新丢失，需要加锁。要么在应用层加锁，要么在缓存加 锁，要么在数据库层使用乐观锁，使用 version 作为更新依据。\n\n> 说明:如果每次访问冲突概率小于20%，推荐使用乐观锁，否则使用悲观锁。乐观锁的重试次 数不得小于3次。 \n\n10.【强制】多线程并行处理定时任务时，Timer 运行多个 TimeTask 时，只要其中之一没有捕获 抛出的异常，其它任务便会自动终止运行，使用ScheduledExecutorService 则没有这个问题。\n\n11.【推荐】循环体中的语句要考量性能,循环体是最容易发生性能问题的地方。以下操作尽量移至循环体外处理,如定义对象、变量、获取数据库连接,进行不必要的try-catch 操作(这个try-catch是否可以移至循环体外)。\n\n12.【强制】循环体内字符串的连接方式,使用StringBuilder的append方法进行扩展。\n\n说明:反编译出的字节码文件显示每次循环都会new出一个StringBuilder对象,然后进行append操作,最后通过toString方法返回String对象,造成内存资源浪费。\n\n反例:\n\n```java\nString str = \"start\";\n\nfor (int i = 0; i < 100; i++) { \n  str = str + \"hello\";\n}\n```\n\n13.【推荐】任何数据结构的构造或初始化,都应指定大小,避免数据结构无限增长吃光内存。\n\n14.【推荐】[在明确的场景下,为集合指定初始容量](http://www.cnblogs.com/DreamDrive/p/5422175.html)。\n\n说明:集合有默认大小，首先每次新增时都会判断是否达到临界点，且当长度不足时动态扩展严重影响性能。\n\n15.【强制】使用entrySet遍历Map类集合KV,而不是keySet方式进行遍历。\n\n说明:keySet其实是遍历了2次,一次是转为Iterator对象,另一次是从hashMap中取出key所对应的value。而entrySet只是遍历了一次就把key和value 都放到了 entry中,效率更高。\n\n\\16. 【推荐】高度注意 Map 类集合 K/V 能不能存储 null 值的情况，如下表格：\n\n \n\n| 集合类            | Key           | Value        | Super       | 说明       |\n| ----------------- | ------------- | ------------ | ----------- | ---------- |\n| Hashtable         | 不允许为null  | 不允许为null | Dictionary  | 线程安全   |\n| ConcurrentHashMap | 不允许为 null | 不允许为 nul | AbstractMap | 锁分段技术 |\n| TreeMap           | 不允许为 nul  | 允许为 null  | AbstractMap | 线程不安全 |\n| HashMap           | 允许为 null   | 允许为 null  | AbstractMap | 线程不安全 |\n\n \n\n反例： 由于 HashMap 的干扰，很多人认为 ConcurrentHashMap 是可以置入 null 值，而事实上， 存储 null 值时会抛出 NPE 异常。\n\n \n\n## 5 日志\n\n1.【强制】不允许使用System.out.print，也不可直接使用日志系统(Log4j、Logback)中的API,而应依赖使用日志框架SLF4J中的API,使用门面模式的日志框架,有利于维护和各个类的日志处理方式统一和更换日志系统。\n\n说明：日志框架可以设定级别，可以控制输出到哪里，容易区分是在代码的什么地方打印的，而System.out.print则不行。而且System.out.print的速度很慢。所以，除非是有意的，否则都要用日志框架。至少在提交到版本库之前把System.out.print换成日志框架。\n\n正例：\n\n```java\nimport org.slf4j.Logger;\n\nimport org.slf4j.LoggerFactory; public class Demo {\n\nprivate static final Logger logger = LoggerFactory.getLogger(Abc.class);\n\n}\n```\n\n2.【强制】避免重复打印日志,浪费磁盘空间,务必在log4j.xml或logback.xml中设置 additivity=false。正例:\n\n<logger name=\"com.iflytek.lx.config\" additivity=\"false\">\n\n3.【强制】生产环境禁止输出debug、trace和其他调试日志；相应的，生产环境一定要记录下错误日志和异常异常，利于现网故障或用户投诉时排查问题。\n\n说明：谨慎地根据需要配置日志级别。例如测试环境可以打开info日志，性能测试需要关闭debug和其他调试日志，保持与生存环境一致。日志的级别由高到低分别为：ERROR >> WARN >> INFO >> DEBUG >> TRACE。\n\n\n\n- Error：用于记录影响系统正常运行的一切信息，包括：Throwable、Error、Exception、与其他系统通讯错误，例如：SQL执行异常、其他系统返回的错误信息；\n\n\n- Warn：用于记录不影响系统正常运行，但需要注意需要及时解决，例如：某个信息；                                        Info：通常生产环境的最低级别，用于记录这种重要的提示信息，例如：各种通讯信息，关键的提示信息，以及这种需要在生产环境下提示的信息；\n- Debug： 记录一些详细的数据，比如我们想知道一个方法的多个入参值，那么在生产环境中，一般不会打印出来，在开发阶段和调试阶段，建议使用debug进行记录查看。在生产环境中将不会出现此类信息（当然可能在某些特定情况下，通过特殊手段某一时间段打开用于生产环境调试）。\n- Trace：用于代替System.out.println()和System.err.println()，供开发阶段调试用。\n\n4.【推荐】在生产环境中配置日志框架自动加载刷新，即不重启应用就可以调整日志的配置。例如在logback.xml的配置中开源加上：\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n\n<configuration scan=\"true\" scanPeriod=\"60 seconds\">\n\n</configuration>\n```\n\n\n\n## 6 异常\n\n1.【强制】不允许使用printStackTrace打印异常日志。\n\n2.【强制】记录异常日志时不要只保存exception.getMessage()，记录整个异常堆栈信息。\n\n3.【强制】捕获异常是为了处理它,不要捕获了却什么都不处理而抛弃之,如果不想处理它,请将该异常抛给它的调用者。另外自己抛出的异常必须要填写详细的描述信息，且必须保留原来的异常，便于问题定位，例如：throw new IOException(\"Writing data error! Data: \" + data. toString(), e)。\n\n4.【强制】不能在finally块中使用return,finally块中的return返回后方法结束执行,不会再执行try块中的return语句。\n\n5.【强制】finally块必须对资源对象、流对象进行关闭，例如数据库操作、IO操作,且有异常也要进行try-catch，因为finally块中如果发生异常, 不会再执行try块中的return语句。\n\n6.【推荐】防止NullPointerException,IndexOutOfBoundsException是程序员的基本修养,代码中可以通过预先检查进行规避,而不应该通过catch来处理。\n\n正例:\n\nif (obj != null) {\n\n...\n\n}\n\n反例: try {\n\nobj.method();\n\n} catch (NullPointerException e) {\n\n...\n\n}\n\n## 7 其他\n\n1.【强制】关于hashCode和equals的处理,遵循如下规则:\n\n** 只要重写equals,就必须重写 hashCode。\n\n** 因为Set存储的是不重复的对象,依据hashCode和equals进行判断,所以Set存储的对象必须重写这两个方法。\n\n** 如果自定义对象做为Map的键,那么必须重写hashCode和equals。\n\n说明:String重写了hashCode和equals方法,所以我们可以非常愉快地使用String 对象作为key来使用。2.【强制】所有的覆写方法,必须加@Override注解。\n\n3.【强制】不能使用过时的类或方法。       4.【推荐】慎用Object的clone方法来拷贝对象。\n\n说明:对象的clone方法默认是浅拷贝,若想实现深拷贝需要重写clone方法实现属性对象的拷贝。                                       5.【推荐】POJO类重写toString方法。使用 IDE 的中工具：source> generate toString 时，如果继承了另一个 POJO 类，注意在前面加一下super.toString。\n\n说明：在方法执行抛出异常时，可以直接调用 POJO 的 toString()方法打印其属性值，便于排查问题。或者使用lombok插件，自动生成toString()方法。使用lomok可以防止在getter/setter加入业务逻辑。\n\n6.【强制】不要在foreach循环里进行集合元素的remove/add操作。remove 元素请使用 Iterator 方式，如果并发操作，需要对 Iterator 对象加锁。\n\n7.【推荐】使用索引访问用String的split方法得到的数组时,做边界检查,否则会有抛IndexOutOfBoundsException的风险。\n\n8.【强制】禁止在代码中显示调用System.gc()。\n\n9.【强制】避免通过一个类的对象引用访问此类的静态变量或静态方法,无谓增加编译器解析成本,直接用类名来访问即可。正例：\n\nFoo.aStaticMethod(); // good反例：\n\nFoo aFoo = ...; aFoo.aStaticMethod();\n\nsomethingThatYieldsAFoo().aStaticMethod();\n\n10.【推荐】类成员与方法访问控制从严，不是必须使用public属性的，请使用protected，不是必须使用protected,请使用private。\n\n![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE18.tmp.png)![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE28.tmp.png)如果不允许外部直接通过new来创建对象,那么构造方法必须是private。\n\n** 工具类不允许有public或default构造方法。\n\n** 类非static成员变量并且与子类共享,必须是protected。\n\n** 类非static成员变量并且仅在本类使用,必须是private。\n\n** 类static成员变量如果仅在本类使用,必须是private。\n\n** 若是 static 成员变量,必须考虑是否为final。\n\n** 类成员方法只供类内部调用,必须是private。\n\n![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE29.tmp.png)类成员方法只对继承类公开,那么限制为protected。\n\n\n\n说明:良好的程序设计应该尽可能减小类与类之间耦合，所遵循的经验法则是：尽量限制成员函数的可见性。\n\n11.【强制】在一个项目组内开发环境、测试环境、生产环境使用统一版本的JDK。\n\n说明:不同版本的JDK编译出来的class不一样，可能存在冲突，不同版本的JDK也会带来莫名奇妙的问题且很难定位，所以一开始就要求必须统一。\n\n12.【推荐】避免出现重复的代码(Don't Repeat Yourself),即DRY原则。\n\n说明:随意复制和粘贴代码,必然会导致代码的重复,在以后需要修改时,需要修改所有的副本,容易遗漏。必要时抽取共性方法,或者抽象公共类,甚至是共用模块。\n\n13.【推荐】在代码中使用\"抛异常\"还是\"返回错误码\",对于公司外的 http/api 开放接口必须使用\"错误码\";而应用内部推荐异常抛出;跨应用间RPC 调用优先考虑使用Result方式,封装isSuccess()方法、\"错误码\"、\"错误简短信息\"。\n\n说明:关于RPC方法返回方式使用Result方式的理由:\n\n![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE3A.tmp.png)使用抛异常返回方式,调用方如果没有捕获到就会产生运行时错误。\n\n![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE3B.tmp.png)如果不加栈信息,只是new自定义异常,加入自己的理解的error message,对于调用端解决问题的帮助不会太多。如果加了栈信息,在频繁调用出错的情况下,数据序列化和传输的性能损耗也是问题。\n\n \n\n14.【推荐】logback比log4j性能要好很多，但是logback和log4j互斥，只能使用其中之一。因此，使用logback需要排除掉log4j依赖所有相关jar 包依赖，且为了兼容一些二方库、三方库（可能使用了log4j），需要引入引入log4j-over-slf4j.jar; 15.【推荐】对于\"明确停止使用的代码和配置\",如方法、变量、类、配置文件、动态配置属性等要坚决从程序中清理出去,避免造成过多垃圾。\n\n \n\n# 系统工程\n\n## 1 工程化\n\n1.【推荐】针对业务形态，工程分为以下几种情况：\n\n![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE3C.tmp.png)Web工程\n\n![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE4D.tmp.png)![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE4E.tmp.png)web-应用名，以\"web-\"前缀开头。Dubbo工程\n\n![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE4F.tmp.png)![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE5F.tmp.png)service-应用名，以\"service-\"前缀开头。Interface工程\n\n![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE60.tmp.png)![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE71.tmp.png)interface-应用名，以\"interface-\"前缀开头。工具或者任务\n\n![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE72.tmp.png)![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE73.tmp.png)tool-应用名，以\"tool-\"前缀开头，或以\"job-\"前缀开头。Java公共Jar包\n\n![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE84.tmp.png)common-模块名，以\"common-\"前缀开头。\n\n![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE85.tmp.jpg)2.【推荐】J2SE项目工程结构\n\n \n\n说明：J2SE项目有两种情况：\n\n一个是小工具，可以独立运行，处理一些简单的业务，打包为zip包。\n\n另一个是公共开发包，打包为jar包。以API方式提供给其它应用程序，以专业专注的精神进行分包，例如：通信协议包，常用工具包，加密解密包等等。公共开发包可能无法独立运行，所有的服务API都需要进行单元测试，并要保证线程安全。\n\n \n\n## 2 包管理、版本管理\n\n1.【推荐】Maven定义GAV遵从以下规则:\n\n\\* GroupID格式:com.{公司}.{部门}.业务线.[子业务线],最多4级。\n\n\\* 正例:com.iflytek.cbg.lx 或 com.iflytek.cgb.kuyin\n\n\n\n![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE86.tmp.png)![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE96.tmp.png)ArtifactID格式:产品线名-模块名。语义不重复不遗漏,先到中央仓库去查证一下。正例:lx-web-user/lx-dubbo-user/lx-common\n\n\\* Version:详细规定参考下方。\n\n2.【推荐】二方库版本号命名方式:主版本号.次版本号.修订号\n\n![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE97.tmp.png)![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE98.tmp.png)主版本号:当做了不兼容的API修改,或者增加了能改变产品方向的新功能。次版本号:当做了向下兼容的功能性新增(新增类、接口等)。\n\n![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEEA9.tmp.png)修订号:修复bug,没有修改方法签名的功能加强,保持API兼容性。\n\n说明:正式发布的类库必须先去中央仓库进行查证,使版本号有延续性,正式版本号不允许覆盖升级。如当前版本:1.3.3,那么下一个合理的版本号: 1.3.4或1.4.0或2.0.0\n\n3.【推荐】线上应用不要依赖SNAPSHOT版本(安全包除外)。\n\n说明:不依赖SNAPSHOT版本是保证应用发布的幂等性。另外,也可以加快编译时的打包构建。\n\n4.【推荐】上传代码至svn时，项目相关的配置文件（.settings、.classpath、.project）不要上传本地调试文件，仅上传src文件夹、pom.xml或bin文件夹。\n\n5.【推荐】Maven工程需要在POM配置仓库地址，避免在本地maven setting中配置，其他组员check out后无法下载或者需要从远程仓库下载；\n\n \n\n## 3 安全性\n\n【备注】公司已经有大量项目被恶意攻击历史，所以研发必须提高安全意识和相关技术、方法、手段。\n\n1.【强制】对外提供的Http Api，必须进行签名、加密。\n\n2.【强制】用户敏感数据禁止直接展示,必须对展示数据进行脱敏。接口对敏感数据也必须加密，例如：用户密码。显示成****\n\n3.【强制】隶属于用户个人的页面或者功能必须进行权限控制校验。\n\n说明：防止没有做水平权限校验就可随意访问、修改、删除别人的数据，比如查看他人的私信内容、修改他人的订单。\n\n3.【参考】用户请求传入的任何参数必须做有效性验证。说明:忽略参数校验可能导致:\n\npage size过大导致内存溢出\n\n恶意order by导致数据库慢查询任意重定向\n\nSQL注入\n\n4.【参考】表单、AJAX请求必须执行CSRF安全过滤。\n\n说明:CSRF(Cross-site request forgery)跨站请求伪造是一类常见编程漏洞。对于存在CSRF漏洞的应用/网站,攻击者可以事先构造好 URL,只要受害者用户一访问,后台便在用户不知情情况下对数据库中用户参数进行相应修改。\n\n5.【参考】在使用平台资源,譬如短信、邮件、电话、下单、支付,必须实现正确的防重放限制,如数量限制、疲劳度控制、验证码校验,避免被滥刷、资损。\n\n说明:如注册时发送验证码到手机,如果没有限制次数和频率,那么可以利用此功能骚扰到其它用户,并造成短信平台资源浪费。\n\n6.【参考】活动类需求，尤其是中奖类活动，必须实现防刷策略。\n\n \n\n## 4 系统、服务器\n\n1.【推荐】高并发服务器建议调小TCP协议的time_wait超时时间。\n\n说明:操作系统默认240秒后,才会关闭处于time_wait状态的连接,在高并发访问下,服务器端会因为处于time_wait的连接数太多,可能无法建立新的连接,所以需要在服务器上调小此等待值。\n\n正例:在 linux服务器上请通过变更/etc/sysctl.conf文件去修改该缺省值(秒): net.ipv4.tcp_fin_timeout = 30\n\n2.【推荐】调大服务器所支持的最大文件句柄数(File Descriptor,简写为fd)。\n\n说明:主流操作系统的设计是将TCP/UDP连接采用与文件一样的方式去管理,即一个连接对应于一个fd。主流的linux服务器默认所支持最大fd数量为1024,当并发连接数很大时很容易因为fd不足而出现\"open too many files\"错误,导致新的连接无法建立。建议将linux服务器所支持的最大句柄数调高数倍(与服务器的内存数量相关)。\n\n3.【推荐】给JVM设置-XX:+HeapDumpOnOutOfMemoryError 参数,让JVM碰到OOM场景时输出dump信息。\n\n说明:OOM的发生是有概率的,甚至有规律地相隔数月才出现一例,出现时的现场信息对查错 非常有价值。\n\n4.【推荐】当生产环境组件异常、无响应、假死时，务必使用jstack dump线程堆栈，使用jstat –gcutil查看下gc信息，方便后期定位、分析问题。\n\n \n\n# 七、MySql数据库\n\n## 1 建表\n\n1.【推荐】使用InnoDB存储引擎、UTF-8(utf8mb4)字符集。\n\n2.【强制】表要有主键。\n\n3.【推荐】若业务上非实时一致性要求，禁止使用外键，由程序保证最终一致性。说明:外键会导致表与表之间耦合，影响sql性能，高并发下有可能会导致死锁。\n\n4.【推荐】表名、字段名必须使用小写字母或数字,禁止出现数字开头,禁止两个下划线中间只出现数字。数据库字段名的修改代价很大,因为无法进行预发布,所以字段名称需要慎重考虑。\n\n正例:getter_admin,task_config,level3_name反例:GetterAdmin,taskConfig,level_3_name\n\n5.【推荐】表名最好不使用复数名词。\n\n说明:表名应该仅仅表示表里面的实体内容,不应该表示实体数量。6.【推荐】表的命名最好是加上\"模块名称_表名\"。\n\n\n\n正例:score_rule / score_user /score_log\n\n7.【强制】千万不要使用mysql中关键字命名，例如：desc, order等；\n\n8.【推荐】如果修改字段含义或对字段表示的状态追加时,需要及时更新字段注释。\n\n9.【强制】主键索引名为pk_字段名;唯一索引名为uk_字段名;普通索引名则为idx_字段名。说明:pk_即 primary key;uk_即unique key;idx_即index的简称。\n\n10.【强制】所有字段定义为Not Null。说明：\n\n \n\n![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEEAA.tmp.png)![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEEBA.tmp.png)![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEEBB.tmp.png)![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEEBC.tmp.png)null列影响索引。                     MySql内部需要对null进行特殊处理,会影响性能null需要更多的存储空间 null查询必须使用is 或is not,不能使用=、in等\n\n11.【强制】禁止使用ENUM类型。\n\n说明：增加新的枚举值时，需要DDL操作。\n\n12.【推荐】小数类型为decimal,禁止使用float和double。\n\n说明:float和double在存储的时候,存在精度损失的问题,很可能在值的比较时,得到不 正确的结果。如果存储的数据范围超过decimal的范围,建议将数据拆成整数和小数分开存储。\n\n13.【推荐】如果存储的字符串长度几乎相等,使用char定长字符串类型。                                                         varchar是可变长字符串,不预先分配存储空间,长度不要超过5000,如果存储长度大于此值,定义字段类型为text,独立出来一张表,用主键来对应,避免影响其它字段索引效率。\n\n14.【推荐】字段允许适当冗余,以提高查询性能,但必须考虑数据一致。冗余字段应遵循:\n\n![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEECD.tmp.png)不是频繁修改的字段。\n\n![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEECE.tmp.png)不是varchar超长字段,更不能是text字段。\n\n正例:商品类目名称使用频率高,字段长度短,名称基本一成不变,可在相关联的表中冗余存储类目名称,避免关联查询。\n\n15.【参考】合适的字符存储长度,不但节约数据库表空间、节约索引存储,更重要的是提升检索速度。\n\n \n\n## 2 索引\n\n说明：务必用explain确认SQL语句是否走了索引。\n\n1.【参考】创建索引时避免有如下极端误解:\n\n![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEECF.tmp.png)宁滥勿缺。误认为一个查询就需要建一个索引。\n\n![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEEE0.tmp.png)宁缺勿滥。误认为索引会消耗空间、严重拖慢更新和新增速度。\n\n![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEEE1.tmp.png)抵制惟一索引。误认为业务的惟一性一律需要在应用层通过\"先查后插\"方式解决。\n\n2.【强制】业务上具有唯一特性的字段,即使是多个字段的组合,也必须建成唯一索引。\n\n说明:不要以为唯一索引影响了insert速度,这个速度损耗可以忽略,但提高查找速度是明显的;另外,即使在应用层做了非常完善的校验控制,只要没有唯一索引,根据墨菲定律,必然有脏数据产生。\n\n3.【参考】建立组合索引，必须根据业务上的查询需求使用合理顺序。\n\n说明:联合索引左前缀原则：(a,b,c)只有查询条件为a|(a,b)|(a,b,c)才会走该组合索引，但跟条件顺序无关，例如：ba、bac、bca、cab都会走索引，而bc、ac不会走索引。\n\n4.【参考】负向查询(!=、not in、not exists)、前导模糊查询(like ![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEEE2.tmp.jpg)xxx')、在查询条件属性上进行函数计算、字段类型需强制转换都不会走索引。\n\n反例：\n\nselect * from score where status!=2 select * from score where name like ![img](file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEEF2.tmp.jpg)XX'\n\nselect * from score where YEAR(create_time) <= '2017' select * from user where phone=13800001234\n\n6.【推荐】数据区分度不大的字段不宜使用索引，效果不明显。\n\n说明：\"状态\"、\"性别\"这种区分度不大的属性，建立索引是没有什么意义的，不能有效过滤数据，性能与全表扫描类似。反例：select * from user whre sex=1\n\n7.【推荐】OR查询最好改为IN查询。\n\n说明：InnoDB引擎中OR查询不能命中索引，MyISAM能命中索引，但会耗费更多的CPU。\n\n8.【推荐】超过三个表不要使用join。需要join的字段,数据类型必须绝对一致;多表关联查询时,保证被关联的字段需要有索引。说明:即使双表join也要注意表索引、SQL性能。\n\n9.【推荐】如果有order by的场景,请注意利用索引的有序性。order by最后的字段是组合 索引的一部分,并且放在索引组合顺序的最后,避免出现file_sort的情况,影响查询性能。\n\n正例:where a=? and b=? order by c; 索引:a_b_c\n\n反例:索引中有范围查找,那么索引有序性无法利用,如:WHERE a>10 ORDER BY b;索引a_b无法排序。10.建组合索引的时候,区分度最高的在最左边。\n\n正例:如果where a=? and b=? ,a列的几乎接近于唯一值,那么只需要单建 idx_a索引即可。\n\n说明:存在非等号和等号混合判断条件时,在建索引时,请把等号条件的列前置。如:where a>? and b=?那么即使a的区分度更高,也必须把b放在索引的最前列。\n\n \n\n## 3 SQL语句\n\n1.【推荐】尽量不要使用select *。\n\n2.【推荐】禁止大表使用join，禁止大表使用子查询。\n\n3.【推荐】不要使用count(列名)或count(常量)来替代count,count(*)是SQL92定义的标准统计行数的语法,跟数据库无关,跟NULL和非NULL无关。说明:count(*)会统计值为NULL的行,而count(列名)不会统计此列为NULL值的行。\n\n4.【强制】使用ISNULL()来判断是否为NULL值。注意:NULL与任何值的直接比较都为NULL。\n\n> 说明:\n>\n> NULL<>NULL的返回结果是NULL,而不是false。\n>\n> NULL=NULL的返回结果是NULL,而不是true。\n>\n> \\* NULL<>1的返回结果是NULL,而不是true。\n>\n\n5.【推荐】在代码中写分页查询逻辑时,若count为0应直接返回,避免执行后面的分页语句。\n\n6.【推荐】不要使用存储过程,存储过程难以调试和扩展,更没有移植性。\n\n \n\n## 4其他\n\n1.【强制】不要使用BLOB相关类型存储大文件或者大照片。说明：文件应使用文件系统存储，数据库存文件的URI\n\n2.【推荐】把计算尽量放到业务层(代码层)而不是数据库层，可以节省数据库服务的CPU资源，还可以根据场景在业务层进行缓存等优化，减少数据库压力。","slug":"Java规范","published":1,"updated":"2019-01-08T07:16:34.023Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjs17mi3l0040pwgtn46z0cyo","content":"<h1 id=\"介绍\"><a href=\"#介绍\" class=\"headerlink\" title=\"介绍\"></a>介绍</h1><h2 id=\"1-目的\"><a href=\"#1-目的\" class=\"headerlink\" title=\"1 目的\"></a>1 目的</h2><p>编码规范对于程序员而言尤为首要，有以下几个原因：</p>\n<blockquote>\n<ul>\n<li>一个软件的生命周期中，80％的花费在于维护。</li>\n<li>几乎没有任何一个软件，在其全部生命周期中，均由最初的开辟人员来维护。编码规范可以改良软件的可读性，可以让程序员尽快而彻底地懂得新的代码。</li>\n</ul>\n</blockquote>\n<p>最佳实践主要是包括编码习惯、禁忌等，能有效避免常见问题，提高代码质量。</p>\n<h2 id=\"2-适用范围\"><a href=\"#2-适用范围\" class=\"headerlink\" title=\"2 适用范围\"></a>2 适用范围</h2><p>本规范适用于Java开发人员。</p>\n<h2 id=\"3-术语\"><a href=\"#3-术语\" class=\"headerlink\" title=\"3 术语\"></a>3 术语</h2><p>强制：编程时强制必须遵守的原则。</p>\n<p>推荐：编程时必须加以考虑的习惯、写法等。参考：编程时无法用代码量化的原则或描述。说明：对此规范或建议进行必要的解释。</p>\n<p>正例、反例：对此规范或建议从正、反两个方面给出例子。</p>\n<h2 id=\"4-总体原则\"><a href=\"#4-总体原则\" class=\"headerlink\" title=\"4 总体原则\"></a>4 总体原则</h2><p>简单、易读、易实施执行</p>\n<h1 id=\"命名规范\"><a href=\"#命名规范\" class=\"headerlink\" title=\"命名规范\"></a>命名规范</h1><h2 id=\"1-基本原则\"><a href=\"#1-基本原则\" class=\"headerlink\" title=\"1 基本原则\"></a>1 基本原则</h2><p>命名力求做到<strong>统一、达意、简洁</strong>。</p>\n<ul>\n<li>统一</li>\n</ul>\n<blockquote>\n<p>统一即对于同一个概念，在程序中用同一种表示方法，比如对于供应商，既可以用supplier，也可以用provider，但是我们只能选定一个使用，至少在一个Java项目中保持统一。</p>\n<p>说明:如果对同一概念有不同的表示方法，会使代码混乱难以理解。即使不能取得好的名称，但是只要统一，阅读起来也不会太困难，因为阅读者只要理解一次。</p>\n</blockquote>\n<ul>\n<li>达意</li>\n</ul>\n<blockquote>\n<p>达意是指，标识符能准确的表达出它所代表的意义，比如：newSupplier,OrderPaymentGatewayService等；而supplier1,service2，idtts等则不是好的命名方式。</p>\n<p>说明:准确有两成含义，一是正确，二是丰富。如果给一个代表供应商的变量起名是order，显然没有正确表达。同样的，supplier1远没有targetSupplier意义丰富。</p>\n</blockquote>\n<ul>\n<li>简洁</li>\n</ul>\n<blockquote>\n<p>简 洁 是 指 ， 在 统 一 和 达 意 的 前 提 下 ， 用 尽 量 少 的 标 识 符 。 如 果 不 能 达 意 ， 宁 愿 不 要 简 洁 。 比 如 ： theOrderNameOfTheTargetSupplierWhichIsTransfered太长， transferedTargetSupplierOrderName则较好，但是transTgtSplOrdNm就不好了。注意：杜绝完全不规范的缩写,避免望文不知义。</p>\n<p>反例: AbstractClass”缩写”命名成AbsClass;condition”缩写”命名成condi,此类随意缩写严重降低了代码的可阅读性。</p>\n</blockquote>\n<h2 id=\"2-通用命名规范\"><a href=\"#2-通用命名规范\" class=\"headerlink\" title=\"2 通用命名规范\"></a>2 通用命名规范</h2><p>【强制】代码中所有命名必须以英文开头，名称只能由英文字母、数字、下划线、”-“符号组成。严禁使用拼音与英文混合的方式,更不允许直接使用中文的方式。如下表：</p>\n<p>说明:正确的英文拼写和语法可以让阅读者易于理解,避免歧义。注意,即使纯拼音命名方式也要尽量避免采用。</p>\n<table>\n<thead>\n<tr>\n<th>类型</th>\n<th>规范</th>\n<th>示例</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>项目名</td>\n<td>工程名或模块名全部小写，多个英文单词以”- “连接。应用名与模块名，采用英文单词，不建议使用3个以上的单词，禁止使用特殊字符与数字</td>\n<td>lx-web-vaclient lx-dubbo-user</td>\n</tr>\n<tr>\n<td>文件</td>\n<td>跟类名保持一致</td>\n<td>PayController.java</td>\n</tr>\n<tr>\n<td>包</td>\n<td>包名只允许使用小写字母和数字，并且单词之间点分隔符连接（不允许使用下划线）</td>\n<td>com.iflytek.cbg.lx. web.user.controller</td>\n</tr>\n<tr>\n<td>类 接口</td>\n<td>类名、接口名使用UpperCamelCase风格,必须遵从驼峰形式，类名如果有复数含义,可以使用复数形式。另类名通常使用名词或名词短语</td>\n<td>PayController UserService</td>\n</tr>\n<tr>\n<td>方 法 名 参 数 名 成员变量局部变量</td>\n<td>方法名、参数名、成员变量、局部变量都统一使用lowerCamelCase 风格,必须遵从驼峰形式。另方法名通常使用动词、动词短语、形容词 在单测方法中可以含有下划线，通常用来指定特定场景：test&lt;测试方法名&gt;_&lt;场景&gt;，比如：testPop_emptyStack。对于测试方法的命名没有强制性要求，也可以采用其他的命名方式</td>\n<td>getScore userId</td>\n</tr>\n<tr>\n<td>常量</td>\n<td>常量命名全部大写,单词间用下划线隔开,力求语义表达完整清楚,不要嫌名字长</td>\n<td>MAX_PAY_TIMEOUT</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"3-类命名\"><a href=\"#3-类命名\" class=\"headerlink\" title=\"3 类命名\"></a>3 类命名</h2><p>类名往往用不同的前缀或后缀表达额外的意思。如下表：</p>\n<table>\n<thead>\n<tr>\n<th>前缀/后缀</th>\n<th>意义</th>\n<th>要求</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>xxxController</td>\n<td>直接处理页面请求、管理页面逻辑类、Http请求处理类</td>\n<td>【强制】</td>\n</tr>\n<tr>\n<td>xxxService</td>\n<td>表明这个类是个服务类，里面包含了给其他类提同业务服务的方法</td>\n<td>【强制】</td>\n</tr>\n<tr>\n<td>xxxDao</td>\n<td>这个类封装了数据访问方法</td>\n<td>【强制】</td>\n</tr>\n<tr>\n<td>xxxEntity<br>xxxDTO<br>xxxVO<br>xxxReq<br>xxxResp<br></td>\n<td>不同用处的POJO类，VO，DTO中不要出现@Entity注解数据传输对象：xxxDTO，xxx 为业务领域相关的名称展示对象：xxxVO，xxx 一般为网页名称</td>\n<td>【推荐】</td>\n</tr>\n<tr>\n<td>xxxEnum</td>\n<td>枚举类</td>\n<td>【强制】</td>\n</tr>\n<tr>\n<td>Ixxx</td>\n<td>这个类是一个接口</td>\n<td>【强制】</td>\n</tr>\n<tr>\n<td>xxxImpl</td>\n<td>这个类是一个实现类，而不是接口</td>\n<td>【强制】</td>\n</tr>\n<tr>\n<td>Abstractxxx</td>\n<td>抽象类</td>\n<td>【强制】</td>\n</tr>\n<tr>\n<td>xxxBase</td>\n<td>其他类的基类</td>\n<td>【推荐】</td>\n</tr>\n<tr>\n<td>xxxFactory<br>xxxProxy<br>xxxAdapter<br>xxxObserver</td>\n<td>如果使用到了设计模式,建议通过后缀在类名中体现出具体模式</td>\n<td>【推荐】</td>\n</tr>\n<tr>\n<td>xxxWrapper</td>\n<td>这是一个包装类，为了给某个类提供没有的能力</td>\n<td>【推荐】</td>\n</tr>\n<tr>\n<td>xxxListener<br>xxxEvent</td>\n<td>响应某种事件相关的类</td>\n<td>【推荐】</td>\n</tr>\n<tr>\n<td>xxxJob</td>\n<td>某种按时间运行的任务</td>\n<td>【推荐】</td>\n</tr>\n<tr>\n<td>xxxUtils</td>\n<td>工具类</td>\n<td>【推荐】</td>\n</tr>\n<tr>\n<td>xxxException</td>\n<td>异常类</td>\n<td>【强制】</td>\n</tr>\n<tr>\n<td>xxxTest</td>\n<td>测试类</td>\n<td>【强制】</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"4-方法命名\"><a href=\"#4-方法命名\" class=\"headerlink\" title=\"4 方法命名\"></a>4 方法命名</h2><p>方法名往往用不同的前缀表达特定的含义，如下表：</p>\n<table>\n<thead>\n<tr>\n<th>前缀/后缀</th>\n<th>意义</th>\n<th>要求</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>getxxx()</td>\n<td>获取单个对象</td>\n<td>【推荐】</td>\n</tr>\n<tr>\n<td>listxxx()</td>\n<td>获取多个对象</td>\n<td>【推荐】</td>\n</tr>\n<tr>\n<td>countxxx()</td>\n<td>计数，获取统计值</td>\n<td>【推荐】</td>\n</tr>\n<tr>\n<td>savexxx()</td>\n<td>插入</td>\n<td>【推荐】</td>\n</tr>\n<tr>\n<td>removexxx()</td>\n<td>删除</td>\n<td>【推荐】</td>\n</tr>\n<tr>\n<td>updatexxx()</td>\n<td>更新</td>\n<td>【推荐】</td>\n</tr>\n<tr>\n<td>findxxx()<br>searchxxx()</td>\n<td>搜索、查询</td>\n<td>【推荐】</td>\n</tr>\n<tr>\n<td>doxxx()<br>executexxx()</td>\n<td>执行某个过程或者流程</td>\n<td>【推荐】</td>\n</tr>\n<tr>\n<td>initxxx()</td>\n<td>初始化</td>\n<td>【推荐】</td>\n</tr>\n<tr>\n<td>checkxxx()<br>validatexxx()</td>\n<td>校验合法性</td>\n<td>【推荐】</td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"排版规范\"><a href=\"#排版规范\" class=\"headerlink\" title=\"排版规范\"></a>排版规范</h1><h2 id=\"1-源文件结构\"><a href=\"#1-源文件结构\" class=\"headerlink\" title=\"1 源文件结构\"></a>1 源文件结构</h2><p>1.【强制】所有源文件必须使用utf-8编码。</p>\n<p>2.【强制】所有未使用的import语句应该被删除。</p>\n<p>3.【强制】禁止使用通配符import。</p>\n<p>说明：Eclipse中可以通过快捷键将不需要的引入包去掉。快捷键：Ctrl + Shift + O。 IntelliJ IDEA自动导入包去除星号：</p>\n<p>打开File&gt; Settings&gt;Editor&gt;Code Style&gt;Java&gt;Scheme Default&gt;Imports </p>\n<ol>\n<li>将Class count to use import with “<em>“改为99（导入同一个包的类超过这个数值自动变为 </em> ） </li>\n<li>将Names count to use static import with “*”改为99（同上，但这是静态导入的） </li>\n<li>将Package to Use import with “<em>“删掉默认的这两个包（不管使用多少个类，只要在这个列表里都会变为 </em> ）</li>\n</ol>\n<p>自动删除没有用到的导入包：</p>\n<p>打开File&gt; Settings&gt;Editor&gt; General &gt; Auto Import</p>\n<p>勾上 <img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsED41.tmp.jpg\" alt=\"img\">                                               </p>\n<p>4.【推荐】同名的构造函数或方法之间禁止插入其他成员，例如重载的方法必须放在一起；不建议把新添加的方法一律放在最后，而是应该插入到合适的地方。</p>\n<p>说明:当一个类有多个构造方法,或者多个同名方法，或者类似方法,这些方法应该按顺序放置在一起,便于阅读。</p>\n<p>5.【推荐】类内定义顺序依次是:常量&gt;公共变量或保护变量&gt;私有变量&gt;构造方法&gt;静态公共方法&gt;静态私有方法&gt;公有方法或保护方法&gt;getter/setter方法&gt;main方法。</p>\n<p>引入lombok插件，IDEA中安装lombok插件使POJO类代码更加简洁，省去写getter/setter，构造函数的方法。具体参考：<a href=\"https://yq.aliyun.com/articles/59972\" target=\"_blank\" rel=\"noopener\">https://yq.aliyun.com/articles/59972</a>, <a href=\"https://www.projectlombok.org/\" target=\"_blank\" rel=\"noopener\">https://www.projectlombok.org/</a></p>\n<h2 id=\"2-代码格式\"><a href=\"#2-代码格式\" class=\"headerlink\" title=\"2 代码格式\"></a>2 代码格式</h2><p>【强制】代码格式规范主要是缩进、空格、换行、空行的运用。具体规范如下表：</p>\n<p>说明:合理的运用缩进、空格、换行、空行，对代码的结构、可读性有非常大影响；另外，可以直接使用IDE自带的格式化快捷键进行全局或局部代码格式化。</p>\n<table>\n<thead>\n<tr>\n<th>分类</th>\n<th>规范解释</th>\n<th>其他描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>行长度</td>\n<td>单行字符数限制不超过120个,超出需要换行， 换行时遵循换行原则；</td>\n<td>设置IDE单行字符数配置</td>\n</tr>\n<tr>\n<td>缩进</td>\n<td>1. 缩进采用4个空格,禁止使用tab字符；<br>2. 方法体的开始、类的定义、以及if、 for、do、while、switch、case语句中的代码都要采用缩进方式；<br>3. 由于列宽限制需要缩进的情况遵循换行原则；</td>\n<td>设置IDE Tab键相关配置</td>\n</tr>\n<tr>\n<td>空格</td>\n<td>1. 左小括号和字符之间不出现空格;同样,右小括号和字符之间也不出现空格；2. if/for/while/switch/do等保留字与括号之间都必须加空格；<br>3. 任何二目、三目运算符的左右两边都需要加一个空格；一元操作符如”!”、” ~”、” ++”、” –”等前后不加空格；<br>4. 方法参数在定义和传入时,多个参数逗号后边必须加空格；5. 强制转型后必须跟一个空格;</td>\n<td>在if、else、for、do和while语句中，即使没有语句或者只有一行，也不得省略花括号。</td>\n</tr>\n<tr>\n<td>换行</td>\n<td>1、每行最多只能写一条语句，每条语句之后都要换行。 <br>2、单行字符数超过120个限制需换行： 第二行相对第一行缩进,从第三行开始,不再继续缩进；运算符与下文一起换行；方法调用的点符号与下文一起换行；在多个参数超长,在逗号后换行；在括号前不要换行；<br>3、大括号：如果是大括号内为空,则简洁地写成{}即可,不需要换行;如果是非空代码块则:左大括号前不换行；左大括号后换行； 右大括号前换行；右大括号后还有else等代码则不换行;表示终止的右大括号后必须换行；</td>\n<td></td>\n</tr>\n<tr>\n<td>空行</td>\n<td>空行可以表达代码在语义逻辑上的分割，注释的作用范围，等等。将类似操作，或一组操作放在一起不用空行隔开，而用空行隔开不同组的代码。例如： 1、在类的不同的成员间增加空行，包括：成员变量、构造函数、方法、内部类、静态初始化块、实例初始化块等； 2、方法体内，按需增加空行，以便从逻辑上对语句进行分组；执行语句组、变量的定义语句组、不同的业务逻辑之间或者不同的语义之间插入一个空行。相同业务逻辑和语义之间不需要插入空行； 3、注释与其上面的代码用空行隔开；</td>\n<td>说明:超过十行的代码如果还不用空行分割， 就会增加阅读困难。另外，没有必要插入多个空行进行隔开。</td>\n</tr>\n</tbody>\n</table>\n<p>正例:</p>\n<p><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsED99.tmp.png\" alt=\"img\"> </p>\n<h1 id=\"注释\"><a href=\"#注释\" class=\"headerlink\" title=\"注释\"></a>注释</h1><h2 id=\"1-基本原则-1\"><a href=\"#1-基本原则-1\" class=\"headerlink\" title=\"1 基本原则\"></a>1 基本原则</h2><ul>\n<li>注释力求精简准确、表达到位。</li>\n</ul>\n<blockquote>\n<ol>\n<li>能够准确反应设计思想和代码逻辑;</li>\n<li>能够描述业务含义,使别的程序员能够迅速了解到代码背后的信息。好的命名、代码结构是自解释的,往往不需要或者只需要很少注释，就可以让人读懂；相反，不能正确表达代码意义的注释，只会损害代码的可读性。</li>\n</ol>\n</blockquote>\n<ul>\n<li>注释宜少而精，不宜多而滥，更不能误导，过多的注释会成为后期维护的负担。</li>\n</ul>\n<blockquote>\n<p>防止过多过滥的注释，没必要的重复注释，或对显而易见的代码添加注释。</p>\n</blockquote>\n<ul>\n<li><p>代码混乱，再多的注释都不能弥补，所以，应当先在代码本身下功夫。</p>\n</li>\n<li><p>注释要和代码同步。代码修改的同时,注释也要进行相应的修改,尤其是参数、返回值、异常、核心逻辑等的修改。</p>\n</li>\n</ul>\n<blockquote>\n<p>说明:代码与注释更新不同步,就像路网与导航软件更新不同步一样,如果导航软件严重滞后,就失去了导航的意义。</p>\n</blockquote>\n<ul>\n<li>注释不是用来管理代码版本的，如果有代码不要了，直接删除，svn会有记录的，不要注释掉，否则以后没人知道那段注释掉的代码该不该删除。</li>\n</ul>\n<h2 id=\"2-Javadoc说明\"><a href=\"#2-Javadoc说明\" class=\"headerlink\" title=\"2 Javadoc说明\"></a>2 Javadoc说明</h2><p>Java程序有两类注释：实现注释和文档注释。</p>\n<p>实现注释是那些在C++中见过的，应用/…/和//界定的注释。文档注释是Java独有的（即Javadoc），由/*…/界定,文档注释可以经由Javadoc工具转换成HTML文件。 Javadoc注释是给类的使用者来看的，主要介绍是什么功能，什么含义，怎么用等信息。凡是类的使用者需要知道，都要用Javadoc来写。Javadoc注释只负责描述类(class)、接口(interface)、方法(method)、构造器(constructor)、成员字段(field)。相应地，文档注释必须写在类、接口、方法、构造器、成员字段前面，而写在其他位置，比如函数内部，是无效的文档注释。</p>\n<p>非Javadoc的注释往往是给代码的维护者看的，用以注释代码或者实现细节，着重告述读者功能以及逻辑，特殊或者复杂的逻辑可以注释说明为什么这样写，如何修改，注意什么问题等。 Javadoc说明可参考文档：<a href=\"http://docs.oracle.com/javase/8/docs/technotes/tools/windows/javadoc.html\" target=\"_blank\" rel=\"noopener\">http://docs.oracle.com/javase/8/docs/technotes/tools/windows/javadoc.html</a> <a href=\"http://blog.csdn.net/garfielder007/article/details/54959597\" target=\"_blank\" rel=\"noopener\">http://blog.csdn.net/garfielder007/article/details/54959597</a></p>\n<p><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEDBF.tmp.png\" alt=\"img\">正例:</p>\n<h2 id=\"3-Javadoc规范\"><a href=\"#3-Javadoc规范\" class=\"headerlink\" title=\"3 Javadoc规范\"></a>3 Javadoc规范</h2><p>下面规范要求不包括符合”注释-基本原则”中代码能自解释的例外情况。</p>\n<ol>\n<li><p>【强制】所有的类都必须添加类功能描述、创建者和创建日期。</p>\n</li>\n<li><p>【推荐】类公共属性、类公共方法需要增加Javadoc注释,即使用/*内容/格式,不得使用//xxx方式。</p>\n</li>\n<li><p>【强制】所有对外暴露的服务(RPC..)中类、方法、输入参数、输出参数必须添加Javadoc注释。</p>\n</li>\n<li><p>【强制】项目组内通用类库或者开发的可复用的类库中对使用者暴露的类、方法、属性必须增加Javadoc注释。</p>\n</li>\n<li><p>【强制】所有抽象类和接口必须要用Javadoc注释；另外，子类中override的方法和接口的实现类对应的方法实现大部分情况下不需要添加注释。</p>\n</li>\n<li><p>【强制】对已经不推荐使用的类和方法需要注明@Deprecated，并说明替代的类或者方法。</p>\n</li>\n<li><p>【推荐】枚举类和常量类字段尽量要有注释, 说明每个字段的含义。说明：字段命名能自解释的除外。</p>\n</li>\n<li><p>【推荐】特殊注释标记,请注明标记人与标记时间。注意及时处理这些标记,通过标记扫描,经常清理此类标记。线上故障有时候就是来源于这些标记处的代码。</p>\n<pre class=\"line-numbers language-Java\"><code class=\"language-Java\">待办事宜(TODO):(标记人,标记时间,[预计处理时间])\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n</li>\n</ol>\n<p>表示需要实现,但目前还未实现的功能。这实际上是一个 Javadoc 的标签,目前的 Javadoc还没有实现,但已经被广泛使用。只能应用于类,接口和方法(因为它是一个 Javadoc 标签)。</p>\n<pre class=\"line-numbers language-java\"><code class=\"language-java\">错误<span class=\"token punctuation\">,</span>不能工作<span class=\"token punctuation\">(</span>FIXME<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span><span class=\"token punctuation\">(</span>标记人<span class=\"token punctuation\">,</span>标记时间<span class=\"token punctuation\">,</span><span class=\"token punctuation\">[</span>预计处理时间<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>在注释中用 FIXME 标记某代码是错误的,而且不能工作,需要及时纠正的情况。</p>\n<p>9.【强制】注释的双斜线与注释内容之间有且仅有一个空格。 正例：// 注释内容，注意在<code>//</code>和<code>注释内容</code>之间有一个空格。</p>\n<h1 id=\"编码规范\"><a href=\"#编码规范\" class=\"headerlink\" title=\"编码规范\"></a>编码规范</h1><h2 id=\"1-声明、赋值等语句\"><a href=\"#1-声明、赋值等语句\" class=\"headerlink\" title=\"1 声明、赋值等语句\"></a>1 声明、赋值等语句</h2><ol>\n<li>【强制】一行只声明一个变量，不允许一行声明多个变量；在需要时声明变量，声明后尽快初始化，即初始化和被使用尽量放在一起。</li>\n<li>【强制】不允许把多个短语句写在一行中，即一行只写一条语句。</li>\n<li>【强制】避免在一个语句中执行多种操作，例如：给多个变量赋雷同的值，或赋值运算符与相等关系运算符混合使用，它很难读懂。</li>\n</ol>\n<p><span style=\"color: #ff0000\">反例:</span> </p>\n<pre class=\"line-numbers language-c\"><code class=\"language-c\">fooBar<span class=\"token punctuation\">.</span>fChar <span class=\"token operator\">=</span> barFoo<span class=\"token punctuation\">.</span>lchar <span class=\"token operator\">=</span> <span class=\"token string\">\"c\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">if</span> （c<span class=\"token operator\">++</span> <span class=\"token operator\">=</span> d<span class=\"token operator\">++</span>） <span class=\"token punctuation\">{</span>\n\n<span class=\"token comment\" spellcheck=\"true\">//TODO</span>\n\n<span class=\"token punctuation\">}</span>\n\nd <span class=\"token operator\">=</span> （a <span class=\"token operator\">=</span> b <span class=\"token operator\">+</span> c） <span class=\"token operator\">+</span> r<span class=\"token punctuation\">;</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<ol start=\"4\">\n<li>【强制】所有的相同类型的包装类对象之间值的比较,全部使用equals方法比较。另外equals方法容易抛空指针异常,应使用常量或确定有值的对象来调用equals。 说明:对于Integer var = ?在-128至127范围内的赋值,Integer对象是在IntegerCache.cache产生,会复用已有对象,这个区间内的Integer值可以直接使用==进行判断,但是这个区间之外的所有数据,都会在堆上产生,并不会复用已有对象,这是一个大坑。 正例: “test”.equals(object); 反例: object.equals(“test”); </li>\n<li>【强制】定义 DO/DTO/VO 等 POJO 类时，不要设定任何属性默认值。 反例：POJO 类的 gmtCreate 默认值为 new Date();但是这个属性在数据提取时并没有置入具体值，在更新其它字段时又附带更新了此字段，导致创建时间被修改成当前时间。 </li>\n<li>【强制】序列化类新增属性时，请不要修改 serialVersionUID 字段，避免反序列失败；如果完全不兼容升级，避免反序列化混乱，那么请修改 serialVersionUID 值。 说明：注意 serialVersionUID 不一致会抛出序列化运行时异常。 </li>\n<li>【强制】构造方法里面禁止加入任何业务逻辑，如果有初始化逻辑，请放在 init 方法中。</li>\n<li>【推荐】当一个类有多个构造方法，或者多个同名方法，这些方法应该按顺序放置在一起， 便于阅读。 </li>\n<li>【推荐】 类内方法定义顺序依次是：公有方法或保护方法 &gt; 私有方法 &gt; getter/setter 方法。 说明：公有方法是类的调用者和维护者最关心的方法，首屏展示最好；保护方法虽然只是子类关心，也可能是”模板设计模式”下的核心方法；而私有方法外部一般不需要特别关心，是一个 黑盒实现；因为承载的信息价值较低，所有Service 和 DAO 的 getter/setter 方法放在类体最后。</li>\n</ol>\n<h2 id=\"2-控制语句、程序结构\"><a href=\"#2-控制语句、程序结构\" class=\"headerlink\" title=\"2 控制语句、程序结构\"></a>2 控制语句、程序结构</h2><ol>\n<li>【强制】在一个switch块内,每个case要么通过break/return等来终止,要么注释说明程序将继续执行到哪一个case为止;在一个switch块内,都必须包含一个default语句并且放在最后,即使它什么代码也没有。</li>\n<li>【强制】在if/else/for/while/do语句中必须使用大括号，即使只有一行代码,避免使用单行的形式:if (condition) statements。</li>\n<li>【强制】不要在if语句中使用等号=进行赋值操作。</li>\n<li>【强制】不要在条件判断中执行其它复杂的语句,将复杂逻辑判断的结果赋值给一个有意义的布尔变量名,提高可读性。</li>\n</ol>\n<blockquote>\n<p>说明:很多if语句内的逻辑相当复杂,阅读者需要分析条件表达式的最终结果,才能明确什么样的条件执行什么样的语句,那么,如果阅读者分析逻辑表达式错误呢?</p>\n</blockquote>\n<p>正例:<br><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEDE2.tmp.png\" alt=\"img\"> </p>\n<p>反例:</p>\n<pre class=\"line-numbers language-java\"><code class=\"language-java\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">.</span><span class=\"token function\">open</span><span class=\"token punctuation\">(</span>fileName<span class=\"token punctuation\">,</span> <span class=\"token string\">\"w\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> null<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n\n<span class=\"token punctuation\">}</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>5.【推荐】代码嵌套层次不要超过3层。<br>说明:代码嵌套层次达3层以上时，一般人理解起来都会困难。减少嵌套的方法有很多：合并条件、利用return以省略后面的else、利用子方法(将嵌套的程序提取出来放到另外的方法里)等。</p>\n<p>6.【推荐】类超过2000行的程序难以阅读，应该尽量避免出现超过2000行的程序；</p>\n<p>7.【推荐】注意运算符的优先级，避免使用默认优先级。一般而言，在含有多种运算符的表达式中应用圆括号来明确表达式的操作顺序，是个好办法。</p>\n<blockquote>\n<p>说明：防止阅读程序时产生误解，防止因默认的优先级与设计思想不符而导致程序出错。</p>\n</blockquote>\n<p>8.【推荐】可以通过return语句减少嵌套层次: if (condition) {</p>\n<p>… return obj;</p>\n<p>}</p>\n<p>// 接着写 else 的业务逻辑代码;</p>\n<h2 id=\"3-常量\"><a href=\"#3-常量\" class=\"headerlink\" title=\"3 常量\"></a>3 常量</h2><p>1.【推荐】魔法值(未经定义的常量)尽量不要直接出现在代码中，代之以有名字的static final静态常量或者enum值。</p>\n<p>说明：魔法值使代码的可读性大大下降，而且，如果同样的数值多次出现时，到底这些数值是不是带有同样的含义呢，谁也说不清楚。另一方面， 如果本来应该使用相同数值的地方，一旦用错了，也很难发现，修改维护也不方便。因此，需要注意以下几点，极力避免使用魔法数值。</p>\n<p>反例:</p>\n<p>String key = “Id#taobao_” + tradeId; cache.put(key, value);</p>\n<p>2.【推荐】不要使用一个常量类维护所有常量,应该按常量功能进行归类分开维护。如:缓存相关的常量放在类:CacheConsts下;系统配置相关的常量放在类:ConfigConsts 下。</p>\n<p>说明:大而全的常量类,非得使用查找功能才能定位到修改的常量,不利于理解和维护。</p>\n<p>3.【推荐】常量的复用层次有五层:跨应用共享常量、应用内共享常量、子工程内共享常量、包内共享常量、类内共享常量。</p>\n<p>4.【推荐】如果变量值仅在一个范围内变化,且带有名称之外的延伸属性,定义为枚举类。下面正例中的数字就是延伸信息,表示星期几。正例:</p>\n<pre class=\"line-numbers language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">enum</span> WeekEnum<span class=\"token punctuation\">{</span>\n\n<span class=\"token function\">MONDAY</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">TUESDAY</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">WEDNESDAY</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">THURSDAY</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">FRIDAY</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">SATURDAY</span><span class=\"token punctuation\">(</span><span class=\"token number\">6</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">SUNDAY</span><span class=\"token punctuation\">(</span><span class=\"token number\">7</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>5.【推荐】避免使用不易理解的数字，用有意义的标识来替代。涉及物理状态或者含有物理意义的常量，不应直接使用数字，用有意义的静态变量来代替更好。</p>\n<p>反例：如下的程序可读性差。 </p>\n<pre class=\"line-numbers language-java\"><code class=\"language-java\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>state <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\nstate <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\" spellcheck=\"true\">// program code</span>\n\n<span class=\"token punctuation\">}</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>正例:</p>\n<pre class=\"line-numbers language-java\"><code class=\"language-java\"><span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span> TRUNK_IDLE <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span> TRUNK_BUSY <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span> TRUNK_UNKNOWN <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>state <span class=\"token operator\">==</span> TRUNK_IDLE<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\nstate <span class=\"token operator\">=</span> TRUNK_BUSY<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\" spellcheck=\"true\">// program code</span>\n\n<span class=\"token punctuation\">}</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h2 id=\"4-并发、线程、性能\"><a href=\"#4-并发、线程、性能\" class=\"headerlink\" title=\"4 并发、线程、性能\"></a>4 并发、线程、性能</h2><ol>\n<li>【强制】获取单例对象需要保证线程安全，其中的方法也要保证线程安全。说明：资源驱动类、工具类、单例工厂类都需要注意。</li>\n<li>【强制】创建线程或线程池时请指定有意义的线程名称，方便出错时回溯。正例：</li>\n</ol>\n<pre class=\"line-numbers language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TimerTaskThread</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Thread</span> <span class=\"token punctuation\">{</span> \n<span class=\"token keyword\">public</span> <span class=\"token function\">TimerTaskThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> \n<span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"TimerTaskThread\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n\n<span class=\"token punctuation\">}</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<ol start=\"3\">\n<li><p>【强制】线程资源必须通过线程池提供，不允许在应用中自行显式创建线程。 说明：使用线程池的好处是减少在创建和销毁线程上所花的时间以及系统资源的开销，解决资 源不足的问题。如果不使用线程池，有可能造成系统创建大量同类线程而导致消耗完内存或者 “过度切换”的问题。</p>\n</li>\n<li><p>【强制】线程池不允许使用 Executors 去创建，而是通过 ThreadPoolExecutor 的方式，这样 的处理方式让写的同学更加明确线程池的运行规则，规避资源耗尽的风险。</p>\n</li>\n</ol>\n<p>说明：Executors 返回的线程池对象的弊端如下：</p>\n<blockquote>\n<p>FixedThreadPool 和 SingleThreadPool:</p>\n</blockquote>\n<p>允许的请求队列长度为Integer.MAX_VALUE，可能会堆积大量的请求，从而导致 OOM。</p>\n<blockquote>\n<p>CachedThreadPool 和 ScheduledThreadPool:</p>\n</blockquote>\n<p>允许的创建线程数量为Integer.MAX_VALUE，可能会创建大量的线程，从而导致OOM。</p>\n<ol start=\"5\">\n<li>【强制】SimpleDateFormat是线程不安全的类,一般不要定义为static变量,如果定义为static,必须加锁,或者使用JodaTime。</li>\n<li>【强制】在使用正则表达式时,利用好其预编译功能,可以有效加快正则匹配速度。说明:不要在方法体内定义:Pattern pattern = Pattern.compile(规则);</li>\n<li>【推荐】避免Random实例被多线程使用,虽然共享该实例是线程安全的,但会因竞争同一seed导致的性能下降。说明:Random实例包括java.util.Random的实例或者Math.random()的方式。</li>\n<li>【推荐】注意Math.random()这个方法返回是double类型,注意取值的范围0≤x&lt;1(能够 取到零值,注意除零异常),如果想获取整数类型的随机数, 不要将x放大10的若干倍然后取整,直接使用Random对象的nextInt或者nextLong法。</li>\n<li>【强制】并发修改同一记录时，避免更新丢失，需要加锁。要么在应用层加锁，要么在缓存加 锁，要么在数据库层使用乐观锁，使用 version 作为更新依据。</li>\n</ol>\n<blockquote>\n<p>说明:如果每次访问冲突概率小于20%，推荐使用乐观锁，否则使用悲观锁。乐观锁的重试次 数不得小于3次。 </p>\n</blockquote>\n<p>10.【强制】多线程并行处理定时任务时，Timer 运行多个 TimeTask 时，只要其中之一没有捕获 抛出的异常，其它任务便会自动终止运行，使用ScheduledExecutorService 则没有这个问题。</p>\n<p>11.【推荐】循环体中的语句要考量性能,循环体是最容易发生性能问题的地方。以下操作尽量移至循环体外处理,如定义对象、变量、获取数据库连接,进行不必要的try-catch 操作(这个try-catch是否可以移至循环体外)。</p>\n<p>12.【强制】循环体内字符串的连接方式,使用StringBuilder的append方法进行扩展。</p>\n<p>说明:反编译出的字节码文件显示每次循环都会new出一个StringBuilder对象,然后进行append操作,最后通过toString方法返回String对象,造成内存资源浪费。</p>\n<p>反例:</p>\n<pre class=\"line-numbers language-java\"><code class=\"language-java\">String str <span class=\"token operator\">=</span> <span class=\"token string\">\"start\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">100</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> \n  str <span class=\"token operator\">=</span> str <span class=\"token operator\">+</span> <span class=\"token string\">\"hello\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>13.【推荐】任何数据结构的构造或初始化,都应指定大小,避免数据结构无限增长吃光内存。</p>\n<p>14.【推荐】<a href=\"http://www.cnblogs.com/DreamDrive/p/5422175.html\" target=\"_blank\" rel=\"noopener\">在明确的场景下,为集合指定初始容量</a>。</p>\n<p>说明:集合有默认大小，首先每次新增时都会判断是否达到临界点，且当长度不足时动态扩展严重影响性能。</p>\n<p>15.【强制】使用entrySet遍历Map类集合KV,而不是keySet方式进行遍历。</p>\n<p>说明:keySet其实是遍历了2次,一次是转为Iterator对象,另一次是从hashMap中取出key所对应的value。而entrySet只是遍历了一次就把key和value 都放到了 entry中,效率更高。</p>\n<p>\\16. 【推荐】高度注意 Map 类集合 K/V 能不能存储 null 值的情况，如下表格：</p>\n<table>\n<thead>\n<tr>\n<th>集合类</th>\n<th>Key</th>\n<th>Value</th>\n<th>Super</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Hashtable</td>\n<td>不允许为null</td>\n<td>不允许为null</td>\n<td>Dictionary</td>\n<td>线程安全</td>\n</tr>\n<tr>\n<td>ConcurrentHashMap</td>\n<td>不允许为 null</td>\n<td>不允许为 nul</td>\n<td>AbstractMap</td>\n<td>锁分段技术</td>\n</tr>\n<tr>\n<td>TreeMap</td>\n<td>不允许为 nul</td>\n<td>允许为 null</td>\n<td>AbstractMap</td>\n<td>线程不安全</td>\n</tr>\n<tr>\n<td>HashMap</td>\n<td>允许为 null</td>\n<td>允许为 null</td>\n<td>AbstractMap</td>\n<td>线程不安全</td>\n</tr>\n</tbody>\n</table>\n<p>反例： 由于 HashMap 的干扰，很多人认为 ConcurrentHashMap 是可以置入 null 值，而事实上， 存储 null 值时会抛出 NPE 异常。</p>\n<h2 id=\"5-日志\"><a href=\"#5-日志\" class=\"headerlink\" title=\"5 日志\"></a>5 日志</h2><p>1.【强制】不允许使用System.out.print，也不可直接使用日志系统(Log4j、Logback)中的API,而应依赖使用日志框架SLF4J中的API,使用门面模式的日志框架,有利于维护和各个类的日志处理方式统一和更换日志系统。</p>\n<p>说明：日志框架可以设定级别，可以控制输出到哪里，容易区分是在代码的什么地方打印的，而System.out.print则不行。而且System.out.print的速度很慢。所以，除非是有意的，否则都要用日志框架。至少在提交到版本库之前把System.out.print换成日志框架。</p>\n<p>正例：</p>\n<pre class=\"line-numbers language-java\"><code class=\"language-java\"><span class=\"token keyword\">import</span> org<span class=\"token punctuation\">.</span>slf4j<span class=\"token punctuation\">.</span>Logger<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> org<span class=\"token punctuation\">.</span>slf4j<span class=\"token punctuation\">.</span>LoggerFactory<span class=\"token punctuation\">;</span> <span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Demo</span> <span class=\"token punctuation\">{</span>\n\n<span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> Logger logger <span class=\"token operator\">=</span> LoggerFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getLogger</span><span class=\"token punctuation\">(</span>Abc<span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>2.【强制】避免重复打印日志,浪费磁盘空间,务必在log4j.xml或logback.xml中设置 additivity=false。正例:</p>\n<logger name=\"com.iflytek.lx.config\" additivity=\"false\">\n\n<p>3.【强制】生产环境禁止输出debug、trace和其他调试日志；相应的，生产环境一定要记录下错误日志和异常异常，利于现网故障或用户投诉时排查问题。</p>\n<p>说明：谨慎地根据需要配置日志级别。例如测试环境可以打开info日志，性能测试需要关闭debug和其他调试日志，保持与生存环境一致。日志的级别由高到低分别为：ERROR &gt;&gt; WARN &gt;&gt; INFO &gt;&gt; DEBUG &gt;&gt; TRACE。</p>\n<ul>\n<li>Error：用于记录影响系统正常运行的一切信息，包括：Throwable、Error、Exception、与其他系统通讯错误，例如：SQL执行异常、其他系统返回的错误信息；</li>\n</ul>\n<ul>\n<li>Warn：用于记录不影响系统正常运行，但需要注意需要及时解决，例如：某个信息；                                        Info：通常生产环境的最低级别，用于记录这种重要的提示信息，例如：各种通讯信息，关键的提示信息，以及这种需要在生产环境下提示的信息；</li>\n<li>Debug： 记录一些详细的数据，比如我们想知道一个方法的多个入参值，那么在生产环境中，一般不会打印出来，在开发阶段和调试阶段，建议使用debug进行记录查看。在生产环境中将不会出现此类信息（当然可能在某些特定情况下，通过特殊手段某一时间段打开用于生产环境调试）。</li>\n<li>Trace：用于代替System.out.println()和System.err.println()，供开发阶段调试用。</li>\n</ul>\n<p>4.【推荐】在生产环境中配置日志框架自动加载刷新，即不重启应用就可以调整日志的配置。例如在logback.xml的配置中开源加上：</p>\n<pre class=\"line-numbers language-xml\"><code class=\"language-xml\"><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>configuration</span> <span class=\"token attr-name\">scan</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">scanPeriod</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>60 seconds<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>configuration</span><span class=\"token punctuation\">></span></span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h2 id=\"6-异常\"><a href=\"#6-异常\" class=\"headerlink\" title=\"6 异常\"></a>6 异常</h2><p>1.【强制】不允许使用printStackTrace打印异常日志。</p>\n<p>2.【强制】记录异常日志时不要只保存exception.getMessage()，记录整个异常堆栈信息。</p>\n<p>3.【强制】捕获异常是为了处理它,不要捕获了却什么都不处理而抛弃之,如果不想处理它,请将该异常抛给它的调用者。另外自己抛出的异常必须要填写详细的描述信息，且必须保留原来的异常，便于问题定位，例如：throw new IOException(“Writing data error! Data: “ + data. toString(), e)。</p>\n<p>4.【强制】不能在finally块中使用return,finally块中的return返回后方法结束执行,不会再执行try块中的return语句。</p>\n<p>5.【强制】finally块必须对资源对象、流对象进行关闭，例如数据库操作、IO操作,且有异常也要进行try-catch，因为finally块中如果发生异常, 不会再执行try块中的return语句。</p>\n<p>6.【推荐】防止NullPointerException,IndexOutOfBoundsException是程序员的基本修养,代码中可以通过预先检查进行规避,而不应该通过catch来处理。</p>\n<p>正例:</p>\n<p>if (obj != null) {</p>\n<p>…</p>\n<p>}</p>\n<p>反例: try {</p>\n<p>obj.method();</p>\n<p>} catch (NullPointerException e) {</p>\n<p>…</p>\n<p>}</p>\n<h2 id=\"7-其他\"><a href=\"#7-其他\" class=\"headerlink\" title=\"7 其他\"></a>7 其他</h2><p>1.【强制】关于hashCode和equals的处理,遵循如下规则:</p>\n<p>** 只要重写equals,就必须重写 hashCode。</p>\n<p>** 因为Set存储的是不重复的对象,依据hashCode和equals进行判断,所以Set存储的对象必须重写这两个方法。</p>\n<p>** 如果自定义对象做为Map的键,那么必须重写hashCode和equals。</p>\n<p>说明:String重写了hashCode和equals方法,所以我们可以非常愉快地使用String 对象作为key来使用。2.【强制】所有的覆写方法,必须加@Override注解。</p>\n<p>3.【强制】不能使用过时的类或方法。       4.【推荐】慎用Object的clone方法来拷贝对象。</p>\n<p>说明:对象的clone方法默认是浅拷贝,若想实现深拷贝需要重写clone方法实现属性对象的拷贝。                                       5.【推荐】POJO类重写toString方法。使用 IDE 的中工具：source&gt; generate toString 时，如果继承了另一个 POJO 类，注意在前面加一下super.toString。</p>\n<p>说明：在方法执行抛出异常时，可以直接调用 POJO 的 toString()方法打印其属性值，便于排查问题。或者使用lombok插件，自动生成toString()方法。使用lomok可以防止在getter/setter加入业务逻辑。</p>\n<p>6.【强制】不要在foreach循环里进行集合元素的remove/add操作。remove 元素请使用 Iterator 方式，如果并发操作，需要对 Iterator 对象加锁。</p>\n<p>7.【推荐】使用索引访问用String的split方法得到的数组时,做边界检查,否则会有抛IndexOutOfBoundsException的风险。</p>\n<p>8.【强制】禁止在代码中显示调用System.gc()。</p>\n<p>9.【强制】避免通过一个类的对象引用访问此类的静态变量或静态方法,无谓增加编译器解析成本,直接用类名来访问即可。正例：</p>\n<p>Foo.aStaticMethod(); // good反例：</p>\n<p>Foo aFoo = …; aFoo.aStaticMethod();</p>\n<p>somethingThatYieldsAFoo().aStaticMethod();</p>\n<p>10.【推荐】类成员与方法访问控制从严，不是必须使用public属性的，请使用protected，不是必须使用protected,请使用private。</p>\n<p><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE18.tmp.png\" alt=\"img\"><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE28.tmp.png\" alt=\"img\">如果不允许外部直接通过new来创建对象,那么构造方法必须是private。</p>\n<p>** 工具类不允许有public或default构造方法。</p>\n<p>** 类非static成员变量并且与子类共享,必须是protected。</p>\n<p>** 类非static成员变量并且仅在本类使用,必须是private。</p>\n<p>** 类static成员变量如果仅在本类使用,必须是private。</p>\n<p>** 若是 static 成员变量,必须考虑是否为final。</p>\n<p>** 类成员方法只供类内部调用,必须是private。</p>\n<p><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE29.tmp.png\" alt=\"img\">类成员方法只对继承类公开,那么限制为protected。</p>\n<p>说明:良好的程序设计应该尽可能减小类与类之间耦合，所遵循的经验法则是：尽量限制成员函数的可见性。</p>\n<p>11.【强制】在一个项目组内开发环境、测试环境、生产环境使用统一版本的JDK。</p>\n<p>说明:不同版本的JDK编译出来的class不一样，可能存在冲突，不同版本的JDK也会带来莫名奇妙的问题且很难定位，所以一开始就要求必须统一。</p>\n<p>12.【推荐】避免出现重复的代码(Don’t Repeat Yourself),即DRY原则。</p>\n<p>说明:随意复制和粘贴代码,必然会导致代码的重复,在以后需要修改时,需要修改所有的副本,容易遗漏。必要时抽取共性方法,或者抽象公共类,甚至是共用模块。</p>\n<p>13.【推荐】在代码中使用”抛异常”还是”返回错误码”,对于公司外的 http/api 开放接口必须使用”错误码”;而应用内部推荐异常抛出;跨应用间RPC 调用优先考虑使用Result方式,封装isSuccess()方法、”错误码”、”错误简短信息”。</p>\n<p>说明:关于RPC方法返回方式使用Result方式的理由:</p>\n<p><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE3A.tmp.png\" alt=\"img\">使用抛异常返回方式,调用方如果没有捕获到就会产生运行时错误。</p>\n<p><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE3B.tmp.png\" alt=\"img\">如果不加栈信息,只是new自定义异常,加入自己的理解的error message,对于调用端解决问题的帮助不会太多。如果加了栈信息,在频繁调用出错的情况下,数据序列化和传输的性能损耗也是问题。</p>\n<p>14.【推荐】logback比log4j性能要好很多，但是logback和log4j互斥，只能使用其中之一。因此，使用logback需要排除掉log4j依赖所有相关jar 包依赖，且为了兼容一些二方库、三方库（可能使用了log4j），需要引入引入log4j-over-slf4j.jar; 15.【推荐】对于”明确停止使用的代码和配置”,如方法、变量、类、配置文件、动态配置属性等要坚决从程序中清理出去,避免造成过多垃圾。</p>\n<h1 id=\"系统工程\"><a href=\"#系统工程\" class=\"headerlink\" title=\"系统工程\"></a>系统工程</h1><h2 id=\"1-工程化\"><a href=\"#1-工程化\" class=\"headerlink\" title=\"1 工程化\"></a>1 工程化</h2><p>1.【推荐】针对业务形态，工程分为以下几种情况：</p>\n<p><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE3C.tmp.png\" alt=\"img\">Web工程</p>\n<p><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE4D.tmp.png\" alt=\"img\"><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE4E.tmp.png\" alt=\"img\">web-应用名，以”web-“前缀开头。Dubbo工程</p>\n<p><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE4F.tmp.png\" alt=\"img\"><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE5F.tmp.png\" alt=\"img\">service-应用名，以”service-“前缀开头。Interface工程</p>\n<p><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE60.tmp.png\" alt=\"img\"><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE71.tmp.png\" alt=\"img\">interface-应用名，以”interface-“前缀开头。工具或者任务</p>\n<p><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE72.tmp.png\" alt=\"img\"><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE73.tmp.png\" alt=\"img\">tool-应用名，以”tool-“前缀开头，或以”job-“前缀开头。Java公共Jar包</p>\n<p><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE84.tmp.png\" alt=\"img\">common-模块名，以”common-“前缀开头。</p>\n<p><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE85.tmp.jpg\" alt=\"img\">2.【推荐】J2SE项目工程结构</p>\n<p>说明：J2SE项目有两种情况：</p>\n<p>一个是小工具，可以独立运行，处理一些简单的业务，打包为zip包。</p>\n<p>另一个是公共开发包，打包为jar包。以API方式提供给其它应用程序，以专业专注的精神进行分包，例如：通信协议包，常用工具包，加密解密包等等。公共开发包可能无法独立运行，所有的服务API都需要进行单元测试，并要保证线程安全。</p>\n<h2 id=\"2-包管理、版本管理\"><a href=\"#2-包管理、版本管理\" class=\"headerlink\" title=\"2 包管理、版本管理\"></a>2 包管理、版本管理</h2><p>1.【推荐】Maven定义GAV遵从以下规则:</p>\n<p>* GroupID格式:com.{公司}.{部门}.业务线.[子业务线],最多4级。</p>\n<p>* 正例:com.iflytek.cbg.lx 或 com.iflytek.cgb.kuyin</p>\n<p><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE86.tmp.png\" alt=\"img\"><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE96.tmp.png\" alt=\"img\">ArtifactID格式:产品线名-模块名。语义不重复不遗漏,先到中央仓库去查证一下。正例:lx-web-user/lx-dubbo-user/lx-common</p>\n<p>* Version:详细规定参考下方。</p>\n<p>2.【推荐】二方库版本号命名方式:主版本号.次版本号.修订号</p>\n<p><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE97.tmp.png\" alt=\"img\"><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE98.tmp.png\" alt=\"img\">主版本号:当做了不兼容的API修改,或者增加了能改变产品方向的新功能。次版本号:当做了向下兼容的功能性新增(新增类、接口等)。</p>\n<p><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEEA9.tmp.png\" alt=\"img\">修订号:修复bug,没有修改方法签名的功能加强,保持API兼容性。</p>\n<p>说明:正式发布的类库必须先去中央仓库进行查证,使版本号有延续性,正式版本号不允许覆盖升级。如当前版本:1.3.3,那么下一个合理的版本号: 1.3.4或1.4.0或2.0.0</p>\n<p>3.【推荐】线上应用不要依赖SNAPSHOT版本(安全包除外)。</p>\n<p>说明:不依赖SNAPSHOT版本是保证应用发布的幂等性。另外,也可以加快编译时的打包构建。</p>\n<p>4.【推荐】上传代码至svn时，项目相关的配置文件（.settings、.classpath、.project）不要上传本地调试文件，仅上传src文件夹、pom.xml或bin文件夹。</p>\n<p>5.【推荐】Maven工程需要在POM配置仓库地址，避免在本地maven setting中配置，其他组员check out后无法下载或者需要从远程仓库下载；</p>\n<h2 id=\"3-安全性\"><a href=\"#3-安全性\" class=\"headerlink\" title=\"3 安全性\"></a>3 安全性</h2><p>【备注】公司已经有大量项目被恶意攻击历史，所以研发必须提高安全意识和相关技术、方法、手段。</p>\n<p>1.【强制】对外提供的Http Api，必须进行签名、加密。</p>\n<p>2.【强制】用户敏感数据禁止直接展示,必须对展示数据进行脱敏。接口对敏感数据也必须加密，例如：用户密码。显示成<em>**</em></p>\n<p>3.【强制】隶属于用户个人的页面或者功能必须进行权限控制校验。</p>\n<p>说明：防止没有做水平权限校验就可随意访问、修改、删除别人的数据，比如查看他人的私信内容、修改他人的订单。</p>\n<p>3.【参考】用户请求传入的任何参数必须做有效性验证。说明:忽略参数校验可能导致:</p>\n<p>page size过大导致内存溢出</p>\n<p>恶意order by导致数据库慢查询任意重定向</p>\n<p>SQL注入</p>\n<p>4.【参考】表单、AJAX请求必须执行CSRF安全过滤。</p>\n<p>说明:CSRF(Cross-site request forgery)跨站请求伪造是一类常见编程漏洞。对于存在CSRF漏洞的应用/网站,攻击者可以事先构造好 URL,只要受害者用户一访问,后台便在用户不知情情况下对数据库中用户参数进行相应修改。</p>\n<p>5.【参考】在使用平台资源,譬如短信、邮件、电话、下单、支付,必须实现正确的防重放限制,如数量限制、疲劳度控制、验证码校验,避免被滥刷、资损。</p>\n<p>说明:如注册时发送验证码到手机,如果没有限制次数和频率,那么可以利用此功能骚扰到其它用户,并造成短信平台资源浪费。</p>\n<p>6.【参考】活动类需求，尤其是中奖类活动，必须实现防刷策略。</p>\n<h2 id=\"4-系统、服务器\"><a href=\"#4-系统、服务器\" class=\"headerlink\" title=\"4 系统、服务器\"></a>4 系统、服务器</h2><p>1.【推荐】高并发服务器建议调小TCP协议的time_wait超时时间。</p>\n<p>说明:操作系统默认240秒后,才会关闭处于time_wait状态的连接,在高并发访问下,服务器端会因为处于time_wait的连接数太多,可能无法建立新的连接,所以需要在服务器上调小此等待值。</p>\n<p>正例:在 linux服务器上请通过变更/etc/sysctl.conf文件去修改该缺省值(秒): net.ipv4.tcp_fin_timeout = 30</p>\n<p>2.【推荐】调大服务器所支持的最大文件句柄数(File Descriptor,简写为fd)。</p>\n<p>说明:主流操作系统的设计是将TCP/UDP连接采用与文件一样的方式去管理,即一个连接对应于一个fd。主流的linux服务器默认所支持最大fd数量为1024,当并发连接数很大时很容易因为fd不足而出现”open too many files”错误,导致新的连接无法建立。建议将linux服务器所支持的最大句柄数调高数倍(与服务器的内存数量相关)。</p>\n<p>3.【推荐】给JVM设置-XX:+HeapDumpOnOutOfMemoryError 参数,让JVM碰到OOM场景时输出dump信息。</p>\n<p>说明:OOM的发生是有概率的,甚至有规律地相隔数月才出现一例,出现时的现场信息对查错 非常有价值。</p>\n<p>4.【推荐】当生产环境组件异常、无响应、假死时，务必使用jstack dump线程堆栈，使用jstat –gcutil查看下gc信息，方便后期定位、分析问题。</p>\n<h1 id=\"七、MySql数据库\"><a href=\"#七、MySql数据库\" class=\"headerlink\" title=\"七、MySql数据库\"></a>七、MySql数据库</h1><h2 id=\"1-建表\"><a href=\"#1-建表\" class=\"headerlink\" title=\"1 建表\"></a>1 建表</h2><p>1.【推荐】使用InnoDB存储引擎、UTF-8(utf8mb4)字符集。</p>\n<p>2.【强制】表要有主键。</p>\n<p>3.【推荐】若业务上非实时一致性要求，禁止使用外键，由程序保证最终一致性。说明:外键会导致表与表之间耦合，影响sql性能，高并发下有可能会导致死锁。</p>\n<p>4.【推荐】表名、字段名必须使用小写字母或数字,禁止出现数字开头,禁止两个下划线中间只出现数字。数据库字段名的修改代价很大,因为无法进行预发布,所以字段名称需要慎重考虑。</p>\n<p>正例:getter_admin,task_config,level3_name反例:GetterAdmin,taskConfig,level_3_name</p>\n<p>5.【推荐】表名最好不使用复数名词。</p>\n<p>说明:表名应该仅仅表示表里面的实体内容,不应该表示实体数量。6.【推荐】表的命名最好是加上”模块名称_表名”。</p>\n<p>正例:score_rule / score_user /score_log</p>\n<p>7.【强制】千万不要使用mysql中关键字命名，例如：desc, order等；</p>\n<p>8.【推荐】如果修改字段含义或对字段表示的状态追加时,需要及时更新字段注释。</p>\n<p>9.【强制】主键索引名为pk_字段名;唯一索引名为uk_字段名;普通索引名则为idx_字段名。说明:pk_即 primary key;uk_即unique key;idx_即index的简称。</p>\n<p>10.【强制】所有字段定义为Not Null。说明：</p>\n<p><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEEAA.tmp.png\" alt=\"img\"><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEEBA.tmp.png\" alt=\"img\"><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEEBB.tmp.png\" alt=\"img\"><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEEBC.tmp.png\" alt=\"img\">null列影响索引。                     MySql内部需要对null进行特殊处理,会影响性能null需要更多的存储空间 null查询必须使用is 或is not,不能使用=、in等</p>\n<p>11.【强制】禁止使用ENUM类型。</p>\n<p>说明：增加新的枚举值时，需要DDL操作。</p>\n<p>12.【推荐】小数类型为decimal,禁止使用float和double。</p>\n<p>说明:float和double在存储的时候,存在精度损失的问题,很可能在值的比较时,得到不 正确的结果。如果存储的数据范围超过decimal的范围,建议将数据拆成整数和小数分开存储。</p>\n<p>13.【推荐】如果存储的字符串长度几乎相等,使用char定长字符串类型。                                                         varchar是可变长字符串,不预先分配存储空间,长度不要超过5000,如果存储长度大于此值,定义字段类型为text,独立出来一张表,用主键来对应,避免影响其它字段索引效率。</p>\n<p>14.【推荐】字段允许适当冗余,以提高查询性能,但必须考虑数据一致。冗余字段应遵循:</p>\n<p><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEECD.tmp.png\" alt=\"img\">不是频繁修改的字段。</p>\n<p><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEECE.tmp.png\" alt=\"img\">不是varchar超长字段,更不能是text字段。</p>\n<p>正例:商品类目名称使用频率高,字段长度短,名称基本一成不变,可在相关联的表中冗余存储类目名称,避免关联查询。</p>\n<p>15.【参考】合适的字符存储长度,不但节约数据库表空间、节约索引存储,更重要的是提升检索速度。</p>\n<h2 id=\"2-索引\"><a href=\"#2-索引\" class=\"headerlink\" title=\"2 索引\"></a>2 索引</h2><p>说明：务必用explain确认SQL语句是否走了索引。</p>\n<p>1.【参考】创建索引时避免有如下极端误解:</p>\n<p><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEECF.tmp.png\" alt=\"img\">宁滥勿缺。误认为一个查询就需要建一个索引。</p>\n<p><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEEE0.tmp.png\" alt=\"img\">宁缺勿滥。误认为索引会消耗空间、严重拖慢更新和新增速度。</p>\n<p><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEEE1.tmp.png\" alt=\"img\">抵制惟一索引。误认为业务的惟一性一律需要在应用层通过”先查后插”方式解决。</p>\n<p>2.【强制】业务上具有唯一特性的字段,即使是多个字段的组合,也必须建成唯一索引。</p>\n<p>说明:不要以为唯一索引影响了insert速度,这个速度损耗可以忽略,但提高查找速度是明显的;另外,即使在应用层做了非常完善的校验控制,只要没有唯一索引,根据墨菲定律,必然有脏数据产生。</p>\n<p>3.【参考】建立组合索引，必须根据业务上的查询需求使用合理顺序。</p>\n<p>说明:联合索引左前缀原则：(a,b,c)只有查询条件为a|(a,b)|(a,b,c)才会走该组合索引，但跟条件顺序无关，例如：ba、bac、bca、cab都会走索引，而bc、ac不会走索引。</p>\n<p>4.【参考】负向查询(!=、not in、not exists)、前导模糊查询(like <img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEEE2.tmp.jpg\" alt=\"img\">xxx’)、在查询条件属性上进行函数计算、字段类型需强制转换都不会走索引。</p>\n<p>反例：</p>\n<p>select <em> from score where status!=2 select </em> from score where name like <img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEEF2.tmp.jpg\" alt=\"img\">XX’</p>\n<p>select <em> from score where YEAR(create_time) &lt;= ‘2017’ select </em> from user where phone=13800001234</p>\n<p>6.【推荐】数据区分度不大的字段不宜使用索引，效果不明显。</p>\n<p>说明：”状态”、”性别”这种区分度不大的属性，建立索引是没有什么意义的，不能有效过滤数据，性能与全表扫描类似。反例：select * from user whre sex=1</p>\n<p>7.【推荐】OR查询最好改为IN查询。</p>\n<p>说明：InnoDB引擎中OR查询不能命中索引，MyISAM能命中索引，但会耗费更多的CPU。</p>\n<p>8.【推荐】超过三个表不要使用join。需要join的字段,数据类型必须绝对一致;多表关联查询时,保证被关联的字段需要有索引。说明:即使双表join也要注意表索引、SQL性能。</p>\n<p>9.【推荐】如果有order by的场景,请注意利用索引的有序性。order by最后的字段是组合 索引的一部分,并且放在索引组合顺序的最后,避免出现file_sort的情况,影响查询性能。</p>\n<p>正例:where a=? and b=? order by c; 索引:a_b_c</p>\n<p>反例:索引中有范围查找,那么索引有序性无法利用,如:WHERE a&gt;10 ORDER BY b;索引a_b无法排序。10.建组合索引的时候,区分度最高的在最左边。</p>\n<p>正例:如果where a=? and b=? ,a列的几乎接近于唯一值,那么只需要单建 idx_a索引即可。</p>\n<p>说明:存在非等号和等号混合判断条件时,在建索引时,请把等号条件的列前置。如:where a&gt;? and b=?那么即使a的区分度更高,也必须把b放在索引的最前列。</p>\n<h2 id=\"3-SQL语句\"><a href=\"#3-SQL语句\" class=\"headerlink\" title=\"3 SQL语句\"></a>3 SQL语句</h2><p>1.【推荐】尽量不要使用select *。</p>\n<p>2.【推荐】禁止大表使用join，禁止大表使用子查询。</p>\n<p>3.【推荐】不要使用count(列名)或count(常量)来替代count,count(<em>)是SQL92定义的标准统计行数的语法,跟数据库无关,跟NULL和非NULL无关。说明:count(</em>)会统计值为NULL的行,而count(列名)不会统计此列为NULL值的行。</p>\n<p>4.【强制】使用ISNULL()来判断是否为NULL值。注意:NULL与任何值的直接比较都为NULL。</p>\n<blockquote>\n<p>说明:</p>\n<p>NULL&lt;&gt;NULL的返回结果是NULL,而不是false。</p>\n<p>NULL=NULL的返回结果是NULL,而不是true。</p>\n<p>* NULL&lt;&gt;1的返回结果是NULL,而不是true。</p>\n</blockquote>\n<p>5.【推荐】在代码中写分页查询逻辑时,若count为0应直接返回,避免执行后面的分页语句。</p>\n<p>6.【推荐】不要使用存储过程,存储过程难以调试和扩展,更没有移植性。</p>\n<h2 id=\"4其他\"><a href=\"#4其他\" class=\"headerlink\" title=\"4其他\"></a>4其他</h2><p>1.【强制】不要使用BLOB相关类型存储大文件或者大照片。说明：文件应使用文件系统存储，数据库存文件的URI</p>\n<p>2.【推荐】把计算尽量放到业务层(代码层)而不是数据库层，可以节省数据库服务的CPU资源，还可以根据场景在业务层进行缓存等优化，减少数据库压力。</p>\n</logger>","site":{"data":{}},"excerpt":"","more":"<h1 id=\"介绍\"><a href=\"#介绍\" class=\"headerlink\" title=\"介绍\"></a>介绍</h1><h2 id=\"1-目的\"><a href=\"#1-目的\" class=\"headerlink\" title=\"1 目的\"></a>1 目的</h2><p>编码规范对于程序员而言尤为首要，有以下几个原因：</p>\n<blockquote>\n<ul>\n<li>一个软件的生命周期中，80％的花费在于维护。</li>\n<li>几乎没有任何一个软件，在其全部生命周期中，均由最初的开辟人员来维护。编码规范可以改良软件的可读性，可以让程序员尽快而彻底地懂得新的代码。</li>\n</ul>\n</blockquote>\n<p>最佳实践主要是包括编码习惯、禁忌等，能有效避免常见问题，提高代码质量。</p>\n<h2 id=\"2-适用范围\"><a href=\"#2-适用范围\" class=\"headerlink\" title=\"2 适用范围\"></a>2 适用范围</h2><p>本规范适用于Java开发人员。</p>\n<h2 id=\"3-术语\"><a href=\"#3-术语\" class=\"headerlink\" title=\"3 术语\"></a>3 术语</h2><p>强制：编程时强制必须遵守的原则。</p>\n<p>推荐：编程时必须加以考虑的习惯、写法等。参考：编程时无法用代码量化的原则或描述。说明：对此规范或建议进行必要的解释。</p>\n<p>正例、反例：对此规范或建议从正、反两个方面给出例子。</p>\n<h2 id=\"4-总体原则\"><a href=\"#4-总体原则\" class=\"headerlink\" title=\"4 总体原则\"></a>4 总体原则</h2><p>简单、易读、易实施执行</p>\n<h1 id=\"命名规范\"><a href=\"#命名规范\" class=\"headerlink\" title=\"命名规范\"></a>命名规范</h1><h2 id=\"1-基本原则\"><a href=\"#1-基本原则\" class=\"headerlink\" title=\"1 基本原则\"></a>1 基本原则</h2><p>命名力求做到<strong>统一、达意、简洁</strong>。</p>\n<ul>\n<li>统一</li>\n</ul>\n<blockquote>\n<p>统一即对于同一个概念，在程序中用同一种表示方法，比如对于供应商，既可以用supplier，也可以用provider，但是我们只能选定一个使用，至少在一个Java项目中保持统一。</p>\n<p>说明:如果对同一概念有不同的表示方法，会使代码混乱难以理解。即使不能取得好的名称，但是只要统一，阅读起来也不会太困难，因为阅读者只要理解一次。</p>\n</blockquote>\n<ul>\n<li>达意</li>\n</ul>\n<blockquote>\n<p>达意是指，标识符能准确的表达出它所代表的意义，比如：newSupplier,OrderPaymentGatewayService等；而supplier1,service2，idtts等则不是好的命名方式。</p>\n<p>说明:准确有两成含义，一是正确，二是丰富。如果给一个代表供应商的变量起名是order，显然没有正确表达。同样的，supplier1远没有targetSupplier意义丰富。</p>\n</blockquote>\n<ul>\n<li>简洁</li>\n</ul>\n<blockquote>\n<p>简 洁 是 指 ， 在 统 一 和 达 意 的 前 提 下 ， 用 尽 量 少 的 标 识 符 。 如 果 不 能 达 意 ， 宁 愿 不 要 简 洁 。 比 如 ： theOrderNameOfTheTargetSupplierWhichIsTransfered太长， transferedTargetSupplierOrderName则较好，但是transTgtSplOrdNm就不好了。注意：杜绝完全不规范的缩写,避免望文不知义。</p>\n<p>反例: AbstractClass”缩写”命名成AbsClass;condition”缩写”命名成condi,此类随意缩写严重降低了代码的可阅读性。</p>\n</blockquote>\n<h2 id=\"2-通用命名规范\"><a href=\"#2-通用命名规范\" class=\"headerlink\" title=\"2 通用命名规范\"></a>2 通用命名规范</h2><p>【强制】代码中所有命名必须以英文开头，名称只能由英文字母、数字、下划线、”-“符号组成。严禁使用拼音与英文混合的方式,更不允许直接使用中文的方式。如下表：</p>\n<p>说明:正确的英文拼写和语法可以让阅读者易于理解,避免歧义。注意,即使纯拼音命名方式也要尽量避免采用。</p>\n<table>\n<thead>\n<tr>\n<th>类型</th>\n<th>规范</th>\n<th>示例</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>项目名</td>\n<td>工程名或模块名全部小写，多个英文单词以”- “连接。应用名与模块名，采用英文单词，不建议使用3个以上的单词，禁止使用特殊字符与数字</td>\n<td>lx-web-vaclient lx-dubbo-user</td>\n</tr>\n<tr>\n<td>文件</td>\n<td>跟类名保持一致</td>\n<td>PayController.java</td>\n</tr>\n<tr>\n<td>包</td>\n<td>包名只允许使用小写字母和数字，并且单词之间点分隔符连接（不允许使用下划线）</td>\n<td>com.iflytek.cbg.lx. web.user.controller</td>\n</tr>\n<tr>\n<td>类 接口</td>\n<td>类名、接口名使用UpperCamelCase风格,必须遵从驼峰形式，类名如果有复数含义,可以使用复数形式。另类名通常使用名词或名词短语</td>\n<td>PayController UserService</td>\n</tr>\n<tr>\n<td>方 法 名 参 数 名 成员变量局部变量</td>\n<td>方法名、参数名、成员变量、局部变量都统一使用lowerCamelCase 风格,必须遵从驼峰形式。另方法名通常使用动词、动词短语、形容词 在单测方法中可以含有下划线，通常用来指定特定场景：test&lt;测试方法名&gt;_&lt;场景&gt;，比如：testPop_emptyStack。对于测试方法的命名没有强制性要求，也可以采用其他的命名方式</td>\n<td>getScore userId</td>\n</tr>\n<tr>\n<td>常量</td>\n<td>常量命名全部大写,单词间用下划线隔开,力求语义表达完整清楚,不要嫌名字长</td>\n<td>MAX_PAY_TIMEOUT</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"3-类命名\"><a href=\"#3-类命名\" class=\"headerlink\" title=\"3 类命名\"></a>3 类命名</h2><p>类名往往用不同的前缀或后缀表达额外的意思。如下表：</p>\n<table>\n<thead>\n<tr>\n<th>前缀/后缀</th>\n<th>意义</th>\n<th>要求</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>xxxController</td>\n<td>直接处理页面请求、管理页面逻辑类、Http请求处理类</td>\n<td>【强制】</td>\n</tr>\n<tr>\n<td>xxxService</td>\n<td>表明这个类是个服务类，里面包含了给其他类提同业务服务的方法</td>\n<td>【强制】</td>\n</tr>\n<tr>\n<td>xxxDao</td>\n<td>这个类封装了数据访问方法</td>\n<td>【强制】</td>\n</tr>\n<tr>\n<td>xxxEntity<br>xxxDTO<br>xxxVO<br>xxxReq<br>xxxResp<br></td>\n<td>不同用处的POJO类，VO，DTO中不要出现@Entity注解数据传输对象：xxxDTO，xxx 为业务领域相关的名称展示对象：xxxVO，xxx 一般为网页名称</td>\n<td>【推荐】</td>\n</tr>\n<tr>\n<td>xxxEnum</td>\n<td>枚举类</td>\n<td>【强制】</td>\n</tr>\n<tr>\n<td>Ixxx</td>\n<td>这个类是一个接口</td>\n<td>【强制】</td>\n</tr>\n<tr>\n<td>xxxImpl</td>\n<td>这个类是一个实现类，而不是接口</td>\n<td>【强制】</td>\n</tr>\n<tr>\n<td>Abstractxxx</td>\n<td>抽象类</td>\n<td>【强制】</td>\n</tr>\n<tr>\n<td>xxxBase</td>\n<td>其他类的基类</td>\n<td>【推荐】</td>\n</tr>\n<tr>\n<td>xxxFactory<br>xxxProxy<br>xxxAdapter<br>xxxObserver</td>\n<td>如果使用到了设计模式,建议通过后缀在类名中体现出具体模式</td>\n<td>【推荐】</td>\n</tr>\n<tr>\n<td>xxxWrapper</td>\n<td>这是一个包装类，为了给某个类提供没有的能力</td>\n<td>【推荐】</td>\n</tr>\n<tr>\n<td>xxxListener<br>xxxEvent</td>\n<td>响应某种事件相关的类</td>\n<td>【推荐】</td>\n</tr>\n<tr>\n<td>xxxJob</td>\n<td>某种按时间运行的任务</td>\n<td>【推荐】</td>\n</tr>\n<tr>\n<td>xxxUtils</td>\n<td>工具类</td>\n<td>【推荐】</td>\n</tr>\n<tr>\n<td>xxxException</td>\n<td>异常类</td>\n<td>【强制】</td>\n</tr>\n<tr>\n<td>xxxTest</td>\n<td>测试类</td>\n<td>【强制】</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"4-方法命名\"><a href=\"#4-方法命名\" class=\"headerlink\" title=\"4 方法命名\"></a>4 方法命名</h2><p>方法名往往用不同的前缀表达特定的含义，如下表：</p>\n<table>\n<thead>\n<tr>\n<th>前缀/后缀</th>\n<th>意义</th>\n<th>要求</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>getxxx()</td>\n<td>获取单个对象</td>\n<td>【推荐】</td>\n</tr>\n<tr>\n<td>listxxx()</td>\n<td>获取多个对象</td>\n<td>【推荐】</td>\n</tr>\n<tr>\n<td>countxxx()</td>\n<td>计数，获取统计值</td>\n<td>【推荐】</td>\n</tr>\n<tr>\n<td>savexxx()</td>\n<td>插入</td>\n<td>【推荐】</td>\n</tr>\n<tr>\n<td>removexxx()</td>\n<td>删除</td>\n<td>【推荐】</td>\n</tr>\n<tr>\n<td>updatexxx()</td>\n<td>更新</td>\n<td>【推荐】</td>\n</tr>\n<tr>\n<td>findxxx()<br>searchxxx()</td>\n<td>搜索、查询</td>\n<td>【推荐】</td>\n</tr>\n<tr>\n<td>doxxx()<br>executexxx()</td>\n<td>执行某个过程或者流程</td>\n<td>【推荐】</td>\n</tr>\n<tr>\n<td>initxxx()</td>\n<td>初始化</td>\n<td>【推荐】</td>\n</tr>\n<tr>\n<td>checkxxx()<br>validatexxx()</td>\n<td>校验合法性</td>\n<td>【推荐】</td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"排版规范\"><a href=\"#排版规范\" class=\"headerlink\" title=\"排版规范\"></a>排版规范</h1><h2 id=\"1-源文件结构\"><a href=\"#1-源文件结构\" class=\"headerlink\" title=\"1 源文件结构\"></a>1 源文件结构</h2><p>1.【强制】所有源文件必须使用utf-8编码。</p>\n<p>2.【强制】所有未使用的import语句应该被删除。</p>\n<p>3.【强制】禁止使用通配符import。</p>\n<p>说明：Eclipse中可以通过快捷键将不需要的引入包去掉。快捷键：Ctrl + Shift + O。 IntelliJ IDEA自动导入包去除星号：</p>\n<p>打开File&gt; Settings&gt;Editor&gt;Code Style&gt;Java&gt;Scheme Default&gt;Imports </p>\n<ol>\n<li>将Class count to use import with “<em>“改为99（导入同一个包的类超过这个数值自动变为 </em> ） </li>\n<li>将Names count to use static import with “*”改为99（同上，但这是静态导入的） </li>\n<li>将Package to Use import with “<em>“删掉默认的这两个包（不管使用多少个类，只要在这个列表里都会变为 </em> ）</li>\n</ol>\n<p>自动删除没有用到的导入包：</p>\n<p>打开File&gt; Settings&gt;Editor&gt; General &gt; Auto Import</p>\n<p>勾上 <img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsED41.tmp.jpg\" alt=\"img\">                                               </p>\n<p>4.【推荐】同名的构造函数或方法之间禁止插入其他成员，例如重载的方法必须放在一起；不建议把新添加的方法一律放在最后，而是应该插入到合适的地方。</p>\n<p>说明:当一个类有多个构造方法,或者多个同名方法，或者类似方法,这些方法应该按顺序放置在一起,便于阅读。</p>\n<p>5.【推荐】类内定义顺序依次是:常量&gt;公共变量或保护变量&gt;私有变量&gt;构造方法&gt;静态公共方法&gt;静态私有方法&gt;公有方法或保护方法&gt;getter/setter方法&gt;main方法。</p>\n<p>引入lombok插件，IDEA中安装lombok插件使POJO类代码更加简洁，省去写getter/setter，构造函数的方法。具体参考：<a href=\"https://yq.aliyun.com/articles/59972\" target=\"_blank\" rel=\"noopener\">https://yq.aliyun.com/articles/59972</a>, <a href=\"https://www.projectlombok.org/\" target=\"_blank\" rel=\"noopener\">https://www.projectlombok.org/</a></p>\n<h2 id=\"2-代码格式\"><a href=\"#2-代码格式\" class=\"headerlink\" title=\"2 代码格式\"></a>2 代码格式</h2><p>【强制】代码格式规范主要是缩进、空格、换行、空行的运用。具体规范如下表：</p>\n<p>说明:合理的运用缩进、空格、换行、空行，对代码的结构、可读性有非常大影响；另外，可以直接使用IDE自带的格式化快捷键进行全局或局部代码格式化。</p>\n<table>\n<thead>\n<tr>\n<th>分类</th>\n<th>规范解释</th>\n<th>其他描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>行长度</td>\n<td>单行字符数限制不超过120个,超出需要换行， 换行时遵循换行原则；</td>\n<td>设置IDE单行字符数配置</td>\n</tr>\n<tr>\n<td>缩进</td>\n<td>1. 缩进采用4个空格,禁止使用tab字符；<br>2. 方法体的开始、类的定义、以及if、 for、do、while、switch、case语句中的代码都要采用缩进方式；<br>3. 由于列宽限制需要缩进的情况遵循换行原则；</td>\n<td>设置IDE Tab键相关配置</td>\n</tr>\n<tr>\n<td>空格</td>\n<td>1. 左小括号和字符之间不出现空格;同样,右小括号和字符之间也不出现空格；2. if/for/while/switch/do等保留字与括号之间都必须加空格；<br>3. 任何二目、三目运算符的左右两边都需要加一个空格；一元操作符如”!”、” ~”、” ++”、” –”等前后不加空格；<br>4. 方法参数在定义和传入时,多个参数逗号后边必须加空格；5. 强制转型后必须跟一个空格;</td>\n<td>在if、else、for、do和while语句中，即使没有语句或者只有一行，也不得省略花括号。</td>\n</tr>\n<tr>\n<td>换行</td>\n<td>1、每行最多只能写一条语句，每条语句之后都要换行。 <br>2、单行字符数超过120个限制需换行： 第二行相对第一行缩进,从第三行开始,不再继续缩进；运算符与下文一起换行；方法调用的点符号与下文一起换行；在多个参数超长,在逗号后换行；在括号前不要换行；<br>3、大括号：如果是大括号内为空,则简洁地写成{}即可,不需要换行;如果是非空代码块则:左大括号前不换行；左大括号后换行； 右大括号前换行；右大括号后还有else等代码则不换行;表示终止的右大括号后必须换行；</td>\n<td></td>\n</tr>\n<tr>\n<td>空行</td>\n<td>空行可以表达代码在语义逻辑上的分割，注释的作用范围，等等。将类似操作，或一组操作放在一起不用空行隔开，而用空行隔开不同组的代码。例如： 1、在类的不同的成员间增加空行，包括：成员变量、构造函数、方法、内部类、静态初始化块、实例初始化块等； 2、方法体内，按需增加空行，以便从逻辑上对语句进行分组；执行语句组、变量的定义语句组、不同的业务逻辑之间或者不同的语义之间插入一个空行。相同业务逻辑和语义之间不需要插入空行； 3、注释与其上面的代码用空行隔开；</td>\n<td>说明:超过十行的代码如果还不用空行分割， 就会增加阅读困难。另外，没有必要插入多个空行进行隔开。</td>\n</tr>\n</tbody>\n</table>\n<p>正例:</p>\n<p><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsED99.tmp.png\" alt=\"img\"> </p>\n<h1 id=\"注释\"><a href=\"#注释\" class=\"headerlink\" title=\"注释\"></a>注释</h1><h2 id=\"1-基本原则-1\"><a href=\"#1-基本原则-1\" class=\"headerlink\" title=\"1 基本原则\"></a>1 基本原则</h2><ul>\n<li>注释力求精简准确、表达到位。</li>\n</ul>\n<blockquote>\n<ol>\n<li>能够准确反应设计思想和代码逻辑;</li>\n<li>能够描述业务含义,使别的程序员能够迅速了解到代码背后的信息。好的命名、代码结构是自解释的,往往不需要或者只需要很少注释，就可以让人读懂；相反，不能正确表达代码意义的注释，只会损害代码的可读性。</li>\n</ol>\n</blockquote>\n<ul>\n<li>注释宜少而精，不宜多而滥，更不能误导，过多的注释会成为后期维护的负担。</li>\n</ul>\n<blockquote>\n<p>防止过多过滥的注释，没必要的重复注释，或对显而易见的代码添加注释。</p>\n</blockquote>\n<ul>\n<li><p>代码混乱，再多的注释都不能弥补，所以，应当先在代码本身下功夫。</p>\n</li>\n<li><p>注释要和代码同步。代码修改的同时,注释也要进行相应的修改,尤其是参数、返回值、异常、核心逻辑等的修改。</p>\n</li>\n</ul>\n<blockquote>\n<p>说明:代码与注释更新不同步,就像路网与导航软件更新不同步一样,如果导航软件严重滞后,就失去了导航的意义。</p>\n</blockquote>\n<ul>\n<li>注释不是用来管理代码版本的，如果有代码不要了，直接删除，svn会有记录的，不要注释掉，否则以后没人知道那段注释掉的代码该不该删除。</li>\n</ul>\n<h2 id=\"2-Javadoc说明\"><a href=\"#2-Javadoc说明\" class=\"headerlink\" title=\"2 Javadoc说明\"></a>2 Javadoc说明</h2><p>Java程序有两类注释：实现注释和文档注释。</p>\n<p>实现注释是那些在C++中见过的，应用/…/和//界定的注释。文档注释是Java独有的（即Javadoc），由/*…/界定,文档注释可以经由Javadoc工具转换成HTML文件。 Javadoc注释是给类的使用者来看的，主要介绍是什么功能，什么含义，怎么用等信息。凡是类的使用者需要知道，都要用Javadoc来写。Javadoc注释只负责描述类(class)、接口(interface)、方法(method)、构造器(constructor)、成员字段(field)。相应地，文档注释必须写在类、接口、方法、构造器、成员字段前面，而写在其他位置，比如函数内部，是无效的文档注释。</p>\n<p>非Javadoc的注释往往是给代码的维护者看的，用以注释代码或者实现细节，着重告述读者功能以及逻辑，特殊或者复杂的逻辑可以注释说明为什么这样写，如何修改，注意什么问题等。 Javadoc说明可参考文档：<a href=\"http://docs.oracle.com/javase/8/docs/technotes/tools/windows/javadoc.html\" target=\"_blank\" rel=\"noopener\">http://docs.oracle.com/javase/8/docs/technotes/tools/windows/javadoc.html</a> <a href=\"http://blog.csdn.net/garfielder007/article/details/54959597\" target=\"_blank\" rel=\"noopener\">http://blog.csdn.net/garfielder007/article/details/54959597</a></p>\n<p><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEDBF.tmp.png\" alt=\"img\">正例:</p>\n<h2 id=\"3-Javadoc规范\"><a href=\"#3-Javadoc规范\" class=\"headerlink\" title=\"3 Javadoc规范\"></a>3 Javadoc规范</h2><p>下面规范要求不包括符合”注释-基本原则”中代码能自解释的例外情况。</p>\n<ol>\n<li><p>【强制】所有的类都必须添加类功能描述、创建者和创建日期。</p>\n</li>\n<li><p>【推荐】类公共属性、类公共方法需要增加Javadoc注释,即使用/*内容/格式,不得使用//xxx方式。</p>\n</li>\n<li><p>【强制】所有对外暴露的服务(RPC..)中类、方法、输入参数、输出参数必须添加Javadoc注释。</p>\n</li>\n<li><p>【强制】项目组内通用类库或者开发的可复用的类库中对使用者暴露的类、方法、属性必须增加Javadoc注释。</p>\n</li>\n<li><p>【强制】所有抽象类和接口必须要用Javadoc注释；另外，子类中override的方法和接口的实现类对应的方法实现大部分情况下不需要添加注释。</p>\n</li>\n<li><p>【强制】对已经不推荐使用的类和方法需要注明@Deprecated，并说明替代的类或者方法。</p>\n</li>\n<li><p>【推荐】枚举类和常量类字段尽量要有注释, 说明每个字段的含义。说明：字段命名能自解释的除外。</p>\n</li>\n<li><p>【推荐】特殊注释标记,请注明标记人与标记时间。注意及时处理这些标记,通过标记扫描,经常清理此类标记。线上故障有时候就是来源于这些标记处的代码。</p>\n<pre><code class=\"Java\">待办事宜(TODO):(标记人,标记时间,[预计处理时间])\n</code></pre>\n</li>\n</ol>\n<p>表示需要实现,但目前还未实现的功能。这实际上是一个 Javadoc 的标签,目前的 Javadoc还没有实现,但已经被广泛使用。只能应用于类,接口和方法(因为它是一个 Javadoc 标签)。</p>\n<pre><code class=\"java\">错误,不能工作(FIXME):(标记人,标记时间,[预计处理时间])\n</code></pre>\n<p>在注释中用 FIXME 标记某代码是错误的,而且不能工作,需要及时纠正的情况。</p>\n<p>9.【强制】注释的双斜线与注释内容之间有且仅有一个空格。 正例：// 注释内容，注意在<code>//</code>和<code>注释内容</code>之间有一个空格。</p>\n<h1 id=\"编码规范\"><a href=\"#编码规范\" class=\"headerlink\" title=\"编码规范\"></a>编码规范</h1><h2 id=\"1-声明、赋值等语句\"><a href=\"#1-声明、赋值等语句\" class=\"headerlink\" title=\"1 声明、赋值等语句\"></a>1 声明、赋值等语句</h2><ol>\n<li>【强制】一行只声明一个变量，不允许一行声明多个变量；在需要时声明变量，声明后尽快初始化，即初始化和被使用尽量放在一起。</li>\n<li>【强制】不允许把多个短语句写在一行中，即一行只写一条语句。</li>\n<li>【强制】避免在一个语句中执行多种操作，例如：给多个变量赋雷同的值，或赋值运算符与相等关系运算符混合使用，它很难读懂。</li>\n</ol>\n<p><span style=\"color: #ff0000\">反例:</span> </p>\n<pre><code class=\"c\">fooBar.fChar = barFoo.lchar = &quot;c&quot;;\n\nif （c++ = d++） {\n\n//TODO\n\n}\n\nd = （a = b + c） + r;\n</code></pre>\n<ol start=\"4\">\n<li>【强制】所有的相同类型的包装类对象之间值的比较,全部使用equals方法比较。另外equals方法容易抛空指针异常,应使用常量或确定有值的对象来调用equals。 说明:对于Integer var = ?在-128至127范围内的赋值,Integer对象是在IntegerCache.cache产生,会复用已有对象,这个区间内的Integer值可以直接使用==进行判断,但是这个区间之外的所有数据,都会在堆上产生,并不会复用已有对象,这是一个大坑。 正例: “test”.equals(object); 反例: object.equals(“test”); </li>\n<li>【强制】定义 DO/DTO/VO 等 POJO 类时，不要设定任何属性默认值。 反例：POJO 类的 gmtCreate 默认值为 new Date();但是这个属性在数据提取时并没有置入具体值，在更新其它字段时又附带更新了此字段，导致创建时间被修改成当前时间。 </li>\n<li>【强制】序列化类新增属性时，请不要修改 serialVersionUID 字段，避免反序列失败；如果完全不兼容升级，避免反序列化混乱，那么请修改 serialVersionUID 值。 说明：注意 serialVersionUID 不一致会抛出序列化运行时异常。 </li>\n<li>【强制】构造方法里面禁止加入任何业务逻辑，如果有初始化逻辑，请放在 init 方法中。</li>\n<li>【推荐】当一个类有多个构造方法，或者多个同名方法，这些方法应该按顺序放置在一起， 便于阅读。 </li>\n<li>【推荐】 类内方法定义顺序依次是：公有方法或保护方法 &gt; 私有方法 &gt; getter/setter 方法。 说明：公有方法是类的调用者和维护者最关心的方法，首屏展示最好；保护方法虽然只是子类关心，也可能是”模板设计模式”下的核心方法；而私有方法外部一般不需要特别关心，是一个 黑盒实现；因为承载的信息价值较低，所有Service 和 DAO 的 getter/setter 方法放在类体最后。</li>\n</ol>\n<h2 id=\"2-控制语句、程序结构\"><a href=\"#2-控制语句、程序结构\" class=\"headerlink\" title=\"2 控制语句、程序结构\"></a>2 控制语句、程序结构</h2><ol>\n<li>【强制】在一个switch块内,每个case要么通过break/return等来终止,要么注释说明程序将继续执行到哪一个case为止;在一个switch块内,都必须包含一个default语句并且放在最后,即使它什么代码也没有。</li>\n<li>【强制】在if/else/for/while/do语句中必须使用大括号，即使只有一行代码,避免使用单行的形式:if (condition) statements。</li>\n<li>【强制】不要在if语句中使用等号=进行赋值操作。</li>\n<li>【强制】不要在条件判断中执行其它复杂的语句,将复杂逻辑判断的结果赋值给一个有意义的布尔变量名,提高可读性。</li>\n</ol>\n<blockquote>\n<p>说明:很多if语句内的逻辑相当复杂,阅读者需要分析条件表达式的最终结果,才能明确什么样的条件执行什么样的语句,那么,如果阅读者分析逻辑表达式错误呢?</p>\n</blockquote>\n<p>正例:<br><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEDE2.tmp.png\" alt=\"img\"> </p>\n<p>反例:</p>\n<pre><code class=\"java\">if ((file.open(fileName, &quot;w&quot;) != null) &amp;&amp; (...) || (...)) {\n\n...\n\n}\n</code></pre>\n<p>5.【推荐】代码嵌套层次不要超过3层。<br>说明:代码嵌套层次达3层以上时，一般人理解起来都会困难。减少嵌套的方法有很多：合并条件、利用return以省略后面的else、利用子方法(将嵌套的程序提取出来放到另外的方法里)等。</p>\n<p>6.【推荐】类超过2000行的程序难以阅读，应该尽量避免出现超过2000行的程序；</p>\n<p>7.【推荐】注意运算符的优先级，避免使用默认优先级。一般而言，在含有多种运算符的表达式中应用圆括号来明确表达式的操作顺序，是个好办法。</p>\n<blockquote>\n<p>说明：防止阅读程序时产生误解，防止因默认的优先级与设计思想不符而导致程序出错。</p>\n</blockquote>\n<p>8.【推荐】可以通过return语句减少嵌套层次: if (condition) {</p>\n<p>… return obj;</p>\n<p>}</p>\n<p>// 接着写 else 的业务逻辑代码;</p>\n<h2 id=\"3-常量\"><a href=\"#3-常量\" class=\"headerlink\" title=\"3 常量\"></a>3 常量</h2><p>1.【推荐】魔法值(未经定义的常量)尽量不要直接出现在代码中，代之以有名字的static final静态常量或者enum值。</p>\n<p>说明：魔法值使代码的可读性大大下降，而且，如果同样的数值多次出现时，到底这些数值是不是带有同样的含义呢，谁也说不清楚。另一方面， 如果本来应该使用相同数值的地方，一旦用错了，也很难发现，修改维护也不方便。因此，需要注意以下几点，极力避免使用魔法数值。</p>\n<p>反例:</p>\n<p>String key = “Id#taobao_” + tradeId; cache.put(key, value);</p>\n<p>2.【推荐】不要使用一个常量类维护所有常量,应该按常量功能进行归类分开维护。如:缓存相关的常量放在类:CacheConsts下;系统配置相关的常量放在类:ConfigConsts 下。</p>\n<p>说明:大而全的常量类,非得使用查找功能才能定位到修改的常量,不利于理解和维护。</p>\n<p>3.【推荐】常量的复用层次有五层:跨应用共享常量、应用内共享常量、子工程内共享常量、包内共享常量、类内共享常量。</p>\n<p>4.【推荐】如果变量值仅在一个范围内变化,且带有名称之外的延伸属性,定义为枚举类。下面正例中的数字就是延伸信息,表示星期几。正例:</p>\n<pre><code class=\"java\">public enum WeekEnum{\n\nMONDAY(1), TUESDAY(2), WEDNESDAY(3), THURSDAY(4), FRIDAY(5), SATURDAY(6), SUNDAY(7);\n\n}\n</code></pre>\n<p>5.【推荐】避免使用不易理解的数字，用有意义的标识来替代。涉及物理状态或者含有物理意义的常量，不应直接使用数字，用有意义的静态变量来代替更好。</p>\n<p>反例：如下的程序可读性差。 </p>\n<pre><code class=\"java\">if (state == 0) {\n\nstate = 1;\n\n// program code\n\n}\n</code></pre>\n<p>正例:</p>\n<pre><code class=\"java\">private final static int TRUNK_IDLE = 0; private final static int TRUNK_BUSY = 1; private final static int TRUNK_UNKNOWN = -1; if (state == TRUNK_IDLE) {\n\nstate = TRUNK_BUSY;\n\n// program code\n\n}\n</code></pre>\n<h2 id=\"4-并发、线程、性能\"><a href=\"#4-并发、线程、性能\" class=\"headerlink\" title=\"4 并发、线程、性能\"></a>4 并发、线程、性能</h2><ol>\n<li>【强制】获取单例对象需要保证线程安全，其中的方法也要保证线程安全。说明：资源驱动类、工具类、单例工厂类都需要注意。</li>\n<li>【强制】创建线程或线程池时请指定有意义的线程名称，方便出错时回溯。正例：</li>\n</ol>\n<pre><code class=\"java\">public class TimerTaskThread extends Thread { \npublic TimerTaskThread() { \nsuper.setName(&quot;TimerTaskThread&quot;);\n\n...\n\n}\n</code></pre>\n<ol start=\"3\">\n<li><p>【强制】线程资源必须通过线程池提供，不允许在应用中自行显式创建线程。 说明：使用线程池的好处是减少在创建和销毁线程上所花的时间以及系统资源的开销，解决资 源不足的问题。如果不使用线程池，有可能造成系统创建大量同类线程而导致消耗完内存或者 “过度切换”的问题。</p>\n</li>\n<li><p>【强制】线程池不允许使用 Executors 去创建，而是通过 ThreadPoolExecutor 的方式，这样 的处理方式让写的同学更加明确线程池的运行规则，规避资源耗尽的风险。</p>\n</li>\n</ol>\n<p>说明：Executors 返回的线程池对象的弊端如下：</p>\n<blockquote>\n<p>FixedThreadPool 和 SingleThreadPool:</p>\n</blockquote>\n<p>允许的请求队列长度为Integer.MAX_VALUE，可能会堆积大量的请求，从而导致 OOM。</p>\n<blockquote>\n<p>CachedThreadPool 和 ScheduledThreadPool:</p>\n</blockquote>\n<p>允许的创建线程数量为Integer.MAX_VALUE，可能会创建大量的线程，从而导致OOM。</p>\n<ol start=\"5\">\n<li>【强制】SimpleDateFormat是线程不安全的类,一般不要定义为static变量,如果定义为static,必须加锁,或者使用JodaTime。</li>\n<li>【强制】在使用正则表达式时,利用好其预编译功能,可以有效加快正则匹配速度。说明:不要在方法体内定义:Pattern pattern = Pattern.compile(规则);</li>\n<li>【推荐】避免Random实例被多线程使用,虽然共享该实例是线程安全的,但会因竞争同一seed导致的性能下降。说明:Random实例包括java.util.Random的实例或者Math.random()的方式。</li>\n<li>【推荐】注意Math.random()这个方法返回是double类型,注意取值的范围0≤x&lt;1(能够 取到零值,注意除零异常),如果想获取整数类型的随机数, 不要将x放大10的若干倍然后取整,直接使用Random对象的nextInt或者nextLong法。</li>\n<li>【强制】并发修改同一记录时，避免更新丢失，需要加锁。要么在应用层加锁，要么在缓存加 锁，要么在数据库层使用乐观锁，使用 version 作为更新依据。</li>\n</ol>\n<blockquote>\n<p>说明:如果每次访问冲突概率小于20%，推荐使用乐观锁，否则使用悲观锁。乐观锁的重试次 数不得小于3次。 </p>\n</blockquote>\n<p>10.【强制】多线程并行处理定时任务时，Timer 运行多个 TimeTask 时，只要其中之一没有捕获 抛出的异常，其它任务便会自动终止运行，使用ScheduledExecutorService 则没有这个问题。</p>\n<p>11.【推荐】循环体中的语句要考量性能,循环体是最容易发生性能问题的地方。以下操作尽量移至循环体外处理,如定义对象、变量、获取数据库连接,进行不必要的try-catch 操作(这个try-catch是否可以移至循环体外)。</p>\n<p>12.【强制】循环体内字符串的连接方式,使用StringBuilder的append方法进行扩展。</p>\n<p>说明:反编译出的字节码文件显示每次循环都会new出一个StringBuilder对象,然后进行append操作,最后通过toString方法返回String对象,造成内存资源浪费。</p>\n<p>反例:</p>\n<pre><code class=\"java\">String str = &quot;start&quot;;\n\nfor (int i = 0; i &lt; 100; i++) { \n  str = str + &quot;hello&quot;;\n}\n</code></pre>\n<p>13.【推荐】任何数据结构的构造或初始化,都应指定大小,避免数据结构无限增长吃光内存。</p>\n<p>14.【推荐】<a href=\"http://www.cnblogs.com/DreamDrive/p/5422175.html\" target=\"_blank\" rel=\"noopener\">在明确的场景下,为集合指定初始容量</a>。</p>\n<p>说明:集合有默认大小，首先每次新增时都会判断是否达到临界点，且当长度不足时动态扩展严重影响性能。</p>\n<p>15.【强制】使用entrySet遍历Map类集合KV,而不是keySet方式进行遍历。</p>\n<p>说明:keySet其实是遍历了2次,一次是转为Iterator对象,另一次是从hashMap中取出key所对应的value。而entrySet只是遍历了一次就把key和value 都放到了 entry中,效率更高。</p>\n<p>\\16. 【推荐】高度注意 Map 类集合 K/V 能不能存储 null 值的情况，如下表格：</p>\n<table>\n<thead>\n<tr>\n<th>集合类</th>\n<th>Key</th>\n<th>Value</th>\n<th>Super</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Hashtable</td>\n<td>不允许为null</td>\n<td>不允许为null</td>\n<td>Dictionary</td>\n<td>线程安全</td>\n</tr>\n<tr>\n<td>ConcurrentHashMap</td>\n<td>不允许为 null</td>\n<td>不允许为 nul</td>\n<td>AbstractMap</td>\n<td>锁分段技术</td>\n</tr>\n<tr>\n<td>TreeMap</td>\n<td>不允许为 nul</td>\n<td>允许为 null</td>\n<td>AbstractMap</td>\n<td>线程不安全</td>\n</tr>\n<tr>\n<td>HashMap</td>\n<td>允许为 null</td>\n<td>允许为 null</td>\n<td>AbstractMap</td>\n<td>线程不安全</td>\n</tr>\n</tbody>\n</table>\n<p>反例： 由于 HashMap 的干扰，很多人认为 ConcurrentHashMap 是可以置入 null 值，而事实上， 存储 null 值时会抛出 NPE 异常。</p>\n<h2 id=\"5-日志\"><a href=\"#5-日志\" class=\"headerlink\" title=\"5 日志\"></a>5 日志</h2><p>1.【强制】不允许使用System.out.print，也不可直接使用日志系统(Log4j、Logback)中的API,而应依赖使用日志框架SLF4J中的API,使用门面模式的日志框架,有利于维护和各个类的日志处理方式统一和更换日志系统。</p>\n<p>说明：日志框架可以设定级别，可以控制输出到哪里，容易区分是在代码的什么地方打印的，而System.out.print则不行。而且System.out.print的速度很慢。所以，除非是有意的，否则都要用日志框架。至少在提交到版本库之前把System.out.print换成日志框架。</p>\n<p>正例：</p>\n<pre><code class=\"java\">import org.slf4j.Logger;\n\nimport org.slf4j.LoggerFactory; public class Demo {\n\nprivate static final Logger logger = LoggerFactory.getLogger(Abc.class);\n\n}\n</code></pre>\n<p>2.【强制】避免重复打印日志,浪费磁盘空间,务必在log4j.xml或logback.xml中设置 additivity=false。正例:</p>\n<logger name=\"com.iflytek.lx.config\" additivity=\"false\">\n\n<p>3.【强制】生产环境禁止输出debug、trace和其他调试日志；相应的，生产环境一定要记录下错误日志和异常异常，利于现网故障或用户投诉时排查问题。</p>\n<p>说明：谨慎地根据需要配置日志级别。例如测试环境可以打开info日志，性能测试需要关闭debug和其他调试日志，保持与生存环境一致。日志的级别由高到低分别为：ERROR &gt;&gt; WARN &gt;&gt; INFO &gt;&gt; DEBUG &gt;&gt; TRACE。</p>\n<ul>\n<li>Error：用于记录影响系统正常运行的一切信息，包括：Throwable、Error、Exception、与其他系统通讯错误，例如：SQL执行异常、其他系统返回的错误信息；</li>\n</ul>\n<ul>\n<li>Warn：用于记录不影响系统正常运行，但需要注意需要及时解决，例如：某个信息；                                        Info：通常生产环境的最低级别，用于记录这种重要的提示信息，例如：各种通讯信息，关键的提示信息，以及这种需要在生产环境下提示的信息；</li>\n<li>Debug： 记录一些详细的数据，比如我们想知道一个方法的多个入参值，那么在生产环境中，一般不会打印出来，在开发阶段和调试阶段，建议使用debug进行记录查看。在生产环境中将不会出现此类信息（当然可能在某些特定情况下，通过特殊手段某一时间段打开用于生产环境调试）。</li>\n<li>Trace：用于代替System.out.println()和System.err.println()，供开发阶段调试用。</li>\n</ul>\n<p>4.【推荐】在生产环境中配置日志框架自动加载刷新，即不重启应用就可以调整日志的配置。例如在logback.xml的配置中开源加上：</p>\n<pre><code class=\"xml\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n\n&lt;configuration scan=&quot;true&quot; scanPeriod=&quot;60 seconds&quot;&gt;\n\n&lt;/configuration&gt;\n</code></pre>\n<h2 id=\"6-异常\"><a href=\"#6-异常\" class=\"headerlink\" title=\"6 异常\"></a>6 异常</h2><p>1.【强制】不允许使用printStackTrace打印异常日志。</p>\n<p>2.【强制】记录异常日志时不要只保存exception.getMessage()，记录整个异常堆栈信息。</p>\n<p>3.【强制】捕获异常是为了处理它,不要捕获了却什么都不处理而抛弃之,如果不想处理它,请将该异常抛给它的调用者。另外自己抛出的异常必须要填写详细的描述信息，且必须保留原来的异常，便于问题定位，例如：throw new IOException(“Writing data error! Data: “ + data. toString(), e)。</p>\n<p>4.【强制】不能在finally块中使用return,finally块中的return返回后方法结束执行,不会再执行try块中的return语句。</p>\n<p>5.【强制】finally块必须对资源对象、流对象进行关闭，例如数据库操作、IO操作,且有异常也要进行try-catch，因为finally块中如果发生异常, 不会再执行try块中的return语句。</p>\n<p>6.【推荐】防止NullPointerException,IndexOutOfBoundsException是程序员的基本修养,代码中可以通过预先检查进行规避,而不应该通过catch来处理。</p>\n<p>正例:</p>\n<p>if (obj != null) {</p>\n<p>…</p>\n<p>}</p>\n<p>反例: try {</p>\n<p>obj.method();</p>\n<p>} catch (NullPointerException e) {</p>\n<p>…</p>\n<p>}</p>\n<h2 id=\"7-其他\"><a href=\"#7-其他\" class=\"headerlink\" title=\"7 其他\"></a>7 其他</h2><p>1.【强制】关于hashCode和equals的处理,遵循如下规则:</p>\n<p>** 只要重写equals,就必须重写 hashCode。</p>\n<p>** 因为Set存储的是不重复的对象,依据hashCode和equals进行判断,所以Set存储的对象必须重写这两个方法。</p>\n<p>** 如果自定义对象做为Map的键,那么必须重写hashCode和equals。</p>\n<p>说明:String重写了hashCode和equals方法,所以我们可以非常愉快地使用String 对象作为key来使用。2.【强制】所有的覆写方法,必须加@Override注解。</p>\n<p>3.【强制】不能使用过时的类或方法。       4.【推荐】慎用Object的clone方法来拷贝对象。</p>\n<p>说明:对象的clone方法默认是浅拷贝,若想实现深拷贝需要重写clone方法实现属性对象的拷贝。                                       5.【推荐】POJO类重写toString方法。使用 IDE 的中工具：source&gt; generate toString 时，如果继承了另一个 POJO 类，注意在前面加一下super.toString。</p>\n<p>说明：在方法执行抛出异常时，可以直接调用 POJO 的 toString()方法打印其属性值，便于排查问题。或者使用lombok插件，自动生成toString()方法。使用lomok可以防止在getter/setter加入业务逻辑。</p>\n<p>6.【强制】不要在foreach循环里进行集合元素的remove/add操作。remove 元素请使用 Iterator 方式，如果并发操作，需要对 Iterator 对象加锁。</p>\n<p>7.【推荐】使用索引访问用String的split方法得到的数组时,做边界检查,否则会有抛IndexOutOfBoundsException的风险。</p>\n<p>8.【强制】禁止在代码中显示调用System.gc()。</p>\n<p>9.【强制】避免通过一个类的对象引用访问此类的静态变量或静态方法,无谓增加编译器解析成本,直接用类名来访问即可。正例：</p>\n<p>Foo.aStaticMethod(); // good反例：</p>\n<p>Foo aFoo = …; aFoo.aStaticMethod();</p>\n<p>somethingThatYieldsAFoo().aStaticMethod();</p>\n<p>10.【推荐】类成员与方法访问控制从严，不是必须使用public属性的，请使用protected，不是必须使用protected,请使用private。</p>\n<p><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE18.tmp.png\" alt=\"img\"><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE28.tmp.png\" alt=\"img\">如果不允许外部直接通过new来创建对象,那么构造方法必须是private。</p>\n<p>** 工具类不允许有public或default构造方法。</p>\n<p>** 类非static成员变量并且与子类共享,必须是protected。</p>\n<p>** 类非static成员变量并且仅在本类使用,必须是private。</p>\n<p>** 类static成员变量如果仅在本类使用,必须是private。</p>\n<p>** 若是 static 成员变量,必须考虑是否为final。</p>\n<p>** 类成员方法只供类内部调用,必须是private。</p>\n<p><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE29.tmp.png\" alt=\"img\">类成员方法只对继承类公开,那么限制为protected。</p>\n<p>说明:良好的程序设计应该尽可能减小类与类之间耦合，所遵循的经验法则是：尽量限制成员函数的可见性。</p>\n<p>11.【强制】在一个项目组内开发环境、测试环境、生产环境使用统一版本的JDK。</p>\n<p>说明:不同版本的JDK编译出来的class不一样，可能存在冲突，不同版本的JDK也会带来莫名奇妙的问题且很难定位，所以一开始就要求必须统一。</p>\n<p>12.【推荐】避免出现重复的代码(Don’t Repeat Yourself),即DRY原则。</p>\n<p>说明:随意复制和粘贴代码,必然会导致代码的重复,在以后需要修改时,需要修改所有的副本,容易遗漏。必要时抽取共性方法,或者抽象公共类,甚至是共用模块。</p>\n<p>13.【推荐】在代码中使用”抛异常”还是”返回错误码”,对于公司外的 http/api 开放接口必须使用”错误码”;而应用内部推荐异常抛出;跨应用间RPC 调用优先考虑使用Result方式,封装isSuccess()方法、”错误码”、”错误简短信息”。</p>\n<p>说明:关于RPC方法返回方式使用Result方式的理由:</p>\n<p><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE3A.tmp.png\" alt=\"img\">使用抛异常返回方式,调用方如果没有捕获到就会产生运行时错误。</p>\n<p><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE3B.tmp.png\" alt=\"img\">如果不加栈信息,只是new自定义异常,加入自己的理解的error message,对于调用端解决问题的帮助不会太多。如果加了栈信息,在频繁调用出错的情况下,数据序列化和传输的性能损耗也是问题。</p>\n<p>14.【推荐】logback比log4j性能要好很多，但是logback和log4j互斥，只能使用其中之一。因此，使用logback需要排除掉log4j依赖所有相关jar 包依赖，且为了兼容一些二方库、三方库（可能使用了log4j），需要引入引入log4j-over-slf4j.jar; 15.【推荐】对于”明确停止使用的代码和配置”,如方法、变量、类、配置文件、动态配置属性等要坚决从程序中清理出去,避免造成过多垃圾。</p>\n<h1 id=\"系统工程\"><a href=\"#系统工程\" class=\"headerlink\" title=\"系统工程\"></a>系统工程</h1><h2 id=\"1-工程化\"><a href=\"#1-工程化\" class=\"headerlink\" title=\"1 工程化\"></a>1 工程化</h2><p>1.【推荐】针对业务形态，工程分为以下几种情况：</p>\n<p><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE3C.tmp.png\" alt=\"img\">Web工程</p>\n<p><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE4D.tmp.png\" alt=\"img\"><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE4E.tmp.png\" alt=\"img\">web-应用名，以”web-“前缀开头。Dubbo工程</p>\n<p><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE4F.tmp.png\" alt=\"img\"><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE5F.tmp.png\" alt=\"img\">service-应用名，以”service-“前缀开头。Interface工程</p>\n<p><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE60.tmp.png\" alt=\"img\"><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE71.tmp.png\" alt=\"img\">interface-应用名，以”interface-“前缀开头。工具或者任务</p>\n<p><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE72.tmp.png\" alt=\"img\"><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE73.tmp.png\" alt=\"img\">tool-应用名，以”tool-“前缀开头，或以”job-“前缀开头。Java公共Jar包</p>\n<p><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE84.tmp.png\" alt=\"img\">common-模块名，以”common-“前缀开头。</p>\n<p><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE85.tmp.jpg\" alt=\"img\">2.【推荐】J2SE项目工程结构</p>\n<p>说明：J2SE项目有两种情况：</p>\n<p>一个是小工具，可以独立运行，处理一些简单的业务，打包为zip包。</p>\n<p>另一个是公共开发包，打包为jar包。以API方式提供给其它应用程序，以专业专注的精神进行分包，例如：通信协议包，常用工具包，加密解密包等等。公共开发包可能无法独立运行，所有的服务API都需要进行单元测试，并要保证线程安全。</p>\n<h2 id=\"2-包管理、版本管理\"><a href=\"#2-包管理、版本管理\" class=\"headerlink\" title=\"2 包管理、版本管理\"></a>2 包管理、版本管理</h2><p>1.【推荐】Maven定义GAV遵从以下规则:</p>\n<p>* GroupID格式:com.{公司}.{部门}.业务线.[子业务线],最多4级。</p>\n<p>* 正例:com.iflytek.cbg.lx 或 com.iflytek.cgb.kuyin</p>\n<p><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE86.tmp.png\" alt=\"img\"><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE96.tmp.png\" alt=\"img\">ArtifactID格式:产品线名-模块名。语义不重复不遗漏,先到中央仓库去查证一下。正例:lx-web-user/lx-dubbo-user/lx-common</p>\n<p>* Version:详细规定参考下方。</p>\n<p>2.【推荐】二方库版本号命名方式:主版本号.次版本号.修订号</p>\n<p><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE97.tmp.png\" alt=\"img\"><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEE98.tmp.png\" alt=\"img\">主版本号:当做了不兼容的API修改,或者增加了能改变产品方向的新功能。次版本号:当做了向下兼容的功能性新增(新增类、接口等)。</p>\n<p><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEEA9.tmp.png\" alt=\"img\">修订号:修复bug,没有修改方法签名的功能加强,保持API兼容性。</p>\n<p>说明:正式发布的类库必须先去中央仓库进行查证,使版本号有延续性,正式版本号不允许覆盖升级。如当前版本:1.3.3,那么下一个合理的版本号: 1.3.4或1.4.0或2.0.0</p>\n<p>3.【推荐】线上应用不要依赖SNAPSHOT版本(安全包除外)。</p>\n<p>说明:不依赖SNAPSHOT版本是保证应用发布的幂等性。另外,也可以加快编译时的打包构建。</p>\n<p>4.【推荐】上传代码至svn时，项目相关的配置文件（.settings、.classpath、.project）不要上传本地调试文件，仅上传src文件夹、pom.xml或bin文件夹。</p>\n<p>5.【推荐】Maven工程需要在POM配置仓库地址，避免在本地maven setting中配置，其他组员check out后无法下载或者需要从远程仓库下载；</p>\n<h2 id=\"3-安全性\"><a href=\"#3-安全性\" class=\"headerlink\" title=\"3 安全性\"></a>3 安全性</h2><p>【备注】公司已经有大量项目被恶意攻击历史，所以研发必须提高安全意识和相关技术、方法、手段。</p>\n<p>1.【强制】对外提供的Http Api，必须进行签名、加密。</p>\n<p>2.【强制】用户敏感数据禁止直接展示,必须对展示数据进行脱敏。接口对敏感数据也必须加密，例如：用户密码。显示成<em>**</em></p>\n<p>3.【强制】隶属于用户个人的页面或者功能必须进行权限控制校验。</p>\n<p>说明：防止没有做水平权限校验就可随意访问、修改、删除别人的数据，比如查看他人的私信内容、修改他人的订单。</p>\n<p>3.【参考】用户请求传入的任何参数必须做有效性验证。说明:忽略参数校验可能导致:</p>\n<p>page size过大导致内存溢出</p>\n<p>恶意order by导致数据库慢查询任意重定向</p>\n<p>SQL注入</p>\n<p>4.【参考】表单、AJAX请求必须执行CSRF安全过滤。</p>\n<p>说明:CSRF(Cross-site request forgery)跨站请求伪造是一类常见编程漏洞。对于存在CSRF漏洞的应用/网站,攻击者可以事先构造好 URL,只要受害者用户一访问,后台便在用户不知情情况下对数据库中用户参数进行相应修改。</p>\n<p>5.【参考】在使用平台资源,譬如短信、邮件、电话、下单、支付,必须实现正确的防重放限制,如数量限制、疲劳度控制、验证码校验,避免被滥刷、资损。</p>\n<p>说明:如注册时发送验证码到手机,如果没有限制次数和频率,那么可以利用此功能骚扰到其它用户,并造成短信平台资源浪费。</p>\n<p>6.【参考】活动类需求，尤其是中奖类活动，必须实现防刷策略。</p>\n<h2 id=\"4-系统、服务器\"><a href=\"#4-系统、服务器\" class=\"headerlink\" title=\"4 系统、服务器\"></a>4 系统、服务器</h2><p>1.【推荐】高并发服务器建议调小TCP协议的time_wait超时时间。</p>\n<p>说明:操作系统默认240秒后,才会关闭处于time_wait状态的连接,在高并发访问下,服务器端会因为处于time_wait的连接数太多,可能无法建立新的连接,所以需要在服务器上调小此等待值。</p>\n<p>正例:在 linux服务器上请通过变更/etc/sysctl.conf文件去修改该缺省值(秒): net.ipv4.tcp_fin_timeout = 30</p>\n<p>2.【推荐】调大服务器所支持的最大文件句柄数(File Descriptor,简写为fd)。</p>\n<p>说明:主流操作系统的设计是将TCP/UDP连接采用与文件一样的方式去管理,即一个连接对应于一个fd。主流的linux服务器默认所支持最大fd数量为1024,当并发连接数很大时很容易因为fd不足而出现”open too many files”错误,导致新的连接无法建立。建议将linux服务器所支持的最大句柄数调高数倍(与服务器的内存数量相关)。</p>\n<p>3.【推荐】给JVM设置-XX:+HeapDumpOnOutOfMemoryError 参数,让JVM碰到OOM场景时输出dump信息。</p>\n<p>说明:OOM的发生是有概率的,甚至有规律地相隔数月才出现一例,出现时的现场信息对查错 非常有价值。</p>\n<p>4.【推荐】当生产环境组件异常、无响应、假死时，务必使用jstack dump线程堆栈，使用jstat –gcutil查看下gc信息，方便后期定位、分析问题。</p>\n<h1 id=\"七、MySql数据库\"><a href=\"#七、MySql数据库\" class=\"headerlink\" title=\"七、MySql数据库\"></a>七、MySql数据库</h1><h2 id=\"1-建表\"><a href=\"#1-建表\" class=\"headerlink\" title=\"1 建表\"></a>1 建表</h2><p>1.【推荐】使用InnoDB存储引擎、UTF-8(utf8mb4)字符集。</p>\n<p>2.【强制】表要有主键。</p>\n<p>3.【推荐】若业务上非实时一致性要求，禁止使用外键，由程序保证最终一致性。说明:外键会导致表与表之间耦合，影响sql性能，高并发下有可能会导致死锁。</p>\n<p>4.【推荐】表名、字段名必须使用小写字母或数字,禁止出现数字开头,禁止两个下划线中间只出现数字。数据库字段名的修改代价很大,因为无法进行预发布,所以字段名称需要慎重考虑。</p>\n<p>正例:getter_admin,task_config,level3_name反例:GetterAdmin,taskConfig,level_3_name</p>\n<p>5.【推荐】表名最好不使用复数名词。</p>\n<p>说明:表名应该仅仅表示表里面的实体内容,不应该表示实体数量。6.【推荐】表的命名最好是加上”模块名称_表名”。</p>\n<p>正例:score_rule / score_user /score_log</p>\n<p>7.【强制】千万不要使用mysql中关键字命名，例如：desc, order等；</p>\n<p>8.【推荐】如果修改字段含义或对字段表示的状态追加时,需要及时更新字段注释。</p>\n<p>9.【强制】主键索引名为pk_字段名;唯一索引名为uk_字段名;普通索引名则为idx_字段名。说明:pk_即 primary key;uk_即unique key;idx_即index的简称。</p>\n<p>10.【强制】所有字段定义为Not Null。说明：</p>\n<p><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEEAA.tmp.png\" alt=\"img\"><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEEBA.tmp.png\" alt=\"img\"><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEEBB.tmp.png\" alt=\"img\"><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEEBC.tmp.png\" alt=\"img\">null列影响索引。                     MySql内部需要对null进行特殊处理,会影响性能null需要更多的存储空间 null查询必须使用is 或is not,不能使用=、in等</p>\n<p>11.【强制】禁止使用ENUM类型。</p>\n<p>说明：增加新的枚举值时，需要DDL操作。</p>\n<p>12.【推荐】小数类型为decimal,禁止使用float和double。</p>\n<p>说明:float和double在存储的时候,存在精度损失的问题,很可能在值的比较时,得到不 正确的结果。如果存储的数据范围超过decimal的范围,建议将数据拆成整数和小数分开存储。</p>\n<p>13.【推荐】如果存储的字符串长度几乎相等,使用char定长字符串类型。                                                         varchar是可变长字符串,不预先分配存储空间,长度不要超过5000,如果存储长度大于此值,定义字段类型为text,独立出来一张表,用主键来对应,避免影响其它字段索引效率。</p>\n<p>14.【推荐】字段允许适当冗余,以提高查询性能,但必须考虑数据一致。冗余字段应遵循:</p>\n<p><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEECD.tmp.png\" alt=\"img\">不是频繁修改的字段。</p>\n<p><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEECE.tmp.png\" alt=\"img\">不是varchar超长字段,更不能是text字段。</p>\n<p>正例:商品类目名称使用频率高,字段长度短,名称基本一成不变,可在相关联的表中冗余存储类目名称,避免关联查询。</p>\n<p>15.【参考】合适的字符存储长度,不但节约数据库表空间、节约索引存储,更重要的是提升检索速度。</p>\n<h2 id=\"2-索引\"><a href=\"#2-索引\" class=\"headerlink\" title=\"2 索引\"></a>2 索引</h2><p>说明：务必用explain确认SQL语句是否走了索引。</p>\n<p>1.【参考】创建索引时避免有如下极端误解:</p>\n<p><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEECF.tmp.png\" alt=\"img\">宁滥勿缺。误认为一个查询就需要建一个索引。</p>\n<p><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEEE0.tmp.png\" alt=\"img\">宁缺勿滥。误认为索引会消耗空间、严重拖慢更新和新增速度。</p>\n<p><img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEEE1.tmp.png\" alt=\"img\">抵制惟一索引。误认为业务的惟一性一律需要在应用层通过”先查后插”方式解决。</p>\n<p>2.【强制】业务上具有唯一特性的字段,即使是多个字段的组合,也必须建成唯一索引。</p>\n<p>说明:不要以为唯一索引影响了insert速度,这个速度损耗可以忽略,但提高查找速度是明显的;另外,即使在应用层做了非常完善的校验控制,只要没有唯一索引,根据墨菲定律,必然有脏数据产生。</p>\n<p>3.【参考】建立组合索引，必须根据业务上的查询需求使用合理顺序。</p>\n<p>说明:联合索引左前缀原则：(a,b,c)只有查询条件为a|(a,b)|(a,b,c)才会走该组合索引，但跟条件顺序无关，例如：ba、bac、bca、cab都会走索引，而bc、ac不会走索引。</p>\n<p>4.【参考】负向查询(!=、not in、not exists)、前导模糊查询(like <img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEEE2.tmp.jpg\" alt=\"img\">xxx’)、在查询条件属性上进行函数计算、字段类型需强制转换都不会走索引。</p>\n<p>反例：</p>\n<p>select <em> from score where status!=2 select </em> from score where name like <img src=\"file:///C:\\Users\\Admin\\AppData\\Local\\Temp\\ksohtml\\wpsEEF2.tmp.jpg\" alt=\"img\">XX’</p>\n<p>select <em> from score where YEAR(create_time) &lt;= ‘2017’ select </em> from user where phone=13800001234</p>\n<p>6.【推荐】数据区分度不大的字段不宜使用索引，效果不明显。</p>\n<p>说明：”状态”、”性别”这种区分度不大的属性，建立索引是没有什么意义的，不能有效过滤数据，性能与全表扫描类似。反例：select * from user whre sex=1</p>\n<p>7.【推荐】OR查询最好改为IN查询。</p>\n<p>说明：InnoDB引擎中OR查询不能命中索引，MyISAM能命中索引，但会耗费更多的CPU。</p>\n<p>8.【推荐】超过三个表不要使用join。需要join的字段,数据类型必须绝对一致;多表关联查询时,保证被关联的字段需要有索引。说明:即使双表join也要注意表索引、SQL性能。</p>\n<p>9.【推荐】如果有order by的场景,请注意利用索引的有序性。order by最后的字段是组合 索引的一部分,并且放在索引组合顺序的最后,避免出现file_sort的情况,影响查询性能。</p>\n<p>正例:where a=? and b=? order by c; 索引:a_b_c</p>\n<p>反例:索引中有范围查找,那么索引有序性无法利用,如:WHERE a&gt;10 ORDER BY b;索引a_b无法排序。10.建组合索引的时候,区分度最高的在最左边。</p>\n<p>正例:如果where a=? and b=? ,a列的几乎接近于唯一值,那么只需要单建 idx_a索引即可。</p>\n<p>说明:存在非等号和等号混合判断条件时,在建索引时,请把等号条件的列前置。如:where a&gt;? and b=?那么即使a的区分度更高,也必须把b放在索引的最前列。</p>\n<h2 id=\"3-SQL语句\"><a href=\"#3-SQL语句\" class=\"headerlink\" title=\"3 SQL语句\"></a>3 SQL语句</h2><p>1.【推荐】尽量不要使用select *。</p>\n<p>2.【推荐】禁止大表使用join，禁止大表使用子查询。</p>\n<p>3.【推荐】不要使用count(列名)或count(常量)来替代count,count(<em>)是SQL92定义的标准统计行数的语法,跟数据库无关,跟NULL和非NULL无关。说明:count(</em>)会统计值为NULL的行,而count(列名)不会统计此列为NULL值的行。</p>\n<p>4.【强制】使用ISNULL()来判断是否为NULL值。注意:NULL与任何值的直接比较都为NULL。</p>\n<blockquote>\n<p>说明:</p>\n<p>NULL&lt;&gt;NULL的返回结果是NULL,而不是false。</p>\n<p>NULL=NULL的返回结果是NULL,而不是true。</p>\n<p>* NULL&lt;&gt;1的返回结果是NULL,而不是true。</p>\n</blockquote>\n<p>5.【推荐】在代码中写分页查询逻辑时,若count为0应直接返回,避免执行后面的分页语句。</p>\n<p>6.【推荐】不要使用存储过程,存储过程难以调试和扩展,更没有移植性。</p>\n<h2 id=\"4其他\"><a href=\"#4其他\" class=\"headerlink\" title=\"4其他\"></a>4其他</h2><p>1.【强制】不要使用BLOB相关类型存储大文件或者大照片。说明：文件应使用文件系统存储，数据库存文件的URI</p>\n<p>2.【推荐】把计算尽量放到业务层(代码层)而不是数据库层，可以节省数据库服务的CPU资源，还可以根据场景在业务层进行缓存等优化，减少数据库压力。</p>\n</logger>"}],"PostAsset":[],"PostCategory":[{"post_id":"cjs17mhwv0000pwgtbiej17tw","category_id":"cjs17mhxa0003pwgt2rtg8eao","_id":"cjs17mhxp000dpwgtgvp1x43s"},{"post_id":"cjs17mhx70002pwgtoh6yd5uy","category_id":"cjs17mhxk0008pwgt2jyuhmhe","_id":"cjs17mhxx000jpwgteqtgfim6"},{"post_id":"cjs17mhxf0005pwgtt93vndu4","category_id":"cjs17mhxq000epwgt17dv8gt1","_id":"cjs17mhy4000ppwgt749z6k3r"},{"post_id":"cjs17mhxh0006pwgt02t19za6","category_id":"cjs17mhxy000kpwgt36z6692h","_id":"cjs17mhya000wpwgt2oh49p9q"},{"post_id":"cjs17mhxj0007pwgtootdppb8","category_id":"cjs17mhy4000rpwgt8oszlvvj","_id":"cjs17mhyh0013pwgtj00sinc9"},{"post_id":"cjs17mhxm000bpwgt59zib5x7","category_id":"cjs17mhyc000ypwgtb26kekp8","_id":"cjs17mhyl001apwgtklesmksn"},{"post_id":"cjs17mhxo000cpwgtw26wjzj0","category_id":"cjs17mhyi0015pwgtiq2z5b2z","_id":"cjs17mhyq001gpwgtye1x7k20"},{"post_id":"cjs17mhxr000gpwgt24q2cb2h","category_id":"cjs17mhym001cpwgt1trqwtav","_id":"cjs17mhyr001kpwgthlpnhv4w"},{"post_id":"cjs17mhxw000ipwgt9cvnayhd","category_id":"cjs17mhyr001ipwgt3hnvuitz","_id":"cjs17mhyt001opwgt3rgkezzg"},{"post_id":"cjs17mhxz000mpwgtqe3n8elr","category_id":"cjs17mhys001mpwgt8s2l7rb4","_id":"cjs17mhyu001spwgt3f6yvdtq"},{"post_id":"cjs17mhy2000opwgtaus3nga7","category_id":"cjs17mhyt001qpwgt9x9cij8b","_id":"cjs17mhyv001wpwgt1m5dargp"},{"post_id":"cjs17mhy5000tpwgthxwpk01k","category_id":"cjs17mhyu001upwgt4okph8kr","_id":"cjs17mhyw0020pwgtikyi1pf4"},{"post_id":"cjs17mhy7000vpwgt1l8udfpo","category_id":"cjs17mhyv001ypwgtol97hcef","_id":"cjs17mhyy0025pwgtak94t3ob"},{"post_id":"cjs17mhyb000xpwgtulk0ghv1","category_id":"cjs17mhyw0022pwgt51b5cyqx","_id":"cjs17mhyz0029pwgt1lwjcufo"},{"post_id":"cjs17mhye0011pwgtq2josenk","category_id":"cjs17mhyy0026pwgtfrqh6jqc","_id":"cjs17mhz0002cpwgtey2cicb1"},{"post_id":"cjs17mhyg0012pwgtwvpbybsf","category_id":"cjs17mhyz002apwgtmlryt46i","_id":"cjs17mhz0002fpwgtvd71miun"},{"post_id":"cjs17mhyj0017pwgtor1u8hjt","category_id":"cjs17mhz0002dpwgti9opa8yu","_id":"cjs17mhz1002hpwgtocnytj57"},{"post_id":"cjs17mhyk0019pwgtblrtjtyv","category_id":"cjs17mhz1002gpwgtfoqrdfqh","_id":"cjs17mhz2002jpwgtcx96n71k"},{"post_id":"cjs17mhyn001epwgt9tcvndgn","category_id":"cjs17mhz1002ipwgtnvytkfqi","_id":"cjs17mhz2002kpwgt30re7z5n"},{"post_id":"cjs17mi04002mpwgth6ykxlda","category_id":"cjs17mi08002ppwgtikpfx5xg","_id":"cjs17mi0k0034pwgtn2ctmncb"},{"post_id":"cjs17mi06002opwgtu2t6dnf9","category_id":"cjs17mi0g002zpwgtxykezxcp","_id":"cjs17mi0o0039pwgtohjmhvj5"},{"post_id":"cjs17mi09002spwgtetmc4l31","category_id":"cjs17mi0l0035pwgt7plxd258","_id":"cjs17mi0p003cpwgtudqc5qbq"},{"post_id":"cjs17mi0c002vpwgtsrv5u09v","category_id":"cjs17mi0o003apwgtpe5wdhhz","_id":"cjs17mi0r003fpwgtjixdmqw4"},{"post_id":"cjs17mi0f002ypwgtdz65rhps","category_id":"cjs17mi0q003dpwgt7oy7ysyp","_id":"cjs17mi0s003hpwgtf350h15c"},{"post_id":"cjs17mi0h0031pwgtxyrkof3w","category_id":"cjs17mi0r003gpwgtstewe422","_id":"cjs17mi0t003jpwgt7dmccnb3"},{"post_id":"cjs17mi0j0033pwgt7qnl8kz4","category_id":"cjs17mi0s003ipwgt8mqggx43","_id":"cjs17mi0u003lpwgtpi8gefnt"},{"post_id":"cjs17mi0m0037pwgty65mfe6l","category_id":"cjs17mi0t003kpwgt1u7ha4n6","_id":"cjs17mi0v003mpwgta6yf5rpk"},{"post_id":"cjs17mi1p003npwgt9ft1w5o4","category_id":"cjs17mi1t003ppwgtfcid8as0","_id":"cjs17mi20003wpwgt0gymktim"},{"post_id":"cjs17mi1s003opwgtdne5xjny","category_id":"cjs17mi1y003upwgtcmg0vnhg","_id":"cjs17mi21003ypwgtdz53w18y"},{"post_id":"cjs17mi1u003rpwgts2s1a1jb","category_id":"cjs17mi20003xpwgtl70p6rky","_id":"cjs17mi22003zpwgt8kkv4ms2"},{"post_id":"cjs17mi3l0040pwgtn46z0cyo","category_id":"cjs17mi3n0041pwgtwuo69916","_id":"cjs17mi3o0044pwgt0iepzg28"}],"PostTag":[{"post_id":"cjs17mhwv0000pwgtbiej17tw","tag_id":"cjs17mhxe0004pwgtx6nfexco","_id":"cjs17mhxm000apwgtay0syri1"},{"post_id":"cjs17mhx70002pwgtoh6yd5uy","tag_id":"cjs17mhxl0009pwgtgvdyz6e6","_id":"cjs17mhxv000hpwgtosj8sayt"},{"post_id":"cjs17mhxf0005pwgtt93vndu4","tag_id":"cjs17mhxq000fpwgtb6oqp9yf","_id":"cjs17mhy1000npwgt0rf8ao42"},{"post_id":"cjs17mhxz000mpwgtqe3n8elr","tag_id":"cjs17mhxq000fpwgtb6oqp9yf","_id":"cjs17mhy4000qpwgtp374kje4"},{"post_id":"cjs17mhxh0006pwgt02t19za6","tag_id":"cjs17mhxy000lpwgt5l49zfrj","_id":"cjs17mhy7000upwgt209q8omu"},{"post_id":"cjs17mhxj0007pwgtootdppb8","tag_id":"cjs17mhy5000spwgtnz13ms4e","_id":"cjs17mhye0010pwgtmt1vsc0k"},{"post_id":"cjs17mhye0011pwgtq2josenk","tag_id":"cjs17mhxq000fpwgtb6oqp9yf","_id":"cjs17mhyi0016pwgttt2g61o1"},{"post_id":"cjs17mhxm000bpwgt59zib5x7","tag_id":"cjs17mhy5000spwgtnz13ms4e","_id":"cjs17mhyk0018pwgtlt9hmj3j"},{"post_id":"cjs17mhyj0017pwgtor1u8hjt","tag_id":"cjs17mhyh0014pwgtioglk6fc","_id":"cjs17mhym001dpwgtxtgl3ww0"},{"post_id":"cjs17mhxo000cpwgtw26wjzj0","tag_id":"cjs17mhyh0014pwgtioglk6fc","_id":"cjs17mhyp001fpwgtkkne9aj3"},{"post_id":"cjs17mhxr000gpwgt24q2cb2h","tag_id":"cjs17mhyl001bpwgtybk9jauu","_id":"cjs17mhyr001jpwgta1y1dwe7"},{"post_id":"cjs17mhxw000ipwgt9cvnayhd","tag_id":"cjs17mhyq001hpwgt7m792p8q","_id":"cjs17mhys001npwgtcyew6zs3"},{"post_id":"cjs17mhy2000opwgtaus3nga7","tag_id":"cjs17mhys001lpwgtckw4zy7n","_id":"cjs17mhyu001rpwgt1u8o9q8a"},{"post_id":"cjs17mhy5000tpwgthxwpk01k","tag_id":"cjs17mhyt001ppwgttcm49c78","_id":"cjs17mhyv001vpwgtvstfk2im"},{"post_id":"cjs17mhy7000vpwgt1l8udfpo","tag_id":"cjs17mhyu001tpwgtqmnevtmf","_id":"cjs17mhyw001zpwgtcglx84g6"},{"post_id":"cjs17mhyb000xpwgtulk0ghv1","tag_id":"cjs17mhyv001xpwgt2dkd3wpy","_id":"cjs17mhyx0023pwgt2zm0kldf"},{"post_id":"cjs17mhyg0012pwgtwvpbybsf","tag_id":"cjs17mhyt001ppwgttcm49c78","_id":"cjs17mhyy0027pwgtb7n4z1pe"},{"post_id":"cjs17mhyk0019pwgtblrtjtyv","tag_id":"cjs17mhyx0024pwgtsoyttnmn","_id":"cjs17mhyz002bpwgts83jyk0x"},{"post_id":"cjs17mhyn001epwgt9tcvndgn","tag_id":"cjs17mhyz0028pwgt194frpsd","_id":"cjs17mhz0002epwgtgy38auru"},{"post_id":"cjs17mi04002mpwgth6ykxlda","tag_id":"cjs17mhyu001tpwgtqmnevtmf","_id":"cjs17mi08002qpwgtlkp8wkhe"},{"post_id":"cjs17mi06002opwgtu2t6dnf9","tag_id":"cjs17mhyu001tpwgtqmnevtmf","_id":"cjs17mi0b002tpwgtczw448wx"},{"post_id":"cjs17mi09002spwgtetmc4l31","tag_id":"cjs17mhyu001tpwgtqmnevtmf","_id":"cjs17mi0e002wpwgtawn94sn3"},{"post_id":"cjs17mi0c002vpwgtsrv5u09v","tag_id":"cjs17mhyu001tpwgtqmnevtmf","_id":"cjs17mi0h0030pwgtq8hnaglv"},{"post_id":"cjs17mi0f002ypwgtdz65rhps","tag_id":"cjs17mhyu001tpwgtqmnevtmf","_id":"cjs17mi0j0032pwgtu55h3q2o"},{"post_id":"cjs17mi0h0031pwgtxyrkof3w","tag_id":"cjs17mhys001lpwgtckw4zy7n","_id":"cjs17mi0l0036pwgtp8t77764"},{"post_id":"cjs17mi0j0033pwgt7qnl8kz4","tag_id":"cjs17mhyl001bpwgtybk9jauu","_id":"cjs17mi0n0038pwgt4wbnpuen"},{"post_id":"cjs17mi0m0037pwgty65mfe6l","tag_id":"cjs17mi0o003bpwgteflmijq1","_id":"cjs17mi0q003epwgtd6oyni9m"},{"post_id":"cjs17mi1s003opwgtdne5xjny","tag_id":"cjs17mhys001lpwgtckw4zy7n","_id":"cjs17mi1w003spwgtwxuo8lq9"},{"post_id":"cjs17mi1u003rpwgts2s1a1jb","tag_id":"cjs17mhyu001tpwgtqmnevtmf","_id":"cjs17mi1x003tpwgtp1j3qqj4"},{"post_id":"cjs17mi1p003npwgt9ft1w5o4","tag_id":"cjs17mi1t003qpwgta7ko2ovq","_id":"cjs17mi1z003vpwgtz9adum32"},{"post_id":"cjs17mi3l0040pwgtn46z0cyo","tag_id":"cjs17mi3n0042pwgtqrd21z9r","_id":"cjs17mi3o0043pwgt26o5shws"}],"Tag":[{"name":"安装教程","_id":"cjs17mhxe0004pwgtx6nfexco"},{"name":"Git","_id":"cjs17mhxl0009pwgtgvdyz6e6"},{"name":"Java工具类","_id":"cjs17mhxq000fpwgtb6oqp9yf"},{"name":"Js","_id":"cjs17mhxy000lpwgt5l49zfrj"},{"name":"Linux","_id":"cjs17mhy5000spwgtnz13ms4e"},{"name":"Maven","_id":"cjs17mhyh0014pwgtioglk6fc"},{"name":"RESTful","_id":"cjs17mhyl001bpwgtybk9jauu"},{"name":"MySQL","_id":"cjs17mhyq001hpwgt7m792p8q"},{"name":"道","_id":"cjs17mhys001lpwgtckw4zy7n"},{"name":"干货","_id":"cjs17mhyt001ppwgttcm49c78"},{"name":"Spring Boot","_id":"cjs17mhyu001tpwgtqmnevtmf"},{"name":"idea","_id":"cjs17mhyv001xpwgt2dkd3wpy"},{"name":"文章","_id":"cjs17mhyx0024pwgtsoyttnmn"},{"name":"跨域","_id":"cjs17mhyz0028pwgt194frpsd"},{"name":"Js工具类","_id":"cjs17mi0o003bpwgteflmijq1"},{"name":"Spring Cloud","_id":"cjs17mi1t003qpwgta7ko2ovq"},{"name":"规范","_id":"cjs17mi3n0042pwgtqrd21z9r"}]}}